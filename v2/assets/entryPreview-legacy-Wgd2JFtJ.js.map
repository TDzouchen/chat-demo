{"version":3,"file":"entryPreview-legacy-Wgd2JFtJ.js","sources":["packages/shared/src/utils/convertCssVariables.ts","packages/shared/src/utils/injectCssVariables.ts","packages/shared/src/utils/injectStyle.ts","packages/shared/src/utils/json.ts","packages/chat-widget-sdk/src/entryPreview.ts","packages/chat-widget-sdk/src/Preview.ts","packages/chat-widget-sdk/src/WidgetElement/WidgetWrapper.ts","packages/shared/src/utils/hasElement.ts","packages/chat-widget-sdk/src/WidgetElement/WidgetTrigger.ts","packages/chat-widget-sdk/src/WidgetElement/WidgetTriggerAnimate.ts","packages/chat-widget-sdk/src/WidgetElement/WidgetFrame.ts","packages/chat-widget-sdk/src/WidgetElement/elements.ts","packages/chat-widget-sdk/src/styles.ts","node_modules/events/events.js","packages/shared/src/utils/moveElement.ts","packages/shared/src/rpc/index.ts","node_modules/@td-org/digital-postmessage-rpc/dist/index.esm.js","packages/chat-widget-sdk/src/utils/storage.ts","packages/chat-widget-sdk/src/utils/getTriggerButtonStyles.ts","packages/chat-widget-sdk/src/utils/validVersion.ts"],"sourcesContent":["function isUpperCase(char: string): boolean {\n  const code = char.charCodeAt(0)\n  return code >= 65 && code <= 90\n}\n\nfunction convertKey(key: string): string {\n  const result = [...key]\n    .map((c, index) => {\n      if (isUpperCase(c)) {\n        return index === 0 ? c.toLowerCase() : '-' + c.toLowerCase()\n      } else {\n        return c\n      }\n    })\n    .join('')\n\n  return `--${result}`\n}\nexport function convertCssVariables<Element extends HTMLElement>(\n  target: Element,\n  themes: Record<string, string>\n): Record<string, string> {\n  const themeKeys = Object.keys(themes)\n\n  if (themeKeys.length) {\n    return themeKeys.reduce(\n      (acc, key) => {\n        if (key.indexOf('-') > -1 || key.indexOf('_') > -1) {\n          return acc\n        } else {\n          target.style.setProperty(convertKey(key), themes[key])\n          return { ...acc, [convertKey(key)]: themes[key] }\n        }\n      },\n      {} as Record<string, string>\n    )\n  }\n\n  return {} as Record<string, string>\n}\n","import { Theme } from '../types/Theme'\n\nimport { convertCssVariables } from './convertCssVariables'\n\nexport function injectCssVariables<Element extends HTMLElement>(selector: string | Element, styles: Partial<Theme>) {\n  let target: HTMLElement | null\n\n  if (typeof selector === 'string') {\n    target =\n      selector.indexOf('#') > -1 ? document.querySelector<HTMLElement>(selector) : document.getElementById(selector)\n  } else {\n    target = selector\n  }\n\n  if (target) {\n    return convertCssVariables(target, styles)\n  }\n}\n","function createStyleElement(id: string): HTMLStyleElement {\n  const styleElement = document.createElement('style')\n  styleElement.id = id\n  return styleElement\n}\n\nfunction getExistStyleElement(id: string, injector: HTMLElement): HTMLStyleElement | null {\n  return injector.querySelector<HTMLStyleElement>(`#${id}`)\n}\n\nexport function injectStyle(css: string, id: string, injector: HTMLElement = document.head): () => void {\n  const existStyleElement = getExistStyleElement(id, injector)\n  if (existStyleElement) {\n    existStyleElement.innerHTML = css\n\n    return () => {\n      const removeStyleElement = getExistStyleElement(id, injector)\n      if (removeStyleElement) {\n        injector.removeChild(removeStyleElement)\n      }\n    }\n  } else {\n    const styleElement = createStyleElement(id)\n    styleElement.innerHTML = css\n    injector.appendChild(styleElement)\n\n    return () => {\n      const removeStyleElement = getExistStyleElement(id, injector)\n      if (removeStyleElement) {\n        injector.removeChild(removeStyleElement)\n      }\n    }\n  }\n}\n","export function safeJsonToString<T>(target: T, onError?: (e: unknown) => void) {\n  try {\n    return JSON.stringify(target)\n  } catch (e) {\n    onError?.(e)\n    return ''\n  }\n}\n\nexport function safeJsonParse<T>(target: string, defaultValue: T, onError?: (e: unknown) => void) {\n  try {\n    return JSON.parse(target) as T\n  } catch (e) {\n    onError?.(e)\n    return defaultValue\n  }\n}\n","import Preview from './Preview'\n\nexport type PreviewSDK = ReturnType<typeof Preview>\n\nfunction entryPoint(injector: string): PreviewSDK {\n  return Preview(injector)\n}\n\nexport default entryPoint\n","import { type AppConfig, type PreviewConfig, RpcConstants, safeJsonToString } from '@td-org/chat-widget-shared'\nimport RPC from '@td-org/digital-postmessage-rpc'\n\nimport storage from './utils/storage'\nimport { injectStyles, listenerScreenChange, updateThemes } from './styles'\nimport { WidgetFrame, WidgetTrigger, WidgetWrapper } from './WidgetElement'\n\ntype Callback = () => void\n\nexport default function Preview(injector: string) {\n  const root = document.getElementById(injector)\n  if (!root) {\n    throw new Error(`The element not exist, element id = \"#${injector}\"`)\n  }\n\n  const cleanups: Callback[] = []\n\n  let rpc: RPC | null = null\n  let previewReady = false\n  let _previewConfig: PreviewConfig | null = null\n  let unListenerScreenChange: (() => void) | null = null\n\n  const widgetWrapper = WidgetWrapper({ root, isPreview: true })\n  const widgetTrigger = WidgetTrigger(widgetWrapper.element, () => {}, true)\n  const widgetFrame = WidgetFrame(\n    widgetWrapper.element,\n    (window) => {\n      rpc = new RPC({\n        name: 'SDK',\n        sender: window,\n        topic: RpcConstants.Topic,\n        debug: import.meta.env.MODE === 'development'\n      })\n\n      rpc.register(RpcConstants.Methods.GetAllConfig, () => {\n        const config = storage.getAllConfig()\n        return config\n      })\n\n      rpc.register(RpcConstants.Methods.PreviewReady, () => {\n        previewReady = true\n        rpc?.trigger(RpcConstants.Methods.UpdatePreviewConfig, _previewConfig)\n      })\n    },\n    true\n  )\n\n  const init = (appConfig: AppConfig = {}) => {\n    storage.setAppConfig(appConfig)\n    cleanups.push(injectStyles(widgetWrapper.element))\n    if (!unListenerScreenChange) {\n      unListenerScreenChange = listenerScreenChange(widgetWrapper.element)\n    }\n    widgetFrame.open()\n    widgetTrigger.open()\n  }\n\n  const destroy: () => void = () => {\n    widgetTrigger.destroy()\n    widgetFrame.destroy()\n    widgetWrapper.destroy()\n    cleanups.forEach((cleanup) => cleanup())\n    cleanups.length = 0\n    _previewConfig = null\n    storage.clearAll()\n    unListenerScreenChange?.()\n    unListenerScreenChange = null\n  }\n\n  const updateConfig = (previewConfig: PreviewConfig) => {\n    storage.setTouchpoint({ active: true, config: safeJsonToString(previewConfig?.widgetSettings), account_id: '' })\n    storage.setParticipantName(previewConfig.userName || '')\n\n    const themes = updateThemes(widgetWrapper.element, storage.getAllConfig()?.appConfig?.styles, previewConfig)\n    widgetTrigger.update({ themes })\n\n    if (previewReady) {\n      rpc?.trigger(RpcConstants.Methods.UpdatePreviewConfig, previewConfig)\n    } else {\n      _previewConfig = previewConfig\n    }\n  }\n\n  return {\n    init,\n    destroy,\n    updateConfig\n  }\n}\n","import { hasElement } from '@td-org/chat-widget-shared'\n\nconst WRAPPER_CLASSNAME = 'tdw-widget-wrapper'\n\ntype Options = {\n  root: HTMLElement\n  isPreview?: boolean\n}\n\nexport function WidgetWrapper({ root, isPreview = false }: Options) {\n  const element = document.createElement('div')\n\n  element.className = WRAPPER_CLASSNAME\n  element.setAttribute(`data-${WRAPPER_CLASSNAME}`, '')\n\n  if (isPreview) {\n    element.setAttribute('data-preview', '')\n  }\n\n  root.appendChild(element)\n\n  return {\n    element,\n    destroy: () => {\n      if (hasElement(root, element)) {\n        root.removeChild(element)\n      }\n      element.remove()\n    }\n  }\n}\n","export function hasElement(origin: HTMLElement, target: HTMLElement) {\n  if (!origin || !target) {\n    return false\n  }\n  if (origin.contains) {\n    return origin.contains(target)\n  }\n  if (origin.childNodes) {\n    return Array.prototype.indexOf.call(origin.childNodes, target) !== -1\n  }\n  return false\n}\n","import { MoveElement } from '@td-org/chat-widget-shared'\n\nimport WidgetTriggerAnimate from './WidgetTriggerAnimate.ts'\n\ntype UpdatePayload = {\n  enablePointMoveTriggerButton?: boolean\n  themes?: Record<string, string>\n}\n\nexport type IWidgetTrigger = {\n  open: () => void\n  close: () => void\n  update: (payload: UpdatePayload) => void\n  destroy: () => void\n  setBadge: (count: number) => void\n}\n\nconst IDENTITY = 'talkdesk-chat-widget-trigger'\n\nexport function WidgetTrigger(injector: HTMLElement, onClick?: () => void, isPreview = false): IWidgetTrigger {\n  const widgetTriggerAnimate = WidgetTriggerAnimate()\n  const element = document.createElement('button')\n  element.id = IDENTITY\n  element.className = 'tdw-widget-trigger'\n  element.ariaLabel = 'Open chat widget'\n\n  if (isPreview) {\n    element.setAttribute('data-preview', '')\n  }\n\n  let badgeElement: HTMLSpanElement | null = null\n  let moveElementInstance: MoveElement<HTMLButtonElement> | null = null\n\n  const inactivePointMove = () => {\n    moveElementInstance?.destroy()\n    moveElementInstance = null\n  }\n\n  const activePointMove = () => {\n    if (!moveElementInstance) {\n      moveElementInstance = new MoveElement<HTMLButtonElement>(element, {\n        onClick: () => {\n          onClick?.()\n        }\n      })\n    }\n  }\n\n  const init = () => {\n    if (!document.getElementById(IDENTITY)) {\n      injector.appendChild(element)\n      element.appendChild(widgetTriggerAnimate.element)\n      element.onclick = () => {\n        if (!moveElementInstance) {\n          onClick?.()\n        }\n      }\n    }\n  }\n\n  const open = () => {\n    init()\n    element.style.display = ''\n  }\n\n  const close = () => {\n    element.style.display = 'none'\n  }\n\n  const update = ({ enablePointMoveTriggerButton, themes = {} }: UpdatePayload) => {\n    if (enablePointMoveTriggerButton) {\n      activePointMove()\n    }\n    element.setAttribute('data-has-chat-icon', themes?.['--chat-icon'] ? 'yes' : 'no')\n  }\n\n  const destroy = () => {\n    inactivePointMove()\n\n    element.removeChild(widgetTriggerAnimate.element)\n    widgetTriggerAnimate.destroy()\n\n    element.remove()\n  }\n\n  const setBadge = (count: number) => {\n    if (count > 0) {\n      if (!badgeElement) {\n        badgeElement = document.createElement('span')\n        badgeElement.className = `tdw-widget-trigger-badge ${count > 9 ? 'tdw-widget-trigger-badge-more' : ''}`\n        badgeElement.ariaLabel = 'new message indicator'\n        element.appendChild(badgeElement)\n      }\n      badgeElement.textContent = count > 99 ? '99+' : count.toString()\n    } else {\n      if (badgeElement) {\n        badgeElement.remove()\n        badgeElement = null\n      }\n    }\n  }\n\n  return {\n    open,\n    close,\n    update,\n    destroy,\n    setBadge\n  }\n}\n","const SVG_ANIMATION =\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 710 710\" width=\"710\" height=\"710\" preserveAspectRatio=\"xMidYMid meet\"><g clip-path=\"url(#__lottie_element_51)\" data-target=\"circle\"><g transform=\"matrix(1,0,0,1,355,355)\"><g opacity=\"1\" transform=\"matrix(1,0,0,1,0,0)\"><path fill=\"rgb(31,31,31)\" fill-opacity=\"1\" d=\" M0,-355.0159912109375 C196.07000732421875,-355.0159912109375 355.0159912109375,-196.07000732421875 355.0159912109375,0 C355.0159912109375,196.07000732421875 196.07000732421875,355.0159912109375 0,355.0159912109375 C-196.07000732421875,355.0159912109375 -355.0159912109375,196.07000732421875 -355.0159912109375,0 C-355.0159912109375,-196.07000732421875 -196.07000732421875,-355.0159912109375 0,-355.0159912109375z\"></path></g></g><g transform=\"matrix(1,0,0,1,354.9989929199219,384.5849914550781)\"><g opacity=\"1\" transform=\"matrix(1,0,0,1,0,0)\"><path fill=\"rgb(255,255,255)\" fill-opacity=\"1\" d=\" M-67.62200164794922,-135.24400329589844 C-67.62200164794922,-135.24400329589844 67.62200164794922,-135.24400329589844 67.62200164794922,-135.24400329589844 C123.64199829101562,-135.24400329589844 169.05499267578125,-89.83100128173828 169.05499267578125,-33.81100082397461 C169.05499267578125,22.20800018310547 123.64199829101562,67.62200164794922 67.62200164794922,67.62200164794922 C67.62200164794922,67.62200164794922 50.71699905395508,67.62200164794922 50.71699905395508,67.62200164794922 C50.71699905395508,67.62200164794922 -50.71699905395508,135.24400329589844 -50.71699905395508,135.24400329589844 C-50.71699905395508,135.24400329589844 -50.71699905395508,67.62200164794922 -50.71699905395508,67.62200164794922 C-50.71699905395508,67.62200164794922 -67.62200164794922,67.62200164794922 -67.62200164794922,67.62200164794922 C-123.64199829101562,67.62200164794922 -169.05499267578125,22.20800018310547 -169.05499267578125,-33.81100082397461 C-169.05499267578125,-89.83100128173828 -123.64199829101562,-135.24400329589844 -67.62200164794922,-135.24400329589844z\"></path></g></g><g data-target=\"dot3\" transform=\"matrix(1,0,0,1,424.6109924316406,355.21099853515625)\"><g opacity=\"1\" transform=\"matrix(1,0,0,1,0,0)\"><path fill=\"rgb(30,30,30)\" fill-opacity=\"1\" d=\" M0,-19.58300018310547 C-10.984000205993652,-19.58300018310547 -19.88800048828125,-10.815999984741211 -19.88800048828125,0 C-19.88800048828125,10.8149995803833 -10.984000205993652,19.58300018310547 0,19.58300018310547 C10.984000205993652,19.58300018310547 19.88800048828125,10.8149995803833 19.88800048828125,0 C19.88800048828125,-10.815999984741211 10.984000205993652,-19.58300018310547 0,-19.58300018310547z\"></path></g></g><g data-target=\"dot1\" transform=\"matrix(1,0,0,1,285.3890075683594,355.21099853515625)\"><g opacity=\"1\" transform=\"matrix(1,0,0,1,0,0)\"><path fill=\"rgb(30,30,30)\" fill-opacity=\"1\" d=\" M0,-19.58300018310547 C-10.984000205993652,-19.58300018310547 -19.888999938964844,-10.815999984741211 -19.888999938964844,0 C-19.888999938964844,10.8149995803833 -10.984000205993652,19.58300018310547 0,19.58300018310547 C10.984000205993652,19.58300018310547 19.888999938964844,10.8149995803833 19.888999938964844,0 C19.888999938964844,-10.815999984741211 10.984000205993652,-19.58300018310547 0,-19.58300018310547z\"></path></g></g><g data-target=\"dot2\" transform=\"matrix(1,0,0,1,354.9989929199219,355.21099853515625)\"><g opacity=\"1\" transform=\"matrix(1,0,0,1,0,0)\"><path fill=\"rgb(30,30,30)\" fill-opacity=\"1\" d=\" M-0.0010000000474974513,-19.58300018310547 C-10.984999656677246,-19.58300018310547 -19.888999938964844,-10.815999984741211 -19.888999938964844,0 C-19.888999938964844,10.8149995803833 -10.984999656677246,19.58300018310547 -0.0010000000474974513,19.58300018310547 C10.984000205993652,19.58300018310547 19.888999938964844,10.8149995803833 19.888999938964844,0 C19.888999938964844,-10.815999984741211 10.984000205993652,-19.58300018310547 -0.0010000000474974513,-19.58300018310547z\"></path></g></g><g data-target=\"wave\"><g transform=\"matrix(0.9995219707489014,-0.03091629408299923,0.03091629408299923,0.9995219707489014,356.4827575683594,355.05108642578125)\" opacity=\"1\"><g opacity=\"1\" transform=\"matrix(1,0,0,1,0,0)\"><path fill=\"rgb(31,31,31)\" fill-opacity=\"1\" d=\" M73.96199798583984,-17.92799949645996 C73.96199798583984,-17.92799949645996 49.125999450683594,-29.759000778198242 49.125999450683594,-29.759000778198242 C40.44200134277344,-9.998000144958496 21.340900421142578,2.770447254180908 0.46700000762939453,2.7699999809265137 C-21.07493782043457,2.769519567489624 -40.41497039794922,-10.566868782043457 -48.804969787597656,-31.209869384765625 C-48.804969787597656,-31.209869384765625 -60.26470184326172,-26.16266632080078 -60.26519775390625,-26.1624755859375 C-60.265830993652344,-26.162199020385742 -73.96195220947266,-20.127910614013672 -73.96195220947266,-20.127910614013672 C-61.29095458984375,11.061088562011719 -32.06700134277344,31.209999084472656 0.46700000762939453,31.209999084472656 C31.999000549316406,31.209999084472656 60.83599853515625,11.920999526977539 73.96199798583984,-17.92799949645996z\"></path></g></g></g></g></svg>'\n\nfunction WidgetTriggerAnimate() {\n  const container = document.createElement('div')\n\n  container.className = 'tdw-widget-trigger-animate'\n  container.innerHTML = SVG_ANIMATION\n  const destroy = () => {\n    container.remove()\n  }\n  return {\n    destroy,\n    get element() {\n      return container\n    }\n  }\n}\nexport default WidgetTriggerAnimate\n","import { PROXY_URI } from '@td-org/chat-widget-shared'\n\nimport storage from '../utils/storage.ts'\nimport validVersion from '../utils/validVersion.ts'\n\nimport { createContainerElement, createIframeElement, createLoadingElement } from './elements.ts'\n\nconst IDENTITY = 'talkdesk-chat-widget'\nconst LOADING_ELEMENT_KEY = 'loading-element'\nconst IFRAME_ELEMENT_KEY = 'iframe-element'\n\ntype UpdatePayload = {\n  enableResponsiveLayout?: boolean\n}\n\ntype ResizePayload = {\n  height?: number | string\n}\n\nexport type IWidgetIFrame = {\n  initInBackground: () => void\n  open: () => void\n  close: () => void\n  destroy: () => void\n  update: (payload: UpdatePayload) => void\n  resize: (payload: ResizePayload) => void\n}\n\nconst getSrc = () => {\n  const { touchpoint, appProps } = storage.getAllConfig()\n  const proxyUrl = appProps?.proxyHost ? `//${appProps.proxyHost}${PROXY_URI.tdChatSdk}` : ''\n  if (import.meta.env.DEV) {\n    return `${import.meta.env.VITE_CDN_BASE}?touchpointId=${appProps?.touchpointId}`\n  }\n  const releaseVersion = touchpoint?.release_version || ''\n  const validated = validVersion(releaseVersion)\n  return `${proxyUrl || import.meta.env.VITE_CDN_BASE}/v2/widget/${\n    validated ? releaseVersion : 'latest'\n  }/index.html?touchpointId=${appProps?.touchpointId}`\n}\n\nconst getPreviewSrc = () => {\n  if (import.meta.env.DEV) {\n    return import.meta.env.VITE_CDN_BASE + '/preview.html'\n  }\n  return `${import.meta.env.VITE_CDN_BASE}/v2/widget/latest/preview.html`\n}\n\nexport function WidgetFrame(\n  injector: HTMLElement,\n  onAppend?: (window: Window) => void,\n  isPreview = false\n): IWidgetIFrame {\n  const container = createContainerElement(IDENTITY)\n  const iframe = createIframeElement(() => {\n    container.remove(LOADING_ELEMENT_KEY)\n  })\n  container.append(LOADING_ELEMENT_KEY, createLoadingElement())\n  container.hide()\n\n  if (isPreview) {\n    container.element.setAttribute('data-preview', '')\n  }\n\n  const init = () => {\n    if (!container.isMounted()) {\n      injector.appendChild(container.element)\n      iframe.element.src = isPreview ? getPreviewSrc() : getSrc()\n      container.append(IFRAME_ELEMENT_KEY, iframe)\n      if (onAppend && iframe.element.contentWindow) {\n        onAppend(iframe.element.contentWindow)\n      }\n    }\n  }\n\n  const initInBackground = () => {\n    init()\n  }\n\n  const resize = ({ height }: ResizePayload) => {\n    if (!height) return\n\n    container.element.style.height = typeof height === 'string' ? height : `${height}px`\n  }\n\n  const open = () => {\n    init()\n    container.show()\n  }\n\n  const close = () => {\n    container.hide()\n  }\n\n  const destroy = () => {\n    container.destroy()\n  }\n\n  const update = ({ enableResponsiveLayout = false }: UpdatePayload = {}) => {\n    if (enableResponsiveLayout) {\n      container.element.setAttribute('data-responsive-layout', 'true')\n    } else {\n      container.element.removeAttribute('data-responsive-layout')\n    }\n  }\n\n  return {\n    initInBackground,\n    resize,\n    open,\n    close,\n    destroy,\n    update\n  }\n}\n","interface AtomElement<T extends HTMLElement = HTMLElement> {\n  element: T\n  destroy: () => void\n}\n\ninterface AtomElementActions {\n  append: (key: string, element: AtomElement) => void\n  remove: (key: string) => void\n  show: () => void\n  hide: () => void\n  isMounted: () => boolean\n}\n\nexport function createContainerElement(id: string): AtomElement<HTMLDivElement> & AtomElementActions {\n  const element = document.createElement('div')\n  element.id = id\n  element.className = 'tdw-widget'\n\n  const childElements: Map<string, AtomElement> = new Map()\n\n  const destroy = () => {\n    element.remove()\n    childElements.forEach((child) => child.destroy())\n    childElements.clear()\n  }\n\n  const append = (key: string, atomElement: AtomElement) => {\n    childElements.set(key, atomElement)\n    element.appendChild(atomElement.element)\n  }\n\n  const remove = (key: string) => {\n    const childElement = childElements.get(key)\n    if (childElement) {\n      childElement.destroy()\n      childElements.delete(key)\n    }\n  }\n\n  const show = () => {\n    element.setAttribute('aria-hidden', 'false')\n  }\n\n  const hide = () => {\n    element.setAttribute('aria-hidden', 'true')\n  }\n\n  const isMounted = () => {\n    return !!document.getElementById(id)\n  }\n\n  return {\n    element,\n    append,\n    remove,\n    show,\n    hide,\n    isMounted,\n    destroy\n  }\n}\n\nexport function createLoadingElement(): AtomElement {\n  const element = document.createElement('div')\n  element.className = 'tdw-widget-loading'\n  element.id = 'tdw-widget-loading'\n  element.ariaLabel = 'Loading'\n  element.innerHTML = ['<div class=\"tdw-widget-content\">', '<span class=\"tdw-loader\"></span>', '</div>'].join('')\n\n  const destroy = () => {\n    element.remove()\n  }\n\n  return {\n    element,\n    destroy\n  }\n}\n\nexport function createIframeElement(onLoad: () => void): AtomElement<HTMLIFrameElement> {\n  const element = document.createElement('iframe')\n  element.title = 'Chat Widget'\n  element.allowFullscreen = true\n  element.style.display = 'none'\n\n  const onLoadHandler = () => {\n    element.style.display = 'block'\n    onLoad()\n  }\n  element.addEventListener('load', onLoadHandler)\n\n  const destroy = () => {\n    element.removeEventListener('load', onLoadHandler)\n    element.remove()\n  }\n\n  return {\n    element,\n    destroy\n  }\n}\n","import {\n  injectCssVariables,\n  injectStyle,\n  type PreviewConfig,\n  safeJsonParse,\n  type Theme,\n  type Touchpoint\n} from '@td-org/chat-widget-shared'\n\nimport css from './style/index.scss?inline'\nimport { getTriggerButtonStyles } from './utils/getTriggerButtonStyles'\n\nconst GLOBAL_STYLE_ID = 'talkdesk-chat-widget-style'\n\nfunction getSettingStyles(target?: Touchpoint | PreviewConfig) {\n  const touchpointConfig = (target as Touchpoint)?.config\n  const configs = (\n    touchpointConfig ? safeJsonParse(touchpointConfig, {}) : (target as PreviewConfig)?.widgetSettings\n  ) as PreviewConfig['widgetSettings']\n  const themes: Record<string, string> = {}\n\n  if (configs?.appearance?.theme?.brandColor) {\n    themes.chatThemeColor = configs?.appearance?.theme.brandColor\n    themes.chatHoverThemeColor = configs?.appearance?.theme.brandColor\n  }\n\n  if (configs?.appearance?.launcher?.color) {\n    themes.chatLauncherColor = configs?.appearance?.launcher?.color\n    themes.chatHoverLauncherColor = configs?.appearance?.launcher?.color\n  }\n\n  if (configs?.appearance?.launcher?.iconUrl) {\n    themes.chatIcon = configs?.appearance?.launcher?.iconUrl\n  }\n\n  if (configs?.appearance?.launcher?.shadow) {\n    themes.chatLauncherShadow = configs.appearance.launcher.shadow\n  }\n\n  return themes\n}\n\nfunction getStyles(styles: Partial<Theme> = {}, target?: Touchpoint | PreviewConfig) {\n  return getTriggerButtonStyles({ ...getSettingStyles(target), ...styles })\n}\n\nexport function injectStyles(target: HTMLElement) {\n  const cleanups: (() => void)[] = []\n\n  cleanups.push(injectStyle(css, GLOBAL_STYLE_ID, target))\n\n  return () => {\n    cleanups.forEach((cleanup) => cleanup())\n    cleanups.length = 0\n  }\n}\n\nexport function updateThemes<Element extends HTMLElement>(\n  target: Element,\n  styles: Partial<Theme> = {},\n  touchpointOrPreviewConfig?: Touchpoint | PreviewConfig\n) {\n  const themes = getStyles(styles, touchpointOrPreviewConfig)\n  const themeKeys = Object.keys(themes)\n  if (themeKeys.length) {\n    return injectCssVariables(target, themes)\n  }\n}\n\nexport function listenerScreenChange<Element extends HTMLElement>(target: Element, onChange?: () => void) {\n  const update = () => {\n    injectCssVariables(target, {\n      chatScreenWidth: window.innerWidth + 'px',\n      chatScreenHeight: window.innerHeight + 'px'\n    } as Partial<Theme>)\n  }\n\n  const handlerResize = () => {\n    update()\n    onChange?.()\n  }\n\n  update()\n\n  window.addEventListener('resize', handlerResize)\n\n  return () => {\n    window.removeEventListener('resize', handlerResize)\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","type Options = {\n  onClick?: () => void\n  onChange?: (event: 'moving' | 'moveEnded') => void\n}\n\nclass MoveElement<Element extends HTMLElement> {\n  private _moving = false\n  private _moved = false\n  private _initialXY = [0, 0]\n  private _startXY = [0, 0]\n  private _boundaryValue = 5\n  private _rb: ResizeObserver | null = null\n  private _isPC = true\n\n  constructor(\n    private readonly current: Element,\n    private readonly options: Options = {}\n  ) {\n    this.onMoveStart = this.onMoveStart.bind(this)\n    this.onMoving = this.onMoving.bind(this)\n    this.onMoveEnd = this.onMoveEnd.bind(this)\n    this.removeDocumentListeners = this.removeDocumentListeners.bind(this)\n\n    this.current.addEventListener('mousedown', this.onMoveStart)\n    this.current.addEventListener('touchstart', this.onMoveStart)\n\n    this._rb = new ResizeObserver(() => {\n      this.reset()\n    })\n    this._rb.observe(document.body)\n  }\n\n  private getEventInfo(event: MouseEvent | TouchEvent) {\n    if ((event as TouchEvent).touches) {\n      this._isPC = false\n      return {\n        clientXY: [(event as TouchEvent).touches[0].clientX, (event as TouchEvent).touches[0].clientY]\n      }\n    } else {\n      this._isPC = true\n      return {\n        clientXY: [(event as MouseEvent).clientX, (event as MouseEvent).clientY]\n      }\n    }\n  }\n\n  private onMoveStart(event: MouseEvent | TouchEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n\n    this._initialXY = [this.current.offsetLeft, this.current.offsetTop]\n    this._startXY = this.getEventInfo(event).clientXY\n    this._moved = false\n\n    this.addDocumentListeners()\n  }\n\n  private onMoving(event: MouseEvent | TouchEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n\n    const { clientXY } = this.getEventInfo(event)\n    const [x, y] = clientXY\n\n    const diffX = x - this._startXY[0]\n    const diffY = y - this._startXY[1]\n\n    if (Math.abs(diffX) < this._boundaryValue && Math.abs(diffY) < this._boundaryValue) {\n      return\n    }\n\n    if (!this._moved) {\n      this._moved = true\n    }\n\n    this._moving = true\n    this.current.style.left =\n      Math.min(Math.max(0, this._initialXY[0] + diffX), window.innerWidth - this.current.offsetWidth) + 'px'\n    this.current.style.top =\n      Math.min(Math.max(0, this._initialXY[1] + diffY), window.innerHeight - this.current.offsetHeight) + 'px'\n    this.options?.onChange?.('moving')\n  }\n\n  private onMoveEnd(event: MouseEvent | TouchEvent) {\n    event.stopPropagation()\n    event.preventDefault()\n\n    if (this._moving) {\n      this.options?.onChange?.('moveEnded')\n    }\n\n    if (!this._moved) {\n      this.options?.onClick?.()\n    }\n\n    this._moved = false\n    this.removeDocumentListeners()\n  }\n\n  private addDocumentListeners() {\n    document.addEventListener('mousemove', this.onMoving, { passive: false })\n    document.addEventListener('mouseup', this.onMoveEnd, { passive: false })\n    this.current.addEventListener('touchmove', this.onMoving, { passive: false })\n    this.current.addEventListener('touchend', this.onMoveEnd, { passive: false })\n  }\n\n  private removeDocumentListeners() {\n    document.removeEventListener('mousemove', this.onMoving)\n    document.removeEventListener('mouseup', this.onMoveEnd)\n    this.current.removeEventListener('touchmove', this.onMoveEnd)\n    this.current.removeEventListener('touchend', this.onMoveEnd)\n  }\n\n  private reset() {\n    if (this._isPC) {\n      this.current.style.top = ''\n      this.current.style.left = ''\n    }\n  }\n\n  public destroy() {\n    this.current.removeEventListener('mousedown', this.onMoveStart)\n    this.current.removeEventListener('touchstart', this.onMoveStart)\n    this.removeDocumentListeners()\n    this._rb?.disconnect()\n    this._rb = null\n  }\n}\n\nexport { MoveElement }\n","export const RpcConstants = {\n  Topic: 'WidgetCommunication',\n  Methods: {\n    Maximize: 'Maximize',\n    Minimize: 'Minimize',\n    GetAllConfig: 'GetAllConfig',\n    GetCredentials: 'GetCredentials',\n    GetTdAccessToken: 'GetTdAccessToken',\n    SetBadge: 'SetBadge',\n    FrameOpened: 'FrameOpened',\n    DownloadTranscript: 'DownloadTranscript',\n    UpdatePreviewConfig: 'UpdatePreviewConfig',\n    PreviewReady: 'PreviewReady',\n    ConversationStart: 'ConversationStart',\n    FrameReady: 'FrameReady',\n    FrameResize: 'FrameResize',\n    UpdateAppConfigs: 'UpdateAppConfigs',\n    UpdateContext: 'UpdateContext'\n  }\n}\n","import EventEmitter from 'events';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nvar RPC = /** @class */ (function () {\n    function RPC(options) {\n        this.options = options;\n        this._traceId = 0;\n        // eslint-disable-next-line\n        this._methods = new Map();\n        this._emitter = new EventEmitter();\n        this._handlerOnMessageByBound = this.handlerOnMessage.bind(this);\n        this.createService();\n        this.getListener().addEventListener('message', this._handlerOnMessageByBound, false);\n    }\n    RPC.jsonParseData = function (target, defaultValue) {\n        try {\n            return JSON.parse(target);\n        }\n        catch (e) {\n            return defaultValue;\n        }\n    };\n    RPC.jsonStringifyData = function (target) {\n        try {\n            return JSON.stringify(target);\n        }\n        catch (e) {\n            return '';\n        }\n    };\n    RPC.runHandler = function (target) {\n        return __awaiter(this, void 0, void 0, function () {\n            var data, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        return [4 /*yield*/, target()];\n                    case 1:\n                        data = _a.sent();\n                        return [2 /*return*/, { data: data, error: null }];\n                    case 2:\n                        e_1 = _a.sent();\n                        // @ts-ignore\n                        return [2 /*return*/, { error: typeof e_1 === 'string' ? e_1 : e_1.message }];\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    RPC.prototype.destroy = function () {\n        this._emitter.removeAllListeners();\n        this._methods.clear();\n        this.getListener().removeEventListener('message', this._handlerOnMessageByBound, false);\n    };\n    // eslint-disable-next-line\n    RPC.prototype.register = function (method, handler) {\n        this._methods.set(method, handler);\n        this.log(\"Register \".concat(method), this._methods);\n    };\n    RPC.prototype.unregister = function (method) {\n        this._methods.delete(method);\n        this.log(\"Unregister \".concat(method), this._methods);\n    };\n    // eslint-disable-next-line\n    RPC.prototype.trigger = function (method) {\n        var _this = this;\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        return new Promise(function (resolve) {\n            var id = _this.createId();\n            _this.sendMessage({ id: id, method: method, payload: args, type: 'request' });\n            _this.log(\"Trigger \".concat(method, \" | \").concat(id), args);\n            _this._emitter.once(\"response_\".concat(id), function (eventData) {\n                resolve(eventData.payload);\n                _this.log(\"Receive \".concat(method, \" | \").concat(id), RPC.jsonStringifyData(eventData));\n            });\n        });\n    };\n    RPC.prototype.createId = function () {\n        return \"\".concat(this.options.name, \"_\").concat(this._traceId++);\n    };\n    RPC.prototype.createService = function () {\n        var _this = this;\n        this._emitter.on(this.options.topic, function (eventData) { return __awaiter(_this, void 0, void 0, function () {\n            var id, payload, method, _method, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        id = eventData.id, payload = eventData.payload, method = eventData.method;\n                        _method = this._methods.get(method);\n                        if (!_method) return [3 /*break*/, 2];\n                        return [4 /*yield*/, RPC.runHandler(function () { return _method.apply(void 0, payload); })];\n                    case 1:\n                        result = _a.sent();\n                        this.sendMessage({ id: id, method: method, payload: result, type: 'response' });\n                        return [3 /*break*/, 3];\n                    case 2:\n                        this.sendMessage({\n                            id: id,\n                            method: method,\n                            payload: { error: 'No found method in service' },\n                            type: 'response',\n                        });\n                        _a.label = 3;\n                    case 3: return [2 /*return*/];\n                }\n            });\n        }); });\n    };\n    RPC.prototype.sendMessage = function (message) {\n        var _a = this.options, sender = _a.sender, origin = _a.origin, topic = _a.topic;\n        var data = RPC.jsonStringifyData(__assign(__assign({}, message), { topic: topic }));\n        if (!sender.postMessage) {\n            throw new Error('The sender no found postMessage method please check the sender option');\n        }\n        if (data) {\n            sender.postMessage(data, origin || '*');\n        }\n    };\n    RPC.prototype.handlerOnMessage = function (event) {\n        var data = event.data;\n        if (!data)\n            return;\n        var rpcMessage = RPC.jsonParseData(data, null);\n        if (!rpcMessage || rpcMessage.topic !== this.options.topic)\n            return;\n        var id = rpcMessage.id, type = rpcMessage.type;\n        if (type === 'request') {\n            this._emitter.emit(this.options.topic, rpcMessage);\n        }\n        if (type === 'response') {\n            this._emitter.emit(\"response_\".concat(id), rpcMessage);\n        }\n    };\n    RPC.prototype.getListener = function () {\n        return this.options.listener || window;\n    };\n    // eslint-disable-next-line\n    RPC.prototype.log = function (message) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        var _a = this.options, debug = _a.debug, name = _a.name;\n        if (debug) {\n            var now = new Date().toISOString();\n            var title = \"[RPC] [\".concat(now, \"] [\").concat(name, \"] \").concat(message);\n            console.groupCollapsed(title);\n            if (args === null || args === void 0 ? void 0 : args.length) {\n                console.info.apply(console, args);\n            }\n            console.groupEnd();\n        }\n    };\n    Object.defineProperty(RPC.prototype, \"methods\", {\n        get: function () {\n            return this._methods;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(RPC.prototype, \"emitter\", {\n        get: function () {\n            return this._emitter;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return RPC;\n}());\n\nexport { RPC as default };\n//# sourceMappingURL=index.esm.js.map\n","import type { AppConfig, AppProps, Touchpoint } from '@td-org/chat-widget-shared'\n\nclass Storage {\n  private appConfig: AppConfig = {}\n  private touchpoint: Touchpoint | null = null\n  private appProps: AppProps | null = null\n  private context: Record<string, string> = {}\n  private participantName: string = ''\n\n  setAppConfig(appConfig: AppConfig) {\n    const styles = appConfig?.styles || {}\n    this.appConfig = {\n      ...this.appConfig,\n      ...appConfig,\n      styles: Object.keys(styles).length ? { ...this.appConfig?.styles, ...styles } : {}\n    }\n    return this.appConfig\n  }\n\n  setTouchpoint(touchpoint: Touchpoint) {\n    this.touchpoint = touchpoint\n  }\n\n  setParticipantName(name: string) {\n    this.participantName = name\n  }\n\n  setAppProps(appProps: AppProps) {\n    this.appProps = appProps\n  }\n\n  getAllConfig() {\n    return {\n      appConfig: this.appConfig,\n      touchpoint: this.touchpoint,\n      context: this.context,\n      appProps: this.appProps,\n\n      participantName: this.participantName,\n      injectorWindowHref: window.location.href,\n      injectorWindowHostname: window.location.hostname\n    }\n  }\n\n  setContextParam(data: Record<string, string>) {\n    this.context = data\n  }\n\n  clearAll() {\n    this.appConfig = {}\n    this.touchpoint = null\n    this.context = {}\n    this.participantName = ''\n  }\n}\n\nexport default new Storage()\n","import { removeEmptyKeys, type Theme } from '@td-org/chat-widget-shared'\n\ntype TriggerButtonStyles = Pick<\n  Theme,\n  | 'chatIcon'\n  | 'chatThemeColor'\n  | 'chatHoverThemeColor'\n  | 'triggerButtonWidth'\n  | 'triggerButtonHeight'\n  | 'triggerButtonPositionBottom'\n  | 'triggerButtonPositionRight'\n  | 'chatPositionBottom'\n  | 'chatContainerHeight'\n  | 'chatContainerWidth'\n  | 'chatLauncherColor'\n  | 'chatHoverLauncherColor'\n  | 'chatLauncherShadow'\n>\n\nexport const getTriggerButtonStyles = (theme: Partial<Theme>): Partial<TriggerButtonStyles> => {\n  const styles: Partial<TriggerButtonStyles> = {\n    chatIcon: theme.chatIcon ? `url(${theme.chatIcon})` : undefined,\n    chatThemeColor: theme.chatThemeColor,\n    chatHoverThemeColor: theme.chatHoverThemeColor,\n    triggerButtonWidth: theme.triggerButtonWidth,\n    triggerButtonHeight: theme.triggerButtonHeight,\n    triggerButtonPositionBottom: theme.triggerButtonPositionBottom,\n    triggerButtonPositionRight: theme.triggerButtonPositionRight,\n    chatPositionBottom: theme.chatPositionBottom,\n    chatContainerHeight: theme.chatContainerHeight,\n    chatContainerWidth: theme.chatContainerWidth,\n    chatLauncherColor: theme.chatLauncherColor,\n    chatHoverLauncherColor: theme.chatHoverLauncherColor,\n    chatLauncherShadow: theme.chatLauncherShadow\n  }\n\n  return removeEmptyKeys(styles, { removeEmptyString: true })\n}\n","function isNumber<T>(target: T) {\n  try {\n    return !isNaN(+target)\n  } catch (e) {\n    return false\n  }\n}\n\nexport default function validVersion<T>(target: T): boolean {\n  if (!target) return false\n  try {\n    const splitVersions = target\n      .toString()\n      .split('.')\n      .map((item) => item.trim())\n      .filter(Boolean)\n    if (splitVersions.length !== 3) return false\n    const [major, minor, patch] = splitVersions\n    return isNumber(major) && isNumber(minor) && isNumber(patch)\n  } catch (e) {\n    return false\n  }\n}\n"],"names":["convertKey","key","result","_toConsumableArray","map","c","index","code","charCodeAt","toLowerCase","join","concat","injectCssVariables","selector","styles","target","indexOf","document","querySelector","getElementById","themes","themeKeys","Object","keys","length","reduce","acc","style","setProperty","_objectSpread","_defineProperty","convertCssVariables","getExistStyleElement","id","injector","safeJsonToString","onError","JSON","stringify","e","root","Error","cleanups","rpc","previewReady","_previewConfig","unListenerScreenChange","widgetWrapper","_ref","_ref$isPreview","isPreview","element","createElement","className","WRAPPER_CLASSNAME","setAttribute","appendChild","destroy","origin","contains","childNodes","Array","prototype","call","hasElement","removeChild","remove","WidgetWrapper","widgetTrigger","onClick","arguments","undefined","widgetTriggerAnimate","container","innerHTML","SVG_ANIMATION","WidgetTriggerAnimate","IDENTITY","ariaLabel","badgeElement","moveElementInstance","inactivePointMove","_moveElementInstance","activePointMove","MoveElement","init","onclick","open","display","close","update","enablePointMoveTriggerButton","_ref2$themes","setBadge","count","textContent","toString","WidgetTrigger","widgetFrame","onAppend","childElements","Map","forEach","child","clear","append","atomElement","set","show","hide","childElement","get","delete","isMounted","createContainerElement","iframe","onLoad","title","allowFullscreen","onLoadHandler","addEventListener","removeEventListener","createIframeElement","LOADING_ELEMENT_KEY","createLoadingElement","src","getPreviewSrc","getSrc","IFRAME_ELEMENT_KEY","contentWindow","initInBackground","_ref4","_ref4$enableResponsiv","enableResponsiveLayout","removeAttribute","resize","_ref3","height","WidgetFrame","window","RPC","name","sender","topic","RpcConstants","Topic","debug","register","Methods","GetAllConfig","storage","getAllConfig","PreviewReady","_rpc","trigger","UpdatePreviewConfig","handlerResize","appConfig","setAppConfig","push","css","head","existStyleElement","removeStyleElement","styleElement","createStyleElement","injectStyle","GLOBAL_STYLE_ID","cleanup","injectStyles","chatScreenWidth","innerWidth","chatScreenHeight","innerHeight","_unListenerScreenChan","clearAll","updateConfig","previewConfig","_storage$getAllConfig2","setTouchpoint","active","config","widgetSettings","account_id","setParticipantName","userName","_rpc2","touchpointOrPreviewConfig","getTriggerButtonStyles","_configs$appearance","_configs$appearance4","_configs$appearance7","_configs$appearance9","_configs$appearance8","touchpointConfig","configs","defaultValue","parse","safeJsonParse","appearance","theme","brandColor","_configs$appearance2","_configs$appearance3","chatThemeColor","chatHoverThemeColor","launcher","color","_configs$appearance5","_configs$appearance6","chatLauncherColor","chatHoverLauncherColor","iconUrl","chatIcon","shadow","chatLauncherShadow","getSettingStyles","getStyles","updateThemes","Preview","ReflectOwnKeys","_createClass","current","_this2","this","options","_classCallCheck","onMoveStart","bind","onMoving","onMoveEnd","removeDocumentListeners","_rb","ResizeObserver","reset","observe","body","value","event","touches","_isPC","clientXY","clientX","clientY","stopPropagation","preventDefault","_initialXY","offsetLeft","offsetTop","_startXY","getEventInfo","_moved","addDocumentListeners","_this$options","_this$options$onChang","_clientXY","_slicedToArray","x","y","diffX","diffY","Math","abs","_boundaryValue","_moving","left","min","max","offsetWidth","top","offsetHeight","onChange","_this$options2","_this$options2$onChan","_this$options3","_this$options3$onClic","passive","_this$_rb","disconnect","Maximize","Minimize","GetCredentials","GetTdAccessToken","SetBadge","FrameOpened","DownloadTranscript","ConversationStart","FrameReady","FrameResize","UpdateAppConfigs","UpdateContext","R","Reflect","_typeof","ReflectApply","apply","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","Number","isNaN","EventEmitter","eventsModule","exports","once","emitter","Promise","resolve","reject","errorListener","err","removeListener","resolver","slice","eventTargetAgnosticAddListener","handler","flags","on","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","m","events","existing","warning","create","newListener","emit","unshift","warned","w","String","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","i","unwrapListeners","arrayClone","listenerCount","n","copy","wrapListener","arg","defineProperty","enumerable","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","pop","spliceOne","off","removeAllListeners","rawListeners","eventNames","__assign","assign","t","s","p","hasOwnProperty","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","rejected","done","then","__generator","f","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","SuppressedError","_traceId","_methods","_emitter","_handlerOnMessageByBound","handlerOnMessage","createService","getListener","jsonParseData","jsonStringifyData","runHandler","e_1","_a","data","method","log","unregister","_this","_i","createId","sendMessage","payload","eventData","_method","postMessage","rpcMessage","now","Date","toISOString","groupCollapsed","info","groupEnd","configurable","Storage","_this$appConfig","touchpoint","participantName","appProps","injectorWindowHref","location","href","injectorWindowHostname","hostname","triggerButtonWidth","triggerButtonHeight","triggerButtonPositionBottom","triggerButtonPositionRight","chatPositionBottom","chatContainerHeight","chatContainerWidth","removeEmptyKeys","removeEmptyString","isNumber","_storage$getAllConfig","proxyUrl","proxyHost","PROXY_URI","tdChatSdk","releaseVersion","release_version","validated","splitVersions","split","item","trim","filter","Boolean","_splitVersions","major","minor","patch","validVersion","touchpointId"],"mappings":"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","x_google_ignoreList":[13,16]}