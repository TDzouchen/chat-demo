import{c as dr,o as Q0,g as X0}from"./main-vendor-DXirhFg8.js";/*!
* Talkdesk Confidential
*
* Copyright (C) Talkdesk Inc. 2024
*
* The source code for this program is not published or otherwise divested
* of its trade secrets, irrespective of what has been deposited with the
* U.S. Copyright Office. Unauthorized copying of this file, via any medium
* is strictly prohibited.
*/function Z0(e,n){for(var t=0;t<n.length;t++){const r=n[t];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const i=Object.getOwnPropertyDescriptor(r,a);i&&Object.defineProperty(e,a,i.get?i:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var ed={},es=function(e){return e&&e.Math===Math&&e},Xe=es(typeof globalThis=="object"&&globalThis)||es(typeof window=="object"&&window)||es(typeof self=="object"&&self)||es(typeof dr=="object"&&dr)||es(typeof dr=="object"&&dr)||function(){return this}()||Function("return this")(),Nn={},We=function(e){try{return!!e()}catch(n){return!0}},e$=We,_t=!e$(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),t$=We,Ns=!t$(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),r$=Ns,du=Function.prototype.call,yt=r$?du.bind(du):function(){return du.apply(du,arguments)},Ls={},Rm={}.propertyIsEnumerable,Cm=Object.getOwnPropertyDescriptor,n$=Cm&&!Rm.call({1:2},1);Ls.f=n$?function(n){var t=Cm(this,n);return!!t&&t.enumerable}:Rm;var Pa=function(e,n){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:n}},Om=Ns,Am=Function.prototype,Yc=Am.call,a$=Om&&Am.bind.bind(Yc,Yc),Ke=Om?a$:function(e){return function(){return Yc.apply(e,arguments)}},Pm=Ke,i$=Pm({}.toString),s$=Pm("".slice),on=function(e){return s$(i$(e),8,-1)},u$=Ke,o$=We,l$=on,vl=Object,c$=u$("".split),xs=o$(function(){return!vl("z").propertyIsEnumerable(0)})?function(e){return l$(e)==="String"?c$(e,""):vl(e)}:vl,ln=function(e){return e==null},f$=ln,d$=TypeError,Qr=function(e){if(f$(e))throw new d$("Can't call method on "+e);return e},v$=xs,p$=Qr,_r=function(e){return v$(p$(e))},pl=typeof document=="object"&&document.all,gt=typeof pl>"u"&&pl!==void 0?function(e){return typeof e=="function"||e===pl}:function(e){return typeof e=="function"},h$=gt,Ct=function(e){return typeof e=="object"?e!==null:h$(e)},hl=Xe,y$=gt,g$=function(e){return y$(e)?e:void 0},Xr=function(e,n){return arguments.length<2?g$(hl[e]):hl[e]&&hl[e][n]},m$=Ke,Ln=m$({}.isPrototypeOf),b$=Xe,Bv=b$.navigator,qv=Bv&&Bv.userAgent,ia=qv?String(qv):"",Mm=Xe,yl=ia,Wv=Mm.process,Gv=Mm.Deno,Hv=Wv&&Wv.versions||Gv&&Gv.version,zv=Hv&&Hv.v8,Vr,ro;zv&&(Vr=zv.split("."),ro=Vr[0]>0&&Vr[0]<4?1:+(Vr[0]+Vr[1]));!ro&&yl&&(Vr=yl.match(/Edge\/(\d+)/),(!Vr||Vr[1]>=74)&&(Vr=yl.match(/Chrome\/(\d+)/),Vr&&(ro=+Vr[1])));var Ci=ro,Vv=Ci,w$=We,_$=Xe,S$=_$.String,Oi=!!Object.getOwnPropertySymbols&&!w$(function(){var e=Symbol("symbol detection");return!S$(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Vv&&Vv<41}),$$=Oi,Nm=$$&&!Symbol.sham&&typeof Symbol.iterator=="symbol",T$=Xr,k$=gt,I$=Ln,E$=Nm,R$=Object,Ai=E$?function(e){return typeof e=="symbol"}:function(e){var n=T$("Symbol");return k$(n)&&I$(n.prototype,R$(e))},C$=String,Ma=function(e){try{return C$(e)}catch(n){return"Object"}},O$=gt,A$=Ma,P$=TypeError,Lr=function(e){if(O$(e))return e;throw new P$(A$(e)+" is not a function")},M$=Lr,N$=ln,Na=function(e,n){var t=e[n];return N$(t)?void 0:M$(t)},gl=yt,ml=gt,bl=Ct,L$=TypeError,x$=function(e,n){var t,r;if(n==="string"&&ml(t=e.toString)&&!bl(r=gl(t,e))||ml(t=e.valueOf)&&!bl(r=gl(t,e))||n!=="string"&&ml(t=e.toString)&&!bl(r=gl(t,e)))return r;throw new L$("Can't convert object to primitive value")},Lm={exports:{}},xm=!1,Kv=Xe,j$=Object.defineProperty,td=function(e,n){try{j$(Kv,e,{value:n,configurable:!0,writable:!0})}catch(t){Kv[e]=n}return n},U$=Xe,D$=td,Yv="__core-js_shared__",Jv=Lm.exports=U$[Yv]||D$(Yv,{});(Jv.versions||(Jv.versions=[])).push({version:"3.38.0",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"});var rd=Lm.exports,Qv=rd,Pi=function(e,n){return Qv[e]||(Qv[e]=n||{})},F$=Qr,B$=Object,Qt=function(e){return B$(F$(e))},q$=Ke,W$=Qt,G$=q$({}.hasOwnProperty),Pt=Object.hasOwn||function(n,t){return G$(W$(n),t)},H$=Ke,z$=0,V$=Math.random(),K$=H$(1 .toString),js=function(e){return"Symbol("+(e===void 0?"":e)+")_"+K$(++z$+V$,36)},Y$=Xe,J$=Pi,Xv=Pt,Q$=js,X$=Oi,Z$=Nm,oi=Y$.Symbol,wl=J$("wks"),eT=Z$?oi.for||oi:oi&&oi.withoutSetter||Q$,mt=function(e){return Xv(wl,e)||(wl[e]=X$&&Xv(oi,e)?oi[e]:eT("Symbol."+e)),wl[e]},tT=yt,Zv=Ct,ep=Ai,rT=Na,nT=x$,aT=mt,iT=TypeError,sT=aT("toPrimitive"),nd=function(e,n){if(!Zv(e)||ep(e))return e;var t=rT(e,sT),r;if(t){if(n===void 0&&(n="default"),r=tT(t,e,n),!Zv(r)||ep(r))return r;throw new iT("Can't convert object to primitive value")}return n===void 0&&(n="number"),nT(e,n)},uT=nd,oT=Ai,To=function(e){var n=uT(e,"string");return oT(n)?n:n+""},lT=Xe,tp=Ct,Jc=lT.document,cT=tp(Jc)&&tp(Jc.createElement),ko=function(e){return cT?Jc.createElement(e):{}},fT=_t,dT=We,vT=ko,jm=!fT&&!dT(function(){return Object.defineProperty(vT("div"),"a",{get:function(){return 7}}).a!==7}),pT=_t,hT=yt,yT=Ls,gT=Pa,mT=_r,bT=To,wT=Pt,_T=jm,rp=Object.getOwnPropertyDescriptor;Nn.f=pT?rp:function(n,t){if(n=mT(n),t=bT(t),_T)try{return rp(n,t)}catch(r){}if(wT(n,t))return gT(!hT(yT.f,n,t),n[t])};var ar={},ST=_t,$T=We,Um=ST&&$T(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),TT=Ct,kT=String,IT=TypeError,Lt=function(e){if(TT(e))return e;throw new IT(kT(e)+" is not an object")},ET=_t,RT=jm,CT=Um,vu=Lt,np=To,OT=TypeError,_l=Object.defineProperty,AT=Object.getOwnPropertyDescriptor,Sl="enumerable",$l="configurable",Tl="writable";ar.f=ET?CT?function(n,t,r){if(vu(n),t=np(t),vu(r),typeof n=="function"&&t==="prototype"&&"value"in r&&Tl in r&&!r[Tl]){var a=AT(n,t);a&&a[Tl]&&(n[t]=r.value,r={configurable:$l in r?r[$l]:a[$l],enumerable:Sl in r?r[Sl]:a[Sl],writable:!1})}return _l(n,t,r)}:_l:function(n,t,r){if(vu(n),t=np(t),vu(r),RT)try{return _l(n,t,r)}catch(a){}if("get"in r||"set"in r)throw new OT("Accessors not supported");return"value"in r&&(n[t]=r.value),n};var PT=_t,MT=ar,NT=Pa,xn=PT?function(e,n,t){return MT.f(e,n,NT(1,t))}:function(e,n,t){return e[n]=t,e},Dm={exports:{}},Qc=_t,LT=Pt,Fm=Function.prototype,xT=Qc&&Object.getOwnPropertyDescriptor,ad=LT(Fm,"name"),jT=ad&&(function(){}).name==="something",UT=ad&&(!Qc||Qc&&xT(Fm,"name").configurable),Us={EXISTS:ad,PROPER:jT,CONFIGURABLE:UT},DT=Ke,FT=gt,Xc=rd,BT=DT(Function.toString);FT(Xc.inspectSource)||(Xc.inspectSource=function(e){return BT(e)});var id=Xc.inspectSource,qT=Xe,WT=gt,ap=qT.WeakMap,GT=WT(ap)&&/native code/.test(String(ap)),HT=Pi,zT=js,ip=HT("keys"),Io=function(e){return ip[e]||(ip[e]=zT(e))},Ds={},VT=GT,Bm=Xe,KT=Ct,YT=xn,kl=Pt,Il=rd,JT=Io,QT=Ds,sp="Object already initialized",Zc=Bm.TypeError,XT=Bm.WeakMap,no,Is,ao,ZT=function(e){return ao(e)?Is(e):no(e,{})},ek=function(e){return function(n){var t;if(!KT(n)||(t=Is(n)).type!==e)throw new Zc("Incompatible receiver, "+e+" required");return t}};if(VT||Il.state){var en=Il.state||(Il.state=new XT);en.get=en.get,en.has=en.has,en.set=en.set,no=function(e,n){if(en.has(e))throw new Zc(sp);return n.facade=e,en.set(e,n),n},Is=function(e){return en.get(e)||{}},ao=function(e){return en.has(e)}}else{var Ya=JT("state");QT[Ya]=!0,no=function(e,n){if(kl(e,Ya))throw new Zc(sp);return n.facade=e,YT(e,Ya,n),n},Is=function(e){return kl(e,Ya)?e[Ya]:{}},ao=function(e){return kl(e,Ya)}}var xr={set:no,get:Is,has:ao,enforce:ZT,getterFor:ek},sd=Ke,tk=We,rk=gt,pu=Pt,ef=_t,nk=Us.CONFIGURABLE,ak=id,qm=xr,ik=qm.enforce,sk=qm.get,up=String,Ku=Object.defineProperty,uk=sd("".slice),ok=sd("".replace),lk=sd([].join),ck=ef&&!tk(function(){return Ku(function(){},"length",{value:8}).length!==8}),fk=String(String).split("String"),dk=Dm.exports=function(e,n,t){uk(up(n),0,7)==="Symbol("&&(n="["+ok(up(n),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(n="get "+n),t&&t.setter&&(n="set "+n),(!pu(e,"name")||nk&&e.name!==n)&&(ef?Ku(e,"name",{value:n,configurable:!0}):e.name=n),ck&&t&&pu(t,"arity")&&e.length!==t.arity&&Ku(e,"length",{value:t.arity});try{t&&pu(t,"constructor")&&t.constructor?ef&&Ku(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(a){}var r=ik(e);return pu(r,"source")||(r.source=lk(fk,typeof n=="string"?n:"")),e};Function.prototype.toString=dk(function(){return rk(this)&&sk(this).source||ak(this)},"toString");var Wm=Dm.exports,vk=gt,pk=ar,hk=Wm,yk=td,ir=function(e,n,t,r){r||(r={});var a=r.enumerable,i=r.name!==void 0?r.name:n;if(vk(t)&&hk(t,i,r),r.global)a?e[n]=t:yk(n,t);else{try{r.unsafe?e[n]&&(a=!0):delete e[n]}catch(s){}a?e[n]=t:pk.f(e,n,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},La={},gk=Math.ceil,mk=Math.floor,bk=Math.trunc||function(n){var t=+n;return(t>0?mk:gk)(t)},wk=bk,cn=function(e){var n=+e;return n!==n||n===0?0:wk(n)},_k=cn,Sk=Math.max,$k=Math.min,Mi=function(e,n){var t=_k(e);return t<0?Sk(t+n,0):$k(t,n)},Tk=cn,kk=Math.min,jn=function(e){var n=Tk(e);return n>0?kk(n,9007199254740991):0},Ik=jn,Xt=function(e){return Ik(e.length)},Ek=_r,Rk=Mi,Ck=Xt,op=function(e){return function(n,t,r){var a=Ek(n),i=Ck(a);if(i===0)return!e&&-1;var s=Rk(r,i),o;if(e&&t!==t){for(;i>s;)if(o=a[s++],o!==o)return!0}else for(;i>s;s++)if((e||s in a)&&a[s]===t)return e||s||0;return!e&&-1}},Eo={includes:op(!0),indexOf:op(!1)},Ok=Ke,El=Pt,Ak=_r,Pk=Eo.indexOf,Mk=Ds,lp=Ok([].push),Gm=function(e,n){var t=Ak(e),r=0,a=[],i;for(i in t)!El(Mk,i)&&El(t,i)&&lp(a,i);for(;n.length>r;)El(t,i=n[r++])&&(~Pk(a,i)||lp(a,i));return a},ud=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Nk=Gm,Lk=ud,xk=Lk.concat("length","prototype");La.f=Object.getOwnPropertyNames||function(n){return Nk(n,xk)};var Fs={};Fs.f=Object.getOwnPropertySymbols;var jk=Xr,Uk=Ke,Dk=La,Fk=Fs,Bk=Lt,qk=Uk([].concat),Hm=jk("Reflect","ownKeys")||function(n){var t=Dk.f(Bk(n)),r=Fk.f;return r?qk(t,r(n)):t},cp=Pt,Wk=Hm,Gk=Nn,Hk=ar,od=function(e,n,t){for(var r=Wk(n),a=Hk.f,i=Gk.f,s=0;s<r.length;s++){var o=r[s];!cp(e,o)&&!(t&&cp(t,o))&&a(e,o,i(n,o))}},zk=We,Vk=gt,Kk=/#|\.prototype\./,Bs=function(e,n){var t=Jk[Yk(e)];return t===Xk?!0:t===Qk?!1:Vk(n)?zk(n):!!n},Yk=Bs.normalize=function(e){return String(e).replace(Kk,".").toLowerCase()},Jk=Bs.data={},Qk=Bs.NATIVE="N",Xk=Bs.POLYFILL="P",Ro=Bs,hu=Xe,Zk=Nn.f,eI=xn,tI=ir,rI=td,nI=od,aI=Ro,Je=function(e,n){var t=e.target,r=e.global,a=e.stat,i,s,o,u,v,g;if(r?s=hu:a?s=hu[t]||rI(t,{}):s=hu[t]&&hu[t].prototype,s)for(o in n){if(v=n[o],e.dontCallGetSet?(g=Zk(s,o),u=g&&g.value):u=s[o],i=aI(r?o:t+(a?".":"#")+o,e.forced),!i&&u!==void 0){if(typeof v==typeof u)continue;nI(v,u)}(e.sham||u&&u.sham)&&eI(v,"sham",!0),tI(s,o,v,e)}},iI=ar.f,sI=Pt,uI=mt,fp=uI("toStringTag"),fn=function(e,n,t){e&&!t&&(e=e.prototype),e&&!sI(e,fp)&&iI(e,fp,{configurable:!0,value:n})},oI=Je,lI=Xe,cI=fn;oI({global:!0},{Reflect:{}});cI(lI.Reflect,"Reflect",!0);var fI=Ns,zm=Function.prototype,dp=zm.apply,vp=zm.call,xa=typeof Reflect=="object"&&Reflect.apply||(fI?vp.bind(dp):function(){return vp.apply(dp,arguments)}),dI=Ke,dn=dI([].slice),Vm=Ke,vI=Lr,pI=Ct,hI=Pt,pp=dn,yI=Ns,Km=Function,gI=Vm([].concat),mI=Vm([].join),Rl={},bI=function(e,n,t){if(!hI(Rl,n)){for(var r=[],a=0;a<n;a++)r[a]="a["+a+"]";Rl[n]=Km("C,a","return new C("+mI(r,",")+")")}return Rl[n](e,t)},wI=yI?Km.bind:function(n){var t=vI(this),r=t.prototype,a=pp(arguments,1),i=function(){var o=gI(a,pp(arguments));return this instanceof i?bI(t,o.length,o):t.apply(n,o)};return pI(r)&&(i.prototype=r),i},_I=mt,SI=_I("toStringTag"),Ym={};Ym[SI]="z";var ld=String(Ym)==="[object z]",$I=ld,TI=gt,Yu=on,kI=mt,II=kI("toStringTag"),EI=Object,RI=Yu(function(){return arguments}())==="Arguments",CI=function(e,n){try{return e[n]}catch(t){}},Un=$I?Yu:function(e){var n,t,r;return e===void 0?"Undefined":e===null?"Null":typeof(t=CI(n=EI(e),II))=="string"?t:RI?Yu(n):(r=Yu(n))==="Object"&&TI(n.callee)?"Arguments":r},OI=Ke,AI=We,Jm=gt,PI=Un,MI=Xr,NI=id,Qm=function(){},Xm=MI("Reflect","construct"),cd=/^\s*(?:class|function)\b/,LI=OI(cd.exec),xI=!cd.test(Qm),ts=function(n){if(!Jm(n))return!1;try{return Xm(Qm,[],n),!0}catch(t){return!1}},Zm=function(n){if(!Jm(n))return!1;switch(PI(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return xI||!!LI(cd,NI(n))}catch(t){return!0}};Zm.sham=!0;var Co=!Xm||AI(function(){var e;return ts(ts.call)||!ts(Object)||!ts(function(){e=!0})||e})?Zm:ts,jI=Co,UI=Ma,DI=TypeError,fd=function(e){if(jI(e))return e;throw new DI(UI(e)+" is not a constructor")},dd={},FI=Gm,BI=ud,qs=Object.keys||function(n){return FI(n,BI)},qI=_t,WI=Um,GI=ar,HI=Lt,zI=_r,VI=qs;dd.f=qI&&!WI?Object.defineProperties:function(n,t){HI(n);for(var r=zI(t),a=VI(t),i=a.length,s=0,o;i>s;)GI.f(n,o=a[s++],r[o]);return n};var KI=Xr,eb=KI("document","documentElement"),YI=Lt,JI=dd,hp=ud,QI=Ds,XI=eb,ZI=ko,eE=Io,yp=">",gp="<",tf="prototype",rf="script",tb=eE("IE_PROTO"),Cl=function(){},rb=function(e){return gp+rf+yp+e+gp+"/"+rf+yp},mp=function(e){e.write(rb("")),e.close();var n=e.parentWindow.Object;return e=null,n},tE=function(){var e=ZI("iframe"),n="java"+rf+":",t;return e.style.display="none",XI.appendChild(e),e.src=String(n),t=e.contentWindow.document,t.open(),t.write(rb("document.F=Object")),t.close(),t.F},yu,Ju=function(){try{yu=new ActiveXObject("htmlfile")}catch(n){}Ju=typeof document<"u"?document.domain&&yu?mp(yu):tE():mp(yu);for(var e=hp.length;e--;)delete Ju[tf][hp[e]];return Ju()};QI[tb]=!0;var sa=Object.create||function(n,t){var r;return n!==null?(Cl[tf]=YI(n),r=new Cl,Cl[tf]=null,r[tb]=n):r=Ju(),t===void 0?r:JI.f(r,t)},rE=Je,nE=Xr,Ol=xa,aE=wI,bp=fd,iE=Lt,wp=Ct,sE=sa,nb=We,vd=nE("Reflect","construct"),uE=Object.prototype,oE=[].push,ab=nb(function(){function e(){}return!(vd(function(){},[],e)instanceof e)}),ib=!nb(function(){vd(function(){})}),_p=ab||ib;rE({target:"Reflect",stat:!0,forced:_p,sham:_p},{construct:function(n,t){bp(n),iE(t);var r=arguments.length<3?n:bp(arguments[2]);if(ib&&!ab)return vd(n,t,r);if(n===r){switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3])}var a=[null];return Ol(oE,a,t),new(Ol(aE,n,a))}var i=r.prototype,s=sE(wp(i)?i:uE),o=Ol(n,s,t);return wp(o)?o:s}});var lE=Je,cE=Qt,sb=qs,fE=We,dE=fE(function(){sb(1)});lE({target:"Object",stat:!0,forced:dE},{keys:function(n){return sb(cE(n))}});var vE=Un,pE=String,Bt=function(e){if(vE(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return pE(e)},pd={},hE=on,yE=_r,ub=La.f,gE=dn,ob=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],mE=function(e){try{return ub(e)}catch(n){return gE(ob)}};pd.f=function(n){return ob&&hE(n)==="Window"?mE(n):ub(yE(n))};var Sp=Wm,bE=ar,vn=function(e,n,t){return t.get&&Sp(t.get,n,{getter:!0}),t.set&&Sp(t.set,n,{setter:!0}),bE.f(e,n,t)},hd={},wE=mt;hd.f=wE;var _E=Xe,lb=_E,$p=lb,SE=Pt,$E=hd,TE=ar.f,cb=function(e){var n=$p.Symbol||($p.Symbol={});SE(n,e)||TE(n,e,{value:$E.f(e)})},kE=yt,IE=Xr,EE=mt,RE=ir,CE=function(){var e=IE("Symbol"),n=e&&e.prototype,t=n&&n.valueOf,r=EE("toPrimitive");n&&!n[r]&&RE(n,r,function(a){return kE(t,this)},{arity:1})},OE=on,AE=Ke,yd=function(e){if(OE(e)==="Function")return AE(e)},Tp=yd,PE=Lr,ME=Ns,NE=Tp(Tp.bind),Dn=function(e,n){return PE(e),n===void 0?e:ME?NE(e,n):function(){return e.apply(n,arguments)}},LE=on,Ws=Array.isArray||function(n){return LE(n)==="Array"},kp=Ws,xE=Co,jE=Ct,UE=mt,DE=UE("species"),Ip=Array,FE=function(e){var n;return kp(e)&&(n=e.constructor,xE(n)&&(n===Ip||kp(n.prototype))?n=void 0:jE(n)&&(n=n[DE],n===null&&(n=void 0))),n===void 0?Ip:n},BE=FE,gd=function(e,n){return new(BE(e))(n===0?0:n)},qE=Dn,WE=Ke,GE=xs,HE=Qt,zE=Xt,VE=gd,Ep=WE([].push),zn=function(e){var n=e===1,t=e===2,r=e===3,a=e===4,i=e===6,s=e===7,o=e===5||i;return function(u,v,g,m){for(var _=HE(u),w=GE(_),R=zE(w),M=qE(v,g),x=0,j=m||VE,H=n?j(u,R):t||s?j(u,0):void 0,me,ne;R>x;x++)if((o||x in w)&&(me=w[x],ne=M(me,x,_),e))if(n)H[x]=ne;else if(ne)switch(e){case 3:return!0;case 5:return me;case 6:return x;case 2:Ep(H,me)}else switch(e){case 4:return!1;case 7:Ep(H,me)}return i?-1:r||a?a:H}},Sr={forEach:zn(0),map:zn(1),filter:zn(2),some:zn(3),every:zn(4),find:zn(5),findIndex:zn(6),filterReject:zn(7)},Oo=Je,Gs=Xe,md=yt,KE=Ke,_i=_t,Si=Oi,YE=We,Wt=Pt,JE=Ln,nf=Lt,Ao=_r,bd=To,QE=Bt,af=Pa,$i=sa,fb=qs,XE=La,db=pd,ZE=Fs,vb=Nn,pb=ar,e1=dd,hb=Ls,Al=ir,t1=vn,wd=Pi,r1=Io,yb=Ds,Rp=js,n1=mt,a1=hd,i1=cb,s1=CE,u1=fn,gb=xr,Po=Sr.forEach,fr=r1("hidden"),Mo="Symbol",Es="prototype",o1=gb.set,Cp=gb.getterFor(Mo),Nr=Object[Es],Ia=Gs.Symbol,ps=Ia&&Ia[Es],l1=Gs.RangeError,c1=Gs.TypeError,Pl=Gs.QObject,mb=vb.f,Ea=pb.f,bb=db.f,f1=hb.f,wb=KE([].push),Cn=wd("symbols"),Hs=wd("op-symbols"),d1=wd("wks"),sf=!Pl||!Pl[Es]||!Pl[Es].findChild,_b=function(e,n,t){var r=mb(Nr,n);r&&delete Nr[n],Ea(e,n,t),r&&e!==Nr&&Ea(Nr,n,r)},uf=_i&&YE(function(){return $i(Ea({},"a",{get:function(){return Ea(this,"a",{value:7}).a}})).a!==7})?_b:Ea,Ml=function(e,n){var t=Cn[e]=$i(ps);return o1(t,{type:Mo,tag:e,description:n}),_i||(t.description=n),t},No=function(n,t,r){n===Nr&&No(Hs,t,r),nf(n);var a=bd(t);return nf(r),Wt(Cn,a)?(r.enumerable?(Wt(n,fr)&&n[fr][a]&&(n[fr][a]=!1),r=$i(r,{enumerable:af(0,!1)})):(Wt(n,fr)||Ea(n,fr,af(1,$i(null))),n[fr][a]=!0),uf(n,a,r)):Ea(n,a,r)},_d=function(n,t){nf(n);var r=Ao(t),a=fb(r).concat(Tb(r));return Po(a,function(i){(!_i||md(of,r,i))&&No(n,i,r[i])}),n},v1=function(n,t){return t===void 0?$i(n):_d($i(n),t)},of=function(n){var t=bd(n),r=md(f1,this,t);return this===Nr&&Wt(Cn,t)&&!Wt(Hs,t)?!1:r||!Wt(this,t)||!Wt(Cn,t)||Wt(this,fr)&&this[fr][t]?r:!0},Sb=function(n,t){var r=Ao(n),a=bd(t);if(!(r===Nr&&Wt(Cn,a)&&!Wt(Hs,a))){var i=mb(r,a);return i&&Wt(Cn,a)&&!(Wt(r,fr)&&r[fr][a])&&(i.enumerable=!0),i}},$b=function(n){var t=bb(Ao(n)),r=[];return Po(t,function(a){!Wt(Cn,a)&&!Wt(yb,a)&&wb(r,a)}),r},Tb=function(e){var n=e===Nr,t=bb(n?Hs:Ao(e)),r=[];return Po(t,function(a){Wt(Cn,a)&&(!n||Wt(Nr,a))&&wb(r,Cn[a])}),r};Si||(Ia=function(){if(JE(ps,this))throw new c1("Symbol is not a constructor");var n=!arguments.length||arguments[0]===void 0?void 0:QE(arguments[0]),t=Rp(n),r=function(a){var i=this===void 0?Gs:this;i===Nr&&md(r,Hs,a),Wt(i,fr)&&Wt(i[fr],t)&&(i[fr][t]=!1);var s=af(1,a);try{uf(i,t,s)}catch(o){if(!(o instanceof l1))throw o;_b(i,t,s)}};return _i&&sf&&uf(Nr,t,{configurable:!0,set:r}),Ml(t,n)},ps=Ia[Es],Al(ps,"toString",function(){return Cp(this).tag}),Al(Ia,"withoutSetter",function(e){return Ml(Rp(e),e)}),hb.f=of,pb.f=No,e1.f=_d,vb.f=Sb,XE.f=db.f=$b,ZE.f=Tb,a1.f=function(e){return Ml(n1(e),e)},_i&&(t1(ps,"description",{configurable:!0,get:function(){return Cp(this).description}}),Al(Nr,"propertyIsEnumerable",of,{unsafe:!0})));Oo({global:!0,constructor:!0,wrap:!0,forced:!Si,sham:!Si},{Symbol:Ia});Po(fb(d1),function(e){i1(e)});Oo({target:Mo,stat:!0,forced:!Si},{useSetter:function(){sf=!0},useSimple:function(){sf=!1}});Oo({target:"Object",stat:!0,forced:!Si,sham:!_i},{create:v1,defineProperty:No,defineProperties:_d,getOwnPropertyDescriptor:Sb});Oo({target:"Object",stat:!0,forced:!Si},{getOwnPropertyNames:$b});s1();u1(Ia,Mo);yb[fr]=!0;var p1=Oi,kb=p1&&!!Symbol.for&&!!Symbol.keyFor,h1=Je,y1=Xr,g1=Pt,m1=Bt,Ib=Pi,b1=kb,Nl=Ib("string-to-symbol-registry"),w1=Ib("symbol-to-string-registry");h1({target:"Symbol",stat:!0,forced:!b1},{for:function(e){var n=m1(e);if(g1(Nl,n))return Nl[n];var t=y1("Symbol")(n);return Nl[n]=t,w1[t]=n,t}});var _1=Je,S1=Pt,$1=Ai,T1=Ma,k1=Pi,I1=kb,Op=k1("symbol-to-string-registry");_1({target:"Symbol",stat:!0,forced:!I1},{keyFor:function(n){if(!$1(n))throw new TypeError(T1(n)+" is not a symbol");if(S1(Op,n))return Op[n]}});var E1=Ke,Ap=Ws,R1=gt,Pp=on,C1=Bt,Mp=E1([].push),O1=function(e){if(R1(e))return e;if(Ap(e)){for(var n=e.length,t=[],r=0;r<n;r++){var a=e[r];typeof a=="string"?Mp(t,a):(typeof a=="number"||Pp(a)==="Number"||Pp(a)==="String")&&Mp(t,C1(a))}var i=t.length,s=!0;return function(o,u){if(s)return s=!1,u;if(Ap(this))return u;for(var v=0;v<i;v++)if(t[v]===o)return u}}},A1=Je,Eb=Xr,Rb=xa,P1=yt,zs=Ke,Cb=We,Np=gt,Lp=Ai,Ob=dn,M1=O1,N1=Oi,L1=String,Zn=Eb("JSON","stringify"),gu=zs(/./.exec),xp=zs("".charAt),x1=zs("".charCodeAt),j1=zs("".replace),U1=zs(1 .toString),D1=/[\uD800-\uDFFF]/g,jp=/^[\uD800-\uDBFF]$/,Up=/^[\uDC00-\uDFFF]$/,Dp=!N1||Cb(function(){var e=Eb("Symbol")("stringify detection");return Zn([e])!=="[null]"||Zn({a:e})!=="{}"||Zn(Object(e))!=="{}"}),Fp=Cb(function(){return Zn("\uDF06\uD834")!=='"\\udf06\\ud834"'||Zn("\uDEAD")!=='"\\udead"'}),F1=function(e,n){var t=Ob(arguments),r=M1(n);if(!(!Np(r)&&(e===void 0||Lp(e))))return t[1]=function(a,i){if(Np(r)&&(i=P1(r,this,L1(a),i)),!Lp(i))return i},Rb(Zn,null,t)},B1=function(e,n,t){var r=xp(t,n-1),a=xp(t,n+1);return gu(jp,e)&&!gu(Up,a)||gu(Up,e)&&!gu(jp,r)?"\\u"+U1(x1(e,0),16):e};Zn&&A1({target:"JSON",stat:!0,arity:3,forced:Dp||Fp},{stringify:function(n,t,r){var a=Ob(arguments),i=Rb(Dp?F1:Zn,null,a);return Fp&&typeof i=="string"?j1(i,D1,B1):i}});var q1=Je,W1=Oi,G1=We,Ab=Fs,H1=Qt,z1=!W1||G1(function(){Ab.f(1)});q1({target:"Object",stat:!0,forced:z1},{getOwnPropertySymbols:function(n){var t=Ab.f;return t?t(H1(n)):[]}});var V1=We,K1=mt,Y1=Ci,J1=K1("species"),Vs=function(e){return Y1>=51||!V1(function(){var n=[],t=n.constructor={};return t[J1]=function(){return{foo:1}},n[e](Boolean).foo!==1})},Q1=Je,X1=Sr.filter,Z1=Vs,eR=Z1("filter");Q1({target:"Array",proto:!0,forced:!eR},{filter:function(n){return X1(this,n,arguments.length>1?arguments[1]:void 0)}});var tR=Je,rR=We,nR=_r,Pb=Nn.f,Mb=_t,aR=!Mb||rR(function(){Pb(1)});tR({target:"Object",stat:!0,forced:aR,sham:!Mb},{getOwnPropertyDescriptor:function(n,t){return Pb(nR(n),t)}});var iR=_t,sR=ar,uR=Pa,Ks=function(e,n,t){iR?sR.f(e,n,uR(0,t)):e[n]=t},oR=Je,lR=_t,cR=Hm,fR=_r,dR=Nn,vR=Ks;oR({target:"Object",stat:!0,sham:!lR},{getOwnPropertyDescriptors:function(n){for(var t=fR(n),r=dR.f,a=cR(t),i={},s=0,o,u;a.length>s;)u=r(t,o=a[s++]),u!==void 0&&vR(i,o,u);return i}});var Nb={exports:{}};(function(e){function n(r,a,i,s,o,u,v){try{var g=r[u](v),m=g.value}catch(_){return void i(_)}g.done?a(m):Promise.resolve(m).then(s,o)}function t(r){return function(){var a=this,i=arguments;return new Promise(function(s,o){var u=r.apply(a,i);function v(m){n(u,s,o,v,g,"next",m)}function g(m){n(u,s,o,v,g,"throw",m)}v(void 0)})}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Nb);var Ys=Nb.exports,Lb={exports:{}};(function(e){function n(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Lb);var ja=Lb.exports,xb={exports:{}},jb={exports:{}};(function(e){function n(t,r){return e.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,i){return a.__proto__=i,a},e.exports.__esModule=!0,e.exports.default=e.exports,n(t,r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(jb);var Sd=jb.exports;(function(e){var n=Sd;function t(r,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(a&&a.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),a&&n(r,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(xb);var pn=xb.exports,Ub={exports:{}},Db={exports:{}};(function(e){function n(t){"@babel/helpers - typeof";return e.exports=n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Db);var jr=Db.exports;(function(e){var n=jr.default,t=ja;function r(a,i){if(i&&(n(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return t(a)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Ub);var hn=Ub.exports,Fb={exports:{}};(function(e){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Fb);var Ur=Fb.exports,Bb={exports:{}},qb={exports:{}},Wb={exports:{}};(function(e){var n=jr.default;function t(r,a){if(n(r)!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var s=i.call(r,a||"default");if(n(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Wb);var pR=Wb.exports;(function(e){var n=jr.default,t=pR;function r(a){var i=t(a,"string");return n(i)=="symbol"?i:i+""}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(qb);var Gb=qb.exports;(function(e){var n=Gb;function t(r,a,i){return(a=n(a))in r?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i,r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(Bb);var Ua=Bb.exports,Hb={exports:{}};(function(e){var n=Gb;function t(a,i){for(var s=0;s<i.length;s++){var o=i[s];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,n(o.key),o)}}function r(a,i,s){return i&&t(a.prototype,i),s&&t(a,s),Object.defineProperty(a,"prototype",{writable:!1}),a}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(Hb);var ua=Hb.exports,zb={exports:{}};(function(e){function n(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(zb);var yn=zb.exports,hR=ld,yR=Un,gR=hR?{}.toString:function(){return"[object "+yR(this)+"]"},mR=ld,bR=ir,wR=gR;mR||bR(Object.prototype,"toString",wR,{unsafe:!0});var rs=Xe,_R=ia,SR=on,mu=function(e){return _R.slice(0,e.length)===e},Vb=function(){return mu("Bun/")?"BUN":mu("Cloudflare-Workers")?"CLOUDFLARE":mu("Deno/")?"DENO":mu("Node.js/")?"NODE":rs.Bun&&typeof Bun.version=="string"?"BUN":rs.Deno&&typeof Deno.version=="object"?"DENO":SR(rs.process)==="process"?"NODE":rs.window&&rs.document?"BROWSER":"REST"}(),$R=Vb,$d=$R==="NODE",TR=Ke,kR=Lr,IR=function(e,n,t){try{return TR(kR(Object.getOwnPropertyDescriptor(e,n)[t]))}catch(r){}},ER=Ct,RR=function(e){return ER(e)||e===null},CR=RR,OR=String,AR=TypeError,PR=function(e){if(CR(e))return e;throw new AR("Can't set "+OR(e)+" as a prototype")},MR=IR,NR=Ct,LR=Qr,xR=PR,Ni=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,n={},t;try{t=MR(Object.prototype,"__proto__","set"),t(n,[]),e=n instanceof Array}catch(r){}return function(a,i){return LR(a),xR(i),NR(a)&&(e?t(a,i):a.__proto__=i),a}}():void 0),jR=Xr,UR=vn,DR=mt,FR=_t,Bp=DR("species"),Lo=function(e){var n=jR(e);FR&&n&&!n[Bp]&&UR(n,Bp,{configurable:!0,get:function(){return this}})},BR=Ln,qR=TypeError,Da=function(e,n){if(BR(n,e))return e;throw new qR("Incorrect invocation")},qp=Lt,WR=fd,GR=ln,HR=mt,zR=HR("species"),Td=function(e,n){var t=qp(e).constructor,r;return t===void 0||GR(r=qp(t)[zR])?n:WR(r)},VR=TypeError,kd=function(e,n){if(e<n)throw new VR("Not enough arguments");return e},KR=ia,Kb=/(?:ipad|iphone|ipod).*applewebkit/i.test(KR),wr=Xe,YR=xa,JR=Dn,Wp=gt,QR=Pt,Yb=We,Gp=eb,XR=dn,Hp=ko,ZR=kd,eC=Kb,tC=$d,lf=wr.setImmediate,cf=wr.clearImmediate,rC=wr.process,Ll=wr.Dispatch,nC=wr.Function,zp=wr.MessageChannel,aC=wr.String,xl=0,bs={},Vp="onreadystatechange",Rs,ga,jl,Ul;Yb(function(){Rs=wr.location});var Id=function(e){if(QR(bs,e)){var n=bs[e];delete bs[e],n()}},Dl=function(e){return function(){Id(e)}},Kp=function(e){Id(e.data)},Yp=function(e){wr.postMessage(aC(e),Rs.protocol+"//"+Rs.host)};(!lf||!cf)&&(lf=function(n){ZR(arguments.length,1);var t=Wp(n)?n:nC(n),r=XR(arguments,1);return bs[++xl]=function(){YR(t,void 0,r)},ga(xl),xl},cf=function(n){delete bs[n]},tC?ga=function(e){rC.nextTick(Dl(e))}:Ll&&Ll.now?ga=function(e){Ll.now(Dl(e))}:zp&&!eC?(jl=new zp,Ul=jl.port2,jl.port1.onmessage=Kp,ga=JR(Ul.postMessage,Ul)):wr.addEventListener&&Wp(wr.postMessage)&&!wr.importScripts&&Rs&&Rs.protocol!=="file:"&&!Yb(Yp)?(ga=Yp,wr.addEventListener("message",Kp,!1)):Vp in Hp("script")?ga=function(e){Gp.appendChild(Hp("script"))[Vp]=function(){Gp.removeChild(this),Id(e)}}:ga=function(e){setTimeout(Dl(e),0)});var Jb={set:lf,clear:cf},Jp=Xe,iC=_t,sC=Object.getOwnPropertyDescriptor,Qb=function(e){if(!iC)return Jp[e];var n=sC(Jp,e);return n&&n.value},Xb=function(){this.head=null,this.tail=null};Xb.prototype={add:function(e){var n={item:e,next:null},t=this.tail;t?t.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e){var n=this.head=e.next;return n===null&&(this.tail=null),e.item}}};var Zb=Xb,uC=ia,oC=/ipad|iphone|ipod/i.test(uC)&&typeof Pebble<"u",lC=ia,cC=/web0s(?!.*chrome)/i.test(lC),Ti=Xe,fC=Qb,Qp=Dn,Fl=Jb.set,dC=Zb,vC=Kb,pC=oC,hC=cC,Bl=$d,Xp=Ti.MutationObserver||Ti.WebKitMutationObserver,Zp=Ti.document,eh=Ti.process,bu=Ti.Promise,ff=fC("queueMicrotask"),Ja,ql,Wl,wu,th;if(!ff){var _u=new dC,Su=function(){var e,n;for(Bl&&(e=eh.domain)&&e.exit();n=_u.get();)try{n()}catch(t){throw _u.head&&Ja(),t}e&&e.enter()};!vC&&!Bl&&!hC&&Xp&&Zp?(ql=!0,Wl=Zp.createTextNode(""),new Xp(Su).observe(Wl,{characterData:!0}),Ja=function(){Wl.data=ql=!ql}):!pC&&bu&&bu.resolve?(wu=bu.resolve(void 0),wu.constructor=bu,th=Qp(wu.then,wu),Ja=function(){th(Su)}):Bl?Ja=function(){eh.nextTick(Su)}:(Fl=Qp(Fl,Ti),Ja=function(){Fl(Su)}),ff=function(e){_u.head||Ja(),_u.add(e)}}var yC=ff,gC=function(e,n){try{arguments.length===1?console.error(e):console.error(e,n)}catch(t){}},Ed=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},mC=Xe,xo=mC.Promise,bC=Xe,ws=xo,wC=gt,_C=Ro,SC=id,$C=mt,rh=Vb,Gl=Ci;ws&&ws.prototype;var TC=$C("species"),df=!1,ew=wC(bC.PromiseRejectionEvent),kC=_C("Promise",function(){var e=SC(ws),n=e!==String(ws);if(!n&&Gl===66)return!0;if(!Gl||Gl<51||!/native code/.test(e)){var t=new ws(function(i){i(1)}),r=function(i){i(function(){},function(){})},a=t.constructor={};if(a[TC]=r,df=t.then(function(){})instanceof r,!df)return!0}return!n&&(rh==="BROWSER"||rh==="DENO")&&!ew}),Js={CONSTRUCTOR:kC,REJECTION_EVENT:ew,SUBCLASSING:df},Li={},nh=Lr,IC=TypeError,EC=function(e){var n,t;this.promise=new e(function(r,a){if(n!==void 0||t!==void 0)throw new IC("Bad Promise constructor");n=r,t=a}),this.resolve=nh(n),this.reject=nh(t)};Li.f=function(e){return new EC(e)};var RC=Je,io=$d,na=Xe,ki=yt,ah=ir,ih=Ni,CC=fn,OC=Lo,AC=Lr,Qu=gt,PC=Ct,MC=Da,NC=Td,tw=Jb.set,Rd=yC,LC=gC,xC=Ed,jC=Zb,rw=xr,so=xo,Cd=Js,nw=Li,jo="Promise",aw=Cd.CONSTRUCTOR,UC=Cd.REJECTION_EVENT,DC=Cd.SUBCLASSING,Hl=rw.getterFor(jo),FC=rw.set,ii=so&&so.prototype,Ta=so,$u=ii,iw=na.TypeError,vf=na.document,Od=na.process,pf=nw.f,BC=pf,qC=!!(vf&&vf.createEvent&&na.dispatchEvent),sw="unhandledrejection",WC="rejectionhandled",sh=0,uw=1,GC=2,Ad=1,ow=2,Tu,uh,HC,oh,lw=function(e){var n;return PC(e)&&Qu(n=e.then)?n:!1},cw=function(e,n){var t=n.value,r=n.state===uw,a=r?e.ok:e.fail,i=e.resolve,s=e.reject,o=e.domain,u,v,g;try{a?(r||(n.rejection===ow&&VC(n),n.rejection=Ad),a===!0?u=t:(o&&o.enter(),u=a(t),o&&(o.exit(),g=!0)),u===e.promise?s(new iw("Promise-chain cycle")):(v=lw(u))?ki(v,u,i,s):i(u)):s(t)}catch(m){o&&!g&&o.exit(),s(m)}},fw=function(e,n){e.notified||(e.notified=!0,Rd(function(){for(var t=e.reactions,r;r=t.get();)cw(r,e);e.notified=!1,n&&!e.rejection&&zC(e)}))},dw=function(e,n,t){var r,a;qC?(r=vf.createEvent("Event"),r.promise=n,r.reason=t,r.initEvent(e,!1,!0),na.dispatchEvent(r)):r={promise:n,reason:t},!UC&&(a=na["on"+e])?a(r):e===sw&&LC("Unhandled promise rejection",t)},zC=function(e){ki(tw,na,function(){var n=e.facade,t=e.value,r=lh(e),a;if(r&&(a=xC(function(){io?Od.emit("unhandledRejection",t,n):dw(sw,n,t)}),e.rejection=io||lh(e)?ow:Ad,a.error))throw a.value})},lh=function(e){return e.rejection!==Ad&&!e.parent},VC=function(e){ki(tw,na,function(){var n=e.facade;io?Od.emit("rejectionHandled",n):dw(WC,n,e.value)})},li=function(e,n,t){return function(r){e(n,r,t)}},di=function(e,n,t){e.done||(e.done=!0,t&&(e=t),e.value=n,e.state=GC,fw(e,!0))},hf=function(e,n,t){if(!e.done){e.done=!0,t&&(e=t);try{if(e.facade===n)throw new iw("Promise can't be resolved itself");var r=lw(n);r?Rd(function(){var a={done:!1};try{ki(r,n,li(hf,a,e),li(di,a,e))}catch(i){di(a,i,e)}}):(e.value=n,e.state=uw,fw(e,!1))}catch(a){di({done:!1},a,e)}}};if(aw&&(Ta=function(n){MC(this,$u),AC(n),ki(Tu,this);var t=Hl(this);try{n(li(hf,t),li(di,t))}catch(r){di(t,r)}},$u=Ta.prototype,Tu=function(n){FC(this,{type:jo,done:!1,notified:!1,parent:!1,reactions:new jC,rejection:!1,state:sh,value:void 0})},Tu.prototype=ah($u,"then",function(n,t){var r=Hl(this),a=pf(NC(this,Ta));return r.parent=!0,a.ok=Qu(n)?n:!0,a.fail=Qu(t)&&t,a.domain=io?Od.domain:void 0,r.state===sh?r.reactions.add(a):Rd(function(){cw(a,r)}),a.promise}),uh=function(){var e=new Tu,n=Hl(e);this.promise=e,this.resolve=li(hf,n),this.reject=li(di,n)},nw.f=pf=function(e){return e===Ta||e===HC?new uh(e):BC(e)},Qu(so)&&ii!==Object.prototype)){oh=ii.then,DC||ah(ii,"then",function(n,t){var r=this;return new Ta(function(a,i){ki(oh,r,a,i)}).then(n,t)},{unsafe:!0});try{delete ii.constructor}catch(e){}ih&&ih(ii,$u)}RC({global:!0,constructor:!0,wrap:!0,forced:aw},{Promise:Ta});CC(Ta,jo,!1);OC(jo);var Qs={},KC=mt,YC=Qs,JC=KC("iterator"),QC=Array.prototype,Pd=function(e){return e!==void 0&&(YC.Array===e||QC[JC]===e)},XC=Un,ch=Na,ZC=ln,eO=Qs,tO=mt,rO=tO("iterator"),Xs=function(e){if(!ZC(e))return ch(e,rO)||ch(e,"@@iterator")||eO[XC(e)]},nO=yt,aO=Lr,iO=Lt,sO=Ma,uO=Xs,oO=TypeError,Uo=function(e,n){var t=arguments.length<2?uO(e):n;if(aO(t))return iO(nO(t,e));throw new oO(sO(e)+" is not iterable")},lO=yt,fh=Lt,cO=Na,vw=function(e,n,t){var r,a;fh(e);try{if(r=cO(e,"return"),!r){if(n==="throw")throw t;return t}r=lO(r,e)}catch(i){a=!0,r=i}if(n==="throw")throw t;if(a)throw r;return fh(r),t},fO=Dn,dO=yt,vO=Lt,pO=Ma,hO=Pd,yO=Xt,dh=Ln,gO=Uo,mO=Xs,vh=vw,bO=TypeError,Xu=function(e,n){this.stopped=e,this.result=n},ph=Xu.prototype,Do=function(e,n,t){var r=t&&t.that,a=!!(t&&t.AS_ENTRIES),i=!!(t&&t.IS_RECORD),s=!!(t&&t.IS_ITERATOR),o=!!(t&&t.INTERRUPTED),u=fO(n,r),v,g,m,_,w,R,M,x=function(H){return v&&vh(v,"normal",H),new Xu(!0,H)},j=function(H){return a?(vO(H),o?u(H[0],H[1],x):u(H[0],H[1])):o?u(H,x):u(H)};if(i)v=e.iterator;else if(s)v=e;else{if(g=mO(e),!g)throw new bO(pO(e)+" is not iterable");if(hO(g)){for(m=0,_=yO(e);_>m;m++)if(w=j(e[m]),w&&dh(ph,w))return w;return new Xu(!1)}v=gO(e,g)}for(R=i?e.next:v.next;!(M=dO(R,v)).done;){try{w=j(M.value)}catch(H){vh(v,"throw",H)}if(typeof w=="object"&&w&&dh(ph,w))return w}return new Xu(!1)},wO=mt,pw=wO("iterator"),hw=!1;try{var _O=0,hh={next:function(){return{done:!!_O++}},return:function(){hw=!0}};hh[pw]=function(){return this},Array.from(hh,function(){throw 2})}catch(e){}var Fo=function(e,n){try{if(!n&&!hw)return!1}catch(a){return!1}var t=!1;try{var r={};r[pw]=function(){return{next:function(){return{done:t=!0}}}},e(r)}catch(a){}return t},SO=xo,$O=Fo,TO=Js.CONSTRUCTOR,yw=TO||!$O(function(e){SO.all(e).then(void 0,function(){})}),kO=Je,IO=yt,EO=Lr,RO=Li,CO=Ed,OO=Do,AO=yw;kO({target:"Promise",stat:!0,forced:AO},{all:function(n){var t=this,r=RO.f(t),a=r.resolve,i=r.reject,s=CO(function(){var o=EO(t.resolve),u=[],v=0,g=1;OO(n,function(m){var _=v++,w=!1;g++,IO(o,t,m).then(function(R){w||(w=!0,u[_]=R,--g||a(u))},i)}),--g||a(u)});return s.error&&i(s.value),r.promise}});var PO=Je,MO=Js.CONSTRUCTOR,yf=xo,NO=Xr,LO=gt,xO=ir,yh=yf&&yf.prototype;PO({target:"Promise",proto:!0,forced:MO,real:!0},{catch:function(e){return this.then(void 0,e)}});if(LO(yf)){var gh=NO("Promise").prototype.catch;yh.catch!==gh&&xO(yh,"catch",gh,{unsafe:!0})}var jO=Je,UO=yt,DO=Lr,FO=Li,BO=Ed,qO=Do,WO=yw;jO({target:"Promise",stat:!0,forced:WO},{race:function(n){var t=this,r=FO.f(t),a=r.reject,i=BO(function(){var s=DO(t.resolve);qO(n,function(o){UO(s,t,o).then(r.resolve,a)})});return i.error&&a(i.value),r.promise}});var GO=Je,HO=Li,zO=Js.CONSTRUCTOR;GO({target:"Promise",stat:!0,forced:zO},{reject:function(n){var t=HO.f(this),r=t.reject;return r(n),t.promise}});var VO=Lt,KO=Ct,YO=Li,JO=function(e,n){if(VO(e),KO(n)&&n.constructor===e)return n;var t=YO.f(e),r=t.resolve;return r(n),t.promise},QO=Je,XO=Xr,ZO=Js.CONSTRUCTOR,eA=JO;XO("Promise");QO({target:"Promise",stat:!0,forced:ZO},{resolve:function(n){return eA(this,n)}});var tA=Je,rA=Sr.map,nA=Vs,aA=nA("map");tA({target:"Array",proto:!0,forced:!aA},{map:function(n){return rA(this,n,arguments.length>1?arguments[1]:void 0)}});var gw={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},iA=ko,zl=iA("span").classList,mh=zl&&zl.constructor&&zl.constructor.prototype,mw=mh===Object.prototype?void 0:mh,sA=We,Bo=function(e,n){var t=[][e];return!!t&&sA(function(){t.call(null,n||function(){return 1},1)})},uA=Sr.forEach,oA=Bo,lA=oA("forEach"),cA=lA?[].forEach:function(n){return uA(this,n,arguments.length>1?arguments[1]:void 0)},bh=Xe,wh=gw,fA=mw,Vl=cA,dA=xn,bw=function(e){if(e&&e.forEach!==Vl)try{dA(e,"forEach",Vl)}catch(n){e.forEach=Vl}};for(var Kl in wh)wh[Kl]&&bw(bh[Kl]&&bh[Kl].prototype);bw(fA);var ww={exports:{}};(function(e){var n=jr.default;function t(){e.exports=t=function(){return a},e.exports.__esModule=!0,e.exports.default=e.exports;var r,a={},i=Object.prototype,s=i.hasOwnProperty,o=Object.defineProperty||function(k,te,le){k[te]=le.value},u=typeof Symbol=="function"?Symbol:{},v=u.iterator||"@@iterator",g=u.asyncIterator||"@@asyncIterator",m=u.toStringTag||"@@toStringTag";function _(k,te,le){return Object.defineProperty(k,te,{value:le,enumerable:!0,configurable:!0,writable:!0}),k[te]}try{_({},"")}catch(k){_=function(le,ce,Ne){return le[ce]=Ne}}function w(k,te,le,ce){var Ne=te&&te.prototype instanceof ne?te:ne,be=Object.create(Ne.prototype),X=new Ye(ce||[]);return o(be,"_invoke",{value:Pe(k,le,X)}),be}function R(k,te,le){try{return{type:"normal",arg:k.call(te,le)}}catch(ce){return{type:"throw",arg:ce}}}a.wrap=w;var M="suspendedStart",x="suspendedYield",j="executing",H="completed",me={};function ne(){}function Ie(){}function Ee(){}var xe={};_(xe,v,function(){return this});var B=Object.getPrototypeOf,J=B&&B(B(ze([])));J&&J!==i&&s.call(J,v)&&(xe=J);var pe=Ee.prototype=ne.prototype=Object.create(xe);function F(k){["next","throw","return"].forEach(function(te){_(k,te,function(le){return this._invoke(te,le)})})}function de(k,te){function le(Ne,be,X,I){var tt=R(k[Ne],k,be);if(tt.type!=="throw"){var Se=tt.arg,ut=Se.value;return ut&&n(ut)=="object"&&s.call(ut,"__await")?te.resolve(ut.__await).then(function(bt){le("next",bt,X,I)},function(bt){le("throw",bt,X,I)}):te.resolve(ut).then(function(bt){Se.value=bt,X(Se)},function(bt){return le("throw",bt,X,I)})}I(tt.arg)}var ce;o(this,"_invoke",{value:function(be,X){function I(){return new te(function(tt,Se){le(be,X,tt,Se)})}return ce=ce?ce.then(I,I):I()}})}function Pe(k,te,le){var ce=M;return function(Ne,be){if(ce===j)throw Error("Generator is already running");if(ce===H){if(Ne==="throw")throw be;return{value:r,done:!0}}for(le.method=Ne,le.arg=be;;){var X=le.delegate;if(X){var I=Me(X,le);if(I){if(I===me)continue;return I}}if(le.method==="next")le.sent=le._sent=le.arg;else if(le.method==="throw"){if(ce===M)throw ce=H,le.arg;le.dispatchException(le.arg)}else le.method==="return"&&le.abrupt("return",le.arg);ce=j;var tt=R(k,te,le);if(tt.type==="normal"){if(ce=le.done?H:x,tt.arg===me)continue;return{value:tt.arg,done:le.done}}tt.type==="throw"&&(ce=H,le.method="throw",le.arg=tt.arg)}}}function Me(k,te){var le=te.method,ce=k.iterator[le];if(ce===r)return te.delegate=null,le==="throw"&&k.iterator.return&&(te.method="return",te.arg=r,Me(k,te),te.method==="throw")||le!=="return"&&(te.method="throw",te.arg=new TypeError("The iterator does not provide a '"+le+"' method")),me;var Ne=R(ce,k.iterator,te.arg);if(Ne.type==="throw")return te.method="throw",te.arg=Ne.arg,te.delegate=null,me;var be=Ne.arg;return be?be.done?(te[k.resultName]=be.value,te.next=k.nextLoc,te.method!=="return"&&(te.method="next",te.arg=r),te.delegate=null,me):be:(te.method="throw",te.arg=new TypeError("iterator result is not an object"),te.delegate=null,me)}function _e(k){var te={tryLoc:k[0]};1 in k&&(te.catchLoc=k[1]),2 in k&&(te.finallyLoc=k[2],te.afterLoc=k[3]),this.tryEntries.push(te)}function he(k){var te=k.completion||{};te.type="normal",delete te.arg,k.completion=te}function Ye(k){this.tryEntries=[{tryLoc:"root"}],k.forEach(_e,this),this.reset(!0)}function ze(k){if(k||k===""){var te=k[v];if(te)return te.call(k);if(typeof k.next=="function")return k;if(!isNaN(k.length)){var le=-1,ce=function Ne(){for(;++le<k.length;)if(s.call(k,le))return Ne.value=k[le],Ne.done=!1,Ne;return Ne.value=r,Ne.done=!0,Ne};return ce.next=ce}}throw new TypeError(n(k)+" is not iterable")}return Ie.prototype=Ee,o(pe,"constructor",{value:Ee,configurable:!0}),o(Ee,"constructor",{value:Ie,configurable:!0}),Ie.displayName=_(Ee,m,"GeneratorFunction"),a.isGeneratorFunction=function(k){var te=typeof k=="function"&&k.constructor;return!!te&&(te===Ie||(te.displayName||te.name)==="GeneratorFunction")},a.mark=function(k){return Object.setPrototypeOf?Object.setPrototypeOf(k,Ee):(k.__proto__=Ee,_(k,m,"GeneratorFunction")),k.prototype=Object.create(pe),k},a.awrap=function(k){return{__await:k}},F(de.prototype),_(de.prototype,g,function(){return this}),a.AsyncIterator=de,a.async=function(k,te,le,ce,Ne){Ne===void 0&&(Ne=Promise);var be=new de(w(k,te,le,ce),Ne);return a.isGeneratorFunction(te)?be:be.next().then(function(X){return X.done?X.value:be.next()})},F(pe),_(pe,m,"Generator"),_(pe,v,function(){return this}),_(pe,"toString",function(){return"[object Generator]"}),a.keys=function(k){var te=Object(k),le=[];for(var ce in te)le.push(ce);return le.reverse(),function Ne(){for(;le.length;){var be=le.pop();if(be in te)return Ne.value=be,Ne.done=!1,Ne}return Ne.done=!0,Ne}},a.values=ze,Ye.prototype={constructor:Ye,reset:function(te){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(he),!te)for(var le in this)le.charAt(0)==="t"&&s.call(this,le)&&!isNaN(+le.slice(1))&&(this[le]=r)},stop:function(){this.done=!0;var te=this.tryEntries[0].completion;if(te.type==="throw")throw te.arg;return this.rval},dispatchException:function(te){if(this.done)throw te;var le=this;function ce(Se,ut){return X.type="throw",X.arg=te,le.next=Se,ut&&(le.method="next",le.arg=r),!!ut}for(var Ne=this.tryEntries.length-1;Ne>=0;--Ne){var be=this.tryEntries[Ne],X=be.completion;if(be.tryLoc==="root")return ce("end");if(be.tryLoc<=this.prev){var I=s.call(be,"catchLoc"),tt=s.call(be,"finallyLoc");if(I&&tt){if(this.prev<be.catchLoc)return ce(be.catchLoc,!0);if(this.prev<be.finallyLoc)return ce(be.finallyLoc)}else if(I){if(this.prev<be.catchLoc)return ce(be.catchLoc,!0)}else{if(!tt)throw Error("try statement without catch or finally");if(this.prev<be.finallyLoc)return ce(be.finallyLoc)}}}},abrupt:function(te,le){for(var ce=this.tryEntries.length-1;ce>=0;--ce){var Ne=this.tryEntries[ce];if(Ne.tryLoc<=this.prev&&s.call(Ne,"finallyLoc")&&this.prev<Ne.finallyLoc){var be=Ne;break}}be&&(te==="break"||te==="continue")&&be.tryLoc<=le&&le<=be.finallyLoc&&(be=null);var X=be?be.completion:{};return X.type=te,X.arg=le,be?(this.method="next",this.next=be.finallyLoc,me):this.complete(X)},complete:function(te,le){if(te.type==="throw")throw te.arg;return te.type==="break"||te.type==="continue"?this.next=te.arg:te.type==="return"?(this.rval=this.arg=te.arg,this.method="return",this.next="end"):te.type==="normal"&&le&&(this.next=le),me},finish:function(te){for(var le=this.tryEntries.length-1;le>=0;--le){var ce=this.tryEntries[le];if(ce.finallyLoc===te)return this.complete(ce.completion,ce.afterLoc),he(ce),me}},catch:function(te){for(var le=this.tryEntries.length-1;le>=0;--le){var ce=this.tryEntries[le];if(ce.tryLoc===te){var Ne=ce.completion;if(Ne.type==="throw"){var be=Ne.arg;he(ce)}return be}}throw Error("illegal catch attempt")},delegateYield:function(te,le,ce){return this.delegate={iterator:ze(te),resultName:le,nextLoc:ce},this.method==="next"&&(this.arg=r),me}},a}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(ww);var vA=ww.exports,Zu=vA(),Zs=Zu;try{regeneratorRuntime=Zu}catch(e){typeof globalThis=="object"?globalThis.regeneratorRuntime=Zu:Function("r","regeneratorRuntime = r")(Zu)}var pA=TypeError,hA=9007199254740991,_w=function(e){if(e>hA)throw pA("Maximum allowed index exceeded");return e},yA=Je,gA=We,mA=Ws,bA=Ct,wA=Qt,_A=Xt,_h=_w,Sh=Ks,SA=gd,$A=Vs,TA=mt,kA=Ci,Sw=TA("isConcatSpreadable"),IA=kA>=51||!gA(function(){var e=[];return e[Sw]=!1,e.concat()[0]!==e}),EA=function(e){if(!bA(e))return!1;var n=e[Sw];return n!==void 0?!!n:mA(e)},RA=!IA||!$A("concat");yA({target:"Array",proto:!0,arity:1,forced:RA},{concat:function(n){var t=wA(this),r=SA(t,0),a=0,i,s,o,u,v;for(i=-1,o=arguments.length;i<o;i++)if(v=i===-1?t:arguments[i],EA(v))for(u=_A(v),_h(a+u),s=0;s<u;s++,a++)s in v&&Sh(r,a,v[s]);else _h(a+1),Sh(r,a++,v);return r.length=a,r}});var CA=Lt,OA=vw,AA=function(e,n,t,r){try{return r?n(CA(t)[0],t[1]):n(t)}catch(a){OA(e,"throw",a)}},PA=Dn,MA=yt,NA=Qt,LA=AA,xA=Pd,jA=Co,UA=Xt,$h=Ks,DA=Uo,FA=Xs,Th=Array,$w=function(n){var t=NA(n),r=jA(this),a=arguments.length,i=a>1?arguments[1]:void 0,s=i!==void 0;s&&(i=PA(i,a>2?arguments[2]:void 0));var o=FA(t),u=0,v,g,m,_,w,R;if(o&&!(this===Th&&xA(o)))for(g=r?new this:[],_=DA(t,o),w=_.next;!(m=MA(w,_)).done;u++)R=s?LA(_,i,[m.value,u],!0):m.value,$h(g,u,R);else for(v=UA(t),g=r?new this(v):Th(v);v>u;u++)R=s?i(t[u],u):t[u],$h(g,u,R);return g.length=u,g},BA=Je,qA=$w,WA=Fo,GA=!WA(function(e){Array.from(e)});BA({target:"Array",stat:!0,forced:GA},{from:qA});var Md=Ke,HA=cn,zA=Bt,VA=Qr,KA=Md("".charAt),kh=Md("".charCodeAt),YA=Md("".slice),Ih=function(e){return function(n,t){var r=zA(VA(n)),a=HA(t),i=r.length,s,o;return a<0||a>=i?e?"":void 0:(s=kh(r,a),s<55296||s>56319||a+1===i||(o=kh(r,a+1))<56320||o>57343?e?KA(r,a):s:e?YA(r,a,a+2):(s-55296<<10)+(o-56320)+65536)}},Nd={codeAt:Ih(!1),charAt:Ih(!0)},JA=We,QA=!JA(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),XA=Pt,ZA=gt,eP=Qt,tP=Io,rP=QA,Eh=tP("IE_PROTO"),gf=Object,nP=gf.prototype,eu=rP?gf.getPrototypeOf:function(e){var n=eP(e);if(XA(n,Eh))return n[Eh];var t=n.constructor;return ZA(t)&&n instanceof t?t.prototype:n instanceof gf?nP:null},aP=We,iP=gt,sP=Ct,Rh=eu,uP=ir,oP=mt,mf=oP("iterator"),Tw=!1,Ca,Yl,Jl;[].keys&&(Jl=[].keys(),"next"in Jl?(Yl=Rh(Rh(Jl)),Yl!==Object.prototype&&(Ca=Yl)):Tw=!0);var lP=!sP(Ca)||aP(function(){var e={};return Ca[mf].call(e)!==e});lP&&(Ca={});iP(Ca[mf])||uP(Ca,mf,function(){return this});var kw={IteratorPrototype:Ca,BUGGY_SAFARI_ITERATORS:Tw},cP=kw.IteratorPrototype,fP=sa,dP=Pa,vP=fn,pP=Qs,hP=function(){return this},Iw=function(e,n,t,r){var a=n+" Iterator";return e.prototype=fP(cP,{next:dP(+!r,t)}),vP(e,a,!1),pP[a]=hP,e},yP=Je,gP=yt,Ew=Us,mP=gt,bP=Iw,Ch=eu,Oh=Ni,wP=fn,_P=xn,Ql=ir,SP=mt,$P=Qs,Rw=kw,TP=Ew.PROPER,kP=Ew.CONFIGURABLE,Ah=Rw.IteratorPrototype,ku=Rw.BUGGY_SAFARI_ITERATORS,ns=SP("iterator"),Ph="keys",as="values",Mh="entries",IP=function(){return this},Ld=function(e,n,t,r,a,i,s){bP(t,n,r);var o=function(j){if(j===a&&_)return _;if(!ku&&j&&j in g)return g[j];switch(j){case Ph:return function(){return new t(this,j)};case as:return function(){return new t(this,j)};case Mh:return function(){return new t(this,j)}}return function(){return new t(this)}},u=n+" Iterator",v=!1,g=e.prototype,m=g[ns]||g["@@iterator"]||a&&g[a],_=!ku&&m||o(a),w=n==="Array"&&g.entries||m,R,M,x;if(w&&(R=Ch(w.call(new e)),R!==Object.prototype&&R.next&&(Ch(R)!==Ah&&(Oh?Oh(R,Ah):mP(R[ns])||Ql(R,ns,IP)),wP(R,u,!0))),TP&&a===as&&m&&m.name!==as&&(kP?_P(g,"name",as):(v=!0,_=function(){return gP(m,this)})),a)if(M={values:o(as),keys:i?_:o(Ph),entries:o(Mh)},s)for(x in M)(ku||v||!(x in g))&&Ql(g,x,M[x]);else yP({target:n,proto:!0,forced:ku||v},M);return g[ns]!==_&&Ql(g,ns,_,{name:a}),$P[n]=_,M},qo=function(e,n){return{value:e,done:n}},EP=Nd.charAt,RP=Bt,Cw=xr,CP=Ld,Nh=qo,Ow="String Iterator",OP=Cw.set,AP=Cw.getterFor(Ow);CP(String,"String",function(e){OP(this,{type:Ow,string:RP(e),index:0})},function(){var n=AP(this),t=n.string,r=n.index,a;return r>=t.length?Nh(void 0,!0):(a=EP(t,r),n.index+=a.length,Nh(a,!1))});var Aw={exports:{}};(function(e){(function(n,t){e.exports?e.exports=t():n.log=t()})(dr,function(){var n=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],i={},s=null;function o(M,x){var j=M[x];if(typeof j.bind=="function")return j.bind(M);try{return Function.prototype.bind.call(j,M)}catch(H){return function(){return Function.prototype.apply.apply(j,[M,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function v(M){return M==="debug"&&(M="log"),typeof console===t?!1:M==="trace"&&r?u:console[M]!==void 0?o(console,M):console.log!==void 0?o(console,"log"):n}function g(){for(var M=this.getLevel(),x=0;x<a.length;x++){var j=a[x];this[j]=x<M?n:this.methodFactory(j,M,this.name)}if(this.log=this.debug,typeof console===t&&M<this.levels.SILENT)return"No console available for logging"}function m(M){return function(){typeof console!==t&&(g.call(this),this[M].apply(this,arguments))}}function _(M,x,j){return v(M)||m.apply(this,arguments)}function w(M,x){var j=this,H,me,ne,Ie="loglevel";typeof M=="string"?Ie+=":"+M:typeof M=="symbol"&&(Ie=void 0);function Ee(F){var de=(a[F]||"silent").toUpperCase();if(!(typeof window===t||!Ie)){try{window.localStorage[Ie]=de;return}catch(Pe){}try{window.document.cookie=encodeURIComponent(Ie)+"="+de+";"}catch(Pe){}}}function xe(){var F;if(!(typeof window===t||!Ie)){try{F=window.localStorage[Ie]}catch(_e){}if(typeof F===t)try{var de=window.document.cookie,Pe=encodeURIComponent(Ie),Me=de.indexOf(Pe+"=");Me!==-1&&(F=/^([^;]+)/.exec(de.slice(Me+Pe.length+1))[1])}catch(_e){}return j.levels[F]===void 0&&(F=void 0),F}}function B(){if(!(typeof window===t||!Ie)){try{window.localStorage.removeItem(Ie)}catch(F){}try{window.document.cookie=encodeURIComponent(Ie)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(F){}}}function J(F){var de=F;if(typeof de=="string"&&j.levels[de.toUpperCase()]!==void 0&&(de=j.levels[de.toUpperCase()]),typeof de=="number"&&de>=0&&de<=j.levels.SILENT)return de;throw new TypeError("log.setLevel() called with invalid level: "+F)}j.name=M,j.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},j.methodFactory=x||_,j.getLevel=function(){return ne!=null?ne:me!=null?me:H},j.setLevel=function(F,de){return ne=J(F),de!==!1&&Ee(ne),g.call(j)},j.setDefaultLevel=function(F){me=J(F),xe()||j.setLevel(F,!1)},j.resetLevel=function(){ne=null,B(),g.call(j)},j.enableAll=function(F){j.setLevel(j.levels.TRACE,F)},j.disableAll=function(F){j.setLevel(j.levels.SILENT,F)},j.rebuild=function(){if(s!==j&&(H=J(s.getLevel())),g.call(j),s===j)for(var F in i)i[F].rebuild()},H=J(s?s.getLevel():"WARN");var pe=xe();pe!=null&&(ne=J(pe)),g.call(j)}s=new w,s.getLogger=function(x){if(typeof x!="symbol"&&typeof x!="string"||x==="")throw new TypeError("You must supply a name when creating a logger.");var j=i[x];return j||(j=i[x]=new w(x,s.methodFactory)),j};var R=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=R),s},s.getLoggers=function(){return i},s.default=s,s})})(Aw);var tu=Aw.exports;const Ra="\\d+(?:[\\.,]\\d+)?",PP="(".concat(Ra,"W)"),MP="(".concat(Ra,"Y)?(").concat(Ra,"M)?(").concat(Ra,"D)?"),NP="T(".concat(Ra,"H)?(").concat(Ra,"M)?(").concat(Ra,"S)?"),LP="P(?:".concat(PP,"|").concat(MP,"(?:").concat(NP,")?)"),xP=["weeks","years","months","days","hours","minutes","seconds"],xd=new RegExp(LP),Pw=e=>e.match(xd).slice(1).reduce((n,t,r)=>(n[xP[r]]=parseFloat(t)||0,n),{}),jd=(e,n)=>{const t=n?n.getTime():Date.now(),r=new Date(t);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+e.seconds*1e3),r.setDate(r.getDate()+e.weeks*7),r},Mw=(e,n)=>{const t=n?n.getTime():Date.now(),r=new Date(t);return(jd(e,r).getTime()-r.getTime())/1e3},jP={end:jd,toSeconds:Mw,pattern:xd,parse:Pw},UP=Object.freeze(Object.defineProperty({__proto__:null,default:jP,end:jd,parse:Pw,pattern:xd,toSeconds:Mw},Symbol.toStringTag,{value:"Module"})),DP=Q0(UP);var FP=mt,BP=sa,qP=ar.f,bf=FP("unscopables"),wf=Array.prototype;wf[bf]===void 0&&qP(wf,bf,{configurable:!0,value:BP(null)});var Ud=function(e){wf[bf][e]=!0},WP=_r,Dd=Ud,Lh=Qs,Nw=xr,GP=ar.f,HP=Ld,Iu=qo,zP=_t,Lw="Array Iterator",VP=Nw.set,KP=Nw.getterFor(Lw),xw=HP(Array,"Array",function(e,n){VP(this,{type:Lw,target:WP(e),index:0,kind:n})},function(){var e=KP(this),n=e.target,t=e.index++;if(!n||t>=n.length)return e.target=void 0,Iu(void 0,!0);switch(e.kind){case"keys":return Iu(t,!1);case"values":return Iu(n[t],!1)}return Iu([t,n[t]],!1)},"values"),xh=Lh.Arguments=Lh.Array;Dd("keys");Dd("values");Dd("entries");if(zP&&xh.name!=="values")try{GP(xh,"name",{value:"values"})}catch(e){}var jh=Xe,jw=gw,YP=mw,hs=xw,Uh=xn,JP=fn,QP=mt,Xl=QP("iterator"),Zl=hs.values,Uw=function(e,n){if(e){if(e[Xl]!==Zl)try{Uh(e,Xl,Zl)}catch(r){e[Xl]=Zl}if(JP(e,n,!0),jw[n]){for(var t in hs)if(e[t]!==hs[t])try{Uh(e,t,hs[t])}catch(r){e[t]=hs[t]}}}};for(var ec in jw)Uw(jh[ec]&&jh[ec].prototype,ec);Uw(YP,"DOMTokenList");var XP=gt,ZP=Ct,Dh=Ni,Wo=function(e,n,t){var r,a;return Dh&&XP(r=n.constructor)&&r!==t&&ZP(a=r.prototype)&&a!==t.prototype&&Dh(e,a),e},eM=Ke,tM=eM(1 .valueOf),rM="	\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF",nM=Ke,aM=Qr,iM=Bt,_f=rM,Fh=nM("".replace),sM=RegExp("^["+_f+"]+"),uM=RegExp("(^|[^"+_f+"])["+_f+"]+$"),tc=function(e){return function(n){var t=iM(aM(n));return e&1&&(t=Fh(t,sM,"")),e&2&&(t=Fh(t,uM,"$1")),t}},oM={start:tc(1),end:tc(2),trim:tc(3)},lM=Je,Dw=xm,cM=_t,Fw=Xe,Bw=lb,qw=Ke,fM=Ro,Bh=Pt,dM=Wo,vM=Ln,pM=Ai,Ww=nd,hM=We,yM=La.f,gM=Nn.f,mM=ar.f,bM=tM,wM=oM.trim,Go="Number",vi=Fw[Go];Bw[Go];var Fd=vi.prototype,_M=Fw.TypeError,SM=qw("".slice),Eu=qw("".charCodeAt),$M=function(e){var n=Ww(e,"number");return typeof n=="bigint"?n:TM(n)},TM=function(e){var n=Ww(e,"number"),t,r,a,i,s,o,u,v;if(pM(n))throw new _M("Cannot convert a Symbol value to a number");if(typeof n=="string"&&n.length>2){if(n=wM(n),t=Eu(n,0),t===43||t===45){if(r=Eu(n,2),r===88||r===120)return NaN}else if(t===48){switch(Eu(n,1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+n}for(s=SM(n,2),o=s.length,u=0;u<o;u++)if(v=Eu(s,u),v<48||v>i)return NaN;return parseInt(s,a)}}return+n},Bd=fM(Go,!vi(" 0o1")||!vi("0b1")||vi("+0x1")),kM=function(e){return vM(Fd,e)&&hM(function(){bM(e)})},Ho=function(n){var t=arguments.length<1?0:vi($M(n));return kM(this)?dM(Object(t),this,Ho):t};Ho.prototype=Fd;Bd&&!Dw&&(Fd.constructor=Ho);lM({global:!0,constructor:!0,wrap:!0,forced:Bd},{Number:Ho});var IM=function(e,n){for(var t=cM?yM(n):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),r=0,a;t.length>r;r++)Bh(n,a=t[r])&&!Bh(e,a)&&mM(e,a,gM(n,a))};(Bd||Dw)&&IM(Bw[Go],vi);var EM=Lt,Gw=function(){var e=EM(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},qd=We,RM=Xe,Wd=RM.RegExp,Gd=qd(function(){var e=Wd("a","y");return e.lastIndex=2,e.exec("abcd")!==null}),CM=Gd||qd(function(){return!Wd("a","y").sticky}),OM=Gd||qd(function(){var e=Wd("^r","gy");return e.lastIndex=2,e.exec("str")!==null}),Hw={BROKEN_CARET:OM,MISSED_STICKY:CM,UNSUPPORTED_Y:Gd},AM=We,PM=Xe,MM=PM.RegExp,NM=AM(function(){var e=MM(".","s");return!(e.dotAll&&e.test("\n")&&e.flags==="s")}),LM=We,xM=Xe,jM=xM.RegExp,UM=LM(function(){var e=jM("(?<a>b)","g");return e.exec("b").groups.a!=="b"||"b".replace(e,"$<a>c")!=="bc"}),ci=yt,zo=Ke,DM=Bt,FM=Gw,BM=Hw,qM=Pi,WM=sa,GM=xr.get,HM=NM,zM=UM,VM=qM("native-string-replace",String.prototype.replace),uo=RegExp.prototype.exec,Sf=uo,KM=zo("".charAt),YM=zo("".indexOf),JM=zo("".replace),rc=zo("".slice),$f=function(){var e=/a/,n=/b*/g;return ci(uo,e,"a"),ci(uo,n,"a"),e.lastIndex!==0||n.lastIndex!==0}(),zw=BM.BROKEN_CARET,Tf=/()??/.exec("")[1]!==void 0,QM=$f||Tf||zw||HM||zM;QM&&(Sf=function(n){var t=this,r=GM(t),a=DM(n),i=r.raw,s,o,u,v,g,m,_;if(i)return i.lastIndex=t.lastIndex,s=ci(Sf,i,a),t.lastIndex=i.lastIndex,s;var w=r.groups,R=zw&&t.sticky,M=ci(FM,t),x=t.source,j=0,H=a;if(R&&(M=JM(M,"y",""),YM(M,"g")===-1&&(M+="g"),H=rc(a,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&KM(a,t.lastIndex-1)!=="\n")&&(x="(?: "+x+")",H=" "+H,j++),o=new RegExp("^(?:"+x+")",M)),Tf&&(o=new RegExp("^"+x+"$(?!\\s)",M)),$f&&(u=t.lastIndex),v=ci(uo,R?o:t,H),R?v?(v.input=rc(v.input,j),v[0]=rc(v[0],j),v.index=t.lastIndex,t.lastIndex+=v[0].length):t.lastIndex=0:$f&&v&&(t.lastIndex=t.global?v.index+v[0].length:u),Tf&&v&&v.length>1&&ci(VM,v[0],o,function(){for(g=1;g<arguments.length-2;g++)arguments[g]===void 0&&(v[g]=void 0)}),v&&w)for(v.groups=m=WM(null),g=0;g<w.length;g++)_=w[g],m[_[0]]=v[_[1]];return v});var Hd=Sf,XM=Je,qh=Hd;XM({target:"RegExp",proto:!0,forced:/./.exec!==qh},{exec:qh});var Wh=yt,Gh=ir,ZM=Hd,Hh=We,Vw=mt,e2=xn,t2=Vw("species"),nc=RegExp.prototype,Vo=function(e,n,t,r){var a=Vw(e),i=!Hh(function(){var v={};return v[a]=function(){return 7},""[e](v)!==7}),s=i&&!Hh(function(){var v=!1,g=/a/;return e==="split"&&(g={},g.constructor={},g.constructor[t2]=function(){return g},g.flags="",g[a]=/./[a]),g.exec=function(){return v=!0,null},g[a](""),!v});if(!i||!s||t){var o=/./[a],u=n(a,""[e],function(v,g,m,_,w){var R=g.exec;return R===ZM||R===nc.exec?i&&!w?{done:!0,value:Wh(o,g,m,_)}:{done:!0,value:Wh(v,m,g,_)}:{done:!1}});Gh(String.prototype,e,u[0]),Gh(nc,a,u[1])}r&&e2(nc[a],"sham",!0)},r2=Nd.charAt,zd=function(e,n,t){return n+(t?r2(e,n).length:1)},Vd=Ke,n2=Qt,a2=Math.floor,ac=Vd("".charAt),i2=Vd("".replace),ic=Vd("".slice),s2=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u2=/\$([$&'`]|\d{1,2})/g,o2=function(e,n,t,r,a,i){var s=t+e.length,o=r.length,u=u2;return a!==void 0&&(a=n2(a),u=s2),i2(i,u,function(v,g){var m;switch(ac(g,0)){case"$":return"$";case"&":return e;case"`":return ic(n,0,t);case"'":return ic(n,s);case"<":m=a[ic(g,1,-1)];break;default:var _=+g;if(_===0)return v;if(_>o){var w=a2(_/10);return w===0?v:w<=o?r[w-1]===void 0?ac(g,1):r[w-1]+ac(g,1):v}m=r[_-1]}return m===void 0?"":m})},zh=yt,l2=Lt,c2=gt,f2=on,d2=Hd,v2=TypeError,Ko=function(e,n){var t=e.exec;if(c2(t)){var r=zh(t,e,n);return r!==null&&l2(r),r}if(f2(e)==="RegExp")return zh(d2,e,n);throw new v2("RegExp#exec called on incompatible receiver")},p2=xa,Vh=yt,Yo=Ke,h2=Vo,y2=We,g2=Lt,m2=gt,b2=ln,w2=cn,_2=jn,Qa=Bt,S2=Qr,$2=zd,T2=Na,k2=o2,I2=Ko,E2=mt,kf=E2("replace"),R2=Math.max,C2=Math.min,O2=Yo([].concat),sc=Yo([].push),Kh=Yo("".indexOf),Yh=Yo("".slice),A2=function(e){return e===void 0?e:String(e)},P2=function(){return"a".replace(/./,"$0")==="$0"}(),Jh=function(){return/./[kf]?/./[kf]("a","$0")==="":!1}(),M2=!y2(function(){var e=/./;return e.exec=function(){var n=[];return n.groups={a:"7"},n},"".replace(e,"$<a>")!=="7"});h2("replace",function(e,n,t){var r=Jh?"$":"$0";return[function(i,s){var o=S2(this),u=b2(i)?void 0:T2(i,kf);return u?Vh(u,i,o,s):Vh(n,Qa(o),i,s)},function(a,i){var s=g2(this),o=Qa(a);if(typeof i=="string"&&Kh(i,r)===-1&&Kh(i,"$<")===-1){var u=t(n,s,o,i);if(u.done)return u.value}var v=m2(i);v||(i=Qa(i));var g=s.global,m;g&&(m=s.unicode,s.lastIndex=0);for(var _=[],w;w=I2(s,o),!(w===null||(sc(_,w),!g));){var R=Qa(w[0]);R===""&&(s.lastIndex=$2(o,_2(s.lastIndex),m))}for(var M="",x=0,j=0;j<_.length;j++){w=_[j];for(var H=Qa(w[0]),me=R2(C2(w2(w.index),o.length),0),ne=[],Ie,Ee=1;Ee<w.length;Ee++)sc(ne,A2(w[Ee]));var xe=w.groups;if(v){var B=O2([H],ne,me,o);xe!==void 0&&sc(B,xe),Ie=Qa(p2(i,void 0,B))}else Ie=k2(H,o,me,ne,xe,i);me>=x&&(M+=Yh(o,x,me)+Ie,x=me+H.length)}return M+Yh(o,x)}]},!M2||!P2||Jh);var N2=Je,L2=Ke,x2=xs,j2=_r,U2=Bo,D2=L2([].join),F2=x2!==Object,B2=F2||!U2("join",",");N2({target:"Array",proto:!0,forced:B2},{join:function(n){return D2(j2(this),n===void 0?",":n)}});var Gt={},q2=_t,W2=Us.EXISTS,Kw=Ke,G2=vn,Yw=Function.prototype,H2=Kw(Yw.toString),Jw=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,z2=Kw(Jw.exec),V2="name";q2&&!W2&&G2(Yw,V2,{configurable:!0,get:function(){try{return z2(Jw,H2(this))[1]}catch(e){return""}}});var Qw={exports:{}},Xw={exports:{}};(function(e){function n(t){if(Array.isArray(t))return t}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Xw);var K2=Xw.exports,Zw={exports:{}};(function(e){function n(t,r){var a=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(a!=null){var i,s,o,u,v=[],g=!0,m=!1;try{if(o=(a=a.call(t)).next,r===0){if(Object(a)!==a)return;g=!1}else for(;!(g=(i=o.call(a)).done)&&(v.push(i.value),v.length!==r);g=!0);}catch(_){m=!0,s=_}finally{try{if(!g&&a.return!=null&&(u=a.return(),Object(u)!==u))return}finally{if(m)throw s}}return v}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(Zw);var Y2=Zw.exports,e_={exports:{}},t_={exports:{}};(function(e){function n(t,r){(r==null||r>t.length)&&(r=t.length);for(var a=0,i=Array(r);a<r;a++)i[a]=t[a];return i}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(t_);var r_=t_.exports;(function(e){var n=r_;function t(r,a){if(r){if(typeof r=="string")return n(r,a);var i={}.toString.call(r).slice(8,-1);return i==="Object"&&r.constructor&&(i=r.constructor.name),i==="Map"||i==="Set"?Array.from(r):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(r,a):void 0}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(e_);var n_=e_.exports,a_={exports:{}};(function(e){function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(a_);var J2=a_.exports;(function(e){var n=K2,t=Y2,r=n_,a=J2;function i(s,o){return n(s)||t(s,o)||r(s,o)||a()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(Qw);var xi=Qw.exports,Q2=Je,Qh=Ws,X2=Co,Z2=Ct,Xh=Mi,eN=Xt,tN=_r,rN=Ks,nN=mt,aN=Vs,iN=dn,sN=aN("slice"),uN=nN("species"),uc=Array,oN=Math.max;Q2({target:"Array",proto:!0,forced:!sN},{slice:function(n,t){var r=tN(this),a=eN(r),i=Xh(n,a),s=Xh(t===void 0?a:t,a),o,u,v;if(Qh(r)&&(o=r.constructor,X2(o)&&(o===uc||Qh(o.prototype))?o=void 0:Z2(o)&&(o=o[uN],o===null&&(o=void 0)),o===uc||o===void 0))return iN(r,i,s);for(u=new(o===void 0?uc:o)(oN(s-i,0)),v=0;i<s;i++,v++)i in r&&rN(u,v,r[i]);return u.length=v,u}});var lN=Je,Zh=yt,cN=gt,ey=Lt,fN=Bt,dN=function(){var e=!1,n=/[ac]/;return n.exec=function(){return e=!0,/./.exec.apply(this,arguments)},n.test("abc")===!0&&e}(),vN=/./.test;lN({target:"RegExp",proto:!0,forced:!dN},{test:function(e){var n=ey(this),t=fN(e),r=n.exec;if(!cN(r))return Zh(vN,n,t);var a=Zh(r,n,t);return a===null?!1:(ey(a),!0)}});var pN=Je,hN=_t,yN=Xe,Ru=Ke,gN=Pt,mN=gt,bN=Ln,wN=Bt,_N=vn,SN=od,$n=yN.Symbol,ma=$n&&$n.prototype;if(hN&&mN($n)&&(!("description"in ma)||$n().description!==void 0)){var ty={},Cu=function(){var n=arguments.length<1||arguments[0]===void 0?void 0:wN(arguments[0]),t=bN(ma,this)?new $n(n):n===void 0?$n():$n(n);return n===""&&(ty[t]=!0),t};SN(Cu,$n),Cu.prototype=ma,ma.constructor=Cu;var $N=String($n("description detection"))==="Symbol(description detection)",TN=Ru(ma.valueOf),kN=Ru(ma.toString),IN=/^Symbol\((.*)\)[^)]+$/,EN=Ru("".replace),RN=Ru("".slice);_N(ma,"description",{configurable:!0,get:function(){var n=TN(this);if(gN(ty,n))return"";var t=kN(n),r=$N?RN(t,7,-1):EN(t,IN,"$1");return r===""?void 0:r}}),pN({global:!0,constructor:!0,forced:!0},{Symbol:Cu})}var CN=cb;CN("iterator");var i_={exports:{}},s_={exports:{}};(function(e){var n=r_;function t(r){if(Array.isArray(r))return n(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(s_);var ON=s_.exports,u_={exports:{}};(function(e){function n(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(u_);var AN=u_.exports,o_={exports:{}};(function(e){function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(o_);var PN=o_.exports;(function(e){var n=ON,t=AN,r=n_,a=PN;function i(s){return n(s)||t(s)||r(s)||a()}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(i_);var ji=i_.exports,MN=Je,NN=Eo.includes,LN=We,xN=Ud,jN=LN(function(){return!Array(1).includes()});MN({target:"Array",proto:!0,forced:jN},{includes:function(n){return NN(this,n,arguments.length>1?arguments[1]:void 0)}});xN("includes");var UN=Ct,DN=Math.floor,l_=Number.isInteger||function(n){return!UN(n)&&isFinite(n)&&DN(n)===n},FN=Je,BN=l_;FN({target:"Number",stat:!0},{isInteger:BN});var c_=_t,qN=We,f_=Ke,WN=eu,GN=qs,HN=_r,zN=Ls.f,d_=f_(zN),VN=f_([].push),KN=c_&&qN(function(){var e=Object.create(null);return e[2]=2,!d_(e,2)}),ry=function(e){return function(n){for(var t=HN(n),r=GN(t),a=KN&&WN(t)===null,i=r.length,s=0,o=[],u;i>s;)u=r[s++],(!c_||(a?u in t:d_(t,u)))&&VN(o,e?[u,t[u]]:t[u]);return o}},YN={entries:ry(!0),values:ry(!1)},JN=Je,QN=YN.entries;JN({target:"Object",stat:!0},{entries:function(n){return QN(n)}});/*
@license
Copyright (c) 2021 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


*/Object.defineProperty(Gt,"__esModule",{value:!0});var XN=jr,ZN=xi,eL=ji,tL=ua,rL=yn,nL=pn,aL=hn,iL=Ur;function oa(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var pi=oa(XN),On=oa(ZN),oc=oa(eL),sL=oa(tL),uL=oa(rL),oL=oa(nL),lL=oa(aL),ny=oa(iL),Fn=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return{checks:t}},v_=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Fn(function(a){for(var i=!1,s=[],o=0,u=t;o<u.length;o++){var v=u[o];if(typeof v=="string"){i=i||pi.default(a)===v,s.push("of type ".concat(v));continue}i=i||a instanceof v,s.push("an instance of ".concat(v.name))}return[i,s]})},cL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return Fn(function(a){for(var i=!1,s=[],o=0,u=t;o<u.length;o++){var v=u[o];i=i||a===v,s.push(typeof v=="string"?'"'.concat(v,'"'):"".concat(v))}return[i,s]})};function fL(e){var n=dL();return function(){var r=ny.default(e),a;if(n){var i=ny.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return lL.default(this,a)}}function dL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Cs(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vL(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function vL(e,n){if(e){if(typeof e=="string")return ay(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ay(e,n)}}function ay(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var Jo=function(n,t){if(t.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(t.length));for(;t.length<n.length;)t.push(void 0);var r=Cs(t.entries()),a;try{for(r.s();!(a=r.n()).done;){var i=On.default(a.value,2),s=i[0],o=i[1],u=Xo(n[s],o),v=On.default(u,4),g=v[0],m=v[1],_=v[2],w=v[3];if(!g){var R=s+1;throw new Error("Argument ".concat(R," is expected to be ").concat(_).concat(w," but got ").concat(m))}}}catch(M){r.e(M)}finally{r.f()}},p_=function(n){var t,r,a=["undefined","boolean","number","bigint","string"];if(a.includes(pi.default(n))&&(r=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),pi.default(n)==="object"&&(n==null||(t=n.constructor)===null||t===void 0?void 0:t.name)!=="Object"){var i;r=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return r||(r=pi.default(n)),r},pL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Kd(t);return function(i){return function(s){oL.default(u,s);var o=fL(u);function u(){uL.default(this,u);for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return Jo(a,g),o.call.apply(o,[this].concat(g))}return sL.default(u)}(i)}},hL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Kd(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var u=o.value;o.value=function(){for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return Jo(a,g),u.apply(this,g)}}},yL=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Kd(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var u=o.value;o.value=function(){for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];try{Jo(a,g)}catch(_){return Promise.reject(_)}return u.apply(this,g)}}},Kd=function(n){var t=[],r=Cs(n),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;t.push(Qo(i))}}catch(s){r.e(s)}finally{r.f()}return t},Qo=function(n){var t=[],r=Array.isArray(n)?n:[n],a=Cs(r),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){t.push(v_(s));continue}t.push(s)}}catch(o){a.e(o)}finally{a.f()}return t},Xo=function(n,t){var r=[],a,i=!1,s=Cs(n),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,v=Cs(u.checks),g;try{for(v.s();!(g=v.n()).done;){var m=g.value,_=m(t),w=On.default(_,3),R=w[0],M=w[1],x=w[2];i=i||R,!a&&x&&(a=x),M&&(r=typeof M=="string"?[].concat(oc.default(r),[M]):[].concat(oc.default(r),oc.default(M)))}}catch(ne){v.e(ne)}finally{v.f()}}}catch(ne){s.e(ne)}finally{s.f()}if(i)return[!0];var j=a||p_(t),H=r.length-1,me=H>0?"".concat(r.slice(0,H).join(", ")," or ").concat(r[H]):r.join(", ");return[!1,j,me,H>1?";":","]};function gL(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=mL(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function mL(e,n){if(e){if(typeof e=="string")return iy(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return iy(e,n)}}function iy(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var bL=function(n,t){return Fn(function(r){if(!Array.isArray(r)||r.length<1)return[!1,"a non-empty array of ".concat(n)];var a=gL(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=On.default(i.value,2),o=s[0],u=s[1],v=Xo(Qo(t),u),g=On.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"a valid non-empty array of ".concat(n," (index ").concat(o," should be ").concat(w,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(_,")")]}}catch(R){a.e(R)}finally{a.f()}return[!0]})},wL=Fn(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),_L=Fn(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),SL=Fn(function(e){return[pi.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]}),$L=function(n,t){return Fn(function(r){if(pi.default(r)!=="object"||r===null||Array.isArray(r))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(t);a<i.length;a++){var s=On.default(i[a],2),o=s[0],u=s[1],v=Xo(Qo(u),r[o]),g=On.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"valid ".concat(n,' (key "').concat(o,'" should be ').concat(w,")"),"malformed ".concat(n,' (key "').concat(o,'" is ').concat(_,")")]}return[!0]})};function TL(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kL(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function kL(e,n){if(e){if(typeof e=="string")return sy(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sy(e,n)}}function sy(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var IL=function(n,t){return Fn(function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(n)];var a=TL(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=On.default(i.value,2),o=s[0],u=s[1],v=Xo(Qo(t),u),g=On.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"a valid array of ".concat(n," (index ").concat(o," should be ").concat(w,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(_,")")]}}catch(R){a.e(R)}finally{a.f()}return[!0]})};Gt.array=IL;Gt.custom=Fn;Gt.literal=cL;Gt.nonEmptyArray=bL;Gt.nonEmptyString=wL;Gt.nonNegativeInteger=_L;Gt.objectSchema=$L;Gt.pureObject=SL;Gt.runtimeTypeValidation=Jo;Gt.stringifyReceivedType=p_;Gt.type=v_;Gt.validateConstructorTypes=pL;Gt.validateTypes=hL;Gt.validateTypesAsync=yL;var Yd={},h_={exports:{}},y_={exports:{}};(function(e){var n=Ur;function t(r,a){for(;!{}.hasOwnProperty.call(r,a)&&(r=n(r))!==null;);return r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(y_);var EL=y_.exports;(function(e){var n=EL;function t(){return e.exports=t=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,a,i){var s=n(r,a);if(s){var o=Object.getOwnPropertyDescriptor(s,a);return o.get?o.get.call(arguments.length<3?r:i):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(h_);var Jd=h_.exports;/*
@license
Copyright (c) 2021 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/Object.defineProperty(Yd,"__esModule",{value:!0});var RL=ji,CL=yn,OL=ua,AL=ja,PL=Jd,ML=pn,NL=hn,LL=Ur,xL=Ua;function Bn(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var uy=Bn(RL),jL=Bn(CL),UL=Bn(OL),DL=Bn(AL),ba=Bn(PL),FL=Bn(ML),BL=Bn(NL),Tn=Bn(LL),qL=Bn(xL),WL;function ea(){}ea.prototype=Object.create(null);function wt(){wt.init.call(this)}wt.EventEmitter=wt;wt.usingDomains=!1;wt.prototype.domain=void 0;wt.prototype._events=void 0;wt.prototype._maxListeners=void 0;wt.defaultMaxListeners=10;wt.init=function(){this.domain=null,wt.usingDomains&&WL.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new ea,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function g_(e){return e._maxListeners===void 0?wt.defaultMaxListeners:e._maxListeners}wt.prototype.getMaxListeners=function(){return g_(this)};function GL(e,n,t){if(n)e.call(t);else for(var r=e.length,a=ru(e,r),i=0;i<r;++i)a[i].call(t)}function HL(e,n,t,r){if(n)e.call(t,r);else for(var a=e.length,i=ru(e,a),s=0;s<a;++s)i[s].call(t,r)}function zL(e,n,t,r,a){if(n)e.call(t,r,a);else for(var i=e.length,s=ru(e,i),o=0;o<i;++o)s[o].call(t,r,a)}function VL(e,n,t,r,a,i){if(n)e.call(t,r,a,i);else for(var s=e.length,o=ru(e,s),u=0;u<s;++u)o[u].call(t,r,a,i)}function KL(e,n,t,r){if(n)e.apply(t,r);else for(var a=e.length,i=ru(e,a),s=0;s<a;++s)i[s].apply(t,r)}wt.prototype.emit=function(n){var t,r,a,i,s,o,u,v=n==="error";if(o=this._events,o)v=v&&o.error==null;else if(!v)return!1;if(u=this.domain,v){if(t=arguments[1],u)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t);else{if(t instanceof Error)throw t;var g=new Error('Uncaught, unspecified "error" event. ('+t+")");throw g.context=t,g}return!1}if(r=o[n],!r)return!1;var m=typeof r=="function";switch(a=arguments.length,a){case 1:GL(r,m,this);break;case 2:HL(r,m,this,arguments[1]);break;case 3:zL(r,m,this,arguments[1],arguments[2]);break;case 4:VL(r,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];KL(r,m,this,i)}return!0};function m_(e,n,t,r){var a,i,s;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),i=e._events),s=i[n]):(i=e._events=new ea,e._eventsCount=0),!s)s=i[n]=t,++e._eventsCount;else if(typeof s=="function"?s=i[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),!s.warned&&(a=g_(e),a&&a>0&&s.length>a)){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,YL(o)}return e}function YL(e){typeof console.warn=="function"?console.warn(e):console.log(e)}wt.prototype.addListener=function(n,t){return m_(this,n,t,!1)};wt.prototype.on=wt.prototype.addListener;wt.prototype.prependListener=function(n,t){return m_(this,n,t,!0)};function b_(e,n,t){var r=!1;function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}return a.listener=t,a}wt.prototype.once=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,b_(this,n,t)),this};wt.prototype.prependOnceListener=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,b_(this,n,t)),this};wt.prototype.removeListener=function(n,t){var r,a,i,s,o;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(r=a[n],!r)return this;if(r===t||r.listener&&r.listener===t)--this._eventsCount===0?this._events=new ea:(delete a[n],a.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new ea,this;delete a[n]}else JL(r,i);a.removeListener&&this.emit("removeListener",n,o||t)}return this};wt.prototype.off=function(e,n){return this.removeListener(e,n)};wt.prototype.removeAllListeners=function(n){var t,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new ea,this._eventsCount=0):r[n]&&(--this._eventsCount===0?this._events=new ea:delete r[n]),this;if(arguments.length===0){for(var a=Object.keys(r),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new ea,this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t)do this.removeListener(n,t[t.length-1]);while(t[0]);return this};wt.prototype.listeners=function(n){var t,r,a=this._events;return a?(t=a[n],t?typeof t=="function"?r=[t.listener||t]:r=QL(t):r=[]):r=[],r};wt.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):w_.call(e,n)};wt.prototype.listenerCount=w_;function w_(e){var n=this._events;if(n){var t=n[e];if(typeof t=="function")return 1;if(t)return t.length}return 0}wt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function JL(e,n){for(var t=n,r=t+1,a=e.length;r<a;t+=1,r+=1)e[t]=e[r];e.pop()}function ru(e,n){for(var t=new Array(n);n--;)t[n]=e[n];return t}function QL(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}function XL(e){var n=ZL();return function(){var r=Tn.default(e),a;if(n){var i=Tn.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return BL.default(this,a)}}function ZL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ex=function(e){FL.default(t,e);var n=XL(t);function t(){var r;return jL.default(this,t),r=n.call(this),qL.default(DL.default(r),"eventHistory",new Map),r}return UL.default(t,[{key:"on",value:function(a,i){return ba.default(Tn.default(t.prototype),"on",this).call(this,a,i)}},{key:"once",value:function(a,i){return ba.default(Tn.default(t.prototype),"once",this).call(this,a,i)}},{key:"off",value:function(a,i){return ba.default(Tn.default(t.prototype),"off",this).call(this,a,i)}},{key:"emit",value:function(a){for(var i,s=arguments.length,o=new Array(s>1?s-1:0),u=1;u<s;u++)o[u-1]=arguments[u];return this.eventHistory.set(a,o),(i=ba.default(Tn.default(t.prototype),"emit",this)).call.apply(i,[this,a].concat(o))}},{key:"addListener",value:function(a,i){return ba.default(Tn.default(t.prototype),"addListener",this).call(this,a,i)}},{key:"removeListener",value:function(a,i){return ba.default(Tn.default(t.prototype),"removeListener",this).call(this,a,i)}},{key:"addListenerWithReplay",value:function(a,i){var s=this.eventHistory.get(a);return s!==void 0&&i.apply(void 0,uy.default(s)),this.addListener(a,i)}},{key:"onWithReplay",value:function(a,i){return this.addListenerWithReplay(a,i)}},{key:"onceWithReplay",value:function(a,i){var s=this.eventHistory.get(a);return s!==void 0?(i.apply(void 0,uy.default(s)),this):ba.default(Tn.default(t.prototype),"once",this).call(this,a,i)}}]),t}(wt);Yd.ReplayEventEmitter=ex;var oo={exports:{}};oo.exports;(function(e,n){var t=200,r="__lodash_hash_undefined__",a=1,i=2,s=9007199254740991,o="[object Arguments]",u="[object Array]",v="[object AsyncFunction]",g="[object Boolean]",m="[object Date]",_="[object Error]",w="[object Function]",R="[object GeneratorFunction]",M="[object Map]",x="[object Number]",j="[object Null]",H="[object Object]",me="[object Promise]",ne="[object Proxy]",Ie="[object RegExp]",Ee="[object Set]",xe="[object String]",B="[object Symbol]",J="[object Undefined]",pe="[object WeakMap]",F="[object ArrayBuffer]",de="[object DataView]",Pe="[object Float32Array]",Me="[object Float64Array]",_e="[object Int8Array]",he="[object Int16Array]",Ye="[object Int32Array]",ze="[object Uint8Array]",k="[object Uint8ClampedArray]",te="[object Uint16Array]",le="[object Uint32Array]",ce=/[\\^$.*+?()[\]{}|]/g,Ne=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,X={};X[Pe]=X[Me]=X[_e]=X[he]=X[Ye]=X[ze]=X[k]=X[te]=X[le]=!0,X[o]=X[u]=X[F]=X[g]=X[de]=X[m]=X[_]=X[w]=X[M]=X[x]=X[H]=X[Ie]=X[Ee]=X[xe]=X[pe]=!1;var I=typeof dr=="object"&&dr&&dr.Object===Object&&dr,tt=typeof self=="object"&&self&&self.Object===Object&&self,Se=I||tt||Function("return this")(),ut=n&&!n.nodeType&&n,bt=ut&&!0&&e&&!e.nodeType&&e,Re=bt&&bt.exports===ut,Ht=Re&&I.process,Ge=function(){try{return Ht&&Ht.binding&&Ht.binding("util")}catch(O){}}(),se=Ge&&Ge.isTypedArray;function Be(O,q){for(var Y=-1,ke=O==null?0:O.length,It=0,Qe=[];++Y<ke;){var Mt=O[Y];q(Mt,Y,O)&&(Qe[It++]=Mt)}return Qe}function nt(O,q){for(var Y=-1,ke=q.length,It=O.length;++Y<ke;)O[It+Y]=q[Y];return O}function ve(O,q){for(var Y=-1,ke=O==null?0:O.length;++Y<ke;)if(q(O[Y],Y,O))return!0;return!1}function Ot(O,q){for(var Y=-1,ke=Array(O);++Y<O;)ke[Y]=q(Y);return ke}function Ve(O){return function(q){return O(q)}}function $t(O,q){return O.has(q)}function xt(O,q){return O==null?void 0:O[q]}function ye(O){var q=-1,Y=Array(O.size);return O.forEach(function(ke,It){Y[++q]=[It,ke]}),Y}function Ut(O,q){return function(Y){return O(q(Y))}}function Zt(O){var q=-1,Y=Array(O.size);return O.forEach(function(ke){Y[++q]=ke}),Y}var Ze=Array.prototype,ft=Function.prototype,et=Object.prototype,He=Se["__core-js_shared__"],Et=ft.toString,Rt=et.hasOwnProperty,Dt=function(){var O=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return O?"Symbol(src)_1."+O:""}(),Zr=et.toString,gn=RegExp("^"+Et.call(Rt).replace(ce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fr=Re?Se.Buffer:void 0,lr=Se.Symbol,dt=Se.Uint8Array,Q=et.propertyIsEnumerable,Z=Ze.splice,G=lr?lr.toStringTag:void 0,K=Object.getOwnPropertySymbols,V=Fr?Fr.isBuffer:void 0,ee=Ut(Object.keys,Object),re=rt(Se,"DataView"),D=rt(Se,"Map"),z=rt(Se,"Promise"),N=rt(Se,"Set"),W=rt(Se,"WeakMap"),L=rt(Object,"create"),ge=f(re),ae=f(D),Ce=f(z),we=f(N),$e=f(W),Te=lr?lr.prototype:void 0,Le=Te?Te.valueOf:void 0;function Oe(O){var q=-1,Y=O==null?0:O.length;for(this.clear();++q<Y;){var ke=O[q];this.set(ke[0],ke[1])}}function Ae(){this.__data__=L?L(null):{},this.size=0}function je(O){var q=this.has(O)&&delete this.__data__[O];return this.size-=q?1:0,q}function De(O){var q=this.__data__;if(L){var Y=q[O];return Y===r?void 0:Y}return Rt.call(q,O)?q[O]:void 0}function Tt(O){var q=this.__data__;return L?q[O]!==void 0:Rt.call(q,O)}function yr(O,q){var Y=this.__data__;return this.size+=this.has(O)?0:1,Y[O]=L&&q===void 0?r:q,this}Oe.prototype.clear=Ae,Oe.prototype.delete=je,Oe.prototype.get=De,Oe.prototype.has=Tt,Oe.prototype.set=yr;function Fe(O){var q=-1,Y=O==null?0:O.length;for(this.clear();++q<Y;){var ke=O[q];this.set(ke[0],ke[1])}}function gr(){this.__data__=[],this.size=0}function da(O){var q=this.__data__,Y=Wr(q,O);if(Y<0)return!1;var ke=q.length-1;return Y==ke?q.pop():Z.call(q,Y,1),--this.size,!0}function va(O){var q=this.__data__,Y=Wr(q,O);return Y<0?void 0:q[Y][1]}function Ga(O){return Wr(this.__data__,O)>-1}function Fi(O,q){var Y=this.__data__,ke=Wr(Y,O);return ke<0?(++this.size,Y.push([O,q])):Y[ke][1]=q,this}Fe.prototype.clear=gr,Fe.prototype.delete=da,Fe.prototype.get=va,Fe.prototype.has=Ga,Fe.prototype.set=Fi;function Br(O){var q=-1,Y=O==null?0:O.length;for(this.clear();++q<Y;){var ke=O[q];this.set(ke[0],ke[1])}}function qr(){this.size=0,this.__data__={hash:new Oe,map:new(D||Fe),string:new Oe}}function lt(O){var q=bn(this,O).delete(O);return this.size-=q?1:0,q}function Bi(O){return bn(this,O).get(O)}function qi(O){return bn(this,O).has(O)}function Wi(O,q){var Y=bn(this,O),ke=Y.size;return Y.set(O,q),this.size+=Y.size==ke?0:1,this}Br.prototype.clear=qr,Br.prototype.delete=lt,Br.prototype.get=Bi,Br.prototype.has=qi,Br.prototype.set=Wi;function mn(O){var q=-1,Y=O==null?0:O.length;for(this.__data__=new Br;++q<Y;)this.add(O[q])}function Ha(O){return this.__data__.set(O,r),this}function Gi(O){return this.__data__.has(O)}mn.prototype.add=mn.prototype.push=Ha,mn.prototype.has=Gi;function kr(O){var q=this.__data__=new Fe(O);this.size=q.size}function Hi(){this.__data__=new Fe,this.size=0}function Kt(O){var q=this.__data__,Y=q.delete(O);return this.size=q.size,Y}function zi(O){return this.__data__.get(O)}function Vi(O){return this.__data__.has(O)}function Ki(O,q){var Y=this.__data__;if(Y instanceof Fe){var ke=Y.__data__;if(!D||ke.length<t-1)return ke.push([O,q]),this.size=++Y.size,this;Y=this.__data__=new Br(ke)}return Y.set(O,q),this.size=Y.size,this}kr.prototype.clear=Hi,kr.prototype.delete=Kt,kr.prototype.get=zi,kr.prototype.has=Vi,kr.prototype.set=Ki;function Yi(O,q){var Y=p(O),ke=!Y&&y(O),It=!Y&&!ke&&T(O),Qe=!Y&&!ke&&!It&&qe(O),Mt=Y||ke||It||Qe,qt=Mt?Ot(O.length,String):[],Vt=qt.length;for(var At in O)Rt.call(O,At)&&!(Mt&&(At=="length"||It&&(At=="offset"||At=="parent")||Qe&&(At=="buffer"||At=="byteLength"||At=="byteOffset")||S(At,Vt)))&&qt.push(At);return qt}function Wr(O,q){for(var Y=O.length;Y--;)if(l(O[Y][0],q))return Y;return-1}function Ji(O,q,Y){var ke=q(O);return p(O)?ke:nt(ke,Y(O))}function cr(O){return O==null?O===void 0?J:j:G&&G in Object(O)?Ka(O):c(O)}function Wn(O){return kt(O)&&cr(O)==o}function pa(O,q,Y,ke,It){return O===q?!0:O==null||q==null||!kt(O)&&!kt(q)?O!==O&&q!==q:Qi(O,q,Y,ke,pa,It)}function Qi(O,q,Y,ke,It,Qe){var Mt=p(O),qt=p(q),Vt=Mt?u:C(O),At=qt?u:C(q);Vt=Vt==o?H:Vt,At=At==o?H:At;var mr=Vt==H,Gr=At==H,Jt=Vt==At;if(Jt&&T(O)){if(!T(q))return!1;Mt=!0,mr=!1}if(Jt&&!mr)return Qe||(Qe=new kr),Mt||qe(O)?at(O,q,Y,ke,It,Qe):Va(O,q,Vt,Y,ke,It,Qe);if(!(Y&a)){var Ir=mr&&Rt.call(O,"__wrapped__"),Er=Gr&&Rt.call(q,"__wrapped__");if(Ir||Er){var Hn=Ir?O.value():O,wn=Er?q.value():q;return Qe||(Qe=new kr),It(Hn,wn,Y,ke,Qe)}}return Jt?(Qe||(Qe=new kr),Gn(O,q,Y,ke,It,Qe)):!1}function za(O){if(!Ue(O)||d(O))return!1;var q=P(O)?gn:Ne;return q.test(f(O))}function Xi(O){return kt(O)&&ue(O.length)&&!!X[cr(O)]}function Zi(O){if(!h(O))return ee(O);var q=[];for(var Y in Object(O))Rt.call(O,Y)&&Y!="constructor"&&q.push(Y);return q}function at(O,q,Y,ke,It,Qe){var Mt=Y&a,qt=O.length,Vt=q.length;if(qt!=Vt&&!(Mt&&Vt>qt))return!1;var At=Qe.get(O);if(At&&Qe.get(q))return At==q;var mr=-1,Gr=!0,Jt=Y&i?new mn:void 0;for(Qe.set(O,q),Qe.set(q,O);++mr<qt;){var Ir=O[mr],Er=q[mr];if(ke)var Hn=Mt?ke(Er,Ir,mr,q,O,Qe):ke(Ir,Er,mr,O,q,Qe);if(Hn!==void 0){if(Hn)continue;Gr=!1;break}if(Jt){if(!ve(q,function(wn,ya){if(!$t(Jt,ya)&&(Ir===wn||It(Ir,wn,Y,ke,Qe)))return Jt.push(ya)})){Gr=!1;break}}else if(!(Ir===Er||It(Ir,Er,Y,ke,Qe))){Gr=!1;break}}return Qe.delete(O),Qe.delete(q),Gr}function Va(O,q,Y,ke,It,Qe,Mt){switch(Y){case de:if(O.byteLength!=q.byteLength||O.byteOffset!=q.byteOffset)return!1;O=O.buffer,q=q.buffer;case F:return!(O.byteLength!=q.byteLength||!Qe(new dt(O),new dt(q)));case g:case m:case x:return l(+O,+q);case _:return O.name==q.name&&O.message==q.message;case Ie:case xe:return O==q+"";case M:var qt=ye;case Ee:var Vt=ke&a;if(qt||(qt=Zt),O.size!=q.size&&!Vt)return!1;var At=Mt.get(O);if(At)return At==q;ke|=i,Mt.set(O,q);var mr=at(qt(O),qt(q),ke,It,Qe,Mt);return Mt.delete(O),mr;case B:if(Le)return Le.call(O)==Le.call(q)}return!1}function Gn(O,q,Y,ke,It,Qe){var Mt=Y&a,qt=ha(O),Vt=qt.length,At=ha(q),mr=At.length;if(Vt!=mr&&!Mt)return!1;for(var Gr=Vt;Gr--;){var Jt=qt[Gr];if(!(Mt?Jt in q:Rt.call(q,Jt)))return!1}var Ir=Qe.get(O);if(Ir&&Qe.get(q))return Ir==q;var Er=!0;Qe.set(O,q),Qe.set(q,O);for(var Hn=Mt;++Gr<Vt;){Jt=qt[Gr];var wn=O[Jt],ya=q[Jt];if(ke)var Fv=Mt?ke(ya,wn,Jt,q,O,Qe):ke(wn,ya,Jt,O,q,Qe);if(!(Fv===void 0?wn===ya||It(wn,ya,Y,ke,Qe):Fv)){Er=!1;break}Hn||(Hn=Jt=="constructor")}if(Er&&!Hn){var cu=O.constructor,fu=q.constructor;cu!=fu&&"constructor"in O&&"constructor"in q&&!(typeof cu=="function"&&cu instanceof cu&&typeof fu=="function"&&fu instanceof fu)&&(Er=!1)}return Qe.delete(O),Qe.delete(q),Er}function ha(O){return Ji(O,Yt,E)}function bn(O,q){var Y=O.__data__;return b(q)?Y[typeof q=="string"?"string":"hash"]:Y.map}function rt(O,q){var Y=xt(O,q);return za(Y)?Y:void 0}function Ka(O){var q=Rt.call(O,G),Y=O[G];try{O[G]=void 0;var ke=!0}catch(Qe){}var It=Zr.call(O);return ke&&(q?O[G]=Y:delete O[G]),It}var E=K?function(O){return O==null?[]:(O=Object(O),Be(K(O),function(q){return Q.call(O,q)}))}:zt,C=cr;(re&&C(new re(new ArrayBuffer(1)))!=de||D&&C(new D)!=M||z&&C(z.resolve())!=me||N&&C(new N)!=Ee||W&&C(new W)!=pe)&&(C=function(O){var q=cr(O),Y=q==H?O.constructor:void 0,ke=Y?f(Y):"";if(ke)switch(ke){case ge:return de;case ae:return M;case Ce:return me;case we:return Ee;case $e:return pe}return q});function S(O,q){return q=q==null?s:q,!!q&&(typeof O=="number"||be.test(O))&&O>-1&&O%1==0&&O<q}function b(O){var q=typeof O;return q=="string"||q=="number"||q=="symbol"||q=="boolean"?O!=="__proto__":O===null}function d(O){return!!Dt&&Dt in O}function h(O){var q=O&&O.constructor,Y=typeof q=="function"&&q.prototype||et;return O===Y}function c(O){return Zr.call(O)}function f(O){if(O!=null){try{return Et.call(O)}catch(q){}try{return O+""}catch(q){}}return""}function l(O,q){return O===q||O!==O&&q!==q}var y=Wn(function(){return arguments}())?Wn:function(O){return kt(O)&&Rt.call(O,"callee")&&!Q.call(O,"callee")},p=Array.isArray;function $(O){return O!=null&&ue(O.length)&&!P(O)}var T=V||er;function A(O,q){return pa(O,q)}function P(O){if(!Ue(O))return!1;var q=cr(O);return q==w||q==R||q==v||q==ne}function ue(O){return typeof O=="number"&&O>-1&&O%1==0&&O<=s}function Ue(O){var q=typeof O;return O!=null&&(q=="object"||q=="function")}function kt(O){return O!=null&&typeof O=="object"}var qe=se?Ve(se):Xi;function Yt(O){return $(O)?Yi(O):Zi(O)}function zt(){return[]}function er(){return!1}e.exports=A})(oo,oo.exports);var tx=oo.exports,__={exports:{}},rx=We,nx=rx(function(){if(typeof ArrayBuffer=="function"){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}),ax=We,ix=Ct,sx=on,oy=nx,eo=Object.isExtensible,ux=ax(function(){eo(1)}),ox=ux||oy?function(n){return!ix(n)||oy&&sx(n)==="ArrayBuffer"?!1:eo?eo(n):!0}:eo,lx=We,cx=!lx(function(){return Object.isExtensible(Object.preventExtensions({}))}),fx=Je,dx=Ke,vx=Ds,px=Ct,Qd=Pt,hx=ar.f,ly=La,yx=pd,Xd=ox,gx=js,mx=cx,S_=!1,An=gx("meta"),bx=0,Zd=function(e){hx(e,An,{value:{objectID:"O"+bx++,weakData:{}}})},wx=function(e,n){if(!px(e))return typeof e=="symbol"?e:(typeof e=="string"?"S":"P")+e;if(!Qd(e,An)){if(!Xd(e))return"F";if(!n)return"E";Zd(e)}return e[An].objectID},_x=function(e,n){if(!Qd(e,An)){if(!Xd(e))return!0;if(!n)return!1;Zd(e)}return e[An].weakData},Sx=function(e){return mx&&S_&&Xd(e)&&!Qd(e,An)&&Zd(e),e},$x=function(){Tx.enable=function(){},S_=!0;var e=ly.f,n=dx([].splice),t={};t[An]=1,e(t).length&&(ly.f=function(r){for(var a=e(r),i=0,s=a.length;i<s;i++)if(a[i]===An){n(a,i,1);break}return a},fx({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:yx.f}))},Tx=__.exports={enable:$x,fastKey:wx,getWeakData:_x,onFreeze:Sx};vx[An]=!0;var $_=__.exports,kx=Je,Ix=Xe,Ex=Ke,cy=Ro,Rx=ir,Cx=$_,Ox=Do,Ax=Da,Px=gt,Mx=ln,lc=Ct,cc=We,Nx=Fo,Lx=fn,xx=Wo,T_=function(e,n,t){var r=e.indexOf("Map")!==-1,a=e.indexOf("Weak")!==-1,i=r?"set":"add",s=Ix[e],o=s&&s.prototype,u=s,v={},g=function(j){var H=Ex(o[j]);Rx(o,j,j==="add"?function(ne){return H(this,ne===0?0:ne),this}:j==="delete"?function(me){return a&&!lc(me)?!1:H(this,me===0?0:me)}:j==="get"?function(ne){return a&&!lc(ne)?void 0:H(this,ne===0?0:ne)}:j==="has"?function(ne){return a&&!lc(ne)?!1:H(this,ne===0?0:ne)}:function(ne,Ie){return H(this,ne===0?0:ne,Ie),this})},m=cy(e,!Px(s)||!(a||o.forEach&&!cc(function(){new s().entries().next()})));if(m)u=t.getConstructor(n,e,r,i),Cx.enable();else if(cy(e,!0)){var _=new u,w=_[i](a?{}:-0,1)!==_,R=cc(function(){_.has(1)}),M=Nx(function(j){new s(j)}),x=!a&&cc(function(){for(var j=new s,H=5;H--;)j[i](H,H);return!j.has(-0)});M||(u=n(function(j,H){Ax(j,o);var me=xx(new s,j,u);return Mx(H)||Ox(H,me[i],{that:me,AS_ENTRIES:r}),me}),u.prototype=o,o.constructor=u),(R||x)&&(g("delete"),g("has"),r&&g("get")),(x||w)&&g(i),a&&o.clear&&delete o.clear}return v[e]=u,kx({global:!0,constructor:!0,forced:u!==s},v),Lx(u,e),a||t.setStrong(u,e,r),u},jx=ir,ev=function(e,n,t){for(var r in n)jx(e,r,n[r],t);return e},fy=sa,Ux=vn,dy=ev,Dx=Dn,Fx=Da,Bx=ln,qx=Do,Wx=Ld,Ou=qo,Gx=Lo,is=_t,vy=$_.fastKey,k_=xr,py=k_.set,fc=k_.getterFor,I_={getConstructor:function(e,n,t,r){var a=e(function(v,g){Fx(v,i),py(v,{type:n,index:fy(null),first:void 0,last:void 0,size:0}),is||(v.size=0),Bx(g)||qx(g,v[r],{that:v,AS_ENTRIES:t})}),i=a.prototype,s=fc(n),o=function(v,g,m){var _=s(v),w=u(v,g),R,M;return w?w.value=m:(_.last=w={index:M=vy(g,!0),key:g,value:m,previous:R=_.last,next:void 0,removed:!1},_.first||(_.first=w),R&&(R.next=w),is?_.size++:v.size++,M!=="F"&&(_.index[M]=w)),v},u=function(v,g){var m=s(v),_=vy(g),w;if(_!=="F")return m.index[_];for(w=m.first;w;w=w.next)if(w.key===g)return w};return dy(i,{clear:function(){for(var g=this,m=s(g),_=m.first;_;)_.removed=!0,_.previous&&(_.previous=_.previous.next=void 0),_=_.next;m.first=m.last=void 0,m.index=fy(null),is?m.size=0:g.size=0},delete:function(v){var g=this,m=s(g),_=u(g,v);if(_){var w=_.next,R=_.previous;delete m.index[_.index],_.removed=!0,R&&(R.next=w),w&&(w.previous=R),m.first===_&&(m.first=w),m.last===_&&(m.last=R),is?m.size--:g.size--}return!!_},forEach:function(g){for(var m=s(this),_=Dx(g,arguments.length>1?arguments[1]:void 0),w;w=w?w.next:m.first;)for(_(w.value,w.key,this);w&&w.removed;)w=w.previous},has:function(g){return!!u(this,g)}}),dy(i,t?{get:function(g){var m=u(this,g);return m&&m.value},set:function(g,m){return o(this,g===0?0:g,m)}}:{add:function(g){return o(this,g=g===0?0:g,g)}}),is&&Ux(i,"size",{configurable:!0,get:function(){return s(this).size}}),a},setStrong:function(e,n,t){var r=n+" Iterator",a=fc(n),i=fc(r);Wx(e,n,function(s,o){py(this,{type:r,target:s,state:a(s),kind:o,last:void 0})},function(){for(var s=i(this),o=s.kind,u=s.last;u&&u.removed;)u=u.previous;return!s.target||!(s.last=u=u?u.next:s.state.first)?(s.target=void 0,Ou(void 0,!0)):Ou(o==="keys"?u.key:o==="values"?u.value:[u.key,u.value],!1)},t?"entries":"values",!t,!0),Gx(n)}},Hx=T_,zx=I_;Hx("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},zx);var qn={};/*
@license
Copyright (c) 2016, Twilio, Inc.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

*/Object.defineProperty(qn,"__esModule",{value:!0});var Vx=yn,Kx=ua,Yx=ja,Jx=pn,Qx=hn,Xx=Ur,Zx=Ua;function Fa(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var tv=Fa(Vx),rv=Fa(Kx),In=Fa(Yx),nv=Fa(Jx),E_=Fa(Qx),lo=Fa(Xx),En=Fa(Zx),ej;function ta(){}ta.prototype=Object.create(null);function pt(){pt.init.call(this)}pt.EventEmitter=pt;pt.usingDomains=!1;pt.prototype.domain=void 0;pt.prototype._events=void 0;pt.prototype._maxListeners=void 0;pt.defaultMaxListeners=10;pt.init=function(){this.domain=null,pt.usingDomains&&ej.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new ta,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};pt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function R_(e){return e._maxListeners===void 0?pt.defaultMaxListeners:e._maxListeners}pt.prototype.getMaxListeners=function(){return R_(this)};function tj(e,n,t){if(n)e.call(t);else for(var r=e.length,a=nu(e,r),i=0;i<r;++i)a[i].call(t)}function rj(e,n,t,r){if(n)e.call(t,r);else for(var a=e.length,i=nu(e,a),s=0;s<a;++s)i[s].call(t,r)}function nj(e,n,t,r,a){if(n)e.call(t,r,a);else for(var i=e.length,s=nu(e,i),o=0;o<i;++o)s[o].call(t,r,a)}function aj(e,n,t,r,a,i){if(n)e.call(t,r,a,i);else for(var s=e.length,o=nu(e,s),u=0;u<s;++u)o[u].call(t,r,a,i)}function ij(e,n,t,r){if(n)e.apply(t,r);else for(var a=e.length,i=nu(e,a),s=0;s<a;++s)i[s].apply(t,r)}pt.prototype.emit=function(n){var t,r,a,i,s,o,u,v=n==="error";if(o=this._events,o)v=v&&o.error==null;else if(!v)return!1;if(u=this.domain,v){if(t=arguments[1],u)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t);else{if(t instanceof Error)throw t;var g=new Error('Uncaught, unspecified "error" event. ('+t+")");throw g.context=t,g}return!1}if(r=o[n],!r)return!1;var m=typeof r=="function";switch(a=arguments.length,a){case 1:tj(r,m,this);break;case 2:rj(r,m,this,arguments[1]);break;case 3:nj(r,m,this,arguments[1],arguments[2]);break;case 4:aj(r,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];ij(r,m,this,i)}return!0};function C_(e,n,t,r){var a,i,s;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),i=e._events),s=i[n]):(i=e._events=new ta,e._eventsCount=0),!s)s=i[n]=t,++e._eventsCount;else if(typeof s=="function"?s=i[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),!s.warned&&(a=R_(e),a&&a>0&&s.length>a)){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,sj(o)}return e}function sj(e){typeof console.warn=="function"?console.warn(e):console.log(e)}pt.prototype.addListener=function(n,t){return C_(this,n,t,!1)};pt.prototype.on=pt.prototype.addListener;pt.prototype.prependListener=function(n,t){return C_(this,n,t,!0)};function O_(e,n,t){var r=!1;function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}return a.listener=t,a}pt.prototype.once=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,O_(this,n,t)),this};pt.prototype.prependOnceListener=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,O_(this,n,t)),this};pt.prototype.removeListener=function(n,t){var r,a,i,s,o;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(r=a[n],!r)return this;if(r===t||r.listener&&r.listener===t)--this._eventsCount===0?this._events=new ta:(delete a[n],a.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new ta,this;delete a[n]}else uj(r,i);a.removeListener&&this.emit("removeListener",n,o||t)}return this};pt.prototype.off=function(e,n){return this.removeListener(e,n)};pt.prototype.removeAllListeners=function(n){var t,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new ta,this._eventsCount=0):r[n]&&(--this._eventsCount===0?this._events=new ta:delete r[n]),this;if(arguments.length===0){for(var a=Object.keys(r),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new ta,this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t)do this.removeListener(n,t[t.length-1]);while(t[0]);return this};pt.prototype.listeners=function(n){var t,r,a=this._events;return a?(t=a[n],t?typeof t=="function"?r=[t.listener||t]:r=oj(t):r=[]):r=[],r};pt.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):A_.call(e,n)};pt.prototype.listenerCount=A_;function A_(e){var n=this._events;if(n){var t=n[e];if(typeof t=="function")return 1;if(t)return t.length}return 0}pt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function uj(e,n){for(var t=n,r=t+1,a=e.length;r<a;t+=1,r+=1)e[t]=e[r];e.pop()}function nu(e,n){for(var t=new Array(n);n--;)t[n]=e[n];return t}function oj(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}function P_(e){var n=lj();return function(){var r=lo.default(e),a;if(n){var i=lo.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return E_.default(this,a)}}function lj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M_=function(e){nv.default(t,e);var n=P_(t);function t(r){var a;return tv.default(this,t),a=n.call(this),En.default(In.default(a),"timeout",null),En.default(In.default(a),"startTimestamp",-1),a.minDelay=r.min,a.maxDelay=r.max,a.initialDelay=r.initial||0,a.maxAttemptsCount=r.maxAttemptsCount||0,a.maxAttemptsTime=r.maxAttemptsTime||0,a.randomness=r.randomness||0,a.inProgress=!1,a.attemptNum=0,a.prevDelay=0,a.currDelay=0,a}return rv.default(t,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(a){if(typeof a=="number")return this.prevDelay=0,this.currDelay=a,a;if(this.attemptNum==0)return this.initialDelay;if(this.attemptNum==1)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var i=this.currDelay+this.prevDelay;return this.maxDelay&&i>this.maxDelay&&(this.currDelay=this.maxDelay,i=this.maxDelay),this.currDelay=i,i}},{key:"randomize",value:function(a){var i=a*this.randomness,s=Math.round(Math.random()*i*2-i);return Math.max(0,a+s)}},{key:"scheduleAttempt",value:function(a){var i=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount){this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached"));return}var s=this.nextDelay(a);if(s=this.randomize(s),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+s){this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached"));return}this.timeout=setTimeout(function(){return i.attempt()},s)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(a){this.emit("succeeded",a)}},{key:"failed",value:function(a,i){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(i)}}]),t}(pt),cj=function(e){nv.default(t,e);var n=P_(t);function t(r){var a;return tv.default(this,t),a=n.call(this),En.default(In.default(a),"resolve",function(){}),En.default(In.default(a),"reject",function(){}),a.retrier=new M_(r),a}return rv.default(t,[{key:"run",value:function(a){var i=this;return this.retrier.on("attempt",function(){a().then(function(s){return i.retrier.succeeded(s)}).catch(function(s){return i.retrier.failed(s)})}),this.retrier.on("succeeded",function(s){return i.resolve(s)}),this.retrier.on("cancelled",function(){return i.reject(new Error("Cancelled"))}),this.retrier.on("failed",function(s){return i.reject(s)}),new Promise(function(s,o){i.resolve=s,i.reject=o,i.retrier.start()})}},{key:"cancel",value:function(){this.retrier.cancel()}}]),t}(pt);function fj(e){var n=dj();return function(){var r=lo.default(e),a;if(n){var i=lo.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return E_.default(this,a)}}function dj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Au(e){return e!=null}var vj=function(e){nv.default(t,e);var n=fj(t);function t(r){var a;tv.default(this,t),a=n.call(this),En.default(In.default(a),"backoffDelay",0),En.default(In.default(a),"nextBackoffDelay",0),En.default(In.default(a),"backoffNumber",0),En.default(In.default(a),"timeoutID",null),En.default(In.default(a),"maxNumberOfRetry",-1),r=r||{};var i=r,s=i.initialDelay,o=i.maxDelay,u=i.randomisationFactor,v=i.factor;if(Au(s)&&s<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(Au(o)&&o<=1)throw new Error("The maximal timeout must be greater than 1.");if(Au(u)&&(u<0||u>1))throw new Error("The randomisation factor must be between 0 and 1.");if(Au(v)&&v<=1)throw new Error("Exponential factor should be greater than 1.");if(a.initialDelay=s||100,a.maxDelay=o||1e4,a.maxDelay<=a.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return a.randomisationFactor=u||0,a.factor=v||2,a.reset(),a}return rv.default(t,[{key:"backoff",value:function(a){this.timeoutID==null&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",a),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,a)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(a){if(a<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(a));this.maxNumberOfRetry=a}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var a=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*a))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(a){return new t(a)}}]),t}(pt);qn.AsyncRetrier=cj;qn.Backoff=vj;qn.Retrier=M_;var Zo={},pj=yt,hj=Pt,yj=Ln,gj=Gw,hy=RegExp.prototype,mj=function(e){var n=e.flags;return n===void 0&&!("flags"in hy)&&!hj(e,"flags")&&yj(hy,e)?pj(gj,e):n},bj=Us.PROPER,wj=ir,_j=Lt,yy=Bt,Sj=We,$j=mj,av="toString",N_=RegExp.prototype,L_=N_[av],Tj=Sj(function(){return L_.call({source:"a",flags:"b"})!=="/a/b"}),kj=bj&&L_.name!==av;(Tj||kj)&&wj(N_,av,function(){var n=_j(this),t=yy(n.source),r=yy($j(n));return"/"+t+"/"+r},{unsafe:!0});var sr={};/*
@license
Copyright (c) 2021 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


*/Object.defineProperty(sr,"__esModule",{value:!0});var Ij=jr,Ej=xi,Rj=ji,Cj=yn,Oj=pn,Aj=hn,Pj=Ur;function Ba(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var hi=Ba(Ij),Oa=Ba(Ej),dc=Ba(Rj),Mj=Ba(Cj),Nj=Ba(Oj),Lj=Ba(Aj),gy=Ba(Pj),la=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return{checks:t}};function xj(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=jj(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function jj(e,n){if(e){if(typeof e=="string")return my(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return my(e,n)}}function my(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var x_=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return la(function(a){var i=!1,s=[],o=xj(t),u;try{for(o.s();!(u=o.n()).done;){var v=u.value;if(typeof v=="string"){i=i||hi.default(a)===v,s.push("of type ".concat(v));continue}i=i||a instanceof v,s.push("an instance of ".concat(v.name))}}catch(g){o.e(g)}finally{o.f()}return[i,s]})};function Uj(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Dj(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function Dj(e,n){if(e){if(typeof e=="string")return by(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return by(e,n)}}function by(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var Fj=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return la(function(a){var i=!1,s=[],o=Uj(t),u;try{for(o.s();!(u=o.n()).done;){var v=u.value;i=i||a===v,s.push(typeof v=="string"?'"'.concat(v,'"'):"".concat(v))}}catch(g){o.e(g)}finally{o.f()}return[i,s]})},Bj=la(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),qj=la(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),Wj=la(function(e){return[hi.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]});function Gj(e){var n=Hj();return function(){var r=gy.default(e),a;if(n){var i=gy.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Lj.default(this,a)}}function Hj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Os(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=zj(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function zj(e,n){if(e){if(typeof e=="string")return wy(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wy(e,n)}}function wy(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var el=function(n,t){if(t.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(t.length));for(;t.length<n.length;)t.push(void 0);var r=Os(t.entries()),a;try{for(r.s();!(a=r.n()).done;){var i=Oa.default(a.value,2),s=i[0],o=i[1],u=uv(n[s],o),v=Oa.default(u,4),g=v[0],m=v[1],_=v[2],w=v[3];if(!g){var R=s+1;throw new Error("Argument ".concat(R," is expected to be ").concat(_).concat(w," but got ").concat(m))}}}catch(M){r.e(M)}finally{r.f()}},j_=function(n){var t,r,a=["undefined","boolean","number","bigint","string"];if(a.includes(hi.default(n))&&(r=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),hi.default(n)==="object"&&(n==null||(t=n.constructor)===null||t===void 0?void 0:t.name)!=="Object"){var i;r=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return r||(r=hi.default(n)),r},Vj=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=iv(t);return function(i){return function(s){Nj.default(u,s);var o=Gj(u);function u(){Mj.default(this,u);for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return el(a,g),o.call.apply(o,[this].concat(g))}return u}(i)}},Kj=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=iv(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var u=o.value;o.value=function(){for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return el(a,g),u.apply(this,g)}}},Yj=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=iv(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var u=o.value;o.value=function(){for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];try{el(a,g)}catch(_){return Promise.reject(_)}return u.apply(this,g)}}},iv=function(n){var t=[],r=Os(n),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;t.push(sv(i))}}catch(s){r.e(s)}finally{r.f()}return t},sv=function(n){var t=[],r=Array.isArray(n)?n:[n],a=Os(r),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){t.push(x_(s));continue}t.push(s)}}catch(o){a.e(o)}finally{a.f()}return t},uv=function(n,t){var r=[],a,i=!1,s=Os(n),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,v=Os(u.checks),g;try{for(v.s();!(g=v.n()).done;){var m=g.value,_=m(t),w=Oa.default(_,3),R=w[0],M=w[1],x=w[2];i=i||R,!a&&x&&(a=x),M&&(r=typeof M=="string"?[].concat(dc.default(r),[M]):[].concat(dc.default(r),dc.default(M)))}}catch(ne){v.e(ne)}finally{v.f()}}}catch(ne){s.e(ne)}finally{s.f()}if(i)return[!0];var j=a||j_(t),H=r.length-1,me=H>0?"".concat(r.slice(0,H).join(", ")," or ").concat(r[H]):r.join(", ");return[!1,j,me,H>1?";":","]},Jj=function(n,t){return la(function(r){if(hi.default(r)!=="object"||r===null||Array.isArray(r))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(t);a<i.length;a++){var s=Oa.default(i[a],2),o=s[0],u=s[1],v=uv(sv(u),r[o]),g=Oa.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"valid ".concat(n,' (key "').concat(o,'" should be ').concat(w,")"),"malformed ".concat(n,' (key "').concat(o,'" is ').concat(_,")")]}return[!0]})};function Qj(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Xj(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function Xj(e,n){if(e){if(typeof e=="string")return _y(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _y(e,n)}}function _y(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var Zj=function(n,t){return la(function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(n)];var a=Qj(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=Oa.default(i.value,2),o=s[0],u=s[1],v=uv(sv(t),u),g=Oa.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"a valid array of ".concat(n," (index ").concat(o," should be ").concat(w,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(_,")")]}}catch(R){a.e(R)}finally{a.f()}return[!0]})};sr.array=Zj;sr.custom=la;sr.literal=Fj;sr.nonEmptyString=Bj;sr.nonNegativeInteger=qj;sr.objectSchema=Jj;sr.pureObject=Wj;sr.runtimeTypeValidation=el;sr.stringifyReceivedType=j_;sr.type=x_;sr.validateConstructorTypes=Vj;sr.validateTypes=Kj;sr.validateTypesAsync=Yj;var eU=T_,tU=I_;eU("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},tU);var U_={exports:{}};(function(e,n){(function(r,a){e.exports=a()})(dr,function(){return function(t){var r={};function a(i){if(r[i])return r[i].exports;var s=r[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=r,a.i=function(i){return i},a.d=function(i,s,o){a.o(i,s)||Object.defineProperty(i,s,{configurable:!1,enumerable:!0,get:o})},a.n=function(i){var s=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(s,"a",s),s},a.o=function(i,s){return Object.prototype.hasOwnProperty.call(i,s)},a.p="",a(a.s=5)}([function(t,r,a){t.exports=function(i,s){var o,u,v;for(o=1;o<arguments.length;o++){u=arguments[o];for(v in u)u.hasOwnProperty(v)&&(i[v]=u[v])}return i}},function(t,r,a){var i=a(0);t.exports={build:function(s,o){var u,v,g,m=o.plugins;for(u=0,v=m.length;u<v;u++)g=m[u],g.methods&&i(s,g.methods),g.properties&&Object.defineProperties(s,g.properties)},hook:function(s,o,u){var v,g,m,_,w=s.config.plugins,R=[s.context];for(u&&(R=R.concat(u)),v=0,g=w.length;v<g;v++)_=w[v],m=w[v][o],m&&m.apply(_,R)}}},function(t,r,a){function i(s){if(s.length===0)return s;var o,u,v=s.split(/[_-]/);if(v.length===1&&v[0][0].toLowerCase()===v[0][0])return s;for(u=v[0].toLowerCase(),o=1;o<v.length;o++)u=u+v[o].charAt(0).toUpperCase()+v[o].substring(1).toLowerCase();return u}i.prepended=function(s,o){return o=i(o),s+o[0].toUpperCase()+o.substring(1)},t.exports=i},function(t,r,a){var i=a(0),s=a(2);function o(u,v){u=u||{},this.options=u,this.defaults=v.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(u.init),this.data=this.configureData(u.data),this.methods=this.configureMethods(u.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(u.transitions||[]),this.plugins=this.configurePlugins(u.plugins,v.plugin)}i(o.prototype,{addState:function(u){this.map[u]||(this.states.push(u),this.addStateLifecycleNames(u),this.map[u]={})},addStateLifecycleNames:function(u){this.lifecycle.onEnter[u]=s.prepended("onEnter",u),this.lifecycle.onLeave[u]=s.prepended("onLeave",u),this.lifecycle.on[u]=s.prepended("on",u)},addTransition:function(u){this.transitions.indexOf(u)<0&&(this.transitions.push(u),this.addTransitionLifecycleNames(u))},addTransitionLifecycleNames:function(u){this.lifecycle.onBefore[u]=s.prepended("onBefore",u),this.lifecycle.onAfter[u]=s.prepended("onAfter",u),this.lifecycle.on[u]=s.prepended("on",u)},mapTransition:function(u){var v=u.name,g=u.from,m=u.to;return this.addState(g),typeof m!="function"&&this.addState(m),this.addTransition(v),this.map[g][v]=u,u},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(u){return typeof u=="string"?this.mapTransition(i({},this.defaults.init,{to:u,active:!0})):typeof u=="object"?this.mapTransition(i({},this.defaults.init,u,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(u){return typeof u=="function"?u:typeof u=="object"?function(){return u}:function(){return{}}},configureMethods:function(u){return u||{}},configurePlugins:function(u,v){u=u||[];var g,m,_;for(g=0,m=u.length;g<m;g++)_=u[g],typeof _=="function"&&(u[g]=_=_()),_.configure&&_.configure(this);return u},configureTransitions:function(u){var v,g,m,_,w,R=this.defaults.wildcard;for(g=0;g<u.length;g++)for(m=u[g],_=Array.isArray(m.from)?m.from:[m.from||R],w=m.to||R,v=0;v<_.length;v++)this.mapTransition({name:m.name,from:_[v],to:w})},transitionFor:function(u,v){var g=this.defaults.wildcard;return this.map[u][v]||this.map[g][v]},transitionsFor:function(u){var v=this.defaults.wildcard;return Object.keys(this.map[u]).concat(Object.keys(this.map[v]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),t.exports=o},function(t,r,a){var i=a(0),s=a(6),o=a(1),u=[null,[]];function v(g,m){this.context=g,this.config=m,this.state=m.init.from,this.observers=[g]}i(v.prototype,{init:function(g){if(i(this.context,this.config.data.apply(this.context,g)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(g){return Array.isArray(g)?g.indexOf(this.state)>=0:this.state===g},isPending:function(){return this.pending},can:function(g){return!this.isPending()&&!!this.seek(g)},cannot:function(g){return!this.can(g)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(g,m){var _=this.config.defaults.wildcard,w=this.config.transitionFor(this.state,g),R=w&&w.to;return typeof R=="function"?R.apply(this.context,m):R===_?this.state:R},fire:function(g,m){return this.transit(g,this.state,this.seek(g,m),m)},transit:function(g,m,_,w){var R=this.config.lifecycle,M=this.config.options.observeUnchangedState||m!==_;return _?this.isPending()?this.context.onPendingTransition(g,m,_):(this.config.addState(_),this.beginTransit(),w.unshift({transition:g,from:m,to:_,fsm:this.context}),this.observeEvents([this.observersForEvent(R.onBefore.transition),this.observersForEvent(R.onBefore[g]),M?this.observersForEvent(R.onLeave.state):u,M?this.observersForEvent(R.onLeave[m]):u,this.observersForEvent(R.on.transition),M?["doTransit",[this]]:u,M?this.observersForEvent(R.onEnter.state):u,M?this.observersForEvent(R.onEnter[_]):u,M?this.observersForEvent(R.on[_]):u,this.observersForEvent(R.onAfter.transition),this.observersForEvent(R.onAfter[g]),this.observersForEvent(R.on[g])],w)):this.context.onInvalidTransition(g,m,_)},beginTransit:function(){this.pending=!0},endTransit:function(g){return this.pending=!1,g},failTransit:function(g){throw this.pending=!1,g},doTransit:function(g){this.state=g.to},observe:function(g){if(g.length===2){var m={};m[g[0]]=g[1],this.observers.push(m)}else this.observers.push(g[0])},observersForEvent:function(g){for(var m=0,_=this.observers.length,w,R=[];m<_;m++)w=this.observers[m],w[g]&&R.push(w);return[g,R,!0]},observeEvents:function(g,m,_,w){if(g.length===0)return this.endTransit(w===void 0?!0:w);var R=g[0][0],M=g[0][1],x=g[0][2];if(m[0].event=R,R&&x&&R!==_&&o.hook(this,"lifecycle",m),M.length===0)return g.shift(),this.observeEvents(g,m,R,w);var j=M.shift(),H=j[R].apply(j,m);return H&&typeof H.then=="function"?H.then(this.observeEvents.bind(this,g,m,R)).catch(this.failTransit.bind(this)):H===!1?this.endTransit(!1):this.observeEvents(g,m,R,H)},onInvalidTransition:function(g,m,_){throw new s("transition is invalid in current state",g,m,_,this.state)},onPendingTransition:function(g,m,_){throw new s("transition is invalid while previous transition is still in progress",g,m,_,this.state)}}),t.exports=v},function(t,r,a){var i=a(0),s=a(2),o=a(1),u=a(3),v=a(4),g={is:function(x){return this._fsm.is(x)},can:function(x){return this._fsm.can(x)},cannot:function(x){return this._fsm.cannot(x)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(x,j,H){return this._fsm.onInvalidTransition(x,j,H)},onPendingTransition:function(x,j,H){return this._fsm.onPendingTransition(x,j,H)}},m={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(x){throw Error("use transitions to change state")}}};function _(x){return R(this||{},x)}function w(){var x,j;typeof arguments[0]=="function"?(x=arguments[0],j=arguments[1]||{}):(x=function(){this._fsm.apply(this,arguments)},j=arguments[0]||{});var H=new u(j,_);return M(x.prototype,H),x.prototype._fsm.config=H,x}function R(x,j){var H=new u(j,_);return M(x,H),x._fsm(),x}function M(x,j){if(typeof x!="object"||Array.isArray(x))throw Error("StateMachine can only be applied to objects");o.build(x,j),Object.defineProperties(x,m),i(x,g),i(x,j.methods),j.allTransitions().forEach(function(H){x[s(H)]=function(){return this._fsm.fire(H,[].slice.call(arguments))}}),x._fsm=function(){this._fsm=new v(this,j),this._fsm.init(arguments)}}_.version="3.0.1",_.factory=w,_.apply=R,_.defaults={wildcard:"*",init:{name:"init",from:"none"}},t.exports=_},function(t,r,a){t.exports=function(i,s,o,u,v){this.message=i,this.transition=s,this.from=o,this.to=u,this.current=v}}])})})(U_);var rU=U_.exports,If={exports:{}},Sy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Sy){var $y=new Uint8Array(16);If.exports=function(){return Sy($y),$y}}else{var Ty=new Array(16);If.exports=function(){for(var n=0,t;n<16;n++)n&3||(t=Math.random()*4294967296),Ty[n]=t>>>((n&3)<<3)&255;return Ty}}var D_=If.exports,F_=[];for(var Pu=0;Pu<256;++Pu)F_[Pu]=(Pu+256).toString(16).substr(1);function nU(e,n){var t=n||0,r=F_;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]]].join("")}var B_=nU,aU=D_,iU=B_,ky,vc,pc=0,hc=0;function sU(e,n,t){var r=n&&t||0,a=n||[];e=e||{};var i=e.node||ky,s=e.clockseq!==void 0?e.clockseq:vc;if(i==null||s==null){var o=aU();i==null&&(i=ky=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),s==null&&(s=vc=(o[6]<<8|o[7])&16383)}var u=e.msecs!==void 0?e.msecs:new Date().getTime(),v=e.nsecs!==void 0?e.nsecs:hc+1,g=u-pc+(v-hc)/1e4;if(g<0&&e.clockseq===void 0&&(s=s+1&16383),(g<0||u>pc)&&e.nsecs===void 0&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");pc=u,hc=v,vc=s,u+=122192928e5;var m=((u&268435455)*1e4+v)%4294967296;a[r++]=m>>>24&255,a[r++]=m>>>16&255,a[r++]=m>>>8&255,a[r++]=m&255;var _=u/4294967296*1e4&268435455;a[r++]=_>>>8&255,a[r++]=_&255,a[r++]=_>>>24&15|16,a[r++]=_>>>16&255,a[r++]=s>>>8|128,a[r++]=s&255;for(var w=0;w<6;++w)a[r+w]=i[w];return n||iU(a)}var uU=sU,oU=D_,lU=B_;function cU(e,n,t){var r=n&&t||0;typeof e=="string"&&(n=e==="binary"?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||oU)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,n)for(var i=0;i<16;++i)n[r+i]=a[i];return n||lU(a)}var fU=cU,dU=uU,q_=fU,ov=q_;ov.v1=dU;ov.v4=q_;var tl=ov,Ef={exports:{}},W_=typeof ArrayBuffer<"u"&&typeof DataView<"u",vU=W_,lv=_t,nr=Xe,G_=gt,rl=Ct,aa=Pt,cv=Un,pU=Ma,hU=xn,Rf=ir,yU=vn,gU=Ln,nl=eu,Ui=Ni,mU=mt,bU=js,H_=xr,z_=H_.enforce,wU=H_.get,co=nr.Int8Array,Cf=co&&co.prototype,Iy=nr.Uint8ClampedArray,Ey=Iy&&Iy.prototype,an=co&&nl(co),Yr=Cf&&nl(Cf),_U=Object.prototype,fv=nr.TypeError,Ry=mU("toStringTag"),Of=bU("TYPED_ARRAY_TAG"),fo="TypedArrayConstructor",Pn=vU&&!!Ui&&cv(nr.opera)!=="Opera",V_=!1,vr,Jn,yi,Mn={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},dv={BigInt64Array:8,BigUint64Array:8},SU=function(n){if(!rl(n))return!1;var t=cv(n);return t==="DataView"||aa(Mn,t)||aa(dv,t)},K_=function(e){var n=nl(e);if(rl(n)){var t=wU(n);return t&&aa(t,fo)?t[fo]:K_(n)}},Y_=function(e){if(!rl(e))return!1;var n=cv(e);return aa(Mn,n)||aa(dv,n)},$U=function(e){if(Y_(e))return e;throw new fv("Target is not a typed array")},TU=function(e){if(G_(e)&&(!Ui||gU(an,e)))return e;throw new fv(pU(e)+" is not a typed array constructor")},kU=function(e,n,t,r){if(lv){if(t)for(var a in Mn){var i=nr[a];if(i&&aa(i.prototype,e))try{delete i.prototype[e]}catch(s){try{i.prototype[e]=n}catch(o){}}}(!Yr[e]||t)&&Rf(Yr,e,t?n:Pn&&Cf[e]||n,r)}},IU=function(e,n,t){var r,a;if(lv){if(Ui){if(t){for(r in Mn)if(a=nr[r],a&&aa(a,e))try{delete a[e]}catch(i){}}if(!an[e]||t)try{return Rf(an,e,t?n:Pn&&an[e]||n)}catch(i){}else return}for(r in Mn)a=nr[r],a&&(!a[e]||t)&&Rf(a,e,n)}};for(vr in Mn)Jn=nr[vr],yi=Jn&&Jn.prototype,yi?z_(yi)[fo]=Jn:Pn=!1;for(vr in dv)Jn=nr[vr],yi=Jn&&Jn.prototype,yi&&(z_(yi)[fo]=Jn);if((!Pn||!G_(an)||an===Function.prototype)&&(an=function(){throw new fv("Incorrect invocation")},Pn))for(vr in Mn)nr[vr]&&Ui(nr[vr],an);if((!Pn||!Yr||Yr===_U)&&(Yr=an.prototype,Pn))for(vr in Mn)nr[vr]&&Ui(nr[vr].prototype,Yr);Pn&&nl(Ey)!==Yr&&Ui(Ey,Yr);if(lv&&!aa(Yr,Ry)){V_=!0,yU(Yr,Ry,{configurable:!0,get:function(){return rl(this)?this[Of]:void 0}});for(vr in Mn)nr[vr]&&hU(nr[vr],Of,vr)}var St={NATIVE_ARRAY_BUFFER_VIEWS:Pn,TYPED_ARRAY_TAG:V_&&Of,aTypedArray:$U,aTypedArrayConstructor:TU,exportTypedArrayMethod:kU,exportTypedArrayStaticMethod:IU,getTypedArrayConstructor:K_,isView:SU,isTypedArray:Y_,TypedArray:an,TypedArrayPrototype:Yr},J_=Xe,yc=We,EU=Fo,RU=St.NATIVE_ARRAY_BUFFER_VIEWS,CU=J_.ArrayBuffer,wa=J_.Int8Array,OU=!RU||!yc(function(){wa(1)})||!yc(function(){new wa(-1)})||!EU(function(e){new wa,new wa(null),new wa(1.5),new wa(e)},!0)||yc(function(){return new wa(new CU(2),1,void 0).length!==1}),AU=cn,PU=jn,MU=RangeError,Q_=function(e){if(e===void 0)return 0;var n=AU(e),t=PU(n);if(n!==t)throw new MU("Wrong length or index");return t},NU=Math.sign||function(n){var t=+n;return t===0||t!==t?t:t<0?-1:1},LU=NU,xU=Math.abs,X_=2220446049250313e-31,Cy=1/X_,jU=function(e){return e+Cy-Cy},UU=function(e,n,t,r){var a=+e,i=xU(a),s=LU(a);if(i<r)return s*jU(i/r/n)*r*n;var o=(1+n/X_)*i,u=o-(o-i);return u>t||u!==u?s*(1/0):s*u},DU=UU,FU=11920928955078125e-23,BU=34028234663852886e22,qU=11754943508222875e-54,WU=Math.fround||function(n){return DU(n,FU,BU,qU)},GU=Array,HU=Math.abs,kn=Math.pow,zU=Math.floor,VU=Math.log,KU=Math.LN2,YU=function(e,n,t){var r=GU(t),a=t*8-n-1,i=(1<<a)-1,s=i>>1,o=n===23?kn(2,-24)-kn(2,-77):0,u=e<0||e===0&&1/e<0?1:0,v=0,g,m,_;for(e=HU(e),e!==e||e===1/0?(m=e!==e?1:0,g=i):(g=zU(VU(e)/KU),_=kn(2,-g),e*_<1&&(g--,_*=2),g+s>=1?e+=o/_:e+=o*kn(2,1-s),e*_>=2&&(g++,_/=2),g+s>=i?(m=0,g=i):g+s>=1?(m=(e*_-1)*kn(2,n),g+=s):(m=e*kn(2,s-1)*kn(2,n),g=0));n>=8;)r[v++]=m&255,m/=256,n-=8;for(g=g<<n|m,a+=n;a>0;)r[v++]=g&255,g/=256,a-=8;return r[v-1]|=u*128,r},JU=function(e,n){var t=e.length,r=t*8-n-1,a=(1<<r)-1,i=a>>1,s=r-7,o=t-1,u=e[o--],v=u&127,g;for(u>>=7;s>0;)v=v*256+e[o--],s-=8;for(g=v&(1<<-s)-1,v>>=-s,s+=n;s>0;)g=g*256+e[o--],s-=8;if(v===0)v=1-i;else{if(v===a)return g?NaN:u?-1/0:1/0;g+=kn(2,n),v-=i}return(u?-1:1)*g*kn(2,v-n)},QU={pack:YU,unpack:JU},XU=Qt,Oy=Mi,ZU=Xt,Z_=function(n){for(var t=XU(this),r=ZU(t),a=arguments.length,i=Oy(a>1?arguments[1]:void 0,r),s=a>2?arguments[2]:void 0,o=s===void 0?r:Oy(s,r);o>i;)t[i++]=n;return t},al=Xe,vv=Ke,gc=_t,eD=W_,eS=Us,tD=xn,rD=vn,Ay=ev,mc=We,Mu=Da,nD=cn,aD=jn,vo=Q_,iD=WU,tS=QU,sD=eu,Py=Ni,uD=Z_,oD=dn,lD=Wo,cD=od,rS=fn,pv=xr,fD=eS.PROPER,My=eS.CONFIGURABLE,gi="ArrayBuffer",il="DataView",mi="prototype",dD="Wrong length",nS="Wrong index",Ny=pv.getterFor(gi),_s=pv.getterFor(il),Ly=pv.set,zr=al[gi],br=zr,Xa=br&&br[mi],rn=al[il],_a=rn&&rn[mi],xy=Object.prototype,vD=al.Array,po=al.RangeError,pD=vv(uD),hD=vv([].reverse),aS=tS.pack,jy=tS.unpack,Uy=function(e){return[e&255]},Dy=function(e){return[e&255,e>>8&255]},Fy=function(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]},By=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},yD=function(e){return aS(iD(e),23,4)},gD=function(e){return aS(e,52,8)},Nu=function(e,n,t){rD(e[mi],n,{configurable:!0,get:function(){return t(this)[n]}})},Vn=function(e,n,t,r){var a=_s(e),i=vo(t),s=!!r;if(i+n>a.byteLength)throw new po(nS);var o=a.bytes,u=i+a.byteOffset,v=oD(o,u,u+n);return s?v:hD(v)},Kn=function(e,n,t,r,a,i){var s=_s(e),o=vo(t),u=r(+a),v=!!i;if(o+n>s.byteLength)throw new po(nS);for(var g=s.bytes,m=o+s.byteOffset,_=0;_<n;_++)g[m+_]=u[v?_:n-_-1]};if(!eD)br=function(n){Mu(this,Xa);var t=vo(n);Ly(this,{type:gi,bytes:pD(vD(t),0),byteLength:t}),gc||(this.byteLength=t,this.detached=!1)},Xa=br[mi],rn=function(n,t,r){Mu(this,_a),Mu(n,Xa);var a=Ny(n),i=a.byteLength,s=nD(t);if(s<0||s>i)throw new po("Wrong offset");if(r=r===void 0?i-s:aD(r),s+r>i)throw new po(dD);Ly(this,{type:il,buffer:n,byteLength:r,byteOffset:s,bytes:a.bytes}),gc||(this.buffer=n,this.byteLength=r,this.byteOffset=s)},_a=rn[mi],gc&&(Nu(br,"byteLength",Ny),Nu(rn,"buffer",_s),Nu(rn,"byteLength",_s),Nu(rn,"byteOffset",_s)),Ay(_a,{getInt8:function(n){return Vn(this,1,n)[0]<<24>>24},getUint8:function(n){return Vn(this,1,n)[0]},getInt16:function(n){var t=Vn(this,2,n,arguments.length>1?arguments[1]:!1);return(t[1]<<8|t[0])<<16>>16},getUint16:function(n){var t=Vn(this,2,n,arguments.length>1?arguments[1]:!1);return t[1]<<8|t[0]},getInt32:function(n){return By(Vn(this,4,n,arguments.length>1?arguments[1]:!1))},getUint32:function(n){return By(Vn(this,4,n,arguments.length>1?arguments[1]:!1))>>>0},getFloat32:function(n){return jy(Vn(this,4,n,arguments.length>1?arguments[1]:!1),23)},getFloat64:function(n){return jy(Vn(this,8,n,arguments.length>1?arguments[1]:!1),52)},setInt8:function(n,t){Kn(this,1,n,Uy,t)},setUint8:function(n,t){Kn(this,1,n,Uy,t)},setInt16:function(n,t){Kn(this,2,n,Dy,t,arguments.length>2?arguments[2]:!1)},setUint16:function(n,t){Kn(this,2,n,Dy,t,arguments.length>2?arguments[2]:!1)},setInt32:function(n,t){Kn(this,4,n,Fy,t,arguments.length>2?arguments[2]:!1)},setUint32:function(n,t){Kn(this,4,n,Fy,t,arguments.length>2?arguments[2]:!1)},setFloat32:function(n,t){Kn(this,4,n,yD,t,arguments.length>2?arguments[2]:!1)},setFloat64:function(n,t){Kn(this,8,n,gD,t,arguments.length>2?arguments[2]:!1)}});else{var qy=fD&&zr.name!==gi;!mc(function(){zr(1)})||!mc(function(){new zr(-1)})||mc(function(){return new zr,new zr(1.5),new zr(NaN),zr.length!==1||qy&&!My})?(br=function(n){return Mu(this,Xa),lD(new zr(vo(n)),this,br)},br[mi]=Xa,Xa.constructor=br,cD(br,zr)):qy&&My&&tD(zr,"name",gi),Py&&sD(_a)!==xy&&Py(_a,xy);var Lu=new rn(new br(2)),Wy=vv(_a.setInt8);Lu.setInt8(0,2147483648),Lu.setInt8(1,2147483649),(Lu.getInt8(0)||!Lu.getInt8(1))&&Ay(_a,{setInt8:function(n,t){Wy(this,n,t<<24>>24)},setUint8:function(n,t){Wy(this,n,t<<24>>24)}},{unsafe:!0})}rS(br,gi);rS(rn,il);var iS={ArrayBuffer:br,DataView:rn},mD=cn,bD=RangeError,wD=function(e){var n=mD(e);if(n<0)throw new bD("The argument can't be less than 0");return n},_D=wD,SD=RangeError,sS=function(e,n){var t=_D(e);if(t%n)throw new SD("Wrong offset");return t},$D=Math.round,TD=function(e){var n=$D(e);return n<0?0:n>255?255:n&255},kD=Un,ID=function(e){var n=kD(e);return n==="BigInt64Array"||n==="BigUint64Array"},ED=nd,RD=TypeError,uS=function(e){var n=ED(e,"number");if(typeof n=="number")throw new RD("Can't convert number to bigint");return BigInt(n)},CD=Dn,OD=yt,AD=fd,PD=Qt,MD=Xt,ND=Uo,LD=Xs,xD=Pd,jD=ID,UD=St.aTypedArrayConstructor,DD=uS,FD=function(n){var t=AD(this),r=PD(n),a=arguments.length,i=a>1?arguments[1]:void 0,s=i!==void 0,o=LD(r),u,v,g,m,_,w,R,M;if(o&&!xD(o))for(R=ND(r,o),M=R.next,r=[];!(w=OD(M,R)).done;)r.push(w.value);for(s&&a>2&&(i=CD(i,arguments[2])),v=MD(r),g=new(UD(t))(v),m=jD(g),u=0;v>u;u++)_=s?i(r[u],u):r[u],g[u]=m?DD(_):+_;return g},BD=Xt,oS=function(e,n,t){for(var r=0,a=arguments.length>2?t:BD(n),i=new e(a);a>r;)i[r]=n[r++];return i},Gy=Je,lS=Xe,Hy=yt,qD=_t,WD=OU,au=St,cS=iS,zy=Da,GD=Pa,ss=xn,HD=l_,zD=jn,Vy=Q_,bc=sS,VD=TD,fS=To,us=Pt,KD=Un,Af=Ct,YD=Ai,JD=sa,QD=Ln,xu=Ni,XD=La.f,Ky=FD,ZD=Sr.forEach,eF=Lo,tF=vn,dS=ar,vS=Nn,Yy=oS,hv=xr,rF=Wo,Pf=hv.get,nF=hv.set,aF=hv.enforce,pS=dS.f,iF=vS.f,wc=lS.RangeError,hS=cS.ArrayBuffer,sF=hS.prototype,uF=cS.DataView,ju=au.NATIVE_ARRAY_BUFFER_VIEWS,Jy=au.TYPED_ARRAY_TAG,Qy=au.TypedArray,os=au.TypedArrayPrototype,Mf=au.isTypedArray,Uu="BYTES_PER_ELEMENT",_c="Wrong length",Du=function(e,n){tF(e,n,{configurable:!0,get:function(){return Pf(this)[n]}})},Xy=function(e){var n;return QD(sF,e)||(n=KD(e))==="ArrayBuffer"||n==="SharedArrayBuffer"},yS=function(e,n){return Mf(e)&&!YD(n)&&n in e&&HD(+n)&&n>=0},Zy=function(n,t){return t=fS(t),yS(n,t)?GD(2,n[t]):iF(n,t)},eg=function(n,t,r){return t=fS(t),yS(n,t)&&Af(r)&&us(r,"value")&&!us(r,"get")&&!us(r,"set")&&!r.configurable&&(!us(r,"writable")||r.writable)&&(!us(r,"enumerable")||r.enumerable)?(n[t]=r.value,n):pS(n,t,r)};qD?(ju||(vS.f=Zy,dS.f=eg,Du(os,"buffer"),Du(os,"byteOffset"),Du(os,"byteLength"),Du(os,"length")),Gy({target:"Object",stat:!0,forced:!ju},{getOwnPropertyDescriptor:Zy,defineProperty:eg}),Ef.exports=function(e,n,t){var r=e.match(/\d+/)[0]/8,a=e+(t?"Clamped":"")+"Array",i="get"+e,s="set"+e,o=lS[a],u=o,v=u&&u.prototype,g={},m=function(M,x){var j=Pf(M);return j.view[i](x*r+j.byteOffset,!0)},_=function(M,x,j){var H=Pf(M);H.view[s](x*r+H.byteOffset,t?VD(j):j,!0)},w=function(M,x){pS(M,x,{get:function(){return m(this,x)},set:function(j){return _(this,x,j)},enumerable:!0})};ju?WD&&(u=n(function(M,x,j,H){return zy(M,v),rF(function(){return Af(x)?Xy(x)?H!==void 0?new o(x,bc(j,r),H):j!==void 0?new o(x,bc(j,r)):new o(x):Mf(x)?Yy(u,x):Hy(Ky,u,x):new o(Vy(x))}(),M,u)}),xu&&xu(u,Qy),ZD(XD(o),function(M){M in u||ss(u,M,o[M])}),u.prototype=v):(u=n(function(M,x,j,H){zy(M,v);var me=0,ne=0,Ie,Ee,xe;if(!Af(x))xe=Vy(x),Ee=xe*r,Ie=new hS(Ee);else if(Xy(x)){Ie=x,ne=bc(j,r);var B=x.byteLength;if(H===void 0){if(B%r)throw new wc(_c);if(Ee=B-ne,Ee<0)throw new wc(_c)}else if(Ee=zD(H)*r,Ee+ne>B)throw new wc(_c);xe=Ee/r}else return Mf(x)?Yy(u,x):Hy(Ky,u,x);for(nF(M,{buffer:Ie,byteOffset:ne,byteLength:Ee,length:xe,view:new uF(Ie)});me<xe;)w(M,me++)}),xu&&xu(u,Qy),v=u.prototype=JD(os)),v.constructor!==u&&ss(v,"constructor",u),aF(v).TypedArrayConstructor=u,Jy&&ss(v,Jy,a);var R=u!==o;g[a]=u,Gy({global:!0,constructor:!0,forced:R,sham:!ju},g),Uu in u||ss(u,Uu,r),Uu in v||ss(v,Uu,r),eF(a)}):Ef.exports=function(){};var oF=Ef.exports,lF=oF;lF("Uint8",function(e){return function(t,r,a){return e(this,t,r,a)}});var tg=Ma,cF=TypeError,yv=function(e,n){if(!delete e[n])throw new cF("Cannot delete property "+tg(n)+" of "+tg(e))},fF=Qt,Sc=Mi,dF=Xt,vF=yv,pF=Math.min,hF=[].copyWithin||function(n,t){var r=fF(this),a=dF(r),i=Sc(n,a),s=Sc(t,a),o=arguments.length>2?arguments[2]:void 0,u=pF((o===void 0?a:Sc(o,a))-s,a-i),v=1;for(s<i&&i<s+u&&(v=-1,s+=u-1,i+=u-1);u-- >0;)s in r?r[i]=r[s]:vF(r,i),i+=v,s+=v;return r},yF=Ke,gS=St,gF=hF,mF=yF(gF),bF=gS.aTypedArray,wF=gS.exportTypedArrayMethod;wF("copyWithin",function(n,t){return mF(bF(this),n,t,arguments.length>2?arguments[2]:void 0)});var mS=St,_F=Sr.every,SF=mS.aTypedArray,$F=mS.exportTypedArrayMethod;$F("every",function(n){return _F(SF(this),n,arguments.length>1?arguments[1]:void 0)});var bS=St,TF=Z_,kF=uS,IF=Un,EF=yt,RF=Ke,CF=We,OF=bS.aTypedArray,AF=bS.exportTypedArrayMethod,PF=RF("".slice),MF=CF(function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),e!==1});AF("fill",function(n){var t=arguments.length;OF(this);var r=PF(IF(this),0,3)==="Big"?kF(n):+n;return EF(TF,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)},MF);var wS=St,NF=Td,LF=wS.aTypedArrayConstructor,xF=wS.getTypedArrayConstructor,sl=function(e){return LF(NF(e,xF(e)))},jF=oS,UF=sl,DF=function(e,n){return jF(UF(e),n)},_S=St,FF=Sr.filter,BF=DF,qF=_S.aTypedArray,WF=_S.exportTypedArrayMethod;WF("filter",function(n){var t=FF(qF(this),n,arguments.length>1?arguments[1]:void 0);return BF(this,t)});var SS=St,GF=Sr.find,HF=SS.aTypedArray,zF=SS.exportTypedArrayMethod;zF("find",function(n){return GF(HF(this),n,arguments.length>1?arguments[1]:void 0)});var $S=St,VF=Sr.findIndex,KF=$S.aTypedArray,YF=$S.exportTypedArrayMethod;YF("findIndex",function(n){return VF(KF(this),n,arguments.length>1?arguments[1]:void 0)});var TS=St,JF=Sr.forEach,QF=TS.aTypedArray,XF=TS.exportTypedArrayMethod;XF("forEach",function(n){JF(QF(this),n,arguments.length>1?arguments[1]:void 0)});var kS=St,ZF=Eo.includes,eB=kS.aTypedArray,tB=kS.exportTypedArrayMethod;tB("includes",function(n){return ZF(eB(this),n,arguments.length>1?arguments[1]:void 0)});var IS=St,rB=Eo.indexOf,nB=IS.aTypedArray,aB=IS.exportTypedArrayMethod;aB("indexOf",function(n){return rB(nB(this),n,arguments.length>1?arguments[1]:void 0)});var iB=Xe,sB=We,gv=Ke,ES=St,mv=xw,uB=mt,bv=uB("iterator"),rg=iB.Uint8Array,oB=gv(mv.values),lB=gv(mv.keys),cB=gv(mv.entries),wv=ES.aTypedArray,ul=ES.exportTypedArrayMethod,si=rg&&rg.prototype,ol=!sB(function(){si[bv].call([1])}),RS=!!si&&si.values&&si[bv]===si.values&&si.values.name==="values",CS=function(){return oB(wv(this))};ul("entries",function(){return cB(wv(this))},ol);ul("keys",function(){return lB(wv(this))},ol);ul("values",CS,ol||!RS,{name:"values"});ul(bv,CS,ol||!RS,{name:"values"});var OS=St,fB=Ke,dB=OS.aTypedArray,vB=OS.exportTypedArrayMethod,pB=fB([].join);vB("join",function(n){return pB(dB(this),n)});var hB=xa,yB=_r,gB=cn,mB=Xt,bB=Bo,wB=Math.min,Nf=[].lastIndexOf,AS=!!Nf&&1/[1].lastIndexOf(1,-0)<0,_B=bB("lastIndexOf"),SB=AS||!_B,$B=SB?function(n){if(AS)return hB(Nf,this,arguments)||0;var t=yB(this),r=mB(t);if(r===0)return-1;var a=r-1;for(arguments.length>1&&(a=wB(a,gB(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===n)return a||0;return-1}:Nf,PS=St,TB=xa,kB=$B,IB=PS.aTypedArray,EB=PS.exportTypedArrayMethod;EB("lastIndexOf",function(n){var t=arguments.length;return TB(kB,IB(this),t>1?[n,arguments[1]]:[n])});var MS=St,RB=Sr.map,CB=sl,OB=MS.aTypedArray,AB=MS.exportTypedArrayMethod;AB("map",function(n){return RB(OB(this),n,arguments.length>1?arguments[1]:void 0,function(t,r){return new(CB(t))(r)})});var PB=Lr,MB=Qt,NB=xs,LB=Xt,ng=TypeError,ag="Reduce of empty array with no initial value",ig=function(e){return function(n,t,r,a){var i=MB(n),s=NB(i),o=LB(i);if(PB(t),o===0&&r<2)throw new ng(ag);var u=e?o-1:0,v=e?-1:1;if(r<2)for(;;){if(u in s){a=s[u],u+=v;break}if(u+=v,e?u<0:o<=u)throw new ng(ag)}for(;e?u>=0:o>u;u+=v)u in s&&(a=t(a,s[u],u,i));return a}},NS={left:ig(!1),right:ig(!0)},LS=St,xB=NS.left,jB=LS.aTypedArray,UB=LS.exportTypedArrayMethod;UB("reduce",function(n){var t=arguments.length;return xB(jB(this),n,t,t>1?arguments[1]:void 0)});var xS=St,DB=NS.right,FB=xS.aTypedArray,BB=xS.exportTypedArrayMethod;BB("reduceRight",function(n){var t=arguments.length;return DB(FB(this),n,t,t>1?arguments[1]:void 0)});var jS=St,qB=jS.aTypedArray,WB=jS.exportTypedArrayMethod,GB=Math.floor;WB("reverse",function(){for(var n=this,t=qB(n).length,r=GB(t/2),a=0,i;a<r;)i=n[a],n[a++]=n[--t],n[t]=i;return n});var US=Xe,DS=yt,_v=St,HB=Xt,zB=sS,VB=Qt,FS=We,KB=US.RangeError,Lf=US.Int8Array,sg=Lf&&Lf.prototype,BS=sg&&sg.set,YB=_v.aTypedArray,JB=_v.exportTypedArrayMethod,xf=!FS(function(){var e=new Uint8ClampedArray(2);return DS(BS,e,{length:1,0:3},1),e[1]!==3}),QB=xf&&_v.NATIVE_ARRAY_BUFFER_VIEWS&&FS(function(){var e=new Lf(2);return e.set(1),e.set("2",1),e[0]!==0||e[1]!==2});JB("set",function(n){YB(this);var t=zB(arguments.length>1?arguments[1]:void 0,1),r=VB(n);if(xf)return DS(BS,this,r,t);var a=this.length,i=HB(r),s=0;if(i+t>a)throw new KB("Wrong length");for(;s<i;)this[t+s]=r[s++]},!xf||QB);var qS=St,XB=sl,ZB=We,e3=dn,t3=qS.aTypedArray,r3=qS.exportTypedArrayMethod,n3=ZB(function(){new Int8Array(1).slice()});r3("slice",function(n,t){for(var r=e3(t3(this),n,t),a=XB(this),i=0,s=r.length,o=new a(s);s>i;)o[i]=r[i++];return o},n3);var WS=St,a3=Sr.some,i3=WS.aTypedArray,s3=WS.exportTypedArrayMethod;s3("some",function(n){return a3(i3(this),n,arguments.length>1?arguments[1]:void 0)});var ug=dn,u3=Math.floor,jf=function(e,n){var t=e.length;if(t<8)for(var r=1,a,i;r<t;){for(i=r,a=e[r];i&&n(e[i-1],a)>0;)e[i]=e[--i];i!==r++&&(e[i]=a)}else for(var s=u3(t/2),o=jf(ug(e,0,s),n),u=jf(ug(e,s),n),v=o.length,g=u.length,m=0,_=0;m<v||_<g;)e[m+_]=m<v&&_<g?n(o[m],u[_])<=0?o[m++]:u[_++]:m<v?o[m++]:u[_++];return e},Sv=jf,o3=ia,og=o3.match(/firefox\/(\d+)/i),GS=!!og&&+og[1],l3=ia,HS=/MSIE|Trident/.test(l3),c3=ia,lg=c3.match(/AppleWebKit\/(\d+)\./),zS=!!lg&&+lg[1],f3=Xe,d3=yd,Uf=We,v3=Lr,p3=Sv,VS=St,cg=GS,h3=HS,fg=Ci,dg=zS,y3=VS.aTypedArray,g3=VS.exportTypedArrayMethod,As=f3.Uint16Array,bi=As&&d3(As.prototype.sort),m3=!!bi&&!(Uf(function(){bi(new As(2),null)})&&Uf(function(){bi(new As(2),{})})),vg=!!bi&&!Uf(function(){if(fg)return fg<74;if(cg)return cg<67;if(h3)return!0;if(dg)return dg<602;var e=new As(516),n=Array(516),t,r;for(t=0;t<516;t++)r=t%4,e[t]=515-t,n[t]=t-2*r+3;for(bi(e,function(a,i){return(a/4|0)-(i/4|0)}),t=0;t<516;t++)if(e[t]!==n[t])return!0}),b3=function(e){return function(n,t){return e!==void 0?+e(n,t)||0:t!==t?-1:n!==n?1:n===0&&t===0?1/n>0&&1/t<0?1:-1:n>t}};g3("sort",function(n){return n!==void 0&&v3(n),vg?bi(this,n):p3(y3(this),b3(n))},!vg||m3);var KS=St,w3=jn,pg=Mi,_3=sl,S3=KS.aTypedArray,$3=KS.exportTypedArrayMethod;$3("subarray",function(n,t){var r=S3(this),a=r.length,i=pg(n,a),s=_3(r);return new s(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,w3((t===void 0?a:pg(t,a))-i))});var T3=Xe,k3=xa,YS=St,Df=We,hg=dn,ho=T3.Int8Array,yg=YS.aTypedArray,I3=YS.exportTypedArrayMethod,JS=[].toLocaleString,E3=!!ho&&Df(function(){JS.call(new ho(1))}),R3=Df(function(){return[1,2].toLocaleString()!==new ho([1,2]).toLocaleString()})||!Df(function(){ho.prototype.toLocaleString.call([1,2])});I3("toLocaleString",function(){return k3(JS,E3?hg(yg(this)):yg(this),hg(arguments))},R3);var C3=St.exportTypedArrayMethod,O3=We,A3=Xe,P3=Ke,gg=A3.Uint8Array,M3=gg&&gg.prototype||{},yo=[].toString,N3=P3([].join);O3(function(){yo.call({})})&&(yo=function(){return N3(this)});var L3=M3.toString!==yo;C3("toString",yo,L3);var $c=yt,QS=Ke,x3=Vo,j3=Lt,U3=ln,D3=Qr,F3=Td,B3=zd,q3=jn,mg=Bt,W3=Na,bg=Ko,G3=Hw,H3=We,Za=G3.UNSUPPORTED_Y,z3=4294967295,V3=Math.min,Tc=QS([].push),kc=QS("".slice),K3=!H3(function(){var e=/(?:)/,n=e.exec;e.exec=function(){return n.apply(this,arguments)};var t="ab".split(e);return t.length!==2||t[0]!=="a"||t[1]!=="b"}),wg="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;x3("split",function(e,n,t){var r="0".split(void 0,0).length?function(a,i){return a===void 0&&i===0?[]:$c(n,this,a,i)}:n;return[function(i,s){var o=D3(this),u=U3(i)?void 0:W3(i,e);return u?$c(u,i,o,s):$c(r,mg(o),i,s)},function(a,i){var s=j3(this),o=mg(a);if(!wg){var u=t(r,s,o,i,r!==n);if(u.done)return u.value}var v=F3(s,RegExp),g=s.unicode,m=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Za?"g":"y"),_=new v(Za?"^(?:"+s.source+")":s,m),w=i===void 0?z3:i>>>0;if(w===0)return[];if(o.length===0)return bg(_,o)===null?[o]:[];for(var R=0,M=0,x=[];M<o.length;){_.lastIndex=Za?0:M;var j=bg(_,Za?kc(o,M):o),H;if(j===null||(H=V3(q3(_.lastIndex+(Za?M:0)),o.length))===R)M=B3(o,M,g);else{if(Tc(x,kc(o,R,M)),x.length===w)return x;for(var me=1;me<=j.length-1;me++)if(Tc(x,j[me]),x.length===w)return x;M=R=H}}return Tc(x,kc(o,R)),x}]},wg||!K3,Za);var XS={exports:{}},ZS={exports:{}};(function(e){function n(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch(r){return typeof t=="function"}}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(ZS);var Y3=ZS.exports,e0={exports:{}},t0={exports:{}};(function(e){function n(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(e.exports=n=function(){return!!t},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(t0);var J3=t0.exports;(function(e){var n=J3,t=Sd;function r(a,i,s){if(n())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,i);var u=new(a.bind.apply(a,o));return s&&t(u,s.prototype),u}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(e0);var Q3=e0.exports;(function(e){var n=Ur,t=Sd,r=Y3,a=Q3;function i(s){var o=typeof Map=="function"?new Map:void 0;return e.exports=i=function(v){if(v===null||!r(v))return v;if(typeof v!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(v))return o.get(v);o.set(v,g)}function g(){return a(v,arguments,n(this).constructor)}return g.prototype=Object.create(v.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),t(g,v)},e.exports.__esModule=!0,e.exports.default=e.exports,i(s)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports})(XS);var $v=XS.exports,go={exports:{}};/*!
 * Platform.js v1.3.6
 * Copyright 2014-2020 Benjamin Tan
 * Copyright 2011-2013 John-David Dalton
 * Available under MIT license
 */go.exports;(function(e,n){(function(){var t={function:!0,object:!0},r=t[typeof window]&&window||this,a=n,i=e&&!e.nodeType&&e,s=a&&i&&typeof dr=="object"&&dr;s&&(s.global===s||s.window===s||s.self===s)&&(r=s);var o=Math.pow(2,53)-1,u=/\bOpera/,v=Object.prototype,g=v.hasOwnProperty,m=v.toString;function _(B){return B=String(B),B.charAt(0).toUpperCase()+B.slice(1)}function w(B,J,pe){var F={"10.0":"10","6.4":"10 Technical Preview","6.3":"8.1","6.2":"8","6.1":"Server 2008 R2 / 7","6.0":"Server 2008 / Vista","5.2":"Server 2003 / XP 64-bit","5.1":"XP","5.01":"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return J&&pe&&/^Win/i.test(B)&&!/^Windows Phone /i.test(B)&&(F=F[/[\d.]+$/.exec(B)])&&(B="Windows "+F),B=String(B),J&&pe&&(B=B.replace(RegExp(J,"i"),pe)),B=M(B.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]),B}function R(B,J){var pe=-1,F=B?B.length:0;if(typeof F=="number"&&F>-1&&F<=o)for(;++pe<F;)J(B[pe],pe,B);else x(B,J)}function M(B){return B=Ie(B),/^(?:webOS|i(?:OS|P))/.test(B)?B:_(B)}function x(B,J){for(var pe in B)g.call(B,pe)&&J(B[pe],pe,B)}function j(B){return B==null?_(B):m.call(B).slice(8,-1)}function H(B,J){var pe=B!=null?typeof B[J]:"number";return!/^(?:boolean|number|string|undefined)$/.test(pe)&&(pe=="object"?!!B[J]:!0)}function me(B){return String(B).replace(/([ -])(?!$)/g,"$1?")}function ne(B,J){var pe=null;return R(B,function(F,de){pe=J(pe,F,de,B)}),pe}function Ie(B){return String(B).replace(/^ +| +$/g,"")}function Ee(B){var J=r,pe=B&&typeof B=="object"&&j(B)!="String";pe&&(J=B,B=null);var F=J.navigator||{},de=F.userAgent||"";B||(B=de);var Pe=pe?!!F.likeChrome:/\bChrome\b/.test(B)&&!/internal|\n/i.test(m.toString()),Me="Object",_e=pe?Me:"ScriptBridgingProxyObject",he=pe?Me:"Environment",Ye=pe&&J.java?"JavaPackage":j(J.java),ze=pe?Me:"RuntimeObject",k=/\bJava/.test(Ye)&&J.java,te=k&&j(J.environment)==he,le=k?"a":"Î±",ce=k?"b":"Î²",Ne=J.document||{},be=J.operamini||J.opera,X=u.test(X=pe&&be?be["[[Class]]"]:j(be))?X:be=null,I,tt=B,Se=[],ut=null,bt=B==de,Re=bt&&be&&typeof be.version=="function"&&be.version(),Ht,Ge=Ot([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),se=$t(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),Be=ye([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),nt=Ve({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),ve=xt(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function Ot(ft){return ne(ft,function(et,He){return et||RegExp("\\b"+(He.pattern||me(He))+"\\b","i").exec(B)&&(He.label||He)})}function Ve(ft){return ne(ft,function(et,He,Et){return et||(He[Be]||He[/^[a-z]+(?: +[a-z]+\b)*/i.exec(Be)]||RegExp("\\b"+me(Et)+"(?:\\b|\\w*\\d)","i").exec(B))&&Et})}function $t(ft){return ne(ft,function(et,He){return et||RegExp("\\b"+(He.pattern||me(He))+"\\b","i").exec(B)&&(He.label||He)})}function xt(ft){return ne(ft,function(et,He){var Et=He.pattern||me(He);return!et&&(et=RegExp("\\b"+Et+"(?:/[\\d.]+|[ \\w.]*)","i").exec(B))&&(et=w(et,Et,He.label||He)),et})}function ye(ft){return ne(ft,function(et,He){var Et=He.pattern||me(He);return!et&&(et=RegExp("\\b"+Et+" *\\d+[.\\w_]*","i").exec(B)||RegExp("\\b"+Et+" *\\w+-[\\w]*","i").exec(B)||RegExp("\\b"+Et+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(B))&&((et=String(He.label&&!RegExp(Et,"i").test(He.label)?He.label:et).split("/"))[1]&&!/[\d.]+/.test(et[0])&&(et[0]+=" "+et[1]),He=He.label||He,et=M(et[0].replace(RegExp(Et,"i"),He).replace(RegExp("; *(?:"+He+"[_-])?","i")," ").replace(RegExp("("+He+")[-_.]?(\\w)","i"),"$1 $2"))),et})}function Ut(ft){return ne(ft,function(et,He){return et||(RegExp(He+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(B)||0)[1]||null})}function Zt(){return this.description||""}if(Ge&&(Ge=[Ge]),/\bAndroid\b/.test(ve)&&!Be&&(I=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(B))&&(Be=Ie(I[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),nt&&!Be?Be=ye([nt]):nt&&Be&&(Be=Be.replace(RegExp("^("+me(nt)+")[-_.\\s]","i"),nt+" ").replace(RegExp("^("+me(nt)+")[-_.]?(\\w)","i"),nt+" $2")),(I=/\bGoogle TV\b/.exec(Be))&&(Be=I[0]),/\bSimulator\b/i.test(B)&&(Be=(Be?Be+" ":"")+"Simulator"),se=="Opera Mini"&&/\bOPiOS\b/.test(B)&&Se.push("running in Turbo/Uncompressed mode"),se=="IE"&&/\blike iPhone OS\b/.test(B)?(I=Ee(B.replace(/like iPhone OS/,"")),nt=I.manufacturer,Be=I.product):/^iP/.test(Be)?(se||(se="Safari"),ve="iOS"+((I=/ OS ([\d_]+)/i.exec(B))?" "+I[1].replace(/_/g,"."):"")):se=="Konqueror"&&/^Linux\b/i.test(ve)?ve="Kubuntu":nt&&nt!="Google"&&(/Chrome/.test(se)&&!/\bMobile Safari\b/i.test(B)||/\bVita\b/.test(Be))||/\bAndroid\b/.test(ve)&&/^Chrome/.test(se)&&/\bVersion\//i.test(B)?(se="Android Browser",ve=/\bAndroid\b/.test(ve)?ve:"Android"):se=="Silk"?(/\bMobi/i.test(B)||(ve="Android",Se.unshift("desktop mode")),/Accelerated *= *true/i.test(B)&&Se.unshift("accelerated")):se=="UC Browser"&&/\bUCWEB\b/.test(B)?Se.push("speed mode"):se=="PaleMoon"&&(I=/\bFirefox\/([\d.]+)\b/.exec(B))?Se.push("identifying as Firefox "+I[1]):se=="Firefox"&&(I=/\b(Mobile|Tablet|TV)\b/i.exec(B))?(ve||(ve="Firefox OS"),Be||(Be=I[1])):!se||(I=!/\bMinefield\b/i.test(B)&&/\b(?:Firefox|Safari)\b/.exec(se))?(se&&!Be&&/[\/,]|^[^(]+?\)/.test(B.slice(B.indexOf(I+"/")+8))&&(se=null),(I=Be||nt||ve)&&(Be||nt||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(ve))&&(se=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(ve)?ve:I)+" Browser")):se=="Electron"&&(I=(/\bChrome\/([\d.]+)\b/.exec(B)||0)[1])&&Se.push("Chromium "+I),Re||(Re=Ut(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",me(se),"(?:Firefox|Minefield|NetFront)"])),(I=Ge=="iCab"&&parseFloat(Re)>3&&"WebKit"||/\bOpera\b/.test(se)&&(/\bOPR\b/.test(B)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(B)&&!/^(?:Trident|EdgeHTML)$/.test(Ge)&&"WebKit"||!Ge&&/\bMSIE\b/i.test(B)&&(ve=="Mac OS"?"Tasman":"Trident")||Ge=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(se)&&"NetFront")&&(Ge=[I]),se=="IE"&&(I=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(B)||0)[1])?(se+=" Mobile",ve="Windows Phone "+(/\+$/.test(I)?I:I+".x"),Se.unshift("desktop mode")):/\bWPDesktop\b/i.test(B)?(se="IE Mobile",ve="Windows Phone 8.x",Se.unshift("desktop mode"),Re||(Re=(/\brv:([\d.]+)/.exec(B)||0)[1])):se!="IE"&&Ge=="Trident"&&(I=/\brv:([\d.]+)/.exec(B))&&(se&&Se.push("identifying as "+se+(Re?" "+Re:"")),se="IE",Re=I[1]),bt){if(H(J,"global"))if(k&&(I=k.lang.System,tt=I.getProperty("os.arch"),ve=ve||I.getProperty("os.name")+" "+I.getProperty("os.version")),te){try{Re=J.require("ringo/engine").version.join("."),se="RingoJS"}catch(ft){(I=J.system)&&I.global.system==J.system&&(se="Narwhal",ve||(ve=I[0].os||null))}se||(se="Rhino")}else typeof J.process=="object"&&!J.process.browser&&(I=J.process)&&(typeof I.versions=="object"&&(typeof I.versions.electron=="string"?(Se.push("Node "+I.versions.node),se="Electron",Re=I.versions.electron):typeof I.versions.nw=="string"&&(Se.push("Chromium "+Re,"Node "+I.versions.node),se="NW.js",Re=I.versions.nw)),se||(se="Node.js",tt=I.arch,ve=I.platform,Re=/[\d.]+/.exec(I.version),Re=Re?Re[0]:null));else j(I=J.runtime)==_e?(se="Adobe AIR",ve=I.flash.system.Capabilities.os):j(I=J.phantom)==ze?(se="PhantomJS",Re=(I=I.version||null)&&I.major+"."+I.minor+"."+I.patch):typeof Ne.documentMode=="number"&&(I=/\bTrident\/(\d+)/i.exec(B))?(Re=[Re,Ne.documentMode],(I=+I[1]+4)!=Re[1]&&(Se.push("IE "+Re[1]+" mode"),Ge&&(Ge[1]=""),Re[1]=I),Re=se=="IE"?String(Re[1].toFixed(1)):Re[0]):typeof Ne.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(se)&&(Se.push("masking as "+se+" "+Re),se="IE",Re="11.0",Ge=["Trident"],ve="Windows");ve=ve&&M(ve)}if(Re&&(I=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(Re)||/(?:alpha|beta)(?: ?\d)?/i.exec(B+";"+(bt&&F.appMinorVersion))||/\bMinefield\b/i.test(B)&&"a")&&(ut=/b/i.test(I)?"beta":"alpha",Re=Re.replace(RegExp(I+"\\+?$"),"")+(ut=="beta"?ce:le)+(/\d+\+?/.exec(I)||"")),se=="Fennec"||se=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(ve))se="Firefox Mobile";else if(se=="Maxthon"&&Re)Re=Re.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(Be))Be=="Xbox 360"&&(ve=null),Be=="Xbox 360"&&/\bIEMobile\b/.test(B)&&Se.unshift("mobile mode");else if((/^(?:Chrome|IE|Opera)$/.test(se)||se&&!Be&&!/Browser|Mobi/.test(se))&&(ve=="Windows CE"||/Mobi/i.test(B)))se+=" Mobile";else if(se=="IE"&&bt)try{J.external===null&&Se.unshift("platform preview")}catch(ft){Se.unshift("embedded")}else(/\bBlackBerry\b/.test(Be)||/\bBB10\b/.test(B))&&(I=(RegExp(Be.replace(/ +/g," *")+"/([.\\d]+)","i").exec(B)||0)[1]||Re)?(I=[I,/BB10/.test(B)],ve=(I[1]?(Be=null,nt="BlackBerry"):"Device Software")+" "+I[0],Re=null):this!=x&&Be!="Wii"&&(bt&&be||/Opera/.test(se)&&/\b(?:MSIE|Firefox)\b/i.test(B)||se=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(ve)||se=="IE"&&(ve&&!/^Win/.test(ve)&&Re>5.5||/\bWindows XP\b/.test(ve)&&Re>8||Re==8&&!/\bTrident\b/.test(B)))&&!u.test(I=Ee.call(x,B.replace(u,"")+";"))&&I.name&&(I="ing as "+I.name+((I=I.version)?" "+I:""),u.test(se)?(/\bIE\b/.test(I)&&ve=="Mac OS"&&(ve=null),I="identify"+I):(I="mask"+I,X?se=M(X.replace(/([a-z])([A-Z])/g,"$1 $2")):se="Opera",/\bIE\b/.test(I)&&(ve=null),bt||(Re=null)),Ge=["Presto"],Se.push(I));(I=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(B)||0)[1])&&(I=[parseFloat(I.replace(/\.(\d)$/,".0$1")),I],se=="Safari"&&I[1].slice(-1)=="+"?(se="WebKit Nightly",ut="alpha",Re=I[1].slice(0,-1)):(Re==I[1]||Re==(I[2]=(/\bSafari\/([\d.]+\+?)/i.exec(B)||0)[1]))&&(Re=null),I[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(B)||0)[1],I[0]==537.36&&I[2]==537.36&&parseFloat(I[1])>=28&&Ge=="WebKit"&&(Ge=["Blink"]),!bt||!Pe&&!I[1]?(Ge&&(Ge[1]="like Safari"),I=(I=I[0],I<400?1:I<500?2:I<526?3:I<533?4:I<534?"4+":I<535?5:I<537?6:I<538?7:I<601?8:I<602?9:I<604?10:I<606?11:I<608?12:"12")):(Ge&&(Ge[1]="like Chrome"),I=I[1]||(I=I[0],I<530?1:I<532?2:I<532.05?3:I<533?4:I<534.03?5:I<534.07?6:I<534.1?7:I<534.13?8:I<534.16?9:I<534.24?10:I<534.3?11:I<535.01?12:I<535.02?"13+":I<535.07?15:I<535.11?16:I<535.19?17:I<536.05?18:I<536.1?19:I<537.01?20:I<537.11?"21+":I<537.13?23:I<537.18?24:I<537.24?25:I<537.36?26:Ge!="Blink"?"27":"28")),Ge&&(Ge[1]+=" "+(I+=typeof I=="number"?".x":/[.+]/.test(I)?"":"+")),se=="Safari"&&(!Re||parseInt(Re)>45)?Re=I:se=="Chrome"&&/\bHeadlessChrome/i.test(B)&&Se.unshift("headless")),se=="Opera"&&(I=/\bzbov|zvav$/.exec(ve))?(se+=" ",Se.unshift("desktop mode"),I=="zvav"?(se+="Mini",Re=null):se+="Mobile",ve=ve.replace(RegExp(" *"+I+"$"),"")):se=="Safari"&&/\bChrome\b/.exec(Ge&&Ge[1])?(Se.unshift("desktop mode"),se="Chrome Mobile",Re=null,/\bOS X\b/.test(ve)?(nt="Apple",ve="iOS 4.3+"):ve=null):/\bSRWare Iron\b/.test(se)&&!Re&&(Re=Ut("Chrome")),Re&&Re.indexOf(I=/[\d.]+$/.exec(ve))==0&&B.indexOf("/"+I+"-")>-1&&(ve=Ie(ve.replace(I,""))),ve&&ve.indexOf(se)!=-1&&!RegExp(se+" OS").test(ve)&&(ve=ve.replace(RegExp(" *"+me(se)+" *"),"")),Ge&&!/\b(?:Avant|Nook)\b/.test(se)&&(/Browser|Lunascape|Maxthon/.test(se)||se!="Safari"&&/^iOS/.test(ve)&&/\bSafari\b/.test(Ge[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(se)&&Ge[1])&&(I=Ge[Ge.length-1])&&Se.push(I),Se.length&&(Se=["("+Se.join("; ")+")"]),nt&&Be&&Be.indexOf(nt)<0&&Se.push("on "+nt),Be&&Se.push((/^on /.test(Se[Se.length-1])?"":"on ")+Be),ve&&(I=/ ([\d.+]+)$/.exec(ve),Ht=I&&ve.charAt(ve.length-I[0].length-1)=="/",ve={architecture:32,family:I&&!Ht?ve.replace(I[0],""):ve,version:I?I[1]:null,toString:function(){var ft=this.version;return this.family+(ft&&!Ht?" "+ft:"")+(this.architecture==64?" 64-bit":"")}}),(I=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(tt))&&!/\bi686\b/i.test(tt)?(ve&&(ve.architecture=64,ve.family=ve.family.replace(RegExp(" *"+I),"")),se&&(/\bWOW64\b/i.test(B)||bt&&/\w(?:86|32)$/.test(F.cpuClass||F.platform)&&!/\bWin64; x64\b/i.test(B))&&Se.unshift("32-bit")):ve&&/^OS X/.test(ve.family)&&se=="Chrome"&&parseFloat(Re)>=39&&(ve.architecture=64),B||(B=null);var Ze={};return Ze.description=B,Ze.layout=Ge&&Ge[0],Ze.manufacturer=nt,Ze.name=se,Ze.prerelease=ut,Ze.product=Be,Ze.ua=B,Ze.version=se&&Re,Ze.os=ve||{architecture:null,family:null,version:null,toString:function(){return"null"}},Ze.parse=Ee,Ze.toString=Zt,Ze.version&&Se.unshift(Re),Ze.name&&Se.unshift(se),ve&&se&&!(ve==String(ve).split(" ")[0]&&(ve==se.split(" ")[0]||Be))&&Se.push(Be?"("+ve+")":"on "+ve),Se.length&&(Ze.description=Se.join(" ")),Ze}var xe=Ee();a&&i?x(xe,function(B,J){a[J]=B}):r.platform=xe}).call(dr)})(go,go.exports);var r0=go.exports,X3=yt,Z3=Vo,e4=Lt,t4=ln,r4=jn,Ic=Bt,n4=Qr,a4=Na,i4=zd,_g=Ko;Z3("match",function(e,n,t){return[function(a){var i=n4(this),s=t4(a)?void 0:a4(a,e);return s?X3(s,a,i):new RegExp(a)[e](Ic(i))},function(r){var a=e4(this),i=Ic(r),s=t(n,a,i);if(s.done)return s.value;if(!a.global)return _g(a,i);var o=a.unicode;a.lastIndex=0;for(var u=[],v=0,g;(g=_g(a,i))!==null;){var m=Ic(g[0]);u[v]=m,m===""&&(a.lastIndex=i4(i,r4(a.lastIndex),o)),v++}return v===0?null:u}]});var s4=Object.is||function(n,t){return n===t?n!==0||1/n===1/t:n!==n&&t!==t},u4=yt,o4=Vo,l4=Lt,c4=ln,f4=Qr,Sg=s4,$g=Bt,d4=Na,v4=Ko;o4("search",function(e,n,t){return[function(a){var i=f4(this),s=c4(a)?void 0:d4(a,e);return s?u4(s,a,i):new RegExp(a)[e]($g(i))},function(r){var a=l4(this),i=$g(r),s=t(n,a,i);if(s.done)return s.value;var o=a.lastIndex;Sg(o,0)||(a.lastIndex=0);var u=v4(a,i);return Sg(a.lastIndex,o)||(a.lastIndex=o),u===null?-1:u.index}]});var p4=_t,h4=Ws,y4=TypeError,g4=Object.getOwnPropertyDescriptor,m4=p4&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),b4=m4?function(e,n){if(h4(e)&&!g4(e,"length").writable)throw new y4("Cannot set read only .length");return e.length=n}:function(e,n){return e.length=n},w4=Je,_4=Qt,S4=Mi,$4=cn,T4=Xt,k4=b4,I4=_w,E4=gd,R4=Ks,Ec=yv,C4=Vs,O4=C4("splice"),A4=Math.max,P4=Math.min;w4({target:"Array",proto:!0,forced:!O4},{splice:function(n,t){var r=_4(this),a=T4(r),i=S4(n,a),s=arguments.length,o,u,v,g,m,_;for(s===0?o=u=0:s===1?(o=0,u=a-i):(o=s-2,u=P4(A4($4(t),0),a-i)),I4(a+o-u),v=E4(r,u),g=0;g<u;g++)m=i+g,m in r&&R4(v,g,r[m]);if(v.length=u,o<u){for(g=i;g<a-u;g++)m=g+u,_=g+o,m in r?r[_]=r[m]:Ec(r,_);for(g=a;g>a-u+o;g--)Ec(r,g-1)}else if(o>u)for(g=a-u;g>i;g--)m=g+u-1,_=g+o-1,m in r?r[_]=r[m]:Ec(r,_);for(g=0;g<o;g++)r[g+i]=arguments[g+2];return k4(r,a-u+o),v}});/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.


*/(function(e){var n=typeof n<"u"?n:typeof self<"u"?self:typeof window<"u"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var t=Ys,r=ua,a=ja,i=Jd,s=pn,o=hn,u=Ur,v=yn,g=Ua,m=Zs,_=jr,w=sr,R=tu,M=rU,x=tl,j=$v,H=qn,me=r0;function ne(d){return d&&typeof d=="object"&&"default"in d?d:{default:d}}function Ie(d){if(d&&d.__esModule)return d;var h=Object.create(null);return d&&Object.keys(d).forEach(function(c){if(c!=="default"){var f=Object.getOwnPropertyDescriptor(d,c);Object.defineProperty(h,c,f.get?f:{enumerable:!0,get:function(){return d[c]}})}}),h.default=d,Object.freeze(h)}var Ee=ne(t),xe=ne(r),B=ne(a),J=ne(i),pe=ne(s),F=ne(o),de=ne(u),Pe=ne(v),Me=ne(g),_e=ne(m),he=ne(_),Ye=Ie(R),ze=Ie(M),k=ne(j),te=Ie(me);function le(d,h,c,f){var l=arguments.length,y=l<3?h:f===null?f=Object.getOwnPropertyDescriptor(h,c):f,p;if((typeof Reflect>"u"?"undefined":he.default(Reflect))==="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(d,h,c,f);else for(var $=d.length-1;$>=0;$--)(p=d[$])&&(y=(l<3?p(y):l>3?p(h,c,y):p(h,c))||y);return l>3&&y&&Object.defineProperty(h,c,y),y}function ce(d,h){if((typeof Reflect>"u"?"undefined":he.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(d,h)}var Ne;function be(){}be.prototype=Object.create(null);function X(){X.init.call(this)}X.EventEmitter=X,X.usingDomains=!1,X.prototype.domain=void 0,X.prototype._events=void 0,X.prototype._maxListeners=void 0,X.defaultMaxListeners=10,X.init=function(){this.domain=null,X.usingDomains&&Ne.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new be,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},X.prototype.setMaxListeners=function(h){if(typeof h!="number"||h<0||isNaN(h))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=h,this};function I(d){return d._maxListeners===void 0?X.defaultMaxListeners:d._maxListeners}X.prototype.getMaxListeners=function(){return I(this)};function tt(d,h,c){if(h)d.call(c);else for(var f=d.length,l=ve(d,f),y=0;y<f;++y)l[y].call(c)}function Se(d,h,c,f){if(h)d.call(c,f);else for(var l=d.length,y=ve(d,l),p=0;p<l;++p)y[p].call(c,f)}function ut(d,h,c,f,l){if(h)d.call(c,f,l);else for(var y=d.length,p=ve(d,y),$=0;$<y;++$)p[$].call(c,f,l)}function bt(d,h,c,f,l,y){if(h)d.call(c,f,l,y);else for(var p=d.length,$=ve(d,p),T=0;T<p;++T)$[T].call(c,f,l,y)}function Re(d,h,c,f){if(h)d.apply(c,f);else for(var l=d.length,y=ve(d,l),p=0;p<l;++p)y[p].apply(c,f)}X.prototype.emit=function(h){var c,f,l,y,p,$,T,A=h==="error";if($=this._events,$)A=A&&$.error==null;else if(!A)return!1;if(T=this.domain,A){if(c=arguments[1],T)c||(c=new Error('Uncaught, unspecified "error" event')),c.domainEmitter=this,c.domain=T,c.domainThrown=!1,T.emit("error",c);else{if(c instanceof Error)throw c;var P=new Error('Uncaught, unspecified "error" event. ('+c+")");throw P.context=c,P}return!1}if(f=$[h],!f)return!1;var ue=typeof f=="function";switch(l=arguments.length,l){case 1:tt(f,ue,this);break;case 2:Se(f,ue,this,arguments[1]);break;case 3:ut(f,ue,this,arguments[1],arguments[2]);break;case 4:bt(f,ue,this,arguments[1],arguments[2],arguments[3]);break;default:for(y=new Array(l-1),p=1;p<l;p++)y[p-1]=arguments[p];Re(f,ue,this,y)}return!0};function Ht(d,h,c,f){var l,y,p;if(typeof c!="function")throw new TypeError('"listener" argument must be a function');if(y=d._events,y?(y.newListener&&(d.emit("newListener",h,c.listener?c.listener:c),y=d._events),p=y[h]):(y=d._events=new be,d._eventsCount=0),!p)p=y[h]=c,++d._eventsCount;else if(typeof p=="function"?p=y[h]=f?[c,p]:[p,c]:f?p.unshift(c):p.push(c),!p.warned&&(l=I(d),l&&l>0&&p.length>l)){p.warned=!0;var $=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+h+" listeners added. Use emitter.setMaxListeners() to increase limit");$.name="MaxListenersExceededWarning",$.emitter=d,$.type=h,$.count=p.length,Ge($)}return d}function Ge(d){typeof console.warn=="function"?console.warn(d):console.log(d)}X.prototype.addListener=function(h,c){return Ht(this,h,c,!1)},X.prototype.on=X.prototype.addListener,X.prototype.prependListener=function(h,c){return Ht(this,h,c,!0)};function se(d,h,c){var f=!1;function l(){d.removeListener(h,l),f||(f=!0,c.apply(d,arguments))}return l.listener=c,l}X.prototype.once=function(h,c){if(typeof c!="function")throw new TypeError('"listener" argument must be a function');return this.on(h,se(this,h,c)),this},X.prototype.prependOnceListener=function(h,c){if(typeof c!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(h,se(this,h,c)),this},X.prototype.removeListener=function(h,c){var f,l,y,p,$;if(typeof c!="function")throw new TypeError('"listener" argument must be a function');if(l=this._events,!l)return this;if(f=l[h],!f)return this;if(f===c||f.listener&&f.listener===c)--this._eventsCount===0?this._events=new be:(delete l[h],l.removeListener&&this.emit("removeListener",h,f.listener||c));else if(typeof f!="function"){for(y=-1,p=f.length;p-- >0;)if(f[p]===c||f[p].listener&&f[p].listener===c){$=f[p].listener,y=p;break}if(y<0)return this;if(f.length===1){if(f[0]=void 0,--this._eventsCount===0)return this._events=new be,this;delete l[h]}else nt(f,y);l.removeListener&&this.emit("removeListener",h,$||c)}return this},X.prototype.off=function(d,h){return this.removeListener(d,h)},X.prototype.removeAllListeners=function(h){var c,f;if(f=this._events,!f)return this;if(!f.removeListener)return arguments.length===0?(this._events=new be,this._eventsCount=0):f[h]&&(--this._eventsCount===0?this._events=new be:delete f[h]),this;if(arguments.length===0){for(var l=Object.keys(f),y=0,p;y<l.length;++y)p=l[y],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=new be,this._eventsCount=0,this}if(c=f[h],typeof c=="function")this.removeListener(h,c);else if(c)do this.removeListener(h,c[c.length-1]);while(c[0]);return this},X.prototype.listeners=function(h){var c,f,l=this._events;return l?(c=l[h],c?typeof c=="function"?f=[c.listener||c]:f=Ot(c):f=[]):f=[],f},X.listenerCount=function(d,h){return typeof d.listenerCount=="function"?d.listenerCount(h):Be.call(d,h)},X.prototype.listenerCount=Be;function Be(d){var h=this._events;if(h){var c=h[d];if(typeof c=="function")return 1;if(c)return c.length}return 0}X.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function nt(d,h){for(var c=h,f=c+1,l=d.length;f<l;c+=1,f+=1)d[c]=d[f];d.pop()}function ve(d,h){for(var c=new Array(h);h--;)c[h]=d[h];return c}function Ot(d){for(var h=new Array(d.length),c=0;c<h.length;++c)h[c]=d[c].listener||d[c];return h}var Ve=Ye.getLogger("twilsock");function $t(d,h){return["".concat(new Date().toISOString()," Twilsock ").concat(d,":")].concat(Array.from(h))}var xt=function(){function d(h){Pe.default(this,d),Me.default(this,"prefix",""),this.prefix=h!=null&&h.length>0?" "+h+":":""}return xe.default(d,[{key:"setLevel",value:function(c){Ve.setLevel(c)}},{key:"trace",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.trace.apply(null,$t("T",f))}},{key:"debug",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.debug.apply(null,$t("D",f))}},{key:"info",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.info.apply(null,$t("I",f))}},{key:"warn",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.warn.apply(null,$t("W",f))}},{key:"error",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.error.apply(null,$t("E",f))}}],[{key:"setLevel",value:function(c){Ve.setLevel(c)}},{key:"trace",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.trace.apply(null,$t("T",f))}},{key:"debug",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.debug.apply(null,$t("D",f))}},{key:"info",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.info.apply(null,$t("I",f))}},{key:"warn",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.warn.apply(null,$t("W",f))}},{key:"error",value:function(){for(var c=arguments.length,f=new Array(c),l=0;l<c;l++)f[l]=arguments[l];Ve.error.apply(null,$t("E",f))}}]),d}(),ye=new xt(""),Ut="0.12.2",Zt=function(){function d(h,c,f){Pe.default(this,d),Me.default(this,"confirmedCapabilities",new Set),this.activeGrant=c,this._token=h;var l=f.region||"us1",y="wss://tsock.".concat(l,".twilio.com/v3/wsconnect"),p=f.twilsock||f.Twilsock||{};this.url=p.uri||y,this._continuationToken=f.continuationToken?f.continuationToken:null,this.logLevel=f.logLevel?f.logLevel:"error",this.retryPolicy=f.retryPolicy?f.retryPolicy:{min:1*1e3,max:2*60*1e3,randomness:.2},this.clientMetadata=f.clientMetadata?f.clientMetadata:{},this.clientMetadata.ver=Ut,this.initRegistrations=f.initRegistrations?f.initRegistrations:null,this.tweaks=f.tweaks?f.tweaks:null}return xe.default(d,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(c){this._token=c}},{key:"updateContinuationToken",value:function(c){this._continuationToken=c}}]),d}(),Ze=function d(h){Pe.default(this,d),this.id=h||"TM".concat(x.v4())};function ft(d){var h=et();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function et(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var He=function(d){pe.default(c,d);var h=ft(c);function c(f,l,y,p,$){var T;return Pe.default(this,c),T=h.call(this),Me.default(B.default(T),"method","init"),T.token=f,T.continuation_token=l,T.metadata=y,T.registrations=p,T.tweaks=$,T.capabilities=["client_update","offline_storage","telemetry.v1"],T}return c}(Ze);function Et(d){var h=Rt();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Rt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var Dt=function(d){pe.default(c,d);var h=Et(c);function c(f,l,y,p,$,T,A){var P;return Pe.default(this,c),P=h.call(this,f),P.continuationToken=l,P.continuationTokenStatus=p,P.offlineStorage=$,P.initRegistrations=T,P.debugInfo=A,P.confirmedCapabilities=y,P}return c}(Ze);function Zr(d){var h=gn();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function gn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var Fr=function(d){pe.default(c,d);var h=Zr(c);function c(f){var l;return Pe.default(this,c),l=h.call(this),Me.default(B.default(l),"method","update"),l.token=f,l}return c}(Ze);function lr(d){var h=dt();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function dt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var Q=function(d){pe.default(c,d);var h=lr(c);function c(f,l,y){var p;return Pe.default(this,c),p=h.call(this),Me.default(B.default(p),"method","message"),p.active_grant=f,p.payload_type=l,p.http_request=y,p}return c}(Ze);function Z(d){var h=G();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function G(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var K=function(d){pe.default(c,d);var h=Z(c);function c(f){var l;return Pe.default(this,c),l=h.call(this,f),Me.default(B.default(l),"method","reply"),Me.default(B.default(l),"payload_type","application/json"),Me.default(B.default(l),"status",{code:200,status:"OK"}),l}return c}(Ze);function V(d){var h=ee();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function ee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var re=function(d){pe.default(c,d);var h=V(c);function c(){var f;return Pe.default(this,c),f=h.call(this),Me.default(B.default(f),"method","close"),f}return c}(Ze);function D(d){var h=z();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var N=function d(h,c,f,l,y,p){Pe.default(this,d),this.start=h,this.end=c,this.title=f,this.details=l,this.id=y,this.type=p},W=function(d){pe.default(c,d);var h=D(c);function c(f){var l;return Pe.default(this,c),l=h.call(this),Me.default(B.default(l),"method","telemetry.v1"),l.events=f,l}return c}(Ze);function L(d){var h=encodeURIComponent(d),c=h.replace(/%([0-9A-F]{2})/g,function(f,l){return String.fromCharCode(+("0x"+l))});return c.length}function ge(d){var h=encodeURIComponent(d),c=h.replace(/%([0-9A-F]{2})/g,function(l,y){return String.fromCharCode(+("0x"+y))}),f=new Uint8Array(c.length);return Array.prototype.forEach.call(c,function(l,y){f[y]=l.charCodeAt(0)}),f}function ae(d){var h=Array.prototype.map.call(d,function(f){return String.fromCharCode(f)}).join(""),c=h.replace(/(.)/g,function(f,l){var y=l.charCodeAt(0).toString(16).toUpperCase();return y.length<2&&(y="0"+y),"%"+y});return decodeURIComponent(c)}function Ce(d){return JSON.parse(ae(d))}function we(d){for(var h="",c=0;c<d.length;++c){var f=String.fromCharCode(d[c]);if(h+=f,f==="\r"){c+=2;break}}var l=h.split(" ");return{size:c,protocol:l[0],version:l[1],headerSize:Number(l[2])}}var $e=function(){function d(){Pe.default(this,d)}return xe.default(d,null,[{key:"parse",value:function(c){var f=2,l=new Uint8Array(c),y=we(l);if(y.protocol!=="TWILSOCK"||y.version!=="V3.0")return ye.error("unsupported protocol: ".concat(y.protocol," ver ").concat(y.version)),null;var p;try{p=Ce(l.subarray(y.size,y.size+y.headerSize))}catch(P){return ye.error("failed to parse message header",P,c),null}ye.debug("message received: ",p.method),ye.trace("message received: ",p);var $;if(p.payload_size>0){var T=f+y.size+y.headerSize,A=p.payload_size;if(!p.hasOwnProperty("payload_type")||p.payload_type.indexOf("application/json")===0)try{$=Ce(l.subarray(T,T+A))}catch(P){return ye.error("failed to parse message body",P,c),null}else p.payload_type.indexOf("text/plain")===0&&($=ae(l.subarray(T,T+A)))}return{method:p.method,header:p,payload:$}}},{key:"createPacket",value:function(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";c.payload_size=L(f);var l=JSON.stringify(c),y="TWILSOCK V3.0 "+L(l);ye.debug("send request:",y+l+f);var p=ge(y+"\r\n"+l+"\r\n"+f);return p.buffer}}]),d}();function Te(d){var h=Le();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Le(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var Oe=function(d){pe.default(c,d);var h=Te(c);function c(f){return Pe.default(this,c),h.call(this,f)}return c}(k.default(Error));function Ae(d){var h=je();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function je(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var De=function(d){pe.default(c,d);var h=Ae(c);function c(f,l){var y;return Pe.default(this,c),y=h.call(this,f),y.reply=l,y}return c}(Oe);function Tt(d,h){var c=Object.keys(d);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(d);h&&(f=f.filter(function(l){return Object.getOwnPropertyDescriptor(d,l).enumerable})),c.push.apply(c,f)}return c}function yr(d){for(var h=1;h<arguments.length;h++){var c=arguments[h]!=null?arguments[h]:{};h%2?Tt(Object(c),!0).forEach(function(f){Me.default(d,f,c[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(c)):Tt(Object(c)).forEach(function(f){Object.defineProperty(d,f,Object.getOwnPropertyDescriptor(c,f))})}return d}function Fe(d){var h=gr();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function gr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var da=function(d){pe.default(c,d);var h=Fe(c);function c(f){var l;return Pe.default(this,c),l=h.call(this),Me.default(B.default(l),"newBackoff",null),Me.default(B.default(l),"usedBackoff",null),Me.default(B.default(l),"retrier",null),l.options=f?yr({},f):{},l}return xe.default(c,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(l){this.newBackoff=l}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");if(this.newBackoff){var l=!this.usedBackoff||this.usedBackoff<this.newBackoff;if(l)this.createRetrier();else{var y;(y=this.retrier)===null||y===void 0||y.failed(new Error)}}else{var p;(p=this.retrier)===null||p===void 0||p.failed(new Error)}}},{key:"cancel",value:function(){var l;(l=this.retrier)===null||l===void 0||l.cancel()}},{key:"cleanRetrier",value:function(){var l,y;(l=this.retrier)===null||l===void 0||l.removeAllListeners(),(y=this.retrier)===null||y===void 0||y.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var l=yr({},this.options);return this.newBackoff&&(l.min=this.newBackoff,l.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),l.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,l}},{key:"createRetrier",value:function(){var l=this;this.cleanRetrier();var y=this.getRetryPolicy();this.retrier=new H.Retrier(y),this.retrier.once("attempt",function(){var p,$;(p=l.retrier)===null||p===void 0||p.on("attempt",function(){return l.emit("attempt")}),($=l.retrier)===null||$===void 0||$.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(p){return l.emit("failed",p)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),c}(X);function va(d){var h=Ga();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Ga(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var Fi=3e3;function Br(d){setTimeout(d,0)}var qr=function(d){pe.default(c,d);var h=va(c);function c(f,l,y){var p;Pe.default(this,c),p=h.call(this),Me.default(B.default(p),"disconnectingTimer",null),Me.default(B.default(p),"disconnectedPromiseResolve",null),Me.default(B.default(p),"terminalStates",["disconnected","rejected"]),Me.default(B.default(p),"tokenExpiredSasCode",20104),Me.default(B.default(p),"terminationReason","Connection is not initialized"),p.websocket=f,p.websocket.on("connected",function(){return p.fsm.socketConnected()}),p.websocket.on("disconnected",function(){return p.fsm.socketClosed()}),p.websocket.on("message",function(T){return p.onIncomingMessage(T)}),p.websocket.on("socketError",function(T){return p.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(T.message),httpStatusCode:null,errorCode:null})}),p.transport=l,p.config=y,p.retrier=new da(y.retryPolicy),p.retrier.on("attempt",function(){return p.retry()}),p.retrier.on("failed",function(T){ye.warn("Retrying failed: ".concat(T.message)),p.disconnect()}),typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",function(){ye.debug("Browser reported connectivity state: online"),p.resetBackoff(),p.fsm.systemOnline()}),window.addEventListener("offline",function(){ye.debug("Browser reported connectivity state: offline"),p.websocket.close(),p.fsm.socketClosed()}));var $=ze.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){p.setupSocket(),p.emit("connecting")},onEnterInitialising:function(){p.sendInit()},onLeaveInitialising:function(){p.cancelInit()},onEnterUpdating:function(){p.sendUpdate()},onLeaveUpdating:function(){p.cancelUpdate()},onEnterRetrying:function(){p.initRetry(),p.emit("connecting")},onEnterConnected:function(){p.resetBackoff(),p.onConnected()},onUserUpdateToken:function(){p.resetBackoff()},onTokenRejected:function(){p.resetBackoff(),p.closeSocket(!0),p.finalizeSocket()},onUserDisconnect:function(){p.closeSocket(!0)},onEnterDisconnecting:function(){p.startDisconnectTimer()},onLeaveDisconnecting:function(){p.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){p.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){p.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){p.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){p.cancelDisconnectTimer()},onDisconnected:function(){p.resetBackoff(),p.finalizeSocket()},onReceiveClose:function(){p.onCloseReceived()},onReceiveOffload:function(A,P){ye.debug("onreceiveoffload: ",P),p.modifyBackoff(P.body),p.onCloseReceived()},onUnsupported:function(){p.closeSocket(!0),p.finalizeSocket()},onError:function(A,P){p.closeSocket(P),p.finalizeSocket()},onEnterState:function(A){A.from!=="none"&&p.changeState(A)},onInvalidTransition:function(A,P,ue){ye.warn("FSM: unexpected transition",P,ue)}}});return p.fsm=new $,p}return xe.default(c,[{key:"changeState",value:function(l){ye.debug("FSM: ".concat(l.transition,": ").concat(l.from," --> ").concat(l.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){ye.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(l){ye.trace("modifyBackoff",l);var y=l?l.backoff_policy:null;y&&typeof y.reconnect_min_ms=="number"&&this.retrier.modifyBackoff(y.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var l=this;ye.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){ye.debug("disconnecting is timed out"),l.closeSocket(!0)},Fi)}},{key:"cancelDisconnectTimer",value:function(){ye.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return this.state==="connected"&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"initRetry",value:function(){ye.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){this.fsm.state!="connecting"?(ye.trace("retry"),this.websocket.close(),this.fsm.userRetry()):ye.trace("can	 retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){ye.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){ye.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(l){var y=$e.parse(l);if(y){var p=y.method,$=y.header,T=y.payload;if(p!=="reply"&&this.confirmReceiving($),p==="notification")this.emit("message",$.message_type,T);else if($.method==="reply")this.transport.processReply({id:$.id,status:$.status,header:$,body:T});else if($.method==="client_update")$.client_update_type==="token_about_to_expire"&&this.emit("tokenAboutToExpire");else if($.method==="close")if($.status.code===308)ye.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:$.status.status,body:T});else if($.status.code===406){var A="Server closed connection because can't parse protocol: ".concat(JSON.stringify($.status));this.emitReplyConnectionError(A,$,!0),ye.error(A),this.fsm.receiveFatalClose()}else $.status.code===417?(ye.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify($.status))),this.fsm.receiveFatalClose($.status.status)):$.status.code===410?(ye.warn("Server closed connection: ".concat(JSON.stringify($.status))),this.fsm.receiveClose($.status.status),this.emit("tokenExpired")):$.status.code===401?(ye.error("Server closed connection: ".concat(JSON.stringify($.status))),this.fsm.receiveClose($.status.status)):(ye.warn("unexpected message: ",$.status),this.fsm.receiveOffload({status:$.status.status,body:null}))}}},{key:"sendInit",value:function(){var f=Ee.default(_e.default.mark(function y(){var p,$;return _e.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return ye.trace("sendInit"),A.prev=1,this.emit("beforeSendInit"),A.next=5,this.transport.sendInit();case 5:p=A.sent,this.config.updateContinuationToken(p.continuationToken),this.config.confirmedCapabilities=p.confirmedCapabilities,this.fsm.initSuccess(p),this.emit("initialized",p),this.emit("tokenUpdated"),A.next=17;break;case 13:A.prev=13,A.t0=A.catch(1),A.t0 instanceof De?($=!1,ye.warn("Init rejected by server: ".concat(JSON.stringify(A.t0.reply.status))),this.emit("sendInitFailed"),A.t0.reply.status.code===401||A.t0.reply.status.code===403?($=!0,this.fsm.tokenRejected(A.t0.reply.status),A.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):A.t0.reply.status.code===429?(this.modifyBackoff(A.t0.reply.body),this.fsm.initError(!0)):A.t0.reply.status.code===500?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(A.t0.message,A.t0.reply,$)):(this.terminationReason=A.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(A.t0.message,"\n").concat(JSON.stringify(A.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",A.t0);case 17:case"end":return A.stop()}},y,this,[[1,13]])}));function l(){return f.apply(this,arguments)}return l}()},{key:"sendUpdate",value:function(){var f=Ee.default(_e.default.mark(function y(){var p,$,T;return _e.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return ye.trace("sendUpdate"),p=new Fr(this.config.token),P.prev=2,P.next=5,this.transport.sendWithReply(p);case 5:$=P.sent,this.fsm.updateSuccess($.body),this.emit("tokenUpdated"),P.next=14;break;case 10:P.prev=10,P.t0=P.catch(2),P.t0 instanceof De?(T=!1,ye.warn("Token update rejected by server: ".concat(JSON.stringify(P.t0.reply.status))),P.t0.reply.status.code===401||P.t0.reply.status.code===403?(T=!0,this.fsm.tokenRejected(P.t0.reply.status),P.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):P.t0.reply.status.code===429?(this.modifyBackoff(P.t0.reply.body),this.fsm.updateError(P.t0.reply.status)):this.fsm.updateError(P.t0.reply.status),this.emitReplyConnectionError(P.t0.message,P.t0.reply,T)):(this.emit("error",!1,P.t0.message,null,null),this.fsm.updateError(P.t0)),this.emit("tokenUpdated",P.t0);case 14:case"end":return P.stop()}},y,this,[[2,10]])}));function l(){return f.apply(this,arguments)}return l}()},{key:"emitReplyConnectionError",value:function(l,y,p){var $=y.status&&y.status.description?y.status.description:l,T=y.status.code,A=y.status&&y.status.errorCode?y.status.errorCode:null;p&&(this.terminationReason=$),this.emit("connectionError",{terminal:p,message:"Connection error: ".concat($),httpStatusCode:T,errorCode:A})}},{key:"cancelInit",value:function(){ye.trace("cancelInit")}},{key:"cancelUpdate",value:function(){ye.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(l){ye.trace("confirmReceiving");try{this.transport.send(new K(l.id))}catch(y){ye.debug("failed to confirm packet receiving",y)}}},{key:"closeSocket",value:function(l){var y=this;ye.trace("closeSocket (graceful: ".concat(l,")")),l&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),Br(function(){return y.fsm.socketClosed()})}},{key:"connect",value:function(){ye.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var l=this;return ye.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise(function(y){l.disconnectedPromiseResolve=y,l.fsm.userDisconnect()})}},{key:"updateToken",value:function(l){var y=this;return ye.trace("updateToken:",l),new Promise(function(p,$){y.once("tokenUpdated",function(T){T?$(T):p()}),y.fsm.userUpdateToken()})}},{key:"isTerminalState",get:function(){return this.terminalStates.indexOf(this.fsm.state)!==-1}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),c}(X),lt=function(){function d(){Pe.default(this,d)}return xe.default(d,null,[{key:"getMetadata",value:function(c){var f,l,y,p,$,T,A,P,ue=c&&c.clientMetadata?c.clientMetadata:{},Ue=["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"],kt={env:(f=te.name)!==null&&f!==void 0?f:"unknown",envv:(l=te.version)!==null&&l!==void 0?l:"unknown",os:(y=(p=te.os)===null||p===void 0?void 0:p.family)!==null&&y!==void 0?y:"unknown",osv:($=(T=te.os)===null||T===void 0?void 0:T.version)!==null&&$!==void 0?$:"unknown",osa:(A=(P=te.os)===null||P===void 0?void 0:P.architecture)!==null&&A!==void 0?A:"unknown",sdk:"js-default"},qe={};return Ue.filter(function(Yt){return Yt in ue||Yt in kt}).forEach(function(Yt){return qe[Yt]=Yt in ue?ue[Yt]:kt[Yt]}),qe}}]),d}(),Bi=3e4;function qi(d){return d>=200&&d<300}function Wi(d){switch(he.default(d)){case"undefined":return"";case"object":return JSON.stringify(d);default:return d}}var mn=function(){function d(h,c){var f=this;Pe.default(this,d),this.config=c,this.activeRequests=new Map,this.channel=h,this.channel.on("reply",function(l){return f.processReply(l)}),this.channel.on("disconnected",function(){f.activeRequests.forEach(function(l){clearTimeout(l.timeout),l.reject(new Oe("disconnected"))}),f.activeRequests.clear()})}return xe.default(d,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(c){var f=this.activeRequests.get(c.id);f&&(clearTimeout(f.timeout),this.activeRequests.delete(c.id),qi(c.status.code)?f.resolve(c):(f.reject(new De("Transport failure: "+c.status.status,c)),ye.trace("message rejected")))}},{key:"storeRequest",value:function(c,f,l){var y={resolve:f,reject:l,timeout:setTimeout(function(){ye.trace("request",c,"is timed out"),l(new Oe("Twilsock: request timeout: "+c))},Bi)};this.activeRequests.set(c,y)}},{key:"shutdown",value:function(){this.activeRequests.forEach(function(c){clearTimeout(c.timeout),c.reject(new Oe("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{key:"sendInit",value:function(){var h=Ee.default(_e.default.mark(function f(){var l,y,p;return _e.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return ye.trace("sendInit"),l=lt.getMetadata(this.config),y=new He(this.config.token,this.config.continuationToken,l,this.config.initRegistrations,this.config.tweaks),T.next=5,this.sendWithReply(y);case 5:return p=T.sent,T.abrupt("return",new Dt(p.id,p.header.continuation_token,new Set(p.header.capabilities),p.header.continuation_token_status,p.header.offline_storage,p.header.init_registrations,p.header.debug_info));case 7:case"end":return T.stop()}},f,this)}));function c(){return h.apply(this,arguments)}return c}()},{key:"sendClose",value:function(){var c=new re;this.send(c)}},{key:"sendWithReply",value:function(c,f){var l=this;return new Promise(function(y,p){var $=l.send(c,f);l.storeRequest($,y,p)})}},{key:"send",value:function(c,f){c.id=c.id||"TM".concat(x.v4());var l=$e.createPacket(c,Wi(f));try{return this.channel.send(l),c.id}catch(y){throw ye.debug("failed to send ",c,y),ye.trace(y.stack),y}}}]),d}();function Ha(d){var h=Gi();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Gi(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var kr=function(d){pe.default(c,d);var h=Ha(c);function c(f){var l;return Pe.default(this,c),l=h.call(this),Me.default(B.default(l),"socket",null),l.url=f,l.url=f,l.WebSocket=n.WebSocket||n.MozWebSocket||{},l}return xe.default(c,[{key:"isConnected",get:function(){return!!this.socket&&this.socket.readyState===1}},{key:"connect",value:function(){var l=this;ye.trace("connecting to socket");var y;try{y=new this.WebSocket(this.url)}catch(p){ye.debug("Socket error: ".concat(this.url)),this.emit("socketError",p);return}y.binaryType="arraybuffer",y.onopen=function(){ye.debug("socket opened ".concat(l.url)),l.emit("connected")},y.onclose=function(p){ye.debug("socket closed",p),l.emit("disconnected",p)},y.onerror=function(p){ye.debug("Socket error:",p),l.emit("socketError",p)},y.onmessage=function(p){l.emit("message",p.data)},this.socket=y}},{key:"send",value:function(l){return this.socket&&this.socket.send(l)}},{key:"close",value:function(){if(ye.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),c}(X);function Hi(d){var h=Kt();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Kt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var zi=function(d){pe.default(c,d);var h=Hi(c);function c(f){var l;return Pe.default(this,c),l=h.call(this),l.transport=f,l.registrations=new Map,l.registrationsInProgress=new Map,l}return xe.default(c,[{key:"putNotificationContext",value:function(){var f=Ee.default(_e.default.mark(function y(p,$){var T;return _e.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return T={method:"put_notification_ctx",notification_ctx_id:p},P.next=3,this.transport.sendWithReply(T,$);case 3:case"end":return P.stop()}},y,this)}));function l(y,p){return f.apply(this,arguments)}return l}()},{key:"deleteNotificationContext",value:function(){var f=Ee.default(_e.default.mark(function y(p){var $;return _e.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return $={method:"delete_notification_ctx",notification_ctx_id:p},A.next=3,this.transport.sendWithReply($);case 3:case"end":return A.stop()}},y,this)}));function l(y){return f.apply(this,arguments)}return l}()},{key:"updateRegistration",value:function(){var f=Ee.default(_e.default.mark(function y(p,$){var T,A;return _e.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return ye.debug("update registration for context",p),T=this.registrationsInProgress.get(p),T||(T=new Set,this.registrationsInProgress.set(p,T)),A=x.v4(),T.add(A),ue.prev=5,ue.next=8,this.putNotificationContext(p,$);case 8:ye.debug("registration attempt succeeded for context",$),T.delete(A),T.size===0&&(this.registrationsInProgress.delete(p),this.emit("registered",p)),ue.next=19;break;case 13:ue.prev=13,ue.t0=ue.catch(5),ye.warn("registration attempt failed for context",$),ye.debug(ue.t0),T.delete(A),T.size===0&&(this.registrationsInProgress.delete(p),this.emit("registrationFailed",p,ue.t0));case 19:case"end":return ue.stop()}},y,this,[[5,13]])}));function l(y,p){return f.apply(this,arguments)}return l}()},{key:"updateRegistrations",value:function(){var f=Ee.default(_e.default.mark(function y(){var p=this,$;return _e.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return ye.trace("refreshing ".concat(this.registrations.size," registrations")),$=[],this.registrations.forEach(function(P,ue){$.push(p.updateRegistration(ue,P))}),A.next=5,Promise.all($);case 5:case"end":return A.stop()}},y,this)}));function l(){return f.apply(this,arguments)}return l}()},{key:"setNotificationsContext",value:function(){var f=Ee.default(_e.default.mark(function y(p,$){return _e.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!(!p||!$)){A.next=2;break}throw new Oe("Invalid arguments provided");case 2:return this.registrations.set(p,$),A.next=5,this.updateRegistration(p,$);case 5:return A.abrupt("return",A.sent);case 6:case"end":return A.stop()}},y,this)}));function l(y,p){return f.apply(this,arguments)}return l}()},{key:"removeNotificationsContext",value:function(){var f=Ee.default(_e.default.mark(function y(p){return _e.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.registrations.has(p)){T.next=2;break}return T.abrupt("return");case 2:return T.next=4,this.deleteNotificationContext(p);case 4:this.transport.isConnected&&this.registrations.delete(p);case 5:case"end":return T.stop()}},y,this)}));function l(y){return f.apply(this,arguments)}return l}()}]),c}(X);function Vi(d){var h=Ki();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Ki(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var Yi=function(d){pe.default(c,d);var h=Vi(c);function c(f,l,y){var p;return Pe.default(this,c),p=h.call(this,l),p.status=f,p.description=l,p.body=y,p}return c}(Oe);function Wr(d){var h=Ji();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function Ji(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var cr=function(d){pe.default(c,d);var h=Wr(c);function c(f){return Pe.default(this,c),h.call(this,f)}return c}(Oe),Wn=2e4;function pa(d){return d>=200&&d<300}function Qi(d){return d&&d.header&&d.header.http_status}function za(d){var h=d.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(h){var c={protocol:h[1],host:h[2],hostname:h[3],port:h[4],pathname:h[5],search:h[6],hash:h[7],params:{}};if(c.search.length>0){var f=c.search.substring(1);c.params=f.split("&").map(function(l){return l.split("=")}).reduce(function(l,y){return l.hasOwnProperty(y[0])?Array.isArray(l[y[0]])?l[y[0]].push(y[1]):l[y[0]]=[l[y[0]],y[1]]:l[y[0]]=y[1],l},{})}return c}throw new Oe("Incorrect URI: "+d)}function Xi(d,h){var c=za(h),f={method:d,host:c.host,path:c.pathname};return c.params&&(f.params=c.params),f}function Zi(d,h,c,f,l){return{to:Xi(d,h),headers:c,body:f,grant:l}}var at=function(){function d(h,c,f){Pe.default(this,d),this.config=f,this.transport=h,this.pendingMessages=[],this.twilsock=c}return xe.default(d,[{key:"saveMessage",value:function(c){var f=this;return new Promise(function(l,y){var p={message:c,resolve:l,reject:y,alreadyRejected:!1,timeout:setTimeout(function(){ye.debug("request is timed out"),y(new Oe("request '".concat(c.to.method,"' to '").concat(c.to.host,"' timed out"))),p.alreadyRejected=!0},Wn)};f.pendingMessages.push(p)})}},{key:"sendPendingMessages",value:function(){for(var c=this,f=function(){var p=c.pendingMessages[0];if(!p.alreadyRejected)try{var $=p.message;c.actualSend($).then(function(T){return p.resolve(T)}).catch(function(T){return p.reject(T)}),clearTimeout(p.timeout)}catch(T){return ye.debug("Failed to send pending message",T),"break"}c.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){var l=f();if(l==="break")break}}},{key:"rejectPendingMessages",value:function(){var c=this;this.pendingMessages.forEach(function(f){f.reject(new cr("Unable to connect: "+c.twilsock.getTerminationReason)),f.alreadyRejected=!0,clearTimeout(f.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:function(){var h=Ee.default(_e.default.mark(function f(l){var y,p,$,T,A,P,ue,Ue;return _e.default.wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return p=l.to,$=l.headers,T=l.body,A=(y=l.grant)!==null&&y!==void 0?y:this.config.activeGrant,P={host:p.host,path:p.path,method:p.method,params:p.params,headers:$},ue=new Q(A,$["Content-Type"]||"application/json",P),ye.trace("Sending upstream message",ue),qe.next=9,this.transport.sendWithReply(ue,T);case 9:if(Ue=qe.sent,ye.trace("Received upstream message response",Ue),!(Qi(Ue)&&!pa(Ue.header.http_status.code))){qe.next=13;break}throw new Yi(Ue.header.http_status.code,Ue.header.http_status.status,Ue.body);case 13:return qe.abrupt("return",{status:Ue.header.http_status,headers:Ue.header.http_headers,body:Ue.body});case 14:case"end":return qe.stop()}},f,this)}));function c(f){return h.apply(this,arguments)}return c}()},{key:"send",value:function(c,f){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new cr("Unable to connect: "+this.twilsock.getTerminationReason));var $=Zi(c,f,l,y,p);return this.twilsock.isConnected?this.actualSend($):this.saveMessage($)}}]),d}(),Va=function(){function d(){var h=this;Pe.default(this,d),this._promise=new Promise(function(c,f){h._resolve=c,h._reject=f})}return xe.default(d,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(c){this._resolve(c)}},{key:"set",value:function(c){this._resolve(c)}},{key:"fail",value:function(c){this._reject(c)}}]),d}(),Gn=function(){function d(h){Pe.default(this,d),this.id=h}return xe.default(d,null,[{key:"create",value:function(c){if(c instanceof Object&&"storage_id"in c)return new d(c.storage_id);throw new Oe('Field "storage_id" is missing')}}]),d}(),ha=function(){function d(){return Pe.default(this,d),Me.default(this,"initializedFlag","twilio_twilsock_token_storage"),Me.default(this,"tokenStoragePrefix","twilio_continuation_token_"),d._instance||(this.initialize(),d._instance=this),d._instance}return xe.default(d,[{key:"sessionStorage",value:function(){try{return n.sessionStorage}catch(c){return null}}},{key:"window",value:function(){try{return n.window}catch(c){return null}}},{key:"storeToken",value:function(c,f){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(f),c)}},{key:"getStoredToken",value:function(c){return this.canStore()?this.sessionStorage.getItem(this.getKeyName(c)):null}},{key:"initialize",value:function(){var c=this;if(this.canStore()){var f=this.sessionStorage.getItem(this.initializedFlag);f&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var l=this.sessionStorage.removeItem;this.window.addEventListener("unload",function(){l(c.initializedFlag)})}}},{key:"clear",value:function(){if(this.canStore()){for(var c=[],f=0;f<this.sessionStorage.length;f++){var l=this.sessionStorage.key(f);l&&l.indexOf(this.tokenStoragePrefix)===0&&c.push(l)}var y=this.sessionStorage.removeItem;c.forEach(function(p){return y(p)}),y(this.initializedFlag)}}},{key:"getKeyName",value:function(c){return"".concat(this.tokenStoragePrefix).concat(c)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),d}();Me.default(ha,"_instance",null);var bn=new ha,rt=function(){function d(h,c,f,l,y,p){Pe.default(this,d),this.title=h,this.details=c,this.start=f,this.type=y,this.id=p,this.end=l}return xe.default(d,[{key:"toTelemetryEvent",value:function(){var c=new Date,f=this.start,l=this.end?this.end:c;if(l<f){var y=l;l=f,f=y}var p=f.getTime()-c.getTime(),$=l.getTime()-c.getTime(),T=new N(p,$,this.title,this.details,this.id,this.type);return T}}]),d}();e.TelemetryPoint=void 0,function(d){d[d.Start=0]="Start",d[d.End=1]="End"}(e.TelemetryPoint||(e.TelemetryPoint={})),e.EventSendingLimitation=void 0,function(d){d[d.MinEventsPortion=0]="MinEventsPortion",d[d.AnyEvents=1]="AnyEvents",d[d.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(e.EventSendingLimitation||(e.EventSendingLimitation={}));var Ka=function(){function d(h,c){Pe.default(this,d),Me.default(this,"minEventsPortionToSend",50),Me.default(this,"maxEventsPortionToSend",100),Me.default(this,"pendingEvents",new Map),Me.default(this,"readyEvents",[]),Me.default(this,"hasInitializationFinished",!1),Me.default(this,"_canSendTelemetry",!1),this.config=h,this.packetInterface=c}return xe.default(d,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(c){ye.debug("TelemetryTracker.canSendTelemetry: ".concat(c," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!c&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=c,c&&this.sendTelemetry(e.EventSendingLimitation.AnyEvents),c&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(c){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(c)}},{key:"addPartialEvent",value:function(c,f,l){ye.debug("Adding ".concat(l===e.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(f,"' event"));var y=this.pendingEvents.has(f);if(l===e.TelemetryPoint.Start)y&&ye.debug("Overwriting starting point for '".concat(f,"' event")),this.pendingEvents.set(f,c);else{if(!y){ye.info("Could not find started event for '".concat(f,"' event"));return}this.addTelemetryEvent(this.merge(this.pendingEvents.get(f),c)),this.pendingEvents.delete(f)}}},{key:"getTelemetryToSend",value:function(c){return!this.canSendTelemetry||this.readyEvents.length==0?[]:c==e.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(c==e.EventSendingLimitation.AnyEventsIncludingUnfinished)}},{key:"getTelemetryPortion",value:function(c){var f=this,l=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),y=this.readyEvents.splice(0,l);return c&&y.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(function(p,$){if(!(y.length>=f.maxEventsPortionToSend)){var T=f.pendingEvents.get($);f.pendingEvents.delete($),y.push(new rt("[UNFINISHED] ".concat(T.title),T.details,T.start,null,T.type,T.id))}}),y}},{key:"merge",value:function(c,f){return new rt(f.title?f.title:c.title,f.details?f.details:c.details,c.start,f.end,f.type?f.type:c.type,f.id?f.id:c.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(e.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function(c){var f=this.getTelemetryToSend(c);if(f.length!==0)try{this.packetInterface.send(new W(f.map(function(l){return l.toTelemetryEvent()})))}catch(l){ye.debug("Error while sending ".concat(f.length," telemetry events due to ").concat(l,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(f)}}}]),d}();function E(d){var h=C();return function(){var f=de.default(d),l;if(h){var y=de.default(this).constructor;l=Reflect.construct(f,arguments,y)}else l=f.apply(this,arguments);return F.default(this,l)}}function C(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(d){return!1}}var S=function d(){Pe.default(this,d)};Me.default(S,"TWILSOCK_CONNECT","twilsock.sdk.connect"),Me.default(S,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=function(d){pe.default(c,d);var h=E(c);function c(f,l,y){var p;Pe.default(this,c),p=h.call(this),Me.default(B.default(p),"version",Ut),Me.default(B.default(p),"offlineStorageDeferred",new Va),y.continuationToken=y.continuationToken?y.continuationToken:bn.getStoredToken(l);var $=p.config=new Zt(f,l,y);ye.setLevel($.logLevel);var T=new kr($.url),A=new mn(T,$);return p.channel=new qr(T,A,$),p.registrations=new zi(A),p.upstream=new at(A,p.channel,$),p.telemetryTracker=new Ka($,A),p.channel.on("initialized",function(){return p.telemetryTracker.canSendTelemetry=!0}),T.on("disconnected",function(){return p.telemetryTracker.canSendTelemetry=!1}),p.registrations.on("registered",function(P){return p.emit("registered",P)}),p.channel.on("message",function(P,ue){return setTimeout(function(){return p.emit("message",P,ue)},0)}),p.channel.on("stateChanged",function(P){return setTimeout(function(){return p.emit("stateChanged",P)},0)}),p.channel.on("connectionError",function(P){return setTimeout(function(){return p.emit("connectionError",P)},0)}),p.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return p.emit("tokenAboutToExpire")},0)}),p.channel.on("tokenExpired",function(){return setTimeout(function(){return p.emit("tokenExpired")},0)}),p.channel.on("connected",function(){return p.registrations.updateRegistrations()}),p.channel.on("connected",function(){return p.upstream.sendPendingMessages()}),p.channel.on("connected",function(){return setTimeout(function(){return p.emit("connected")},0)}),p.channel.on("beforeConnect",function(){return p.telemetryTracker.addPartialEvent(new rt("Establish WebSocket connection","",new Date),S.TWILSOCK_CONNECT,e.TelemetryPoint.Start)}),p.channel.on("connected",function(){return p.telemetryTracker.addPartialEvent(new rt("Establish WebSocket connection","",new Date,new Date),S.TWILSOCK_CONNECT,e.TelemetryPoint.End)}),p.channel.on("beforeSendInit",function(){return p.telemetryTracker.addPartialEvent(new rt("Send Twilsock init","",new Date),S.TWILSOCK_INIT,e.TelemetryPoint.Start)}),p.channel.on("initialized",function(){return p.telemetryTracker.addPartialEvent(new rt("Send Twilsock init","Succeeded",new Date,new Date),S.TWILSOCK_INIT,e.TelemetryPoint.End)}),p.channel.on("sendInitFailed",function(){return p.telemetryTracker.addPartialEvent(new rt("Send Twilsock init","Failed",new Date,new Date),S.TWILSOCK_INIT,e.TelemetryPoint.End)}),p.channel.on("initialized",function(P){p.handleStorageId(l,P),bn.storeToken(P.continuationToken,l),setTimeout(function(){return p.emit("initialized",P)},0)}),p.channel.on("disconnected",function(){return setTimeout(function(){return p.emit("disconnected")},0)}),p.channel.on("disconnected",function(){return p.upstream.rejectPendingMessages()}),p.channel.on("disconnected",function(){return p.offlineStorageDeferred.fail(new Oe("Client disconnected"))}),p.offlineStorageDeferred.promise.catch(function(){}),p}return xe.default(c,[{key:"emit",value:function(l){for(var y,p=arguments.length,$=new Array(p>1?p-1:0),T=1;T<p;T++)$[T-1]=arguments[T];return ye.debug("Emitting ".concat(l.toString(),"(").concat($.map(function(A){return JSON.stringify(A)}).join(", "),")")),(y=J.default(de.default(c.prototype),"emit",this)).call.apply(y,[this,l].concat($))}},{key:"handleStorageId",value:function(l,y){if(!y.offlineStorage)this.offlineStorageDeferred.fail(new Oe("No offline storage id"));else if(y.offlineStorage.hasOwnProperty(l))try{this.offlineStorageDeferred.set(Gn.create(y.offlineStorage[l])),ye.debug("Offline storage for '".concat(l,"' product: ").concat(JSON.stringify(y.offlineStorage[l]),"."))}catch(p){this.offlineStorageDeferred.fail(new Oe("Failed to parse offline storage for ".concat(l," ").concat(JSON.stringify(y.offlineStorage[l]),". ").concat(p,".")))}else this.offlineStorageDeferred.fail(new Oe("No offline storage id for '".concat(l,"' product: ").concat(JSON.stringify(y.offlineStorage))))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:function(){var f=Ee.default(_e.default.mark(function y(p){return _e.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(ye.trace("updating token '".concat(p,"'")),this.config.token!==p){T.next=3;break}return T.abrupt("return");case 3:return this.config.updateToken(p),T.next=6,this.channel.updateToken(p);case 6:return T.abrupt("return",T.sent);case 7:case"end":return T.stop()}},y,this)}));function l(y){return f.apply(this,arguments)}return l}()},{key:"setNotificationsContext",value:function(){var f=Ee.default(_e.default.mark(function y(p,$){return _e.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,this.registrations.setNotificationsContext(p,$);case 2:case"end":return A.stop()}},y,this)}));function l(y,p){return f.apply(this,arguments)}return l}()},{key:"removeNotificationsContext",value:function(){var f=Ee.default(_e.default.mark(function y(p){return _e.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this.registrations.removeNotificationsContext(p);case 2:case"end":return T.stop()}},y,this)}));function l(y){return f.apply(this,arguments)}return l}()},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){var f=Ee.default(_e.default.mark(function y(){return _e.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEventsIncludingUnfinished),$.next=3,this.channel.disconnect();case 3:return $.abrupt("return",$.sent);case 4:case"end":return $.stop()}},y,this)}));function l(){return f.apply(this,arguments)}return l}()},{key:"get",value:function(){var f=Ee.default(_e.default.mark(function y(p,$,T){return _e.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),P.next=3,this.upstream.send("GET",p,$,void 0,T);case 3:return P.abrupt("return",P.sent);case 4:case"end":return P.stop()}},y,this)}));function l(y,p,$){return f.apply(this,arguments)}return l}()},{key:"post",value:function(){var f=Ee.default(_e.default.mark(function y(p,$,T,A){return _e.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),ue.next=3,this.upstream.send("POST",p,$,T,A);case 3:return ue.abrupt("return",ue.sent);case 4:case"end":return ue.stop()}},y,this)}));function l(y,p,$,T){return f.apply(this,arguments)}return l}()},{key:"put",value:function(){var f=Ee.default(_e.default.mark(function y(p,$,T,A){return _e.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),ue.next=3,this.upstream.send("PUT",p,$,T,A);case 3:return ue.abrupt("return",ue.sent);case 4:case"end":return ue.stop()}},y,this)}));function l(y,p,$,T){return f.apply(this,arguments)}return l}()},{key:"delete",value:function(){var f=Ee.default(_e.default.mark(function y(p,$,T,A){return _e.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return this.telemetryTracker.sendTelemetry(e.EventSendingLimitation.AnyEvents),ue.next=3,this.upstream.send("DELETE",p,$,T,A);case 3:return ue.abrupt("return",ue.sent);case 4:case"end":return ue.stop()}},y,this)}));function l(y,p,$,T){return f.apply(this,arguments)}return l}()},{key:"addTelemetryEvent",value:function(l){this.telemetryTracker.addTelemetryEvent(l),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(l,y,p){this.telemetryTracker.addPartialEvent(l,y,p),p===e.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),c}(X),e.TwilsockClient=le([w.validateConstructorTypes(w.nonEmptyString,w.nonEmptyString,[w.pureObject,"undefined",w.literal(null)]),ce("design:paramtypes",[String,String,Object])],e.TwilsockClient);var b=function(){function d(h){Pe.default(this,d),this.product=h,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return xe.default(d,[{key:"populateInitRegistrations",value:function(c){var f=new Set(this.message_types);for(var l in c)f.add(c[l]);this.message_types=Array.from(f)}}]),d}();e.InitRegistration=b,e.TelemetryEventDescription=rt,e.TelemetryTracker=Ka,e.TransportUnavailableError=cr,e.Twilsock=e.TwilsockClient,e.TwilsockError=Oe})(Zo);var n0={},Tg=_t,M4=Ke,N4=yt,L4=We,Rc=qs,x4=Fs,j4=Ls,U4=Qt,D4=xs,ei=Object.assign,kg=Object.defineProperty,F4=M4([].concat),a0=!ei||L4(function(){if(Tg&&ei({b:1},ei(kg({},"a",{enumerable:!0,get:function(){kg(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},t=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[t]=7,r.split("").forEach(function(a){n[a]=a}),ei({},e)[t]!==7||Rc(ei({},n)).join("")!==r})?function(n,t){for(var r=U4(n),a=arguments.length,i=1,s=x4.f,o=j4.f;a>i;)for(var u=D4(arguments[i++]),v=s?F4(Rc(u),s(u)):Rc(u),g=v.length,m=0,_;g>m;)_=v[m++],(!Tg||N4(o,u,_))&&(r[_]=u[_]);return r}:ei,B4=Je,Ig=a0;B4({target:"Object",stat:!0,arity:2,forced:Object.assign!==Ig},{assign:Ig});/*
@license
The MIT License (MIT)

Copyright (c) 2016 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n=Ys,t=yn,r=ua,a=pn,i=hn,s=Ur,o=Zs,u=jr,v=Zo,g=ja,m=Ua,_=qn,w=xi,R=ji,M=tu,x=tl,j=Gt;function H(Q){return Q&&typeof Q=="object"&&"default"in Q?Q:{default:Q}}function me(Q){if(Q&&Q.__esModule)return Q;var Z=Object.create(null);return Q&&Object.keys(Q).forEach(function(G){if(G!=="default"){var K=Object.getOwnPropertyDescriptor(Q,G);Object.defineProperty(Z,G,K.get?K:{enumerable:!0,get:function(){return Q[G]}})}}),Z.default=Q,Object.freeze(Z)}var ne=H(n),Ie=H(t),Ee=H(r),xe=H(a),B=H(i),J=H(s),pe=H(o),F=H(u),de=H(g),Pe=H(m),Me=H(w),_e=H(R),he=me(M),Ye=me(x);function ze(Q,Z,G,K){var V=arguments.length,ee=V<3?Z:K===null?K=Object.getOwnPropertyDescriptor(Z,G):K,re;if((typeof Reflect>"u"?"undefined":F.default(Reflect))==="object"&&typeof Reflect.decorate=="function")ee=Reflect.decorate(Q,Z,G,K);else for(var D=Q.length-1;D>=0;D--)(re=Q[D])&&(ee=(V<3?re(ee):V>3?re(Z,G,ee):re(Z,G))||ee);return V>3&&ee&&Object.defineProperty(Z,G,ee),ee}function k(Q,Z){if((typeof Reflect>"u"?"undefined":F.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(Q,Z)}var te;function le(){}le.prototype=Object.create(null);function ce(){ce.init.call(this)}ce.EventEmitter=ce,ce.usingDomains=!1,ce.prototype.domain=void 0,ce.prototype._events=void 0,ce.prototype._maxListeners=void 0,ce.defaultMaxListeners=10,ce.init=function(){this.domain=null,ce.usingDomains&&te.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new le,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ce.prototype.setMaxListeners=function(Z){if(typeof Z!="number"||Z<0||isNaN(Z))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=Z,this};function Ne(Q){return Q._maxListeners===void 0?ce.defaultMaxListeners:Q._maxListeners}ce.prototype.getMaxListeners=function(){return Ne(this)};function be(Q,Z,G){if(Z)Q.call(G);else for(var K=Q.length,V=se(Q,K),ee=0;ee<K;++ee)V[ee].call(G)}function X(Q,Z,G,K){if(Z)Q.call(G,K);else for(var V=Q.length,ee=se(Q,V),re=0;re<V;++re)ee[re].call(G,K)}function I(Q,Z,G,K,V){if(Z)Q.call(G,K,V);else for(var ee=Q.length,re=se(Q,ee),D=0;D<ee;++D)re[D].call(G,K,V)}function tt(Q,Z,G,K,V,ee){if(Z)Q.call(G,K,V,ee);else for(var re=Q.length,D=se(Q,re),z=0;z<re;++z)D[z].call(G,K,V,ee)}function Se(Q,Z,G,K){if(Z)Q.apply(G,K);else for(var V=Q.length,ee=se(Q,V),re=0;re<V;++re)ee[re].apply(G,K)}ce.prototype.emit=function(Z){var G,K,V,ee,re,D,z,N=Z==="error";if(D=this._events,D)N=N&&D.error==null;else if(!N)return!1;if(z=this.domain,N){if(G=arguments[1],z)G||(G=new Error('Uncaught, unspecified "error" event')),G.domainEmitter=this,G.domain=z,G.domainThrown=!1,z.emit("error",G);else{if(G instanceof Error)throw G;var W=new Error('Uncaught, unspecified "error" event. ('+G+")");throw W.context=G,W}return!1}if(K=D[Z],!K)return!1;var L=typeof K=="function";switch(V=arguments.length,V){case 1:be(K,L,this);break;case 2:X(K,L,this,arguments[1]);break;case 3:I(K,L,this,arguments[1],arguments[2]);break;case 4:tt(K,L,this,arguments[1],arguments[2],arguments[3]);break;default:for(ee=new Array(V-1),re=1;re<V;re++)ee[re-1]=arguments[re];Se(K,L,this,ee)}return!0};function ut(Q,Z,G,K){var V,ee,re;if(typeof G!="function")throw new TypeError('"listener" argument must be a function');if(ee=Q._events,ee?(ee.newListener&&(Q.emit("newListener",Z,G.listener?G.listener:G),ee=Q._events),re=ee[Z]):(ee=Q._events=new le,Q._eventsCount=0),!re)re=ee[Z]=G,++Q._eventsCount;else if(typeof re=="function"?re=ee[Z]=K?[G,re]:[re,G]:K?re.unshift(G):re.push(G),!re.warned&&(V=Ne(Q),V&&V>0&&re.length>V)){re.warned=!0;var D=new Error("Possible EventEmitter memory leak detected. "+re.length+" "+Z+" listeners added. Use emitter.setMaxListeners() to increase limit");D.name="MaxListenersExceededWarning",D.emitter=Q,D.type=Z,D.count=re.length,bt(D)}return Q}function bt(Q){typeof console.warn=="function"?console.warn(Q):console.log(Q)}ce.prototype.addListener=function(Z,G){return ut(this,Z,G,!1)},ce.prototype.on=ce.prototype.addListener,ce.prototype.prependListener=function(Z,G){return ut(this,Z,G,!0)};function Re(Q,Z,G){var K=!1;function V(){Q.removeListener(Z,V),K||(K=!0,G.apply(Q,arguments))}return V.listener=G,V}ce.prototype.once=function(Z,G){if(typeof G!="function")throw new TypeError('"listener" argument must be a function');return this.on(Z,Re(this,Z,G)),this},ce.prototype.prependOnceListener=function(Z,G){if(typeof G!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(Z,Re(this,Z,G)),this},ce.prototype.removeListener=function(Z,G){var K,V,ee,re,D;if(typeof G!="function")throw new TypeError('"listener" argument must be a function');if(V=this._events,!V)return this;if(K=V[Z],!K)return this;if(K===G||K.listener&&K.listener===G)--this._eventsCount===0?this._events=new le:(delete V[Z],V.removeListener&&this.emit("removeListener",Z,K.listener||G));else if(typeof K!="function"){for(ee=-1,re=K.length;re-- >0;)if(K[re]===G||K[re].listener&&K[re].listener===G){D=K[re].listener,ee=re;break}if(ee<0)return this;if(K.length===1){if(K[0]=void 0,--this._eventsCount===0)return this._events=new le,this;delete V[Z]}else Ge(K,ee);V.removeListener&&this.emit("removeListener",Z,D||G)}return this},ce.prototype.off=function(Q,Z){return this.removeListener(Q,Z)},ce.prototype.removeAllListeners=function(Z){var G,K;if(K=this._events,!K)return this;if(!K.removeListener)return arguments.length===0?(this._events=new le,this._eventsCount=0):K[Z]&&(--this._eventsCount===0?this._events=new le:delete K[Z]),this;if(arguments.length===0){for(var V=Object.keys(K),ee=0,re;ee<V.length;++ee)re=V[ee],re!=="removeListener"&&this.removeAllListeners(re);return this.removeAllListeners("removeListener"),this._events=new le,this._eventsCount=0,this}if(G=K[Z],typeof G=="function")this.removeListener(Z,G);else if(G)do this.removeListener(Z,G[G.length-1]);while(G[0]);return this},ce.prototype.listeners=function(Z){var G,K,V=this._events;return V?(G=V[Z],G?typeof G=="function"?K=[G.listener||G]:K=Be(G):K=[]):K=[],K},ce.listenerCount=function(Q,Z){return typeof Q.listenerCount=="function"?Q.listenerCount(Z):Ht.call(Q,Z)},ce.prototype.listenerCount=Ht;function Ht(Q){var Z=this._events;if(Z){var G=Z[Q];if(typeof G=="function")return 1;if(G)return G.length}return 0}ce.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function Ge(Q,Z){for(var G=Z,K=G+1,V=Q.length;K<V;G+=1,K+=1)Q[G]=Q[K];Q.pop()}function se(Q,Z){for(var G=new Array(Z);Z--;)G[Z]=Q[Z];return G}function Be(Q){for(var Z=new Array(Q.length),G=0;G<Z.length;++G)Z[G]=Q[G].listener||Q[G];return Z}var nt=he.getLogger("twilio-notificatiions");function ve(Q,Z){return["".concat(new Date().toISOString()," Twilio.Notifications ").concat(Q,":")].concat(Array.from(Z))}var Ot=function(){function Q(){Ie.default(this,Q)}return Ee.default(Q,[{key:"setLevel",value:function(G){nt.setLevel(G)}},{key:"trace",value:function(){if(nt.getLevel()==nt.levels.TRACE){for(var G=arguments.length,K=new Array(G),V=0;V<G;V++)K[V]=arguments[V];nt.debug.apply(null,ve("T",K))}}},{key:"debug",value:function(){for(var G=arguments.length,K=new Array(G),V=0;V<G;V++)K[V]=arguments[V];nt.debug.apply(null,ve("D",K))}},{key:"info",value:function(){for(var G=arguments.length,K=new Array(G),V=0;V<G;V++)K[V]=arguments[V];nt.info.apply(null,ve("I",K))}},{key:"warn",value:function(){for(var G=arguments.length,K=new Array(G),V=0;V<G;V++)K[V]=arguments[V];nt.warn.apply(null,ve("W",K))}},{key:"error",value:function(){for(var G=arguments.length,K=new Array(G),V=0;V<G;V++)K[V]=arguments[V];nt.error.apply(null,ve("E",K))}}]),Q}(),Ve=new Ot;function $t(Q){var Z=xt();return function(){var K=J.default(Q),V;if(Z){var ee=J.default(this).constructor;V=Reflect.construct(K,arguments,ee)}else V=K.apply(this,arguments);return B.default(this,V)}}function xt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var ye=Ee.default(function Q(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Set;Ie.default(this,Q),this.token=Z,this.notificationId=G,this.messageTypes=K});function Ut(Q,Z){return[].concat(_e.default(_e.default(Q).filter(function(G){return!Z.has(G)})),_e.default(_e.default(Z).filter(function(G){return!Q.has(G)})))}function Zt(Q,Z){var G=new Set;return Q.notificationId!==Z.notificationId&&G.add("notificationId"),Q.token!==Z.token&&G.add("token"),Ut(Q.messageTypes,Z.messageTypes).length>0&&G.add("messageType"),[G.size>0,G]}var Ze=function(Q){xe.default(G,Q);var Z=$t(G);function G(K){var V;return Ie.default(this,G),V=Z.call(this),Pe.default(de.default(V),"desiredState",new ye),Pe.default(de.default(V),"currentState",new ye),Pe.default(de.default(V),"_hasActiveAttempt",!1),V.channelType=K,V}return Ee.default(G,[{key:"setNotificationId",value:function(V){this.desiredState.notificationId=V}},{key:"isActive",value:function(){return this.desiredState.notificationId!==""}},{key:"subscribe",value:function(V){if(this.desiredState.messageTypes.has(V)){Ve.debug("message type '".concat(V,"' for channel ").concat(this.channelType," is already registered"));return}this.desiredState.messageTypes.add(V)}},{key:"unsubscribe",value:function(V){this.desiredState.messageTypes.has(V)&&this.desiredState.messageTypes.delete(V)}},{key:"updateToken",value:function(V){this.desiredState.token=V}},{key:"commitChanges",value:function(){var K=ne.default(pe.default.mark(function ee(){var re,D,z,N,W,L;return pe.default.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(!this._hasActiveAttempt){ae.next=3;break}throw Ve.error("One registration attempt is already in progress"),new Error("One registration attempt is already in progress");case 3:if(re=Zt(this.desiredState,this.currentState),D=Me.default(re,2),z=D[0],N=D[1],z){ae.next=6;break}return ae.abrupt("return");case 6:if(this.currentState.notificationId||N.delete("notificationId"),Ve.trace("Persisting ".concat(this.channelType," registration"),N,this.desiredState),ae.prev=8,this._hasActiveAttempt=!0,W=new ye,W.token=this.desiredState.token,W.notificationId=this.desiredState.notificationId,W.messageTypes=new Set(this.desiredState.messageTypes),!(W.messageTypes.size>0)){ae.next=24;break}return ae.next=17,this.updateRegistration(W,N);case 17:L=ae.sent,this.currentState.token=L.token,this.currentState.notificationId=L.notificationId,this.currentState.messageTypes=new Set(L.messageTypes),this.emit("stateChanged",this.channelType,"registered",this.currentState),ae.next=30;break;case 24:return ae.next=26,this.removeRegistration();case 26:this.currentState.token=W.token,this.currentState.notificationId=W.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged",this.channelType,"unregistered",this.currentState);case 30:ae.next=35;break;case 32:throw ae.prev=32,ae.t0=ae.catch(8),ae.t0;case 35:return ae.prev=35,this._hasActiveAttempt=!1,ae.finish(35);case 38:case"end":return ae.stop()}},ee,this,[[8,32,35,38]])}));function V(){return K.apply(this,arguments)}return V}()}]),G}(ce);function ft(Q){var Z=et();return function(){var K=J.default(Q),V;if(Z){var ee=J.default(this).constructor;V=Reflect.construct(K,arguments,ee)}else V=K.apply(this,arguments);return B.default(this,V)}}function et(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var He={min:2e3,max:12e4,randomness:.2},Et=function(Q){xe.default(G,Q);var Z=ft(G);function G(K,V,ee,re){var D;return Ie.default(this,G),D=Z.call(this,K),Pe.default(de.default(D),"registrationId",null),D.context=V,D.twilsock=ee,D.registrarUrl=re,D}return Ee.default(G,[{key:"updateRegistration",value:function(){var K=ne.default(pe.default.mark(function ee(re,D){var z=this,N,W,L,ge,ae;return pe.default.wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(!D.has("notificationId")){we.next=3;break}return we.next=3,this.removeRegistration();case 3:if(!(!re.notificationId||!re.notificationId.length)){we.next=6;break}throw Ve.error("No push notification ID for registration"),new Error("No push notification ID for registration");case 6:return Ve.trace("Registering",this.channelType,re),N={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(re.messageTypes),data:{registration_id:re.notificationId}},W=this.context.productId,L="".concat(this.registrarUrl,"?productId=").concat(W),ge={"Content-Type":"application/json"},Ve.trace("Creating registration for channel ".concat(this.channelType)),we.prev=12,we.next=15,new _.AsyncRetrier(He).run(function(){return z.twilsock.post(L,ge,N,W)});case 15:ae=we.sent,this.registrationId=ae.body.id,Ve.debug("Registration created: ",ae),we.next=24;break;case 20:throw we.prev=20,we.t0=we.catch(12),Ve.error("Registration failed: ",we.t0),we.t0;case 24:return we.abrupt("return",re);case 25:case"end":return we.stop()}},ee,this,[[12,20]])}));function V(ee,re){return K.apply(this,arguments)}return V}()},{key:"removeRegistration",value:function(){var K=ne.default(pe.default.mark(function ee(){var re=this,D,z,N;return pe.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(this.registrationId){L.next=2;break}return L.abrupt("return");case 2:return D=this.context.productId,z="".concat(this.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(D),N={"Content-Type":"application/json"},Ve.trace("Removing registration for ".concat(this.channelType)),L.prev=6,L.next=9,new _.AsyncRetrier(Object.assign(He,{maxAttemptsCount:3})).run(function(){return re.twilsock.delete(z,N,{},D)});case 9:this.registrationId=null,this.currentState.notificationId="",Ve.debug("Registration removed for ".concat(this.channelType)),L.next=18;break;case 14:throw L.prev=14,L.t0=L.catch(6),Ve.error("Failed to remove registration ",this.channelType,L.t0),L.t0;case 18:case"end":return L.stop()}},ee,this,[[6,14]])}));function V(){return K.apply(this,arguments)}return V}()},{key:"sendDeviceRemoveRequest",value:function(){var K=ne.default(pe.default.mark(function ee(re){var D=this,z,N,W,L;return pe.default.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(re!==""){ae.next=2;break}throw new Error("Empty registration ID");case 2:return z=this.context.productId,N="".concat(this.registrarUrl,"?productId=").concat(z),W={"Content-Type":"application/json"},L={binding_type:this.channelType,address:re},ae.prev=6,Ve.trace("Removing old registrations for ".concat(this.channelType)),ae.next=10,new _.AsyncRetrier(Object.assign(He,{maxAttemptsCount:3})).run(function(){return D.twilsock.delete(N,W,L,z)});case 10:this.registrationId=null,this.currentState.notificationId="",Ve.debug("Registration removed for ".concat(this.channelType)),ae.next=19;break;case 15:throw ae.prev=15,ae.t0=ae.catch(6),Ve.error("Failed to remove registration ",this.channelType,ae.t0),ae.t0;case 19:case"end":return ae.stop()}},ee,this,[[6,15]])}));function V(ee){return K.apply(this,arguments)}return V}()}]),G}(Ze);function Rt(Q){var Z=Dt();return function(){var K=J.default(Q),V;if(Z){var ee=J.default(this).constructor;V=Reflect.construct(K,arguments,ee)}else V=K.apply(this,arguments);return B.default(this,V)}}function Dt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Zr=function(Q){xe.default(G,Q);var Z=Rt(G);function G(K,V,ee){var re;return Ie.default(this,G),re=Z.call(this,"twilsock"),Pe.default(de.default(re),"contextId",Ye.v4()),re.productId=K,re.platform=V,re.twilsock=ee,re}return Ee.default(G,[{key:"updateRegistration",value:function(){var K=ne.default(pe.default.mark(function ee(re,D){var z,N;return pe.default.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(D.has("messageType")){L.next=2;break}return L.abrupt("return",re);case 2:return z=Array.from(re.messageTypes),N={product_id:this.productId,notification_protocol_version:4,endpoint_platform:this.platform,message_types:z},L.prev=4,L.next=7,this.twilsock.setNotificationsContext(this.contextId,N);case 7:L.next=13;break;case 9:throw L.prev=9,L.t0=L.catch(4),Ve.error("Failed to update twilsock notification context: ".concat(L.t0)),L.t0;case 13:return L.abrupt("return",re);case 14:case"end":return L.stop()}},ee,this,[[4,9]])}));function V(ee,re){return K.apply(this,arguments)}return V}()},{key:"removeRegistration",value:function(){var K=ne.default(pe.default.mark(function ee(){return pe.default.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.prev=0,D.next=3,this.twilsock.removeNotificationsContext(this.contextId);case 3:D.next=9;break;case 5:throw D.prev=5,D.t0=D.catch(0),Ve.error("Failed to remove twilsock notification context: ".concat(D.t0)),D.t0;case 9:case"end":return D.stop()}},ee,this,[[0,5]])}));function V(){return K.apply(this,arguments)}return V}()},{key:"sendDeviceRemoveRequest",value:function(){var K=ne.default(pe.default.mark(function ee(re){return pe.default.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:case"end":return z.stop()}},ee)}));function V(ee){return K.apply(this,arguments)}return V}()}]),G}(Ze);function gn(Q){var Z=Fr();return function(){var K=J.default(Q),V;if(Z){var ee=J.default(this).constructor;V=Reflect.construct(K,arguments,ee)}else V=K.apply(this,arguments);return B.default(this,V)}}function Fr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var lr,dt=j.literal("apn","fcm","twilsock");e.Notifications=lr=function(Q){xe.default(G,Q);var Z=gn(G);function G(K){var V,ee,re,D,z,N,W,L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ie.default(this,G),W=Z.call(this),L.logLevel=(V=L.logLevel)!==null&&V!==void 0?V:"error",Ve.setLevel(L.logLevel);var ge=(ee=L.productId)!==null&&ee!==void 0?ee:"notifications",ae=!L.twilsockClient,Ce=L.twilsockClient=(re=L.twilsockClient)!==null&&re!==void 0?re:new v.TwilsockClient(K,ge,L),we=(D=L.notifications)!==null&&D!==void 0?D:{},$e=(z=(N=we.region)!==null&&N!==void 0?N:L.region)!==null&&z!==void 0?z:"us1",Te="https://ers.".concat($e,".twilio.com/v1/registrations"),Le=we.ersUrl||Te;W.connectors=new Map;var Oe=lr._detectPlatform();return W.connectors.set("apn",new Et("apn",{protocolVersion:4,productId:ge,platform:Oe},Ce,Le)),W.connectors.set("fcm",new Et("fcm",{protocolVersion:3,productId:ge,platform:Oe},Ce,Le)),W.connectors.set("twilsock",new Zr(ge,Oe,Ce)),Ce.on("stateChanged",function(Ae){return W.emit("transportState",Ae)}),W._connector("twilsock").on("stateChanged",function(Ae,je,De){return W.emit("stateChanged",Ae,je,De)}),W._connector("apn").on("stateChanged",function(Ae,je,De){return W.emit("stateChanged",Ae,je,De)}),W._connector("fcm").on("stateChanged",function(Ae,je,De){return W.emit("stateChanged",Ae,je,De)}),Ce.on("message",function(Ae,je){return W._routeMessage(Ae,je)}),W.updateToken(K),ae&&(Ce.connect(),W.twilsock=Ce),W}return Ee.default(G,[{key:"shutdown",value:function(){var K=ne.default(pe.default.mark(function ee(){return pe.default.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(this.connectors.clear(),!this.twilsock){D.next=4;break}return D.next=4,this.twilsock.disconnect();case 4:case"end":return D.stop()}},ee,this)}));function V(){return K.apply(this,arguments)}return V}()},{key:"setPushRegistrationId",value:function(V,ee){Ve.debug("Set ".concat(V," push registration id '").concat(ee,"'")),this._connector(V).setNotificationId(ee)}},{key:"subscribe",value:function(V,ee){Ve.debug("Add ".concat(V," subscriptions for message type ").concat(ee)),this._connector(V).subscribe(ee)}},{key:"unsubscribe",value:function(V,ee){Ve.debug("Remove ".concat(V," subscriptions for message type ").concat(ee)),this._connector(V).unsubscribe(ee)}},{key:"updateToken",value:function(V){this.connectors.forEach(function(ee){return ee.updateToken(V)})}},{key:"commitChanges",value:function(){var K=ne.default(pe.default.mark(function ee(){var re;return pe.default.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return re=[],this.connectors.forEach(function(N){N.isActive()&&re.push(N.commitChanges())}),z.next=4,Promise.all(re);case 4:case"end":return z.stop()}},ee,this)}));function V(){return K.apply(this,arguments)}return V}()},{key:"removeRegistrations",value:function(){var K=ne.default(pe.default.mark(function ee(re,D){return pe.default.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,this._connector(re).sendDeviceRemoveRequest(D);case 2:case"end":return N.stop()}},ee,this)}));function V(ee,re){return K.apply(this,arguments)}return V}()},{key:"handlePushNotification",value:function(V){return{messageType:V.twi_message_type,payload:V.payload}}},{key:"_routeMessage",value:function(V,ee){Ve.debug("Notification message arrived: ",V,ee),this.emit("message",V,ee)}},{key:"_connector",value:function(V){var ee=this.connectors.get(V);if(!ee)throw new Error("Unknown channel type: ".concat(V));return ee}}],[{key:"_detectPlatform",value:function(){var V="";return typeof navigator<"u"?(V="unknown",typeof navigator.product<"u"&&(V=navigator.product),typeof navigator.userAgent<"u"&&(V=navigator.userAgent)):V="web",V.substring(0,128)}}]),G}(ce),ze([j.validateTypes(dt,j.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String,String]),k("design:returntype",void 0)],e.Notifications.prototype,"setPushRegistrationId",null),ze([j.validateTypes(dt,j.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String,String]),k("design:returntype",void 0)],e.Notifications.prototype,"subscribe",null),ze([j.validateTypes(dt,j.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String,String]),k("design:returntype",void 0)],e.Notifications.prototype,"unsubscribe",null),ze([j.validateTypes(j.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",void 0)],e.Notifications.prototype,"updateToken",null),ze([j.validateTypesAsync(dt,j.nonEmptyString),k("design:type",Function),k("design:paramtypes",[String,String]),k("design:returntype",Promise)],e.Notifications.prototype,"removeRegistrations",null),e.Notifications=lr=ze([j.validateConstructorTypes(j.nonEmptyString,[j.pureObject,"undefined",j.literal(null)]),k("design:paramtypes",[String,Object])],e.Notifications)})(n0);var hr={},ur={};/*
@license
Copyright (c) 2021 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


*/Object.defineProperty(ur,"__esModule",{value:!0});var q4=jr,W4=xi,G4=ji,H4=yn,z4=pn,V4=hn,K4=Ur;function qa(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var wi=qa(q4),Aa=qa(W4),Cc=qa(G4),Y4=qa(H4),J4=qa(z4),Q4=qa(V4),Eg=qa(K4),ca=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return{checks:t}};function X4(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Z4(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function Z4(e,n){if(e){if(typeof e=="string")return Rg(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Rg(e,n)}}function Rg(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var i0=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return ca(function(a){var i=!1,s=[],o=X4(t),u;try{for(o.s();!(u=o.n()).done;){var v=u.value;if(typeof v=="string"){i=i||wi.default(a)===v,s.push("of type ".concat(v));continue}i=i||a instanceof v,s.push("an instance of ".concat(v.name))}}catch(g){o.e(g)}finally{o.f()}return[i,s]})};function e6(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=t6(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function t6(e,n){if(e){if(typeof e=="string")return Cg(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Cg(e,n)}}function Cg(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var r6=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return ca(function(a){var i=!1,s=[],o=e6(t),u;try{for(o.s();!(u=o.n()).done;){var v=u.value;i=i||a===v,s.push(typeof v=="string"?'"'.concat(v,'"'):"".concat(v))}}catch(g){o.e(g)}finally{o.f()}return[i,s]})},n6=ca(function(e){return[typeof e=="string"&&e.length>0,"a non-empty string"]}),a6=ca(function(e){return[typeof e=="number"&&Number.isInteger(e)&&e>=0,"a non-negative integer"]}),i6=ca(function(e){return[wi.default(e)==="object"&&e!==null&&!Array.isArray(e),"a pure object (non-null and non-array)"]});function s6(e){var n=u6();return function(){var r=Eg.default(e),a;if(n){var i=Eg.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return Q4.default(this,a)}}function u6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ps(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=o6(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function o6(e,n){if(e){if(typeof e=="string")return Og(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Og(e,n)}}function Og(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var ll=function(n,t){if(t.length>n.length)throw new Error("Expected at most ".concat(n.length," argument(s), but got ").concat(t.length));for(;t.length<n.length;)t.push(void 0);var r=Ps(t.entries()),a;try{for(r.s();!(a=r.n()).done;){var i=Aa.default(a.value,2),s=i[0],o=i[1],u=Iv(n[s],o),v=Aa.default(u,4),g=v[0],m=v[1],_=v[2],w=v[3];if(!g){var R=s+1;throw new Error("Argument ".concat(R," is expected to be ").concat(_).concat(w," but got ").concat(m))}}}catch(M){r.e(M)}finally{r.f()}},s0=function(n){var t,r,a=["undefined","boolean","number","bigint","string"];if(a.includes(wi.default(n))&&(r=typeof n=="string"?'"'.concat(n,'"'):"".concat(n)),wi.default(n)==="object"&&(n==null||(t=n.constructor)===null||t===void 0?void 0:t.name)!=="Object"){var i;r=n===null?"null":"instance of ".concat(n==null||(i=n.constructor)===null||i===void 0?void 0:i.name)}return r||(r=wi.default(n)),r},l6=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Tv(t);return function(i){return function(s){J4.default(u,s);var o=s6(u);function u(){Y4.default(this,u);for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return ll(a,g),o.call.apply(o,[this].concat(g))}return u}(i)}},c6=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Tv(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypes decorator can only be applied to methods");var u=o.value;o.value=function(){for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return ll(a,g),u.apply(this,g)}}},f6=function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var a=Tv(t);return function(i,s,o){if(typeof o.value!="function")throw new Error("The validateTypesAsync decorator can only be applied to methods");var u=o.value;o.value=function(){for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];try{ll(a,g)}catch(_){return Promise.reject(_)}return u.apply(this,g)}}},Tv=function(n){var t=[],r=Ps(n),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;t.push(kv(i))}}catch(s){r.e(s)}finally{r.f()}return t},kv=function(n){var t=[],r=Array.isArray(n)?n:[n],a=Ps(r),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;if(typeof s=="string"||typeof s=="function"){t.push(i0(s));continue}t.push(s)}}catch(o){a.e(o)}finally{a.f()}return t},Iv=function(n,t){var r=[],a,i=!1,s=Ps(n),o;try{for(s.s();!(o=s.n()).done;){var u=o.value,v=Ps(u.checks),g;try{for(v.s();!(g=v.n()).done;){var m=g.value,_=m(t),w=Aa.default(_,3),R=w[0],M=w[1],x=w[2];i=i||R,!a&&x&&(a=x),M&&(r=typeof M=="string"?[].concat(Cc.default(r),[M]):[].concat(Cc.default(r),Cc.default(M)))}}catch(ne){v.e(ne)}finally{v.f()}}}catch(ne){s.e(ne)}finally{s.f()}if(i)return[!0];var j=a||s0(t),H=r.length-1,me=H>0?"".concat(r.slice(0,H).join(", ")," or ").concat(r[H]):r.join(", ");return[!1,j,me,H>1?";":","]},d6=function(n,t){return ca(function(r){if(wi.default(r)!=="object"||r===null||Array.isArray(r))return[!1,"valid ".concat(n," (should be a pure object)")];for(var a=0,i=Object.entries(t);a<i.length;a++){var s=Aa.default(i[a],2),o=s[0],u=s[1],v=Iv(kv(u),r[o]),g=Aa.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"valid ".concat(n,' (key "').concat(o,'" should be ').concat(w,")"),"malformed ".concat(n,' (key "').concat(o,'" is ').concat(_,")")]}return[!0]})};function v6(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=p6(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function p6(e,n){if(e){if(typeof e=="string")return Ag(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ag(e,n)}}function Ag(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var h6=function(n,t){return ca(function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(n)];var a=v6(r.entries()),i;try{for(a.s();!(i=a.n()).done;){var s=Aa.default(i.value,2),o=s[0],u=s[1],v=Iv(kv(t),u),g=Aa.default(v,3),m=g[0],_=g[1],w=g[2];if(!m)return[!1,"a valid array of ".concat(n," (index ").concat(o," should be ").concat(w,")"),"malformed array of ".concat(n," (index ").concat(o," is ").concat(_,")")]}}catch(R){a.e(R)}finally{a.f()}return[!0]})};ur.array=h6;ur.custom=ca;ur.literal=r6;ur.nonEmptyString=n6;ur.nonNegativeInteger=a6;ur.objectSchema=d6;ur.pureObject=i6;ur.runtimeTypeValidation=ll;ur.stringifyReceivedType=s0;ur.type=i0;ur.validateConstructorTypes=l6;ur.validateTypes=c6;ur.validateTypesAsync=f6;/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.

*/Object.defineProperty(hr,"__esModule",{value:!0});var y6=Ys,g6=yn,m6=ua,b6=ja,w6=pn,_6=hn,S6=Ur,$6=Ua,T6=Zs,k6=jr,ie=ur,mo=Zo,I6=$v,E6=tu,R6=xi,u0=qn,o0=tl,C6=Jd,O6=r0;function $r(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function Ev(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var fe=$r(y6),it=$r(g6),ct=$r(m6),sn=$r(b6),or=$r(w6),fa=$r(_6),Nt=$r(S6),vt=$r($6),U=$r(T6),l0=$r(k6),A6=$r(I6),P6=Ev(E6),c0=$r(R6),M6=Ev(o0),iu=$r(C6),Fu=Ev(O6);function st(e,n,t,r){var a=arguments.length,i=a<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,t):r,s;if((typeof Reflect>"u"?"undefined":l0.default(Reflect))==="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,n,t,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(i=(a<3?s(i):a>3?s(n,t,i):s(n,t))||i);return a>3&&i&&Object.defineProperty(n,t,i),i}function oe(e,n){if((typeof Reflect>"u"?"undefined":l0.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,n)}var N6;function ra(){}ra.prototype=Object.create(null);function ht(){ht.init.call(this)}ht.EventEmitter=ht;ht.usingDomains=!1;ht.prototype.domain=void 0;ht.prototype._events=void 0;ht.prototype._maxListeners=void 0;ht.defaultMaxListeners=10;ht.init=function(){this.domain=null,ht.usingDomains&&N6.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new ra,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ht.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this};function f0(e){return e._maxListeners===void 0?ht.defaultMaxListeners:e._maxListeners}ht.prototype.getMaxListeners=function(){return f0(this)};function L6(e,n,t){if(n)e.call(t);else for(var r=e.length,a=su(e,r),i=0;i<r;++i)a[i].call(t)}function x6(e,n,t,r){if(n)e.call(t,r);else for(var a=e.length,i=su(e,a),s=0;s<a;++s)i[s].call(t,r)}function j6(e,n,t,r,a){if(n)e.call(t,r,a);else for(var i=e.length,s=su(e,i),o=0;o<i;++o)s[o].call(t,r,a)}function U6(e,n,t,r,a,i){if(n)e.call(t,r,a,i);else for(var s=e.length,o=su(e,s),u=0;u<s;++u)o[u].call(t,r,a,i)}function D6(e,n,t,r){if(n)e.apply(t,r);else for(var a=e.length,i=su(e,a),s=0;s<a;++s)i[s].apply(t,r)}ht.prototype.emit=function(n){var t,r,a,i,s,o,u,v=n==="error";if(o=this._events,o)v=v&&o.error==null;else if(!v)return!1;if(u=this.domain,v){if(t=arguments[1],u)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t);else{if(t instanceof Error)throw t;var g=new Error('Uncaught, unspecified "error" event. ('+t+")");throw g.context=t,g}return!1}if(r=o[n],!r)return!1;var m=typeof r=="function";switch(a=arguments.length,a){case 1:L6(r,m,this);break;case 2:x6(r,m,this,arguments[1]);break;case 3:j6(r,m,this,arguments[1],arguments[2]);break;case 4:U6(r,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(a-1),s=1;s<a;s++)i[s-1]=arguments[s];D6(r,m,this,i)}return!0};function d0(e,n,t,r){var a,i,s;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(i=e._events,i?(i.newListener&&(e.emit("newListener",n,t.listener?t.listener:t),i=e._events),s=i[n]):(i=e._events=new ra,e._eventsCount=0),!s)s=i[n]=t,++e._eventsCount;else if(typeof s=="function"?s=i[n]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),!s.warned&&(a=f0(e),a&&a>0&&s.length>a)){s.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=n,o.count=s.length,F6(o)}return e}function F6(e){typeof console.warn=="function"?console.warn(e):console.log(e)}ht.prototype.addListener=function(n,t){return d0(this,n,t,!1)};ht.prototype.on=ht.prototype.addListener;ht.prototype.prependListener=function(n,t){return d0(this,n,t,!0)};function v0(e,n,t){var r=!1;function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}return a.listener=t,a}ht.prototype.once=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(n,v0(this,n,t)),this};ht.prototype.prependOnceListener=function(n,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(n,v0(this,n,t)),this};ht.prototype.removeListener=function(n,t){var r,a,i,s,o;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(r=a[n],!r)return this;if(r===t||r.listener&&r.listener===t)--this._eventsCount===0?this._events=new ra:(delete a[n],a.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new ra,this;delete a[n]}else B6(r,i);a.removeListener&&this.emit("removeListener",n,o||t)}return this};ht.prototype.off=function(e,n){return this.removeListener(e,n)};ht.prototype.removeAllListeners=function(n){var t,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new ra,this._eventsCount=0):r[n]&&(--this._eventsCount===0?this._events=new ra:delete r[n]),this;if(arguments.length===0){for(var a=Object.keys(r),i=0,s;i<a.length;++i)s=a[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new ra,this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t)do this.removeListener(n,t[t.length-1]);while(t[0]);return this};ht.prototype.listeners=function(n){var t,r,a=this._events;return a?(t=a[n],t?typeof t=="function"?r=[t.listener||t]:r=q6(t):r=[]):r=[],r};ht.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):p0.call(e,n)};ht.prototype.listenerCount=p0;function p0(e){var n=this._events;if(n){var t=n[e];if(typeof t=="function")return 1;if(t)return t.length}return 0}ht.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function B6(e,n){for(var t=n,r=t+1,a=e.length;r<a;t+=1,r+=1)e[t]=e[r];e.pop()}function su(e,n){for(var t=new Array(n);n--;)t[n]=e[n];return t}function q6(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}var Ii=function(){function e(n){it.default(this,e),this.base=n,this.args=new Array,this.paths=new Array}return ct.default(e,[{key:"pathSegment",value:function(t){return this.paths.push(encodeURIComponent(t)),this}},{key:"queryParam",value:function(t,r){return typeof r<"u"&&this.args.push(encodeURIComponent(t)+"="+encodeURIComponent(r)),this}},{key:"build",value:function(){var t=this.base;return this.paths.length&&(t+="/"+this.paths.join("/")),this.args.length&&(t+="?"+this.args.join("&")),t}}]),e}();function h0(e){var n=W6();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function W6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pr=function(e){or.default(t,e);var n=h0(t);function t(r){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return it.default(this,t),a=n.call(this),a.name=a.constructor.name,a.message="".concat(r," (status: ").concat(i,", code: ").concat(s,")"),a.status=i,a.code=s,a}return t}(A6.default(Error)),G6=function(e){or.default(t,e);var n=h0(t);function t(r){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;return it.default(this,t),a=n.call(this,r,i,s),a.body=o,a}return t}(pr);function Jr(e){return JSON.parse(JSON.stringify(e))}function y0(e){var n=e===void 0||Rv(e);if(!n)throw new pr("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function H6(e){return!isNaN(parseInt(e))&&isFinite(e)}function Rv(e){return H6(e)&&e>0}var ti=P6.getLogger("twilio-sync");function ls(e,n){return["".concat(new Date().toISOString()," Sync ").concat(e,":")].concat(Array.from(n))}var ot={setLevel:function(n){ti.setLevel(n)},trace:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ti.trace.apply(null,ls("T",t))},debug:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ti.debug.apply(null,ls("D",t))},info:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ti.info.apply(null,ls("I",t))},warn:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ti.warn.apply(null,ls("W",t))},error:function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];ti.error.apply(null,ls("E",t))}},z6="/v4/Subscriptions",V6="/v3/Maps",K6="/v3/Lists",Y6="/v3/Documents",J6="/v3/Streams",Q6="/v3/Insights";function X6(e,n,t){return e&&typeof e[n]<"u"?e[n]:t}var Z6=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};it.default(this,e);var t=n.region||"us1",r="https://cds.".concat(t,".twilio.com"),a=n.cdsUri||r;this.settings={subscriptionsUri:a+z6,documentsUri:a+Y6,listsUri:a+K6,mapsUri:a+V6,streamsUri:a+J6,insightsUri:a+Q6,sessionStorageEnabled:X6(n.Sync,"enableSessionStorage",!0),productId:n.productId}}return ct.default(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function cs(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=eq(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function eq(e,n){if(e){if(typeof e=="string")return Pg(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Pg(e,n)}}function Pg(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var tq=function(){function e(n){it.default(this,e),this.localObject=n,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return ct.default(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(t,r){this.localObject._update(t,r)}},{key:"updatePending",value:function(t,r){this.pendingAction=t,this.pendingCorrelationId=r}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(t){this.rejectedWithError=t.error,this.updatePending(null,null),this.localObject.reportFailure(new pr("Failed to subscribe on service events: ".concat(t.error.message),t.error.status,t.error.code))}},{key:"complete",value:function(t){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(t)}},{key:"setSubscriptionState",value:function(t){this.localObject._setSubscriptionState(t)}}]),e}(),rq=function(){function e(n){var t=this;it.default(this,e),vt.default(this,"isConnected",!1),vt.default(this,"maxBatchSize",100),vt.default(this,"subscriptionTtlTimer",null),vt.default(this,"pendingPokeReason",null),this.services=n,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;var r={randomisationFactor:.2,initialDelay:100,maxDelay:2*60*1e3};this.backoff=u0.Backoff.exponential(Object.assign(r,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var a=t.getSubscriptionUpdateBatch(),i=a.action,s=a.subscriptions;i?t.applyNewSubscriptionUpdateBatch(i,s):(t.backoff.reset(),ot.debug("All subscriptions resolved."))})}return ct.default(e,[{key:"getSubscriptionUpdateBatch",value:function(){function t(i,s,o,u){var v=[],g=cs(i),m;try{for(g.s();!(m=g.n()).done;){var _=c0.default(m.value,2),w=_[0],R=_[1],M=s.get(w);if(!M&&o!==R.pendingAction&&!R.rejectedWithError&&(v.push(R),u&&v.length>=u))break}}catch(x){g.e(x)}finally{g.f()}return v}var r=t(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(r.length>0)return{action:"establish",subscriptions:r};var a=t(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return a.length>0?{action:"cancel",subscriptions:a}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:function(){var n=fe.default(U.default.mark(function r(a,i){var s=this,o,u,v,g,m,_,w,R,M,x,j,H,me,ne,Ie,Ee;return U.default.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.isConnected){B.next=4;break}return ot.debug("Twilsock connection (required for subscription) not ready; waitingâ¦"),this.backoff.reset(),B.abrupt("return");case 4:i=this.processLocalActions(a,i),o=new Date().getTime(),u=cs(i);try{for(u.s();!(v=u.n()).done;)g=v.value,this.recordActionAttemptOn(g,a,o)}catch(J){u.e(J)}finally{u.f()}return m=this.pendingPokeReason,this.pendingPokeReason=null,B.prev=10,B.next=13,this.request(a,o,m,i);case 13:_=B.sent,w=_.body.max_batch_size,!isNaN(parseInt(w))&&isFinite(w)&&w>0&&(this.maxBatchSize=w),this.subscriptionTtlTimer||(R=_.body.ttl_in_s,M=!isNaN(parseFloat(R))&&isFinite(R),x=M&&R>0,x&&(this.subscriptionTtlTimer=setTimeout(function(){return s.onSubscriptionTtlElapsed()},R*1e3))),a==="establish"&&(j=_.body.estimated_delivery_in_ms,H=!isNaN(parseFloat(j))&&isFinite(j),me=H&&j>0,me?setTimeout(function(){return s.verifyPokeDelivery(o,j,i)},j):ot.error("Invalid timeout: ".concat(j)),i.filter(function(J){return J.pendingCorrelationId===o}).forEach(function(J){return J.setSubscriptionState("response_in_flight")})),this.backoff.reset(),B.next=26;break;case 21:B.prev=21,B.t0=B.catch(10),ne=cs(i);try{for(ne.s();!(Ie=ne.n()).done;)Ee=Ie.value,this.recordActionFailureOn(Ee,a)}catch(J){ne.e(J)}finally{ne.f()}B.t0 instanceof mo.TransportUnavailableError?(ot.debug("Twilsock connection (required for subscription) not ready (c:".concat(o,"); waitingâ¦")),this.backoff.reset()):(ot.debug("Failed an attempt to ".concat(a," subscriptions (c:").concat(o,"); retrying"),B.t0),this.persist());case 26:case"end":return B.stop()}},r,this,[[10,21]])}));function t(r,a){return n.apply(this,arguments)}return t}()},{key:"verifyPokeDelivery",value:function(t,r,a){var i=this,s=this.latestPokeResponseArrivalTimestampByCorrelationId.get(t),o=s?new Date().getTime()-s:r;if(o>=r)a.filter(function(v){return v.pendingCorrelationId===t}).forEach(function(v){v.updatePending(null,null),v.retryCount++,i.persisted.delete(v.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(t);else{var u=r-o;setTimeout(function(){return i.verifyPokeDelivery(t,r,a)},u)}}},{key:"processLocalActions",value:function(t,r){return t==="cancel"?r.filter(function(a){return!a.rejectedWithError}):r}},{key:"recordActionAttemptOn",value:function(t,r,a){if(t.setSubscriptionState("request_in_flight"),r==="establish")this.persisted.set(t.sid,t),t.updatePending(r,a);else{var i=this.persisted.get(t.sid);i&&i.updatePending(r,a)}}},{key:"recordActionFailureOn",value:function(t,r){t.setSubscriptionState("none"),t.updatePending(null,null),r==="establish"&&this.persisted.delete(t.sid)}},{key:"request",value:function(t,r,a,i){var s=i.map(function(v){return{object_sid:v.sid,object_type:v.type,last_event_id:t==="establish"?v.lastEventId:void 0,index_name:t==="establish"?v.indexName:void 0,query_string:t==="establish"?v.queryString:void 0}}),o=i.filter(function(v){return v.retryCount>0}).length;ot.debug("Attempting '".concat(t,"' request (c:").concat(r,"):"),s);var u={event_protocol_version:4,action:t,correlation_id:r,retried_requests:o,ttl_in_s:-1,requests:s};return a==="ttl"&&(u.reason=a),this.services.network.post(this.services.config.subscriptionsUri,u)}},{key:"add",value:function(t,r){ot.debug("Establishing intent to subscribe to ".concat(t));var a=this.subscriptions.get(t);a&&r&&a.lastEventId===r.lastEventId||(this.persisted.delete(t),this.subscriptions.set(t,new tq(r)),this.persist())}},{key:"remove",value:function(t){ot.debug("Establishing intent to unsubscribe from ".concat(t));var r=this.subscriptions.delete(t);r&&this.persist()}},{key:"acceptMessage",value:function(t,r){ot.trace("Subscriptions received",t);var a=t.event_type,i=typeof t.events<"u"?t.events:[t.event],s=t.correlation_id;s&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(s,new Date().getTime());var o=cs(i),u;try{for(o.s();!(u=o.n()).done;){var v=u.value,g=void 0;switch(t.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(v,s);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(v,s);break;case"subscription_failed":this.applySubscriptionFailedMessage(v,s);break;case(g=a.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:{var m=void 0;switch(g[0]){case"map_":m=v.map_sid;break;case"list_":m=v.list_sid;break;case"document_":m=v.document_sid;break;case"stream_":m=v.stream_sid;break;case"live_query_":m=v.query_id,r=!1,t.strictly_ordered===!0&&(r=!0);break;default:m=void 0}this.applyEventToSubscribedEntity(m,v,a,r);break}default:ot.debug("Dropping unknown message type ".concat(a));break}}}catch(_){o.e(_)}finally{o.f()}}},{key:"applySubscriptionEstablishedMessage",value:function(t,r){var a=t.object_sid,i=this.persisted.get(t.object_sid);i&&i.pendingCorrelationId===r?t.replay_status==="interrupted"?(ot.debug("Event Replay for subscription to ".concat(a," (c:").concat(r,") interrupted; continuing eagerly.")),i.updatePending(null,null),this.persisted.delete(i.sid),this.backoff.reset()):t.replay_status==="completed"&&(ot.debug("Event Replay for subscription to ".concat(a," (c:").concat(r,") completed. Subscription is ready.")),i.complete(t.last_event_id),this.persisted.set(t.object_sid,i),i.setSubscriptionState("established"),this.backoff.reset()):ot.debug("Late message for ".concat(t.object_sid," (c:").concat(r,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(t,r){var a=this.persisted.get(t.object_sid);a&&a.pendingCorrelationId===r?(a.updatePending(null,null),a.setSubscriptionState("none"),this.persisted.delete(t.object_sid)):ot.debug("Late message for ".concat(t.object_sid," (c:").concat(r,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(t,r){var a=t.object_sid,i=this.subscriptions.get(a),s=this.persisted.get(a);i&&s?s.pendingCorrelationId===r&&(ot.error("Failed to subscribe on ".concat(s.sid),t.error),s.markAsFailed(t),s.setSubscriptionState("none")):!i&&s&&(this.persisted.delete(a),s.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(t,r,a,i){var s=this;if(t){i=i||function(){var u=s.persisted.get(t);return u&&u.isEstablished}();var o=this.subscriptions.get(t);o?(r.type=a,o.update(r,i)):ot.debug("Message dropped for SID '".concat(t,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(t){this.isConnected=t,t&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(t){ot.debug("Triggering event replay for all subscriptions, reason=".concat(t)),this.pendingPokeReason=t,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var r=[],a=cs(this.persisted.values()),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;s.reset(),s.rejectedWithError&&r.push(s)}}catch(g){a.e(g)}finally{a.f()}this.persisted.clear();for(var o=0,u=r;o<u.length;o++){var v=u[o];this.persisted.set(v.sid,v)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}(),nq=4e3,aq=6e4,iq=9e4,sq=.2;function Mg(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function Ng(e){return e.body?e.body.code:0}function fs(e){return e.status===409?new G6(Mg(e),e.status,Ng(e),e.body):e.status?new pr(Mg(e),e.status,Ng(e)):e instanceof mo.TransportUnavailableError?e:new pr(e.message,0,0)}var uq=function(){function e(n,t,r){it.default(this,e),this.clientInfo=n,this.config=t,this.transport=r}return ct.default(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+M6.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:nq,max:aq,maxAttemptsTime:iq,randomness:sq},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(t){var r=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return new Promise(function(i,s){var o=[502,503,504];a&&o.push(429);var u=new u0.Retrier(r.backoffConfig());u.on("attempt",function(){t().then(function(v){return u.succeeded(v)}).catch(function(v){if(o.includes(v.status)){var g=parseInt(v.headers?v.headers["Retry-After"]:null);u.failed(fs(v),isNaN(g)?null:g*1e3)}else v.message==="Twilsock disconnected"?u.failed(fs(v)):(u.removeAllListeners(),u.cancel(),s(fs(v)))})}),u.on("succeeded",function(v){i(v)}),u.on("cancelled",function(v){return s(fs(v))}),u.on("failed",function(v){return s(fs(v))}),u.start()})}},{key:"get",value:function(t){var r=this,a=this.createHeaders();return ot.debug("GET",t,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return r.transport.get(t,a,r.config.productId)},!0)}},{key:"post",value:function(t,r,a){var i=this,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=this.createHeaders();return typeof a<"u"&&a!==null&&(o["If-Match"]=a),ot.debug("POST",t,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.post(t,o,r,i.config.productId)},s)}},{key:"put",value:function(t,r,a){var i=this,s=this.createHeaders();return typeof a<"u"&&a!==null&&(s["If-Match"]=a),ot.debug("PUT",t,"ID:",s["Twilio-Request-Id"]),this.executeWithRetry(function(){return i.transport.put(t,s,r,i.config.productId)},!1)}},{key:"delete",value:function(t){var r=this,a=this.createHeaders();return ot.debug("DELETE",t,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry(function(){return r.transport.delete(t,a,r.config.productId)},!1)}}]),e}(),oq=function(){function e(n,t){it.default(this,e),this.config=n,this.storageId=null;try{this.storage=t||sessionStorage}catch(r){}}return ct.default(e,[{key:"storageKey",value:function(t,r){return"".concat(this.storageId,"::").concat(t,"::").concat(r)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(t){this.storageId=t}},{key:"store",value:function(t,r,a){return this.isReady?this._store(this.storageKey(t,r),a):null}},{key:"read",value:function(t,r){return this.isReady?this._read(this.storageKey(t,r)):null}},{key:"remove",value:function(t,r,a){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(t,r)),a&&this.storage.removeItem(this.storageKey(t,a))}catch(i){}}},{key:"update",value:function(t,r,a,i){if(!this.isReady)return null;this._apply(this.storageKey(t,r),i),a&&this._apply(this.storageKey(t,a),i)}},{key:"_store",value:function(t,r){try{this.storage.setItem(t,JSON.stringify(r))}catch(a){}}},{key:"_read",value:function(t){try{var r=this.storage.getItem(t);if(r)return JSON.parse(r)}catch(a){}return null}},{key:"_apply",value:function(t,r){var a=this._read(t);if(!a)return!1;this._store(t,Object.assign(a,r))}}]),e}();function lq(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=cq(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function cq(e,n){if(e){if(typeof e=="string")return Lg(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Lg(e,n)}}function Lg(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var uu=function(){function e(n,t){it.default(this,e),this.services=n,this.removalHandler=t,this.subscriptionState="none",this._attachedListeners=new Map}return ct.default(e,[{key:"_advanceLastEventId",value:function(t,r){}},{key:"reportFailure",value:function(t){t.status===404?this.onRemoved(!1):this.broadcastEventToListeners("failure",t)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(t){this.subscriptionState=t,this.broadcastEventToListeners("_subscriptionStateChanged",t)}},{key:"close",value:function(){this._unsubscribe(),this.removalHandler!=null&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(t){var r=t.listenerUuid,a=this._attachedListeners.get(r);a||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(r,t))}},{key:"detach",value:function(t){this._attachedListeners.delete(t),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(t,r){var a=lq(this._attachedListeners.values()),i;try{for(a.s();!(i=a.n()).done;){var s=i.value;s.emit(t,r)}}catch(o){a.e(o)}finally{a.f()}}}]),e}(),g0=function(){function e(n){it.default(this,e),vt.default(this,"queuedRequests",[]),vt.default(this,"isRequestInFlight",!1),this.inputMergingFunction=n}return ct.default(e,[{key:"add",value:function(t,r){var a=this,i=new Promise(function(s,o){return a.queuedRequests.push({input:t,requestFunction:r,resolve:s,reject:o})});return this.wakeupQueue(),i}},{key:"squashAndAdd",value:function(t,r){var a=this.queuedRequests;this.queuedRequests=[];var i;a.length>0?(i=a.map(function(o){return o.input}).reduce(this.inputMergingFunction),i=this.inputMergingFunction(i,t)):i=t;var s=this.add(i,r);return a.forEach(function(o){return s.then(o.resolve,o.reject)}),s}},{key:"isEmpty",value:function(){return this.queuedRequests.length===0&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var t=this;if(!(this.queuedRequests.length===0||this.isRequestInFlight)){var r=this.queuedRequests.shift();this.isRequestInFlight=!0,r.requestFunction(r.input).then(r.resolve,r.reject).then(function(a){t.isRequestInFlight=!1,t.wakeupQueue()})}}}]),e}(),m0=function(){function e(n){it.default(this,e),vt.default(this,"queueByNamespaceKey",new Map),this.inputReducer=n}return ct.default(e,[{key:"add",value:function(){var n=fe.default(U.default.mark(function r(a,i,s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.invokeQueueMethod(a,function(v){return v.add(i,s)}));case 1:case"end":return u.stop()}},r,this)}));function t(r,a,i){return n.apply(this,arguments)}return t}()},{key:"squashAndAdd",value:function(){var n=fe.default(U.default.mark(function r(a,i,s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.invokeQueueMethod(a,function(v){return v.squashAndAdd(i,s)}));case 1:case"end":return u.stop()}},r,this)}));function t(r,a,i){return n.apply(this,arguments)}return t}()},{key:"invokeQueueMethod",value:function(){var n=fe.default(U.default.mark(function r(a,i){var s,o;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.queueByNamespaceKey.has(a)||this.queueByNamespaceKey.set(a,new g0(this.inputReducer)),s=this.queueByNamespaceKey.get(a),o=i(s),this.queueByNamespaceKey.get(a).isEmpty()&&this.queueByNamespaceKey.delete(a),v.abrupt("return",o);case 5:case"end":return v.stop()}},r,this)}));function t(r,a){return n.apply(this,arguments)}return t}()}]),e}();function fq(e){var n=dq();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function dq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ou=function(e){or.default(t,e);var n=fq(t);function t(){var r;return it.default(this,t),r=n.call(this),r.closed=!1,r.uuid=o0.v4(),r}return ct.default(t,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),t}(ht);function b0(e){var n=vq();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function vq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ff=function(e){or.default(t,e);var n=b0(t);function t(r,a,i){var s;it.default(this,t),s=n.call(this,r,i),vt.default(sn.default(s),"isDeleted",!1);var o=function(v,g){return typeof g.ttl=="number"?{ttl:g.ttl}:v};return s.updateMergingQueue=new g0(o),s.descriptor=a,s.descriptor.data=s.descriptor.data||{},s.descriptor.date_updated=new Date(s.descriptor.date_updated),s}return ct.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(a){switch(a.date_created=new Date(a.date_created),a.type){case"document_updated":if(a.id<=this.lastEventId){ot.trace("Document update skipped, current:",this.lastEventId,", remote:",a.id);break}var i=this.descriptor.data!==void 0?Jr(this.descriptor.data):null;this.descriptor.last_event_id=a.id,this.descriptor.revision=a.document_revision,this.descriptor.date_updated=a.date_created,this.descriptor.data=a.document_data,this.broadcastEventToListeners("updated",{data:a.document_data,isLocal:!1,previousData:i}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:a.id,revision:a.document_revision,date_updated:a.date_created,data:a.document_data});break;case"document_removed":this.onRemoved(!1);break}}},{key:"set",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u=this,v;return U.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return v=o||{},m.abrupt("return",this.updateMergingQueue.squashAndAdd(v,function(_){return u._setUnconditionally(s,_.ttl)}));case 2:case"end":return m.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u=this,v;return U.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return v=o||{},m.abrupt("return",this.updateMergingQueue.add(v,function(_){return u._setWithIfMatch(s,_.ttl)}));case 2:case"end":return m.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",this.mutate(function(g){return Object.assign(g,s)},o));case 1:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){var o;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this._postUpdateToServer({ttl:s});case 2:o=v.sent,this.descriptor.date_expires=o.date_expires;case 4:case"end":return v.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_setUnconditionally",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u;return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this._postUpdateToServer({data:s,revision:void 0,ttl:o});case 2:return u=g.sent,this._handleSuccessfulUpdateResult(u),g.abrupt("return",this.descriptor.data);case 5:case"end":return g.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_setWithIfMatch",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u,v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(u=s(Jr(this.descriptor.data)),!u){_.next=22;break}return v=this.revision,_.prev=3,_.next=6,this._postUpdateToServer({data:u,revision:v,ttl:o});case 6:return g=_.sent,this._handleSuccessfulUpdateResult(g),_.abrupt("return",this.descriptor.data);case 11:if(_.prev=11,_.t0=_.catch(3),_.t0.status!==412){_.next=19;break}return _.next=16,this._softSync();case 16:return _.abrupt("return",this._setWithIfMatch(s));case 19:throw _.t0;case 20:_.next=23;break;case 22:return _.abrupt("return",this.descriptor.data);case 23:case"end":return _.stop()}},i,this,[[3,11]])}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_handleSuccessfulUpdateResult",value:function(a){if(!(a.last_event_id<=this.descriptor.last_event_id)){var i=this.descriptor.data!==void 0?Jr(this.descriptor.data):null;this.descriptor.revision=a.revision,this.descriptor.data=a.data,this.descriptor.last_event_id=a.last_event_id,this.descriptor.date_expires=a.date_expires,this.descriptor.date_updated=new Date(a.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:a.last_event_id,revision:a.revision,date_updated:a.date_updated,data:a.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:i})}}},{key:"_postUpdateToServer",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u,v;return U.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.isDeleted){m.next=17;break}return o={data:s.data},s.ttl!==void 0&&(o.ttl=s.ttl),u=s.revision,m.prev=4,m.next=7,this.services.network.post(this.uri,o,u);case 7:return v=m.sent,m.abrupt("return",{revision:v.body.revision,data:s.data,last_event_id:v.body.last_event_id,date_updated:v.body.date_updated,date_expires:v.body.date_expires});case 11:throw m.prev=11,m.t0=m.catch(4),m.t0.status===404&&this.onRemoved(!1),m.t0;case 15:m.next=18;break;case 17:return m.abrupt("return",Promise.reject(new pr("The Document has been removed",404,54100)));case 18:case"end":return m.stop()}},i,this,[[4,11]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_softSync",value:function(){var r=fe.default(U.default.mark(function i(){var s=this;return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.services.network.get(this.uri).then(function(v){var g={type:"document_updated",id:v.body.last_event_id,document_revision:v.body.revision,document_data:v.body.data,date_created:v.body.date_updated};return s._update(g),s}).catch(function(v){v.status===404?s.onRemoved(!1):ot.error("Can't get updates for ".concat(s.sid,":"),v)}));case 1:case"end":return u.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"onRemoved",value:function(a){if(!this.isDeleted){var i=this.descriptor.data!==void 0?Jr(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a,previousData:i})}}},{key:"removeDocument",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.isDeleted){o.next=6;break}return o.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),o.next=7;break;case 6:return o.abrupt("return",Promise.reject(new pr("The Document has been removed",404,54100)));case 7:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()}],[{key:"type",get:function(){return"document"}}]),t}(uu),Mr=function(e){or.default(t,e);var n=b0(t);function t(r){var a;return it.default(this,t),a=n.call(this),a.syncDocumentImpl=r,a.syncDocumentImpl.attach(sn.default(a)),a}return ct.default(t,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return Ff.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.ensureNotClosed(),v.abrupt("return",this.syncDocumentImpl.set(s,o));case 2:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.ensureNotClosed(),v.abrupt("return",this.syncDocumentImpl.mutate(s,o));case 2:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.ensureNotClosed(),v.abrupt("return",this.syncDocumentImpl.update(s,o));case 2:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncDocumentImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"removeDocument",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){iu.default(Nt.default(t.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Ff.type}}]),t}(ou);vt.default(Mr,"removed","removed");vt.default(Mr,"updated","updated");st([ie.validateTypesAsync(ie.pureObject,["undefined",ie.objectSchema("document metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object,Object]),oe("design:returntype",Promise)],Mr.prototype,"set",null);st([ie.validateTypesAsync("function",["undefined",ie.objectSchema("document metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Function,Object]),oe("design:returntype",Promise)],Mr.prototype,"mutate",null);st([ie.validateTypesAsync(ie.pureObject,["undefined",ie.objectSchema("document metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object,Object]),oe("design:returntype",Promise)],Mr.prototype,"update",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],Mr.prototype,"setTtl",null);var Bf=function(){function e(n){it.default(this,e),this.descriptor=n}return ct.default(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(t,r,a,i){return this.descriptor.lastEventId=t,this.descriptor.revision=r,this.descriptor.data=a,this.descriptor.dateUpdated=i,this}},{key:"updateDateExpires",value:function(t){this.descriptor.dateExpires=t}}]),e}(),Cv=function(){function e(n,t,r,a){it.default(this,e),this.prevToken=r,this.nextToken=a,this.items=n,this.source=t}return ct.default(e,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:function(){var n=fe.default(U.default.mark(function r(){return U.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.hasNextPage){i.next=2;break}throw new Error("No next page");case 2:return i.abrupt("return",this.source(this.nextToken));case 3:case"end":return i.stop()}},r,this)}));function t(){return n.apply(this,arguments)}return t}()},{key:"prevPage",value:function(){var n=fe.default(U.default.mark(function r(){return U.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.hasPrevPage){i.next=2;break}throw new Error("No previous page");case 2:return i.abrupt("return",this.source(this.prevToken));case 3:case"end":return i.stop()}},r,this)}));function t(){return n.apply(this,arguments)}return t}()}]),e}();function pq(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hq(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function hq(e,n){if(e){if(typeof e=="string")return xg(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xg(e,n)}}function xg(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var yq=function(){function e(n,t){it.default(this,e),this.balanceFactor=0,this.key=n,this.value=t,this.parent=null,this.left=null,this.right=null}return ct.default(e,[{key:"isRoot",get:function(){return this.parent===null}},{key:"isLeaf",get:function(){return this.left===null&&this.right===null}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(t){this.value=t}},{key:"replace",value:function(t,r){t&&(this.left===r?this.left=r:this.right===r&&(this.right=r))}}]),e}(),gq=function(){function e(n,t){it.default(this,e),this.isLessThan=n||function(r,a){return r<a},this.isEqual=t||function(r,a){return r===a},this.root=null,this.count=null}return ct.default(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(t,r){var a=this.getNode(t);a?a.update(r):this.insert(t,r)}},{key:"insert",value:function(t,r){var a=new yq(t,r);if(this.count++,!this.root){this.root=a;return}for(var i=this.root;;)if(this.isLessThan(t,i.key))if(i.left)i=i.left;else{i.left=a;break}else if(i.right)i=i.right;else{i.right=a;break}for(a.parent=i,i=a;i.parent;){var s=i.parent,o=s.balanceFactor;if(i.isLeftChild?s.balanceFactor++:s.balanceFactor--,Math.abs(s.balanceFactor)<Math.abs(o))break;if(s.balanceFactor<-1||s.balanceFactor>1){this.rebalance(s);break}i=s}}},{key:"get",value:function(t){for(var r=this.root;r;){if(this.isEqual(t,r.key))return r.value;this.isLessThan(t,r.key)?r=r.left:r=r.right}return null}},{key:"delete",value:function(t){var r=this.getNode(t);if(!r||r.key!==t)return null;var a=r.parent,i=r.left,s=r.right;if(!!i!=!!s){var o=i||s;!a&&!o?this.root=null:a&&!o?this.root=o:(a.replace(r,null),this.rebalance(a))}else{for(var u=r.left;u.right;)u=u.right;if(r.left===u)r.isRoot?(this.root=u,u.parent=null):(r.isLeftChild?r.parent.left=u:r.parent.right=u,u.parent=r.parent),u.right=r.right,u.right.parent=u,u.balanceFactor=r.balanceFactor,r={parent:u,isLeftChild:!0};else{var v=u.parent,g=u.left;v.right=g,g&&(g.parent=v),r.isRoot?(this.root=u,u.parent=null):(r.isLeftChild?r.parent.left=u:r.parent.right=u,u.parent=r.parent),u.right=r.right,u.right.parent=u,u.left=r.left,u.left.parent=u,u.balanceFactor=r.balanceFactor,r={parent:v,isLeftChild:!1}}}for(this.count--;r.parent;){var m=r.parent,_=m.balanceFactor;if(r.isLeftChild?m.balanceFactor-=1:m.balanceFactor+=1,Math.abs(m.balanceFactor)>Math.abs(_))if(m.balanceFactor<-1||m.balanceFactor>1)if(this.rebalance(m),m.parent.balanceFactor===0)r=m.parent;else break;else break;else r=m}return null}},{key:"getNode",value:function(t){for(var r=this.root;r;){if(this.isEqual(t,r.key))return r;this.isLessThan(t,r.key)?r=r.left:r=r.right}return null}},{key:"rebalance",value:function(t){t.balanceFactor<0?t.right.balanceFactor>0?(this.rotateRight(t.right),this.rotateLeft(t)):this.rotateLeft(t):t.balanceFactor>0&&(t.left.balanceFactor<0?(this.rotateLeft(t.left),this.rotateRight(t)):this.rotateRight(t))}},{key:"rotateLeft",value:function(t){var r=t.right;t.right=r.left,r.left!==null&&(r.left.parent=t),r.parent=t.parent,r.parent===null?this.root=r:t.isLeftChild?r.parent.left=r:r.parent.right=r,r.left=t,t.parent=r,t.balanceFactor=t.balanceFactor+1-Math.min(r.balanceFactor,0),r.balanceFactor=r.balanceFactor+1-Math.max(t.balanceFactor,0)}},{key:"rotateRight",value:function(t){var r=t.left;t.left=r.right,r.right!==null&&(r.right.parent=t),r.parent=t.parent,r.parent===null?this.root=r:t.isLeftChild?r.parent.left=r:r.parent.right=r,r.right=t,t.parent=r,t.balanceFactor=t.balanceFactor-1-Math.min(r.balanceFactor,0),r.balanceFactor=r.balanceFactor-1-Math.max(t.balanceFactor,0)}},{key:Symbol.iterator,value:U.default.mark(function n(){var t,r,a;return U.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:t=pq(this.getIterator()),s.prev=1,t.s();case 3:if((r=t.n()).done){s.next=9;break}return a=r.value,s.next=7,a;case 7:s.next=3;break;case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(1),t.e(s.t0);case 14:return s.prev=14,t.f(),s.finish(14);case 17:case"end":return s.stop()}},n,this,[[1,11,14,17]])})},{key:"getIterator",value:U.default.mark(function n(){var t,r,a,i=arguments;return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=i.length>0&&i[0]!==void 0?i[0]:null,r=this.root;case 2:if(!r){o.next=8;break}if(!(this.isEqual(t,r.key)||t===null&&!r.left)){o.next=5;break}return o.abrupt("break",8);case 5:this.isLessThan(t,r.key)||t===null?r=r.left:r=r.right,o.next=2;break;case 8:if(r){o.next=10;break}return o.abrupt("return",null);case 10:a=!0;case 11:if(!a){o.next=29;break}return o.next=14,[r.key,r.value];case 14:if(a=!1,!r.right){o.next=21;break}for(r=r.right;r.left;)r=r.left;a=!0,o.next=27;break;case 21:if(!r.parent){o.next=26;break}a=r.parent.left===r,r=r.parent,o.next=27;break;case 26:return o.abrupt("break",37);case 27:o.next=35;break;case 29:if(!r.parent){o.next=34;break}a=r.parent.left===r,r=r.parent,o.next=35;break;case 34:return o.abrupt("break",37);case 35:o.next=11;break;case 37:return o.abrupt("return",null);case 38:case"end":return o.stop()}},n,this)})},{key:"getReverseIterator",value:U.default.mark(function n(){var t,r,a,i=arguments;return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=i.length>0&&i[0]!==void 0?i[0]:null,r=this.root;case 2:if(!r){o.next=8;break}if(!(this.isEqual(t,r.key)||t===null&&!r.right)){o.next=5;break}return o.abrupt("break",8);case 5:!this.isLessThan(t,r.key)||t===null?r=r.right:r=r.left,o.next=2;break;case 8:if(r){o.next=10;break}return o.abrupt("return",null);case 10:a=!0;case 11:if(!a){o.next=29;break}return o.next=14,[r.key,r.value];case 14:if(a=!1,!r.left){o.next=21;break}for(r=r.left;r.right;)r=r.right;a=!0,o.next=27;break;case 21:if(!r.parent){o.next=26;break}a=r.parent.right===r,r=r.parent,o.next=27;break;case 26:return o.abrupt("break",37);case 27:o.next=35;break;case 29:if(!r.parent){o.next=34;break}a=r.parent.right===r,r=r.parent,o.next=35;break;case 34:return o.abrupt("break",37);case 35:o.next=11;break;case 37:return o.abrupt("return",null);case 38:case"end":return o.stop()}},n,this)})}]),e}();function mq(e,n){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=bq(e))||n){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(v){throw v},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=!0,s=!1,o;return{s:function(){t=t.call(e)},n:function(){var v=t.next();return i=v.done,v},e:function(v){s=!0,o=v},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw o}}}}function bq(e,n){if(e){if(typeof e=="string")return jg(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jg(e,n)}}function jg(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var wq=function(){function e(n,t){it.default(this,e),this.value=n,this.revision=t||0}return ct.default(e,[{key:"isValid",get:function(){return!0}}]),e}(),_q=function(){function e(n){it.default(this,e),this.revision=n}return ct.default(e,[{key:"isValid",get:function(){return!1}}]),e}(),Ov=function(){function e(){it.default(this,e),this.items=new gq}return ct.default(e,[{key:"store",value:function(t,r,a){var i=this.items.get(t);return i&&i.revision>a?i.isValid?i.value:null:(this.items.set(t,new wq(r,a)),r)}},{key:"delete",value:function(t,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.items.get(t);(!i||i.revision<r||i&&a===!0)&&this.items.set(t,new _q(r))}},{key:"isKnown",value:function(t,r){var a=this.items.get(t);return a&&a.revision>=r}},{key:"get",value:function(t){var r=this.items.get(t);return r&&r.isValid?r.value:null}},{key:"has",value:function(t){var r=this.items.get(t);return r&&r.isValid}},{key:"forEach",value:function(t){if(this.items){var r=mq(this.items),a;try{for(r.s();!(a=r.n()).done;){var i=c0.default(a.value,2),s=i[0],o=i[1];o.isValid&&t(s,o.value)}}catch(u){r.e(u)}finally{r.f()}}}}]),e}();function w0(e){var n=Sq();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function Sq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qf=function(e){or.default(t,e);var n=w0(t);function t(r,a,i){var s;it.default(this,t),s=n.call(this,r,i);var o=function(v,g){return typeof g.ttl=="number"?{ttl:g.ttl}:v};return s.updateMergingQueue=new m0(o),s.cache=new Ov,s.descriptor=a,s.descriptor.date_updated=new Date(s.descriptor.date_updated),s}return ct.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:function(){var r=fe.default(U.default.mark(function i(s,o,u,v){var g,m;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return g={data:o},v!==void 0&&(g.ttl=v),w.next=4,this.services.network.post(s,g,u);case 4:return m=w.sent,m.body.data=o,m.body.date_updated=new Date(m.body.date_updated),w.abrupt("return",m.body);case 8:case"end":return w.stop()}},i,this)}));function a(i,s,o,u){return r.apply(this,arguments)}return a}()},{key:"push",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u,v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return u=(o||{}).ttl,_.next=3,this._addOrUpdateItemOnServer(this.links.items,s,void 0,u);case 3:return v=_.sent,g=Number(v.index),this._handleItemMutated(g,v.url,v.last_event_id,v.revision,s,v.date_updated,v.date_expires,!0,!1),_.abrupt("return",this.cache.get(g));case 7:case"end":return _.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"set",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v=this,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return g=u||{},_.abrupt("return",this.updateMergingQueue.squashAndAdd(s,g,function(w){return v._updateItemUnconditionally(s,o,w.ttl)}));case 2:case"end":return _.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_updateItemUnconditionally",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this.get(s);case 2:return v=_.sent,_.next=5,this._addOrUpdateItemOnServer(v.uri,o,void 0,u);case 5:return g=_.sent,this._handleItemMutated(s,g.url,g.last_event_id,g.revision,g.data,g.date_updated,g.date_expires,!1,!1),_.abrupt("return",this.cache.get(s));case 8:case"end":return _.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_updateItemWithIfMatch",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v,g,m,_;return U.default.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,this.get(s);case 2:if(v=R.sent,g=o(Jr(v.data)),!g){R.next=25;break}return m=v.revision,R.prev=6,R.next=9,this._addOrUpdateItemOnServer(v.uri,g,m,u);case 9:return _=R.sent,this._handleItemMutated(s,_.url,_.last_event_id,_.revision,_.data,_.date_updated,_.date_expires,!1,!1),R.abrupt("return",this.cache.get(s));case 14:if(R.prev=14,R.t0=R.catch(6),R.t0.status!==412){R.next=22;break}return R.next=19,this._getItemFromServer(s);case 19:return R.abrupt("return",this._updateItemWithIfMatch(s,o,u));case 22:throw R.t0;case 23:R.next=26;break;case 25:return R.abrupt("return",v);case 26:case"end":return R.stop()}},i,this,[[6,14]])}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v=this,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return g=u||{},_.abrupt("return",this.updateMergingQueue.add(s,g,function(w){return v._updateItemWithIfMatch(s,o,w.ttl)}));case 2:case"end":return _.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",this.mutate(s,function(m){return Object.assign(m,o)},u));case 1:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u,v;return U.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.get(s);case 2:return o=m.sent,u=Jr(o.data),m.next=6,this.services.network.delete(o.uri);case 6:v=m.sent,this._handleItemRemoved(s,v.body.last_event_id,u,new Date(v.body.date_updated),!1);case 8:case"end":return m.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=fe.default(U.default.mark(function i(s){var o;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=this.cache.get(s),!o){v.next=5;break}return v.abrupt("return",o);case 5:return v.abrupt("return",this._getItemFromServer(s));case 6:case"end":return v.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_getItemFromServer",value:function(){var r=fe.default(U.default.mark(function i(s){var o;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.queryItems({index:s});case 2:if(o=v.sent,!(o.items.length<1)){v.next=7;break}throw new pr("No item with index ".concat(s," found"),404,54151);case 7:return v.abrupt("return",o.items[0]);case 8:case"end":return v.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"queryItems",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u,v,g,m;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=s||{},u=new Ii(this.links.items).queryParam("From",s.from).queryParam("PageSize",s.limit).queryParam("Index",s.index).queryParam("PageToken",s.pageToken).queryParam("Order",s.order).build(),w.next=4,this.services.network.get(u);case 4:return v=w.sent,g=v.body.items.map(function(R){R.date_updated=new Date(R.date_updated);var M=o.cache.get(R.index);return M?o._handleItemMutated(R.index,R.url,R.last_event_id,R.revision,R.data,R.date_updated,R.date_expires,!1,!0):o.cache.store(Number(R.index),new Bf({index:Number(R.index),uri:R.url,revision:R.revision,lastEventId:R.last_event_id,dateUpdated:R.date_updated,dateExpires:R.date_expires,data:R.data}),R.last_event_id),o.cache.get(R.index)}),m=v.body.meta,w.abrupt("return",new Cv(g,function(R){return o.queryItems({pageToken:R})},m.previous_token,m.next_token));case 8:case"end":return w.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=s||{},y0(s.pageSize),s.limit=s.pageSize||s.limit||50,s.order=s.order||"asc",u.abrupt("return",this.queryItems(s));case 5:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getContext",value:function(){var r=fe.default(U.default.mark(function i(){var s;return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.context){u.next=5;break}return u.next=3,this.services.network.get(this.links.context);case 3:s=u.sent,this._updateContextIfRequired(s.body.data,s.body.last_event_id);case 5:return u.abrupt("return",this.context);case 6:case"end":return u.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u;return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,o={ttl:s},g.next=4,this.services.network.post(this.uri,o);case 4:u=g.sent,this.descriptor.date_expires=u.body.date_expires,g.next=12;break;case 8:throw g.prev=8,g.t0=g.catch(0),g.t0.status===404&&this.onRemoved(!1),g.t0;case 12:case"end":return g.stop()}},i,this,[[0,8]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u,v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this.get(s);case 2:return u=_.sent,v={ttl:o},_.next=6,this.services.network.post(u.uri,v);case 6:g=_.sent,u.updateDateExpires(g.body.date_expires);case 8:case"end":return _.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeList",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}},{key:"shouldIgnoreEvent",value:function(a,i){return this.cache.isKnown(a,i)}},{key:"_update",value:function(a,i){var s=Number(a.item_index);switch(a.date_created=new Date(a.date_created),a.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(s,a.item_url,a.id,a.item_revision,a.item_data,a.date_created,void 0,a.type==="list_item_added",!0);break;case"list_item_removed":this._handleItemRemoved(s,a.id,a.item_data,a.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(a.context_data,a.id,a.date_created);break;case"list_removed":this.onRemoved(!1);break}i&&this._advanceLastEventId(a.id,a.list_revision)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a,i&&(this.descriptor.revision=i))}},{key:"_updateRootDateUpdated",value:function(a){(!this.descriptor.date_updated||a.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=a,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:a}))}},{key:"_handleItemMutated",value:function(a,i,s,o,u,v,g,m,_){if(this.shouldIgnoreEvent(a,s)){ot.trace("Item ".concat(a," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(s));return}this._updateRootDateUpdated(v);var w=this.cache.get(a);if(!w){var R=new Bf({index:a,uri:i,lastEventId:s,revision:o,data:u,dateUpdated:v,dateExpires:g});this.cache.store(a,R,s),this.emitItemMutationEvent(R,_,m);return}var M=Jr(w.data);w.update(s,o,u,v),this.cache.store(a,w,s),g!==void 0&&w.updateDateExpires(g),this.emitItemMutationEvent(w,_,!1,M)}},{key:"emitItemMutationEvent",value:function(a,i,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=s?"itemAdded":"itemUpdated",v={item:a,isLocal:!i};s||(v.previousItemData=o),this.broadcastEventToListeners(u,v)}},{key:"_handleItemRemoved",value:function(a,i,s,o,u){this._updateRootDateUpdated(o),this.cache.delete(a,i),this.broadcastEventToListeners("itemRemoved",{index:a,isLocal:!u,previousItemData:s})}},{key:"_handleContextUpdate",value:function(a,i,s){this._updateRootDateUpdated(s),this._updateContextIfRequired(a,i)&&this.broadcastEventToListeners("contextUpdated",{context:a,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(a,i){return!this.contextEventId||i>this.contextEventId?(this.context=a,this.contextEventId=i,!0):(ot.trace("Context update skipped, current:",this.lastEventId,", remote:",i),!1)}}],[{key:"type",get:function(){return"list"}}]),t}(uu),jt=function(e){or.default(t,e);var n=w0(t);function t(r){var a;return it.default(this,t),a=n.call(this),a.syncListImpl=r,a.syncListImpl.attach(sn.default(a)),a}return ct.default(t,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return qf.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.ensureNotClosed(),v.abrupt("return",this.syncListImpl.push(s,o));case 2:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"set",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncListImpl.set(s,o,u));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncListImpl.mutate(s,o,u));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncListImpl.update(s,o,u));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.remove(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.get(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getContext",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.getItems(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncListImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.ensureNotClosed(),v.abrupt("return",this.syncListImpl.setItemTtl(s,o));case 2:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeList",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){iu.default(Nt.default(t.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return qf.type}}]),t}(ou);vt.default(jt,"itemAdded","itemAdded");vt.default(jt,"itemUpdated","itemUpdated");vt.default(jt,"itemRemoved","itemRemoved");vt.default(jt,"removed","removed");st([ie.validateTypesAsync(ie.pureObject,["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object,Object]),oe("design:returntype",Promise)],jt.prototype,"push",null);st([ie.validateTypesAsync(ie.nonNegativeInteger,ie.pureObject,["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Number,Object,Object]),oe("design:returntype",Promise)],jt.prototype,"set",null);st([ie.validateTypesAsync(ie.nonNegativeInteger,"function",["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Number,Function,Object]),oe("design:returntype",Promise)],jt.prototype,"mutate",null);st([ie.validateTypesAsync(ie.nonNegativeInteger,ie.pureObject,["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Number,Object,Object]),oe("design:returntype",Promise)],jt.prototype,"update",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],jt.prototype,"remove",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],jt.prototype,"get",null);st([ie.validateTypesAsync(["undefined",ie.objectSchema("query options",{from:[ie.nonNegativeInteger,"undefined"],pageSize:[ie.custom(function(e){return[Rv(e),"a positive integer"]}),"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],jt.prototype,"getItems",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],jt.prototype,"setTtl",null);st([ie.validateTypesAsync(ie.nonNegativeInteger,ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number,Number]),oe("design:returntype",Promise)],jt.prototype,"setItemTtl",null);var ys=function(){function e(n){it.default(this,e),this.descriptor=n}return ct.default(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(t,r,a,i){return this.descriptor.last_event_id=t,this.descriptor.revision=r,this.descriptor.data=a,this.descriptor.date_updated=i,this}},{key:"updateDateExpires",value:function(t){this.descriptor.date_expires=t}}]),e}();function _0(e){var n=$q();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function $q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wf=function(e){or.default(t,e);var n=_0(t);function t(r,a,i){var s;it.default(this,t),s=n.call(this,r,i);var o=function(v,g){return typeof g.ttl=="number"?{ttl:g.ttl}:v};return s.updateMergingQueue=new m0(o),s.cache=new Ov,s.descriptor=a,s.descriptor.date_updated=new Date(s.descriptor.date_updated),a.items&&a.items.forEach(function(u){u.date_updated=new Date(u.date_updated),s.cache.store(u.key,new ys(u),u.last_event_id)}),s}return ct.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v=this,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return g=u||{},_.abrupt("return",this.updateMergingQueue.squashAndAdd(s,g,function(w){return v._putItemUnconditionally(s,o,w.ttl)}));case 2:case"end":return _.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(s!=null){u.next=2;break}throw new pr("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(s)){u.next=6;break}return u.abrupt("return",this.cache.get(s));case 6:return u.abrupt("return",this._getItemFromServer(s));case 7:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_getItemFromServer",value:function(){var r=fe.default(U.default.mark(function i(s){var o;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,this.queryItems({key:s});case 2:if(o=v.sent,!(o.items.length<1)){v.next=7;break}throw new pr("The specified Map Item does not exist",404,54201);case 7:return v.abrupt("return",o.items[0]);case 8:case"end":return v.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v=this,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return g=u||{},_.abrupt("return",this.updateMergingQueue.add(s,g,function(w){return v._putItemWithIfMatch(s,o,w.ttl)}));case 2:case"end":return _.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",this.mutate(s,function(m){return Object.assign(m,o)},u));case 1:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_putItemUnconditionally",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this._putItemToServer(s,o,void 0,u);case 2:return v=_.sent,g=v.item,this._handleItemMutated(g.key,g.url,g.last_event_id,g.revision,g.data,g.date_updated,g.date_expires,v.added,!1),_.abrupt("return",this.cache.get(g.key));case 6:case"end":return _.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_putItemWithIfMatch",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){var v,g,m,_,w;return U.default.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.get(s).catch(function(x){if(x.status===404)return new ys({key:s,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw x});case 2:if(v=M.sent,g=o(Jr(v.data)),!g){M.next=26;break}return m=v.revision,M.prev=6,M.next=9,this._putItemToServer(s,g,m,u);case 9:return _=M.sent,w=_.item,this._handleItemMutated(w.key,w.url,w.last_event_id,w.revision,w.data,w.date_updated,w.date_expires,_.added,!1),M.abrupt("return",this.cache.get(w.key));case 15:if(M.prev=15,M.t0=M.catch(6),M.t0.status!==412){M.next=23;break}return M.next=20,this._getItemFromServer(s);case 20:return M.abrupt("return",this._putItemWithIfMatch(s,o,u));case 23:throw M.t0;case 24:M.next=27;break;case 26:return M.abrupt("return",v);case 27:case"end":return M.stop()}},i,this,[[6,15]])}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"_putItemToServer",value:function(){var r=fe.default(U.default.mark(function i(s,o,u,v){var g,m,_,w,R;return U.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return g=new Ii(this.links.items).pathSegment(s).build(),m={data:o},v!==void 0&&(m.ttl=v),x.prev=3,x.next=6,this.services.network.put(g,m,u);case 6:return _=x.sent,w=_.body,w.data=o,w.date_updated=new Date(w.date_updated),R=_.status.code===201,x.abrupt("return",{added:R,item:w});case 14:throw x.prev=14,x.t0=x.catch(3),x.t0.status===404&&this.onRemoved(!1),x.t0;case 18:case"end":return x.stop()}},i,this,[[3,14]])}));function a(i,s,o,u){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u,v;return U.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.get(s);case 2:return o=m.sent,u=Jr(o.data),m.next=6,this.services.network.delete(o.uri);case 6:v=m.sent,this._handleItemRemoved(s,v.body.last_event_id,u,new Date(v.body.date_updated),!1);case 8:case"end":return m.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"queryItems",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u,v,g,m;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return s=s||{},u=new Ii(this.links.items).queryParam("From",s.from).queryParam("PageSize",s.limit).queryParam("Key",s.key).queryParam("PageToken",s.pageToken).queryParam("Order",s.order).build(),w.next=4,this.services.network.get(u);case 4:return v=w.sent,g=v.body.items.map(function(R){R.date_updated=new Date(R.date_updated);var M=o.cache.get(R.key);return M?o._handleItemMutated(R.key,R.url,R.last_event_id,R.revision,R.data,R.date_updated,R.date_expires,!1,!0):o.cache.store(R.key,new ys(R),R.last_event_id),o.cache.get(R.key)}),m=v.body.meta,w.abrupt("return",new Cv(g,function(R){return o.queryItems({pageToken:R})},m.previous_token,m.next_token));case 8:case"end":return w.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=s||{},y0(s.pageSize),s.limit=s.pageSize||s.limit||50,s.order=s.order||"asc",u.abrupt("return",this.queryItems(s));case 5:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"shouldIgnoreEvent",value:function(a,i){return this.cache.isKnown(a,i)}},{key:"_update",value:function(a,i){switch(a.date_created=new Date(a.date_created),a.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(a.item_key,a.item_url,a.id,a.item_revision,a.item_data,a.date_created,void 0,a.type==="map_item_added",!0);break;case"map_item_removed":this._handleItemRemoved(a.item_key,a.id,a.item_data,a.date_created,!0);break;case"map_removed":this.onRemoved(!1);break}i&&this._advanceLastEventId(a.id,a.map_revision)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a,i&&(this.descriptor.revision=i))}},{key:"_updateRootDateUpdated",value:function(a){(!this.descriptor.date_updated||a.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=a,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:a}))}},{key:"_handleItemMutated",value:function(a,i,s,o,u,v,g,m,_){if(this.shouldIgnoreEvent(a,s)){ot.trace("SyncMapItem ",a," update skipped, current:",this.lastEventId,", remote:",s);return}this._updateRootDateUpdated(v);var w=this.cache.get(a);if(!w){var R=new ys({key:a,url:i,last_event_id:s,revision:o,data:u,date_updated:v,date_expires:g});this.cache.store(a,R,s),this.emitItemMutationEvent(R,_,m);return}var M=Jr(w.data);w.update(s,o,u,v),this.cache.store(a,w,s),g!==void 0&&w.updateDateExpires(g),this.emitItemMutationEvent(w,_,!1,M)}},{key:"emitItemMutationEvent",value:function(a,i,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,u=s?"itemAdded":"itemUpdated",v={item:a,isLocal:!i};s||(v.previousItemData=o),this.broadcastEventToListeners(u,v)}},{key:"_handleItemRemoved",value:function(a,i,s,o,u){this._updateRootDateUpdated(o),this.cache.delete(a,i),this.broadcastEventToListeners("itemRemoved",{key:a,isLocal:!u,previousItemData:s})}},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u;return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,o={ttl:s},g.next=4,this.services.network.post(this.uri,o);case 4:u=g.sent,this.descriptor.date_expires=u.body.date_expires,g.next=12;break;case 8:throw g.prev=8,g.t0=g.catch(0),g.t0.status===404&&this.onRemoved(!1),g.t0;case 12:case"end":return g.stop()}},i,this,[[0,8]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u,v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,this.get(s);case 2:return u=_.sent,v={ttl:o},_.next=6,this.services.network.post(u.uri,v);case 6:g=_.sent,u.updateDateExpires(g.body.date_expires);case 8:case"end":return _.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeMap",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()}],[{key:"type",get:function(){return"map"}}]),t}(uu),Ft=function(e){or.default(t,e);var n=_0(t);function t(r){var a;return it.default(this,t),a=n.call(this),a.syncMapImpl=r,a.syncMapImpl.attach(sn.default(a)),a}return ct.default(t,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return Wf.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncMapImpl.set(s,o,u));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"get",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.get(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"mutate",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncMapImpl.mutate(s,o,u));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"update",value:function(){var r=fe.default(U.default.mark(function i(s,o,u){return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.ensureNotClosed(),g.abrupt("return",this.syncMapImpl.update(s,o,u));case 2:case"end":return g.stop()}},i,this)}));function a(i,s,o){return r.apply(this,arguments)}return a}()},{key:"remove",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.remove(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.getItems(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncMapImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setItemTtl",value:function(){var r=fe.default(U.default.mark(function i(s,o){return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.ensureNotClosed(),v.abrupt("return",this.syncMapImpl.setItemTtl(s,o));case 2:case"end":return v.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"removeMap",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.next=3,this.syncMapImpl.removeMap();case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){iu.default(Nt.default(t.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Wf.type}}]),t}(ou);vt.default(Ft,"itemAdded","itemAdded");vt.default(Ft,"itemUpdated","itemUpdated");vt.default(Ft,"itemRemoved","itemRemoved");vt.default(Ft,"removed","removed");st([ie.validateTypesAsync("string",ie.pureObject,["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[String,Object,Object]),oe("design:returntype",Promise)],Ft.prototype,"set",null);st([ie.validateTypesAsync("string"),oe("design:type",Function),oe("design:paramtypes",[String]),oe("design:returntype",Promise)],Ft.prototype,"get",null);st([ie.validateTypesAsync("string","function",["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[String,Function,Object]),oe("design:returntype",Promise)],Ft.prototype,"mutate",null);st([ie.validateTypesAsync("string",ie.pureObject,["undefined",ie.objectSchema("item metadata",{ttl:[ie.nonNegativeInteger,"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[String,Object,Object]),oe("design:returntype",Promise)],Ft.prototype,"update",null);st([ie.validateTypesAsync("string"),oe("design:type",Function),oe("design:paramtypes",[String]),oe("design:returntype",Promise)],Ft.prototype,"remove",null);st([ie.validateTypesAsync(["undefined",ie.objectSchema("query options",{from:["string","undefined"],pageSize:[ie.custom(function(e){return[Rv(e),"a positive integer"]}),"undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],Ft.prototype,"getItems",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],Ft.prototype,"setTtl",null);st([ie.validateTypesAsync("string",ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[String,Number]),oe("design:returntype",Promise)],Ft.prototype,"setItemTtl",null);function S0(e){var n=Tq();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function Tq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ms=function(e){or.default(t,e);var n=S0(t);function t(r,a,i){var s;return it.default(this,t),s=n.call(this,r,i),s.descriptor=a,s}return ct.default(t,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u,v,g;return U.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return o={data:s},_.next=3,this.services.network.post(this.links.messages,o);case 3:return u=_.sent,v=u.body,g=this._handleMessagePublished(v.sid,s,!1),_.abrupt("return",g);case 7:case"end":return _.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u;return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,o={ttl:s},g.next=4,this.services.network.post(this.uri,o);case 4:u=g.sent,this.descriptor.date_expires=u.body.date_expires,g.next=12;break;case 8:throw g.prev=8,g.t0=g.catch(0),g.t0.status===404&&this.onRemoved(!1),g.t0;case 12:case"end":return g.stop()}},i,this,[[0,8]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"removeStream",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"_update",value:function(a){switch(a.type){case"stream_message_published":{this._handleMessagePublished(a.message_sid,a.message_data,!0);break}case"stream_removed":{this.onRemoved(!1);break}}}},{key:"_handleMessagePublished",value:function(a,i,s){var o={sid:a,data:i};return this.broadcastEventToListeners("messagePublished",{message:o,isLocal:!s}),o}},{key:"onRemoved",value:function(a){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:a})}}],[{key:"type",get:function(){return"stream"}}]),t}(uu);st([ie.validateTypesAsync(ie.pureObject),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],Ms.prototype,"publishMessage",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],Ms.prototype,"setTtl",null);var nn=function(e){or.default(t,e);var n=S0(t);function t(r){var a;return it.default(this,t),a=n.call(this),a.syncStreamImpl=r,a.syncStreamImpl.attach(sn.default(a)),a}return ct.default(t,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return Ms.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncStreamImpl.publishMessage(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"setTtl",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.ensureNotClosed(),u.abrupt("return",this.syncStreamImpl.setTtl(s));case 2:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"removeStream",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.ensureNotClosed(),o.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"close",value:function(){iu.default(Nt.default(t.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return Ms.type}}]),t}(ou);vt.default(nn,"messagePublished","messagePublished");vt.default(nn,"removed","removed");st([ie.validateTypesAsync(ie.pureObject),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],nn.prototype,"publishMessage",null);st([ie.validateTypesAsync(ie.nonNegativeInteger),oe("design:type",Function),oe("design:paramtypes",[Number]),oe("design:returntype",Promise)],nn.prototype,"setTtl",null);var kq=function e(n){it.default(this,e),this.sdk="js",this.sdkVer=n,this.os=Fu.os.family,this.osVer=Fu.os.version,this.pl=Fu.name,this.plVer=Fu.version},Iq=function(){function e(){it.default(this,e),this.names=new Map,this.entities=new Map}return ct.default(e,[{key:"store",value:function(t){var r=this.entities.get(t.sid);return r||(this.entities.set(t.sid,t),t.uniqueName&&this.names.set(t.type+"::"+t.uniqueName,t.sid),t)}},{key:"getResolved",value:function(t,r){var a=this.names.get(r+"::"+t);return a?this.entities.get(a):null}},{key:"get",value:function(t,r){return this.entities.get(t)||this.getResolved(t,r)||null}},{key:"remove",value:function(t){var r=this.entities.get(t);r&&(this.entities.delete(t),r.uniqueName&&this.names.delete(r.type+"::"+r.uniqueName))}}]),e}();function Av(e){var n=Eq();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function Eq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rq=function e(){it.default(this,e)},Gf=function(e){or.default(t,e);var n=Av(t);function t(r,a,i,s){var o;return it.default(this,t),o=n.call(this,a,i),o.descriptor=r,o.cache=new Ov,s&&s.forEach(function(u){o.cache.store(u.key,{key:u.key,value:u.data},u.revision)}),o}return ct.default(t,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return t.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var a={};return this.cache.forEach(function(i,s){a[i]=s.value}),a}},{key:"_update",value:function(a,i){switch(a.type){case"live_query_item_updated":this.handleItemMutated(a.item_key,a.item_data,a.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(a.item_key,a.item_revision);break;case"live_query_updated":this.handleBatchUpdate(a.items);break}i&&this._advanceLastEventId(a.last_event_id)}},{key:"handleItemMutated",value:function(a,i,s){if(this.shouldIgnoreEvent(a,s))ot.trace("Item ".concat(a," update skipped, revision: ").concat(s));else{var o={key:a,value:i};this.cache.store(a,o,s),this.broadcastEventToListeners("itemUpdated",o)}}},{key:"handleItemRemoved",value:function(a,i){var s=i===null;this.shouldIgnoreEvent(a,i)?ot.trace("Item ".concat(a," delete skipped, revision: ").concat(i)):(this.cache.delete(a,i,s),this.broadcastEventToListeners("itemRemoved",{key:a}))}},{key:"handleBatchUpdate",value:function(a){var i=this,s={};a!=null&&a.forEach(function(u){s[u.key]={data:u.data,revision:u.revision}}),this.cache.forEach(function(u,v){var g=s[u];g!=null?i.handleItemMutated(u,g.data,g.revision):i.handleItemRemoved(u,null),delete s[u]});for(var o in s)this.handleItemMutated(o,s[o].data,s[o].revision)}},{key:"shouldIgnoreEvent",value:function(a,i){return a!=null&&i!=null&&this.cache.isKnown(a,i)}},{key:"_advanceLastEventId",value:function(a,i){this.lastEventId<a&&(this.descriptor.last_event_id=a)}}],[{key:"type",get:function(){return"live_query"}}]),t}(uu);function $0(e){return Hf.apply(this,arguments)}function Hf(){return Hf=fe.default(U.default.mark(function e(n){var t,r,a,i,s,o;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(t=n.network,r=n.queryString,a=n.uri,i=n.type,r!=null){v.next=3;break}throw new pr("Invalid query",400,54507);case 3:return s={query_string:r},i===Rn.type&&(s.type=i),v.next=7,t.post(a,s,void 0,!0);case 7:return o=v.sent,v.abrupt("return",o.body);case 9:case"end":return v.stop()}},e)})),Hf.apply(this,arguments)}var Rn=function(e){or.default(t,e);var n=Av(t);function t(r){var a;return it.default(this,t),a=n.call(this),a.liveQueryImpl=r,a.liveQueryImpl.attach(sn.default(a)),a}return ct.default(t,[{key:"type",get:function(){return Gf.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){iu.default(Nt.default(t.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return Gf.type}}]),t}(ou);vt.default(Rn,"itemUpdated","itemUpdated");vt.default(Rn,"itemRemoved","itemRemoved");var lu=function(e){or.default(t,e);var n=Av(t);function t(r){var a;return it.default(this,t),a=n.call(this),vt.default(sn.default(a),"queryExpression",null),vt.default(sn.default(a),"items",{}),Object.assign(sn.default(a),r),a.updateIndexName(r.indexName),a}return ct.default(t,[{key:"type",get:function(){return t.type}},{key:"search",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this;return U.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.items={},v.abrupt("return",$0({network:this.network,uri:this.queryUri,queryString:s}).then(function(g){o.queryExpression=s,g.items&&g.items.forEach(function(m){o.items[m.key]=m.data}),o.emit("searchResult",o.getItems())}).catch(function(g){throw ot.error("Error '".concat(g.message,"' while executing query '").concat(s,"'")),o.queryExpression=null,g}));case 2:case"end":return v.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"subscribe",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.queryExpression!=null){o.next=2;break}return o.abrupt("return",Promise.reject(new pr("Invalid query",400,54507)));case 2:return o.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(a){this.indexName=a,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(a){return new Ii(this.insightsUri).pathSegment(a).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),t}(ht);vt.default(lu,"searchResult","searchResult");st([ie.validateTypesAsync("string"),oe("design:type",Function),oe("design:paramtypes",[String]),oe("design:returntype",Promise)],lu.prototype,"search",null);st([ie.validateTypes(ie.nonEmptyString),oe("design:type",Function),oe("design:paramtypes",[String]),oe("design:returntype",void 0)],lu.prototype,"updateIndexName",null);var Cq="3.1.0";function Oq(e){var n=Aq();return function(){var r=Nt.default(e),a;if(n){var i=Nt.default(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return fa.default(this,a)}}function Aq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ug(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Dg(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Ug(Object(t),!0).forEach(function(r){vt.default(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ug(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var Pq="data_sync",Oc=Cq;function Bu(e){if(e){if(typeof e=="string")return{id:e,mode:"open_or_create"};var n=e.mode||(e.id?"open_or_create":"create_new");return Dg(Dg({},e),{},{mode:n})}else return{mode:"create_new"}}var Fg="com.twilio.rtd.cds.document",Bg="com.twilio.rtd.cds.list",qg="com.twilio.rtd.cds.map",Wg="twilio.sync.event",Tr=function(e){or.default(t,e);var n=Oq(t);function t(r){var a,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(it.default(this,t),a=n.call(this),!r)throw new Error("Sync library needs a valid Twilio token to be passed");i.hasOwnProperty("logLevel")?ot.setLevel(i.logLevel):ot.setLevel("silent");var s=i.productId=i.productId||Pq;i.clientMetadata=i.clientMetadata||{},i.clientMetadata.hasOwnProperty("type")||(i.clientMetadata.type="sync"),i.clientMetadata.hasOwnProperty("sdk")||(i.clientMetadata.sdk="JS",i.clientMetadata.sdkv=Oc);var o=!i.twilsockClient;if(!i.initRegistrations){var u=new mo.InitRegistration(s);t.populateInitRegistrations(u),i.initRegistrations=[u]}var v=i.twilsockClient=i.twilsockClient||new mo.Twilsock(r,s,i);v.on("tokenAboutToExpire",function(w){return a.emit("tokenAboutToExpire",w)}),v.on("tokenExpired",function(){return a.emit("tokenExpired")}),v.on("connectionError",function(w){return a.emit("connectionError",w)}),v.on("stateChanged",function(w){a.emit("connectionStateChanged",w),a.services.subscriptions.onConnectionStateChanged(w==="connected")}),v.on("message",function(w,R){return a._routeMessage(w,R)});var g=new Z6(i),m=new uq(new kq(Oc),g,v),_=new oq(g);return a.services={config:g,twilsock:v,network:m,storage:_,router:sn.default(a),subscriptions:null},a.services.subscriptions=new rq(a.services),a.entities=new Iq,o&&v.connect(),a}return ct.default(t,[{key:"_routeMessage",value:function(a,i){switch(ot.trace("Notification type:",a,"content:",i),a){case Fg:case Bg:case qg:this.services.subscriptions.acceptMessage(i,!1);break;case Wg:this.services.subscriptions.acceptMessage(i,!0);break}}},{key:"_subscribe",value:function(a,i){this.services.subscriptions.add(a,i)}},{key:"_unsubscribe",value:function(a){this.services.subscriptions.remove(a)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:function(){var r=fe.default(U.default.mark(function i(){var s;return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.services.config.sessionStorageEnabled){u.next=2;break}return u.abrupt("return");case 2:return u.prev=2,u.next=5,this.services.twilsock.storageId();case 5:s=u.sent,this.services.storage.updateStorageId(s.id),u.next=12;break;case 9:u.prev=9,u.t0=u.catch(2),ot.warn("Failed to initialize storage",u.t0);case 12:case"end":return u.stop()}},i,this,[[2,9]])}));function a(){return r.apply(this,arguments)}return a}()},{key:"storeRootInSessionCache",value:function(a,i,s){if(!(!this.services.config.sessionStorageEnabled||!i)){var o=Jr(s);(a===jt.type||a===Ft.type)&&(o.last_event_id=null,delete o.items),this.services.storage.store(a,i,o)}}},{key:"readRootFromSessionCache",value:function(a,i){return!this.services.config.sessionStorageEnabled||!i?null:this.services.storage.read(a,i)}},{key:"_get",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u,v,g,m=arguments;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(u=m.length>2&&m[2]!==void 0?m[2]:!1,o){w.next=3;break}throw new pr("Cannot get entity without id",404);case 3:return v=new Ii(s).pathSegment(o).queryParam("Include",u?"items":void 0).build(),w.next=6,this.services.network.get(v);case 6:return g=w.sent,w.abrupt("return",g.body);case 8:case"end":return w.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_createDocument",value:function(a,i,s){var o={unique_name:a,data:i||{}};return s!==void 0&&(o.ttl=s),this.services.network.post(this.services.config.documentsUri,o).then(function(u){return u.body.data=o.data,u.body})}},{key:"_getDocument",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.readRootFromSessionCache(Mr.type,s)||this._get(this.services.config.documentsUri,s));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_createList",value:function(a,i,s,o){var u={unique_name:a,purpose:i,context:s};return o!==void 0&&(u.ttl=o),this.services.network.post(this.services.config.listsUri,u).then(function(v){return v.body})}},{key:"_getList",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.readRootFromSessionCache(jt.type,s)||this._get(this.services.config.listsUri,s));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_createMap",value:function(a,i){var s={unique_name:a};return i!==void 0&&(s.ttl=i),this.services.network.post(this.services.config.mapsUri,s).then(function(o){return o.body})}},{key:"_getMap",value:function(){var r=fe.default(U.default.mark(function i(s){var o,u=arguments;return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o=u.length>1&&u[1]!==void 0?u[1]:!1,g.abrupt("return",this.readRootFromSessionCache(Ft.type,s)||this._get(this.services.config.mapsUri,s,o));case 2:case"end":return g.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_getStream",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.readRootFromSessionCache(nn.type,s)||this._get(this.services.config.streamsUri,s,!1));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"_createStream",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u,v;return U.default.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return u={unique_name:s},o!==void 0&&(u.ttl=o),m.next=4,this.services.network.post(this.services.config.streamsUri,u);case 4:return v=m.sent,m.abrupt("return",v.body);case 6:case"end":return m.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"_getLiveQuery",value:function(a){return this.readRootFromSessionCache(Rn.type,a)}},{key:"getCached",value:function(a,i){return a&&this.entities.get(a,i)||null}},{key:"removeFromCacheAndSession",value:function(a,i,s){this.entities.remove(i),this.services.config.sessionStorageEnabled&&this.services.storage.remove(a,i,s)}},{key:"document",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u,v,g,m;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.ensureReady();case 2:if(u=Bu(s),u.mode!=="create_new"){w.next=9;break}return w.next=6,this._createDocument(u.id,u.data,u.ttl);case 6:v=w.sent,w.next=39;break;case 9:if(g=this.getCached(u.id,Mr.type),!g){w.next=14;break}return w.abrupt("return",new Mr(g));case 14:return w.prev=14,w.next=17,this._getDocument(u.id);case 17:v=w.sent,w.next=39;break;case 20:if(w.prev=20,w.t0=w.catch(14),!(w.t0.status!==404||u.mode==="open_existing")){w.next=26;break}throw w.t0;case 26:return w.prev=26,w.next=29,this._createDocument(u.id,u.data,u.ttl);case 29:v=w.sent,w.next=39;break;case 32:if(w.prev=32,w.t1=w.catch(26),w.t1.status!==409){w.next=38;break}return w.abrupt("return",this.document(s));case 38:throw w.t1;case 39:return this.storeRootInSessionCache(Mr.type,u.id,v),m=new Ff(this.services,v,function(R,M,x){return o.removeFromCacheAndSession(R,M,x)}),m=this.entities.store(m),w.abrupt("return",new Mr(m));case 43:case"end":return w.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"map",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u,v,g,m;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.ensureReady();case 2:if(u=Bu(s),u.mode!=="create_new"){w.next=9;break}return w.next=6,this._createMap(u.id,u.ttl);case 6:v=w.sent,w.next=39;break;case 9:if(g=this.getCached(u.id,Ft.type),!g){w.next=14;break}return w.abrupt("return",new Ft(g));case 14:return w.prev=14,w.next=17,this._getMap(u.id,u.includeItems);case 17:v=w.sent,w.next=39;break;case 20:if(w.prev=20,w.t0=w.catch(14),!(w.t0.status!==404||u.mode==="open_existing")){w.next=26;break}throw w.t0;case 26:return w.prev=26,w.next=29,this._createMap(u.id,u.ttl);case 29:v=w.sent,w.next=39;break;case 32:if(w.prev=32,w.t1=w.catch(26),w.t1.status!==409){w.next=38;break}return w.abrupt("return",this.map(s));case 38:throw w.t1;case 39:return this.storeRootInSessionCache(Ft.type,u.id,v),m=new Wf(this.services,v,function(R,M,x){return o.removeFromCacheAndSession(R,M,x)}),m=this.entities.store(m),w.abrupt("return",new Ft(m));case 43:case"end":return w.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"list",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u,v,g,m;return U.default.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,this.ensureReady();case 2:if(u=Bu(s),u.mode!=="create_new"){w.next=9;break}return w.next=6,this._createList(u.id,u.purpose,u.context,u.ttl);case 6:v=w.sent,w.next=39;break;case 9:if(g=this.getCached(u.id,jt.type),!g){w.next=14;break}return w.abrupt("return",new jt(g));case 14:return w.prev=14,w.next=17,this._getList(u.id);case 17:v=w.sent,w.next=39;break;case 20:if(w.prev=20,w.t0=w.catch(14),!(w.t0.status!==404||u.mode==="open_existing")){w.next=26;break}throw w.t0;case 26:return w.prev=26,w.next=29,this._createList(u.id,u.purpose,u.context,u.ttl);case 29:v=w.sent,w.next=39;break;case 32:if(w.prev=32,w.t1=w.catch(26),w.t1.status!==409){w.next=38;break}return w.abrupt("return",this.list(s));case 38:throw w.t1;case 39:return this.storeRootInSessionCache(jt.type,u.id,v),m=new qf(this.services,v,function(R,M,x){return o.removeFromCacheAndSession(R,M,x)}),m=this.entities.store(m),w.abrupt("return",new jt(m));case 43:case"end":return w.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"stream",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u,v,g,m,_;return U.default.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,this.ensureReady();case 2:if(u=Bu(s),u.mode!=="create_new"){R.next=9;break}return R.next=6,this._createStream(u.id,u.ttl);case 6:v=R.sent,R.next=39;break;case 9:if(g=this.getCached(u.id,nn.type),!g){R.next=14;break}return R.abrupt("return",new nn(g));case 14:return R.prev=14,R.next=17,this._getStream(u.id);case 17:v=R.sent,R.next=39;break;case 20:if(R.prev=20,R.t0=R.catch(14),!(R.t0.status!==404||u.mode==="open_existing")){R.next=26;break}throw R.t0;case 26:return R.prev=26,R.next=29,this._createStream(u.id,u.ttl);case 29:v=R.sent,R.next=39;break;case 32:if(R.prev=32,R.t1=R.catch(26),R.t1.status!==409){R.next=38;break}return R.abrupt("return",this.stream(s));case 38:throw R.t1;case 39:return this.storeRootInSessionCache(nn.type,u.id,v),m=function(x,j,H){return o.removeFromCacheAndSession(x,j,H)},_=new Ms(this.services,v,m),_=this.entities.store(_),R.abrupt("return",new nn(_));case 44:case"end":return R.stop()}},i,this,[[14,20],[26,32]])}));function a(i){return r.apply(this,arguments)}return a}()},{key:"shutdown",value:function(){var r=fe.default(U.default.mark(function i(){return U.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.services.subscriptions.shutdown();case 2:return o.next=4,this.services.twilsock.disconnect();case 4:case"end":return o.stop()}},i,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"updateToken",value:function(){var r=fe.default(U.default.mark(function i(s){return U.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",this.services.twilsock.updateToken(s).catch(function(v){var g,m=v==null||(g=v.reply)===null||g===void 0?void 0:g.status;throw(m==null?void 0:m.code)===401&&(m==null?void 0:m.status)==="UNAUTHORIZED"?new pr("Updated token was rejected by server",400,51130):v}));case 1:case"end":return u.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"liveQuery",value:function(){var r=fe.default(U.default.mark(function i(s,o){var u=this,v,g,m,_,w;return U.default.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,this.ensureReady();case 2:return v=new Ii(this.services.config.insightsUri).pathSegment(s).pathSegment("Items").build(),M.next=5,$0({network:this.services.network,uri:v,queryString:o,type:Rn.type});case 5:return g=M.sent,m=this.getCached(g.query_id,Rn.type),m||(_=this._getLiveQuery(g.query_id),_||(_={indexName:s,queryExpression:o,sid:g.query_id,queryUri:v,last_event_id:g.last_event_id}),w=function(j,H,me){return u.removeFromCacheAndSession(j,H,me)},m=new Gf(_,this.services,w,g.items)),this.storeRootInSessionCache(Rn.type,g.query_id,m.liveQueryDescriptor),m=this.entities.store(m),M.abrupt("return",new Rn(m));case 11:case"end":return M.stop()}},i,this)}));function a(i,s){return r.apply(this,arguments)}return a}()},{key:"instantQuery",value:function(){var r=fe.default(U.default.mark(function i(s){var o=this,u;return U.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.ensureReady();case 2:return u=function(_,w){return o.liveQuery(_,w)},g.abrupt("return",new lu({indexName:s,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:u}));case 4:case"end":return g.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()}],[{key:"populateInitRegistrations",value:function(a){a.populateInitRegistrations([Wg,Fg,Bg,qg])}},{key:"version",get:function(){return Oc}}]),t}(ht);vt.default(Tr,"connectionStateChanged","connectionStateChanged");vt.default(Tr,"connectionError","connectionError");vt.default(Tr,"tokenAboutToExpire","tokenAboutToExpire");vt.default(Tr,"tokenExpired","tokenExpired");st([ie.validateTypesAsync(["undefined","string",ie.objectSchema("open document options",{id:["string","undefined"],mode:[ie.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ie.nonNegativeInteger,"undefined"],data:[ie.pureObject,"undefined",ie.literal(null)]})]),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],Tr.prototype,"document",null);st([ie.validateTypesAsync(["undefined","string",ie.objectSchema("open map options",{id:["string","undefined"],mode:[ie.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ie.nonNegativeInteger,"undefined"],data:[ie.pureObject,"undefined",ie.literal(null)],includeItems:["boolean","undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],Tr.prototype,"map",null);st([ie.validateTypesAsync(["undefined","string",ie.objectSchema("open list options",{id:["string","undefined"],mode:[ie.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ie.nonNegativeInteger,"undefined"],data:[ie.pureObject,"undefined",ie.literal(null)],purpose:["string","undefined"],context:[ie.pureObject,"undefined"],includeItems:["boolean","undefined"]})]),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],Tr.prototype,"list",null);st([ie.validateTypesAsync(["undefined","string",ie.objectSchema("open stream options",{id:["string","undefined"],mode:[ie.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[ie.nonNegativeInteger,"undefined"],data:[ie.pureObject,"undefined",ie.literal(null)]})]),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",Promise)],Tr.prototype,"stream",null);st([ie.validateTypesAsync(ie.nonEmptyString),oe("design:type",Function),oe("design:paramtypes",[String]),oe("design:returntype",Promise)],Tr.prototype,"updateToken",null);st([ie.validateTypesAsync(ie.nonEmptyString,"string"),oe("design:type",Function),oe("design:paramtypes",[String,String]),oe("design:returntype",Promise)],Tr.prototype,"liveQuery",null);st([ie.validateTypesAsync(ie.nonEmptyString),oe("design:type",Function),oe("design:paramtypes",[String]),oe("design:returntype",Promise)],Tr.prototype,"instantQuery",null);hr.Client=Tr;hr.InsightsItem=Rq;hr.InstantQuery=lu;hr.LiveQuery=Rn;hr.Paginator=Cv;hr.SyncClient=Tr;hr.SyncDocument=Mr;hr.SyncList=jt;hr.SyncListItem=Bf;hr.SyncMap=Ft;hr.SyncMapItem=ys;hr.SyncStream=nn;var T0={},Mq=Ct,Nq=on,Lq=mt,xq=Lq("match"),jq=function(e){var n;return Mq(e)&&((n=e[xq])!==void 0?!!n:Nq(e)==="RegExp")},Uq=jq,Dq=TypeError,k0=function(e){if(Uq(e))throw new Dq("The method doesn't accept regular expressions");return e},Fq=mt,Bq=Fq("match"),I0=function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Bq]=!1,"/./"[e](n)}catch(r){}}return!1},qq=Je,Wq=yd,Gq=Nn.f,Hq=jn,Gg=Bt,zq=k0,Vq=Qr,Kq=I0,Yq=Wq("".slice),Jq=Math.min,E0=Kq("startsWith"),Qq=!E0&&!!function(){var e=Gq(String.prototype,"startsWith");return e&&!e.writable}();qq({target:"String",proto:!0,forced:!Qq&&!E0},{startsWith:function(n){var t=Gg(Vq(this));zq(n);var r=Hq(Jq(arguments.length>1?arguments[1]:void 0,t.length)),a=Gg(n);return Yq(t,r,r+a.length)===a}});var Xq=We,Zq=mt,e8=_t,Hg=xm,t8=Zq("iterator"),R0=!Xq(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),n=e.searchParams,t=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",n.forEach(function(a,i){n.delete("b"),r+=i+a}),t.delete("a",2),t.delete("b",void 0),Hg&&(!e.toJSON||!t.has("a",1)||t.has("a",2)||!t.has("a",void 0)||t.has("b"))||!n.size&&(Hg||!e8)||!n.sort||e.href!=="https://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[t8]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://ÑÐµÑÑ").host!=="xn--e1aybc"||new URL("https://a#Ð±").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Wa=Ke,Ac=2147483647,Ss=36,C0=1,zf=26,r8=38,n8=700,a8=72,i8=128,s8="-",u8=/[^\0-\u007E]/,O0=/[.\u3002\uFF0E\uFF61]/g,zg="Overflow: input needs wider integers to process",Pc=Ss-C0,Vg=RangeError,o8=Wa(O0.exec),fi=Math.floor,Mc=String.fromCharCode,Kg=Wa("".charCodeAt),A0=Wa([].join),Qn=Wa([].push),l8=Wa("".replace),c8=Wa("".split),f8=Wa("".toLowerCase),d8=function(e){for(var n=[],t=0,r=e.length;t<r;){var a=Kg(e,t++);if(a>=55296&&a<=56319&&t<r){var i=Kg(e,t++);(i&64512)===56320?Qn(n,((a&1023)<<10)+(i&1023)+65536):(Qn(n,a),t--)}else Qn(n,a)}return n},Yg=function(e){return e+22+75*(e<26)},v8=function(e,n,t){var r=0;for(e=t?fi(e/n8):e>>1,e+=fi(e/n);e>Pc*zf>>1;)e=fi(e/Pc),r+=Ss;return fi(r+(Pc+1)*e/(e+r8))},p8=function(e){var n=[];e=d8(e);var t=e.length,r=i8,a=0,i=a8,s,o;for(s=0;s<e.length;s++)o=e[s],o<128&&Qn(n,Mc(o));var u=n.length,v=u;for(u&&Qn(n,s8);v<t;){var g=Ac;for(s=0;s<e.length;s++)o=e[s],o>=r&&o<g&&(g=o);var m=v+1;if(g-r>fi((Ac-a)/m))throw new Vg(zg);for(a+=(g-r)*m,r=g,s=0;s<e.length;s++){if(o=e[s],o<r&&++a>Ac)throw new Vg(zg);if(o===r){for(var _=a,w=Ss;;){var R=w<=i?C0:w>=i+zf?zf:w-i;if(_<R)break;var M=_-R,x=Ss-R;Qn(n,Mc(Yg(R+M%x))),_=fi(M/x),w+=Ss}Qn(n,Mc(Yg(_))),i=v8(a,m,v===u),a=0,v++}}a++,r++}return A0(n,"")},h8=function(e){var n=[],t=c8(l8(f8(e),O0,"."),"."),r,a;for(r=0;r<t.length;r++)a=t[r],Qn(n,o8(u8,a)?"xn--"+p8(a):a);return A0(n,".")},Vf=Je,cl=Xe,Pv=Qb,qu=yt,un=Ke,$s=_t,P0=R0,M0=ir,y8=vn,g8=ev,m8=fn,b8=Iw,Mv=xr,N0=Da,Nc=gt,w8=Pt,_8=Dn,S8=Un,$8=Lt,L0=Ct,rr=Bt,T8=sa,Jg=Pa,Qg=Uo,k8=Xs,Wu=qo,ri=kd,I8=mt,E8=Sv,R8=I8("iterator"),Di="URLSearchParams",x0=Di+"Iterator",j0=Mv.set,Ar=Mv.getterFor(Di),C8=Mv.getterFor(x0),Xg=Pv("fetch"),bo=Pv("Request"),Ts=Pv("Headers"),Lc=bo&&bo.prototype,Zg=Ts&&Ts.prototype,O8=cl.RegExp,A8=cl.TypeError,U0=cl.decodeURIComponent,P8=cl.encodeURIComponent,M8=un("".charAt),em=un([].join),ka=un([].push),Kf=un("".replace),N8=un([].shift),tm=un([].splice),rm=un("".split),L8=un("".slice),x8=/\+/g,nm=Array(4),j8=function(e){return nm[e-1]||(nm[e-1]=O8("((?:%[\\da-f]{2}){"+e+"})","gi"))},U8=function(e){try{return U0(e)}catch(n){return e}},am=function(e){var n=Kf(e,x8," "),t=4;try{return U0(n)}catch(r){for(;t;)n=Kf(n,j8(t--),U8);return n}},D8=/[!'()~]|%20/g,F8={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},B8=function(e){return F8[e]},im=function(e){return Kf(P8(e),D8,B8)},xc=b8(function(n,t){j0(this,{type:x0,target:Ar(n).entries,index:0,kind:t})},Di,function(){var n=C8(this),t=n.target,r=n.index++;if(!t||r>=t.length)return n.target=void 0,Wu(void 0,!0);var a=t[r];switch(n.kind){case"keys":return Wu(a.key,!1);case"values":return Wu(a.value,!1)}return Wu([a.key,a.value],!1)},!0),D0=function(e){this.entries=[],this.url=null,e!==void 0&&(L0(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?M8(e,0)==="?"?L8(e,1):e:rr(e)))};D0.prototype={type:Di,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n=this.entries,t=k8(e),r,a,i,s,o,u,v;if(t)for(r=Qg(e,t),a=r.next;!(i=qu(a,r)).done;){if(s=Qg($8(i.value)),o=s.next,(u=qu(o,s)).done||(v=qu(o,s)).done||!qu(o,s).done)throw new A8("Expected sequence with length 2");ka(n,{key:rr(u.value),value:rr(v.value)})}else for(var g in e)w8(e,g)&&ka(n,{key:g,value:rr(e[g])})},parseQuery:function(e){if(e)for(var n=this.entries,t=rm(e,"&"),r=0,a,i;r<t.length;)a=t[r++],a.length&&(i=rm(a,"="),ka(n,{key:am(N8(i)),value:am(em(i,"="))}))},serialize:function(){for(var e=this.entries,n=[],t=0,r;t<e.length;)r=e[t++],ka(n,im(r.key)+"="+im(r.value));return em(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var fl=function(){N0(this,Ei);var n=arguments.length>0?arguments[0]:void 0,t=j0(this,new D0(n));$s||(this.size=t.entries.length)},Ei=fl.prototype;g8(Ei,{append:function(n,t){var r=Ar(this);ri(arguments.length,2),ka(r.entries,{key:rr(n),value:rr(t)}),$s||this.length++,r.updateURL()},delete:function(e){for(var n=Ar(this),t=ri(arguments.length,1),r=n.entries,a=rr(e),i=t<2?void 0:arguments[1],s=i===void 0?i:rr(i),o=0;o<r.length;){var u=r[o];if(u.key===a&&(s===void 0||u.value===s)){if(tm(r,o,1),s!==void 0)break}else o++}$s||(this.size=r.length),n.updateURL()},get:function(n){var t=Ar(this).entries;ri(arguments.length,1);for(var r=rr(n),a=0;a<t.length;a++)if(t[a].key===r)return t[a].value;return null},getAll:function(n){var t=Ar(this).entries;ri(arguments.length,1);for(var r=rr(n),a=[],i=0;i<t.length;i++)t[i].key===r&&ka(a,t[i].value);return a},has:function(n){for(var t=Ar(this).entries,r=ri(arguments.length,1),a=rr(n),i=r<2?void 0:arguments[1],s=i===void 0?i:rr(i),o=0;o<t.length;){var u=t[o++];if(u.key===a&&(s===void 0||u.value===s))return!0}return!1},set:function(n,t){var r=Ar(this);ri(arguments.length,1);for(var a=r.entries,i=!1,s=rr(n),o=rr(t),u=0,v;u<a.length;u++)v=a[u],v.key===s&&(i?tm(a,u--,1):(i=!0,v.value=o));i||ka(a,{key:s,value:o}),$s||(this.size=a.length),r.updateURL()},sort:function(){var n=Ar(this);E8(n.entries,function(t,r){return t.key>r.key?1:-1}),n.updateURL()},forEach:function(n){for(var t=Ar(this).entries,r=_8(n,arguments.length>1?arguments[1]:void 0),a=0,i;a<t.length;)i=t[a++],r(i.value,i.key,this)},keys:function(){return new xc(this,"keys")},values:function(){return new xc(this,"values")},entries:function(){return new xc(this,"entries")}},{enumerable:!0});M0(Ei,R8,Ei.entries,{name:"entries"});M0(Ei,"toString",function(){return Ar(this).serialize()},{enumerable:!0});$s&&y8(Ei,"size",{get:function(){return Ar(this).entries.length},configurable:!0,enumerable:!0});m8(fl,Di);Vf({global:!0,constructor:!0,forced:!P0},{URLSearchParams:fl});if(!P0&&Nc(Ts)){var q8=un(Zg.has),W8=un(Zg.set),sm=function(e){if(L0(e)){var n=e.body,t;if(S8(n)===Di)return t=e.headers?new Ts(e.headers):new Ts,q8(t,"content-type")||W8(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),T8(e,{body:Jg(0,rr(n)),headers:Jg(0,t)})}return e};if(Nc(Xg)&&Vf({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return Xg(n,arguments.length>1?sm(arguments[1]):{})}}),Nc(bo)){var jc=function(n){return N0(this,Lc),new bo(n,arguments.length>1?sm(arguments[1]):{})};Lc.constructor=jc,jc.prototype=Lc,Vf({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:jc})}}var G8={URLSearchParams:fl,getState:Ar},H8=Je,Nv=_t,z8=R0,Lv=Xe,um=Dn,Dr=Ke,wo=ir,Rr=vn,V8=Da,Yf=Pt,xv=a0,ni=$w,Hr=dn,K8=Nd.codeAt,Y8=h8,Sn=Bt,J8=fn,Q8=kd,F0=G8,B0=xr,X8=B0.set,_o=B0.getterFor("URL"),Z8=F0.URLSearchParams,e5=F0.getState,ds=Lv.URL,Jf=Lv.TypeError,So=Lv.parseInt,t5=Math.floor,om=Math.pow,Pr=Dr("".charAt),Kr=Dr(/./.exec),gs=Dr([].join),r5=Dr(1 .toString),n5=Dr([].pop),ui=Dr([].push),Uc=Dr("".replace),a5=Dr([].shift),i5=Dr("".split),ks=Dr("".slice),$o=Dr("".toLowerCase),s5=Dr([].unshift),u5="Invalid authority",Dc="Invalid scheme",Sa="Invalid host",lm="Invalid port",q0=/[a-z]/i,o5=/[\d+-.a-z]/i,Qf=/\d/,l5=/^0x/i,c5=/^[0-7]+$/,f5=/^\d+$/,W0=/^[\da-f]+$/i,d5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,v5=/[\0\t\n\r #/:<>?@[\\\]^|]/,p5=/^[\u0000-\u0020]+/,h5=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,y5=/[\t\n\r]/g,Cr,g5=function(e){var n=i5(e,"."),t,r,a,i,s,o,u;if(n.length&&n[n.length-1]===""&&n.length--,t=n.length,t>4)return e;for(r=[],a=0;a<t;a++){if(i=n[a],i==="")return e;if(s=10,i.length>1&&Pr(i,0)==="0"&&(s=Kr(l5,i)?16:8,i=ks(i,s===8?1:2)),i==="")o=0;else{if(!Kr(s===10?f5:s===8?c5:W0,i))return e;o=So(i,s)}ui(r,o)}for(a=0;a<t;a++)if(o=r[a],a===t-1){if(o>=om(256,5-t))return null}else if(o>255)return null;for(u=n5(r),a=0;a<r.length;a++)u+=r[a]*om(256,3-a);return u},m5=function(e){var n=[0,0,0,0,0,0,0,0],t=0,r=null,a=0,i,s,o,u,v,g,m,_=function(){return Pr(e,a)};if(_()===":"){if(Pr(e,1)!==":")return;a+=2,t++,r=t}for(;_();){if(t===8)return;if(_()===":"){if(r!==null)return;a++,t++,r=t;continue}for(i=s=0;s<4&&Kr(W0,_());)i=i*16+So(_(),16),a++,s++;if(_()==="."){if(s===0||(a-=s,t>6))return;for(o=0;_();){if(u=null,o>0)if(_()==="."&&o<4)a++;else return;if(!Kr(Qf,_()))return;for(;Kr(Qf,_());){if(v=So(_(),10),u===null)u=v;else{if(u===0)return;u=u*10+v}if(u>255)return;a++}n[t]=n[t]*256+u,o++,(o===2||o===4)&&t++}if(o!==4)return;break}else if(_()===":"){if(a++,!_())return}else if(_())return;n[t++]=i}if(r!==null)for(g=t-r,t=7;t!==0&&g>0;)m=n[t],n[t--]=n[r+g-1],n[r+--g]=m;else if(t!==8)return;return n},b5=function(e){for(var n=null,t=1,r=null,a=0,i=0;i<8;i++)e[i]!==0?(a>t&&(n=r,t=a),r=null,a=0):(r===null&&(r=i),++a);return a>t?r:n},vs=function(e){var n,t,r,a;if(typeof e=="number"){for(n=[],t=0;t<4;t++)s5(n,e%256),e=t5(e/256);return gs(n,".")}if(typeof e=="object"){for(n="",r=b5(e),t=0;t<8;t++)a&&e[t]===0||(a&&(a=!1),r===t?(n+=t?":":"::",a=!0):(n+=r5(e[t],16),t<7&&(n+=":")));return"["+n+"]"}return e},to={},G0=xv({},to,{" ":1,'"':1,"<":1,">":1,"`":1}),H0=xv({},G0,{"#":1,"?":1,"{":1,"}":1}),Fc=xv({},H0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Yn=function(e,n){var t=K8(e,0);return t>32&&t<127&&!Yf(n,e)?e:encodeURIComponent(e)},Gu={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ms=function(e,n){var t;return e.length===2&&Kr(q0,Pr(e,0))&&((t=Pr(e,1))===":"||!n&&t==="|")},cm=function(e){var n;return e.length>1&&ms(ks(e,0,2))&&(e.length===2||(n=Pr(e,2))==="/"||n==="\\"||n==="?"||n==="#")},w5=function(e){return e==="."||$o(e)==="%2e"},_5=function(e){return e=$o(e),e===".."||e==="%2e."||e===".%2e"||e==="%2e%2e"},Bc={},fm={},qc={},dm={},vm={},Wc={},pm={},hm={},Hu={},zu={},Gc={},Hc={},zc={},Vc={},ym={},Kc={},ai={},tn={},gm={},$a={},_n={},jv=function(e,n,t){var r=Sn(e),a,i,s;if(n){if(i=this.parse(r),i)throw new Jf(i);this.searchParams=null}else{if(t!==void 0&&(a=new jv(t,!0)),i=this.parse(r,null,a),i)throw new Jf(i);s=e5(new Z8),s.bindURL(this),this.searchParams=s}};jv.prototype={type:"URL",parse:function(e,n,t){var r=this,a=n||Bc,i=0,s="",o=!1,u=!1,v=!1,g,m,_,w;for(e=Sn(e),n||(r.scheme="",r.username="",r.password="",r.host=null,r.port=null,r.path=[],r.query=null,r.fragment=null,r.cannotBeABaseURL=!1,e=Uc(e,p5,""),e=Uc(e,h5,"$1")),e=Uc(e,y5,""),g=ni(e);i<=g.length;){switch(m=g[i],a){case Bc:if(m&&Kr(q0,m))s+=$o(m),a=fm;else{if(n)return Dc;a=qc;continue}break;case fm:if(m&&(Kr(o5,m)||m==="+"||m==="-"||m==="."))s+=$o(m);else if(m===":"){if(n&&(r.isSpecial()!==Yf(Gu,s)||s==="file"&&(r.includesCredentials()||r.port!==null)||r.scheme==="file"&&!r.host))return;if(r.scheme=s,n){r.isSpecial()&&Gu[r.scheme]===r.port&&(r.port=null);return}s="",r.scheme==="file"?a=Vc:r.isSpecial()&&t&&t.scheme===r.scheme?a=dm:r.isSpecial()?a=hm:g[i+1]==="/"?(a=vm,i++):(r.cannotBeABaseURL=!0,ui(r.path,""),a=gm)}else{if(n)return Dc;s="",a=qc,i=0;continue}break;case qc:if(!t||t.cannotBeABaseURL&&m!=="#")return Dc;if(t.cannotBeABaseURL&&m==="#"){r.scheme=t.scheme,r.path=Hr(t.path),r.query=t.query,r.fragment="",r.cannotBeABaseURL=!0,a=_n;break}a=t.scheme==="file"?Vc:Wc;continue;case dm:if(m==="/"&&g[i+1]==="/")a=Hu,i++;else{a=Wc;continue}break;case vm:if(m==="/"){a=zu;break}else{a=tn;continue}case Wc:if(r.scheme=t.scheme,m===Cr)r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=Hr(t.path),r.query=t.query;else if(m==="/"||m==="\\"&&r.isSpecial())a=pm;else if(m==="?")r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=Hr(t.path),r.query="",a=$a;else if(m==="#")r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=Hr(t.path),r.query=t.query,r.fragment="",a=_n;else{r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,r.path=Hr(t.path),r.path.length--,a=tn;continue}break;case pm:if(r.isSpecial()&&(m==="/"||m==="\\"))a=Hu;else if(m==="/")a=zu;else{r.username=t.username,r.password=t.password,r.host=t.host,r.port=t.port,a=tn;continue}break;case hm:if(a=Hu,m!=="/"||Pr(s,i+1)!=="/")continue;i++;break;case Hu:if(m!=="/"&&m!=="\\"){a=zu;continue}break;case zu:if(m==="@"){o&&(s="%40"+s),o=!0,_=ni(s);for(var R=0;R<_.length;R++){var M=_[R];if(M===":"&&!v){v=!0;continue}var x=Yn(M,Fc);v?r.password+=x:r.username+=x}s=""}else if(m===Cr||m==="/"||m==="?"||m==="#"||m==="\\"&&r.isSpecial()){if(o&&s==="")return u5;i-=ni(s).length+1,s="",a=Gc}else s+=m;break;case Gc:case Hc:if(n&&r.scheme==="file"){a=Kc;continue}else if(m===":"&&!u){if(s==="")return Sa;if(w=r.parseHost(s),w)return w;if(s="",a=zc,n===Hc)return}else if(m===Cr||m==="/"||m==="?"||m==="#"||m==="\\"&&r.isSpecial()){if(r.isSpecial()&&s==="")return Sa;if(n&&s===""&&(r.includesCredentials()||r.port!==null))return;if(w=r.parseHost(s),w)return w;if(s="",a=ai,n)return;continue}else m==="["?u=!0:m==="]"&&(u=!1),s+=m;break;case zc:if(Kr(Qf,m))s+=m;else if(m===Cr||m==="/"||m==="?"||m==="#"||m==="\\"&&r.isSpecial()||n){if(s!==""){var j=So(s,10);if(j>65535)return lm;r.port=r.isSpecial()&&j===Gu[r.scheme]?null:j,s=""}if(n)return;a=ai;continue}else return lm;break;case Vc:if(r.scheme="file",m==="/"||m==="\\")a=ym;else if(t&&t.scheme==="file")switch(m){case Cr:r.host=t.host,r.path=Hr(t.path),r.query=t.query;break;case"?":r.host=t.host,r.path=Hr(t.path),r.query="",a=$a;break;case"#":r.host=t.host,r.path=Hr(t.path),r.query=t.query,r.fragment="",a=_n;break;default:cm(gs(Hr(g,i),""))||(r.host=t.host,r.path=Hr(t.path),r.shortenPath()),a=tn;continue}else{a=tn;continue}break;case ym:if(m==="/"||m==="\\"){a=Kc;break}t&&t.scheme==="file"&&!cm(gs(Hr(g,i),""))&&(ms(t.path[0],!0)?ui(r.path,t.path[0]):r.host=t.host),a=tn;continue;case Kc:if(m===Cr||m==="/"||m==="\\"||m==="?"||m==="#"){if(!n&&ms(s))a=tn;else if(s===""){if(r.host="",n)return;a=ai}else{if(w=r.parseHost(s),w)return w;if(r.host==="localhost"&&(r.host=""),n)return;s="",a=ai}continue}else s+=m;break;case ai:if(r.isSpecial()){if(a=tn,m!=="/"&&m!=="\\")continue}else if(!n&&m==="?")r.query="",a=$a;else if(!n&&m==="#")r.fragment="",a=_n;else if(m!==Cr&&(a=tn,m!=="/"))continue;break;case tn:if(m===Cr||m==="/"||m==="\\"&&r.isSpecial()||!n&&(m==="?"||m==="#")){if(_5(s)?(r.shortenPath(),m!=="/"&&!(m==="\\"&&r.isSpecial())&&ui(r.path,"")):w5(s)?m!=="/"&&!(m==="\\"&&r.isSpecial())&&ui(r.path,""):(r.scheme==="file"&&!r.path.length&&ms(s)&&(r.host&&(r.host=""),s=Pr(s,0)+":"),ui(r.path,s)),s="",r.scheme==="file"&&(m===Cr||m==="?"||m==="#"))for(;r.path.length>1&&r.path[0]==="";)a5(r.path);m==="?"?(r.query="",a=$a):m==="#"&&(r.fragment="",a=_n)}else s+=Yn(m,H0);break;case gm:m==="?"?(r.query="",a=$a):m==="#"?(r.fragment="",a=_n):m!==Cr&&(r.path[0]+=Yn(m,to));break;case $a:!n&&m==="#"?(r.fragment="",a=_n):m!==Cr&&(m==="'"&&r.isSpecial()?r.query+="%27":m==="#"?r.query+="%23":r.query+=Yn(m,to));break;case _n:m!==Cr&&(r.fragment+=Yn(m,G0));break}i++}},parseHost:function(e){var n,t,r;if(Pr(e,0)==="["){if(Pr(e,e.length-1)!=="]"||(n=m5(ks(e,1,-1)),!n))return Sa;this.host=n}else if(this.isSpecial()){if(e=Y8(e),Kr(d5,e)||(n=g5(e),n===null))return Sa;this.host=n}else{if(Kr(v5,e))return Sa;for(n="",t=ni(e),r=0;r<t.length;r++)n+=Yn(t[r],to);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return Yf(Gu,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;n&&(this.scheme!=="file"||n!==1||!ms(e[0],!0))&&e.length--},serialize:function(){var e=this,n=e.scheme,t=e.username,r=e.password,a=e.host,i=e.port,s=e.path,o=e.query,u=e.fragment,v=n+":";return a!==null?(v+="//",e.includesCredentials()&&(v+=t+(r?":"+r:"")+"@"),v+=vs(a),i!==null&&(v+=":"+i)):n==="file"&&(v+="//"),v+=e.cannotBeABaseURL?s[0]:s.length?"/"+gs(s,"/"):"",o!==null&&(v+="?"+o),u!==null&&(v+="#"+u),v},setHref:function(e){var n=this.parse(e);if(n)throw new Jf(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e==="blob")try{return new Ri(e.path[0]).origin}catch(t){return"null"}return e==="file"||!this.isSpecial()?"null":e+"://"+vs(this.host)+(n!==null?":"+n:"")},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Sn(e)+":",Bc)},getUsername:function(){return this.username},setUsername:function(e){var n=ni(Sn(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var t=0;t<n.length;t++)this.username+=Yn(n[t],Fc)}},getPassword:function(){return this.password},setPassword:function(e){var n=ni(Sn(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var t=0;t<n.length;t++)this.password+=Yn(n[t],Fc)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?vs(e):vs(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Gc)},getHostname:function(){var e=this.host;return e===null?"":vs(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Hc)},getPort:function(){var e=this.port;return e===null?"":Sn(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(e=Sn(e),e===""?this.port=null:this.parse(e,zc))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+gs(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,ai))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){e=Sn(e),e===""?this.query=null:(Pr(e,0)==="?"&&(e=ks(e,1)),this.query="",this.parse(e,$a)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){if(e=Sn(e),e===""){this.fragment=null;return}Pr(e,0)==="#"&&(e=ks(e,1)),this.fragment="",this.parse(e,_n)},update:function(){this.query=this.searchParams.serialize()||null}};var Ri=function(n){var t=V8(this,tr),r=Q8(arguments.length,1)>1?arguments[1]:void 0,a=X8(t,new jv(n,!1,r));Nv||(t.href=a.serialize(),t.origin=a.getOrigin(),t.protocol=a.getProtocol(),t.username=a.getUsername(),t.password=a.getPassword(),t.host=a.getHost(),t.hostname=a.getHostname(),t.port=a.getPort(),t.pathname=a.getPathname(),t.search=a.getSearch(),t.searchParams=a.getSearchParams(),t.hash=a.getHash())},tr=Ri.prototype,Or=function(e,n){return{get:function(){return _o(this)[e]()},set:n&&function(t){return _o(this)[n](t)},configurable:!0,enumerable:!0}};Nv&&(Rr(tr,"href",Or("serialize","setHref")),Rr(tr,"origin",Or("getOrigin")),Rr(tr,"protocol",Or("getProtocol","setProtocol")),Rr(tr,"username",Or("getUsername","setUsername")),Rr(tr,"password",Or("getPassword","setPassword")),Rr(tr,"host",Or("getHost","setHost")),Rr(tr,"hostname",Or("getHostname","setHostname")),Rr(tr,"port",Or("getPort","setPort")),Rr(tr,"pathname",Or("getPathname","setPathname")),Rr(tr,"search",Or("getSearch","setSearch")),Rr(tr,"searchParams",Or("getSearchParams")),Rr(tr,"hash",Or("getHash","setHash")));wo(tr,"toJSON",function(){return _o(this).serialize()},{enumerable:!0});wo(tr,"toString",function(){return _o(this).serialize()},{enumerable:!0});if(ds){var mm=ds.createObjectURL,bm=ds.revokeObjectURL;mm&&wo(Ri,"createObjectURL",um(mm,ds)),bm&&wo(Ri,"revokeObjectURL",um(bm,ds))}J8(Ri,"URL");H8({global:!0,constructor:!0,forced:!z8,sham:!Nv},{URL:Ri});/*
@license
Copyright (c) 2018, Twilio, Inc.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted, provided that the above
copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

*/(function(e){var n=typeof n<"u"?n:typeof self<"u"?self:typeof window<"u"?window:{};Object.defineProperty(e,"__esModule",{value:!0});var t=yn,r=ua,a=pn,i=hn,s=Ur,o=$v,u=Ua,v=Ys,g=Zs,m=jr,_=tu,w=qn,R=Gt;function M(D){return D&&typeof D=="object"&&"default"in D?D:{default:D}}function x(D){if(D&&D.__esModule)return D;var z=Object.create(null);return D&&Object.keys(D).forEach(function(N){if(N!=="default"){var W=Object.getOwnPropertyDescriptor(D,N);Object.defineProperty(z,N,W.get?W:{enumerable:!0,get:function(){return D[N]}})}}),z.default=D,Object.freeze(z)}var j=M(t),H=M(r),me=M(a),ne=M(i),Ie=M(s),Ee=M(o),xe=M(u),B=M(v),J=M(g),pe=M(m),F=x(_),de={exports:{}},Pe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Pe){var Me=new Uint8Array(16);de.exports=function(){return Pe(Me),Me}}else{var _e=new Array(16);de.exports=function(){for(var z=0,N;z<16;z++)z&3||(N=Math.random()*4294967296),_e[z]=N>>>((z&3)<<3)&255;return _e}}for(var he=[],Ye=0;Ye<256;++Ye)he[Ye]=(Ye+256).toString(16).substr(1);function ze(D,z){var N=z||0,W=he;return[W[D[N++]],W[D[N++]],W[D[N++]],W[D[N++]],"-",W[D[N++]],W[D[N++]],"-",W[D[N++]],W[D[N++]],"-",W[D[N++]],W[D[N++]],"-",W[D[N++]],W[D[N++]],W[D[N++]],W[D[N++]],W[D[N++]],W[D[N++]]].join("")}var k=ze,te=de.exports,le=k,ce,Ne,be=0,X=0;function I(D,z,N){var W=z&&N||0,L=z||[];D=D||{};var ge=D.node||ce,ae=D.clockseq!==void 0?D.clockseq:Ne;if(ge==null||ae==null){var Ce=te();ge==null&&(ge=ce=[Ce[0]|1,Ce[1],Ce[2],Ce[3],Ce[4],Ce[5]]),ae==null&&(ae=Ne=(Ce[6]<<8|Ce[7])&16383)}var we=D.msecs!==void 0?D.msecs:new Date().getTime(),$e=D.nsecs!==void 0?D.nsecs:X+1,Te=we-be+($e-X)/1e4;if(Te<0&&D.clockseq===void 0&&(ae=ae+1&16383),(Te<0||we>be)&&D.nsecs===void 0&&($e=0),$e>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");be=we,X=$e,Ne=ae,we+=122192928e5;var Le=((we&268435455)*1e4+$e)%4294967296;L[W++]=Le>>>24&255,L[W++]=Le>>>16&255,L[W++]=Le>>>8&255,L[W++]=Le&255;var Oe=we/4294967296*1e4&268435455;L[W++]=Oe>>>8&255,L[W++]=Oe&255,L[W++]=Oe>>>24&15|16,L[W++]=Oe>>>16&255,L[W++]=ae>>>8|128,L[W++]=ae&255;for(var Ae=0;Ae<6;++Ae)L[W+Ae]=ge[Ae];return z||le(L)}var tt=I,Se=de.exports,ut=k;function bt(D,z,N){var W=z&&N||0;typeof D=="string"&&(z=D==="binary"?new Array(16):null,D=null),D=D||{};var L=D.random||(D.rng||Se)();if(L[6]=L[6]&15|64,L[8]=L[8]&63|128,z)for(var ge=0;ge<16;++ge)z[W+ge]=L[ge];return z||ut(L)}var Re=bt,Ht=tt,Ge=Re,se=Ge;se.v1=Ht,se.v4=Ge;var Be=se;function nt(D){var z=ve();return function(){var W=Ie.default(D),L;if(z){var ge=Ie.default(this).constructor;L=Reflect.construct(W,arguments,ge)}else L=W.apply(this,arguments);return ne.default(this,L)}}function ve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var Ot=function(D){me.default(N,D);var z=nt(N);function N(W){var L;j.default(this,N);var ge=Be.v4(),ae;return L=z.call(this,function(Ce,we){return ae=we,W(function($e){N.cancellationMap.delete(ge),Ce($e)},function($e){N.cancellationMap.delete(ge),we($e)},function($e){N.cancellationMap.set(ge,$e)})}),L.id=ge,L.rejectPromise=ae,L}return H.default(N,[{key:"cancel",value:function(){var L=N.cancellationMap.get(this.id);return L==null||L(),this.rejectPromise&&(this.catch(function(){}),this.rejectPromise(new Error("Promise was cancelled"))),this}}]),N}(Ee.default(Promise));xe.default(Ot,"cancellationMap",new Map);function Ve(D,z,N,W){var L=arguments.length,ge=L<3?z:W===null?W=Object.getOwnPropertyDescriptor(z,N):W,ae;if((typeof Reflect>"u"?"undefined":pe.default(Reflect))==="object"&&typeof Reflect.decorate=="function")ge=Reflect.decorate(D,z,N,W);else for(var Ce=D.length-1;Ce>=0;Ce--)(ae=D[Ce])&&(ge=(L<3?ae(ge):L>3?ae(z,N,ge):ae(z,N))||ge);return L>3&&ge&&Object.defineProperty(z,N,ge),ge}function $t(D,z){if((typeof Reflect>"u"?"undefined":pe.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(D,z)}function xt(D,z){return["".concat(new Date().toISOString()," MCS Client ").concat(D,":")].concat(Array.from(z))}var ye=function(){function D(z){j.default(this,D),xe.default(this,"prefix",""),this.prefix=z!=null&&z.length>0?z+" ":""}return H.default(D,[{key:"setLevel",value:function(N){F.setLevel(N)}},{key:"trace",value:function(){if(F.getLevel()==F.levels.TRACE){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.debug.apply(null,xt(this.prefix+"T",W))}}},{key:"debug",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.debug.apply(null,xt(this.prefix+"D",W))}},{key:"info",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.info.apply(null,xt(this.prefix+"I",W))}},{key:"warn",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.warn.apply(null,xt(this.prefix+"W",W))}},{key:"error",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.error.apply(null,xt(this.prefix+"E",W))}}],[{key:"scope",value:function(N){return new D(N)}},{key:"setLevel",value:function(N){F.setLevel(N)}},{key:"trace",value:function(){if(F.getLevel()==F.levels.TRACE){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.debug.apply(null,xt("T",W))}}},{key:"debug",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.debug.apply(null,xt("D",W))}},{key:"info",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.info.apply(null,xt("I",W))}},{key:"warn",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.warn.apply(null,xt("W",W))}},{key:"error",value:function(){for(var N=arguments.length,W=new Array(N),L=0;L<N;L++)W[L]=arguments[L];F.error.apply(null,xt("E",W))}}]),D}(),Ut=1e3,Zt=4e3,Ze=3,ft=!0,et=function(z){return"https://mcs.".concat(z!=null?z:"us1",".twilio.com")},He=function(z){return z.startsWith("http")},Et=function(z,N){return"".concat(He(z)?"":et(N)).concat(z)},Rt=function(){function D(z,N,W,L){var ge,ae,Ce,we,$e,Te;j.default(this,D);var Le=(ge=(ae=L.MCS)!==null&&ae!==void 0?ae:L)!==null&&ge!==void 0?ge:{};this.region=(Ce=(we=Le.region)!==null&&we!==void 0?we:L.region)!==null&&Ce!==void 0?Ce:"us1",this.mediaUrl=Et(N,this.region),this.mediaSetUrl=W?Et(W):"".concat(this.mediaUrl,"Set"),this.token=z,this.retryWhenThrottledOverride=($e=Le.retryWhenThrottledOverride)!==null&&$e!==void 0?$e:ft,this.backoffConfigOverride=(Te=Le.backoffConfigOverride)!==null&&Te!==void 0?Te:D.backoffConfigDefault}return H.default(D,[{key:"updateToken",value:function(N){this.token=N}}],[{key:"backoffConfigDefault",get:function(){return{min:Ut,max:Zt,maxAttemptsCount:Ze}}},{key:"retryWhenThrottledDefault",get:function(){return ft}}]),D}(),Dt=function(){function D(z,N,W){j.default(this,D),this.config=z,this.network=N,this._update(W)}return H.default(D,[{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}},{key:"filename",get:function(){return this.state.filename}},{key:"category",get:function(){return this.state.category}},{key:"getContentUrl",value:function(){var N=this;return new Ot(function(){var W=B.default(J.default.mark(function L(ge,ae,Ce){var we,$e;return J.default.wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:return we=N.network.get("".concat(N.config.mediaUrl,"/").concat(N.sid)),Ce(function(){return we.cancel()}),Le.prev=2,Le.next=5,we;case 5:$e=Le.sent,N._update($e.body),ge(N.state.contentDirectUrl),Le.next=13;break;case 10:Le.prev=10,Le.t0=Le.catch(2),ae(Le.t0);case 13:case"end":return Le.stop()}},L,null,[[2,10]])}));return function(L,ge,ae){return W.apply(this,arguments)}}())}},{key:"_update",value:function(N){var W,L,ge,ae;this.state={sid:N.sid,serviceSid:N.service_sid,channelSid:N.channel_sid,messageSid:N.message_sid,dateCreated:N.date_created?new Date(N.date_created):null,dateUploadUpdated:N.date_upload_updated?new Date(N.date_upload_updated):null,dateUpdated:N.date_updated?new Date(N.date_updated):null,size:N.size,contentType:N.content_type,author:N.author,url:N.url,contentUrl:N.links.content,contentDirectUrl:(W=N.links.content_direct_temporary)!==null&&W!==void 0?W:null,filename:(L=N.filename)!==null&&L!==void 0?L:null,category:(ge=N.category)!==null&&ge!==void 0?ge:"media",isMultipartUpstream:(ae=N.is_multipart_upstream)!==null&&ae!==void 0?ae:!1}}},{key:"_state",value:function(){var N;return{sid:this.state.sid,category:this.state.category,filename:(N=this.state.filename)!==null&&N!==void 0?N:null,contentType:this.state.contentType,size:this.state.size}}}]),D}();function Zr(D){var z=gn();return function(){var W=Ie.default(D),L;if(z){var ge=Ie.default(this).constructor;L=Reflect.construct(W,arguments,ge)}else L=W.apply(this,arguments);return ne.default(this,L)}}function gn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var Fr=function(D){me.default(N,D);var z=Zr(N);function N(W,L,ge,ae,Ce){var we;return j.default(this,N),we=z.call(this,W),we.code=L,we.body=ge,we.status=ae,we.headers=Ce,we}return H.default(N)}(Ee.default(Error)),lr=n.XMLHttpRequest||{};function dt(D){return D?D.split("\r\n").map(function(z){return z.split(": ")}).filter(function(z){return z.length===2&&z[1].length>0}).reduce(function(z,N){return z[N[0]]=N[1],z},{}):{}}function Q(D){var z=D.getResponseHeader("Content-Type");if(!z||z.indexOf("application/json")!==0||D.responseText.length===0)return D.responseText;try{return JSON.parse(D.responseText)}catch(N){return D.responseText}}var Z=function(){function D(){j.default(this,D)}return H.default(D,[{key:"get",value:function(N,W){return D.request("GET",N,W)}},{key:"post",value:function(N,W,L){return D.request("POST",N,W,L)}}],[{key:"request",value:function(N,W,L,ge){return new Ot(function(ae,Ce,we){var $e=new lr,Te=!1;we(function(){$e.abort(),Te=!0}),$e.open(N,W,!0),$e.onreadystatechange=function(){if(!($e.readyState!==4||Te)){var Ae=dt($e.getAllResponseHeaders()),je=Q($e);if(200<=$e.status&&$e.status<300)ae({status:$e.status,headers:Ae,body:je});else{var De,Tt=(De=$e.statusText)!==null&&De!==void 0?De:"NONE",yr;if(typeof je=="string")if(je&&je.split("\n",2).length===1)yr=je;else{var Fe,gr=(Fe=je.replace(/<.*?>/g,"").split(/\r\n/g).filter(function(va){return va.length})[0])===null||Fe===void 0?void 0:Fe.split(" ");yr=(gr==null?void 0:gr.length)>2?gr==null?void 0:gr.slice(1).join(" "):""}else yr=JSON.stringify(je);var da="".concat($e.status,": [").concat(Tt,"] ").concat(yr);Ce(new Fr(da,$e.status,je,Tt,Ae))}}};for(var Le in L)$e.setRequestHeader(Le,L[Le]),Le==="Content-Type"&&L[Le]==="application/json"&&(ge=JSON.stringify(ge));$e.send(ge)})}}]),D}(),G=ye.scope("Network"),K=function(){function D(z,N){j.default(this,D),this.config=z,this.transport=N}return H.default(D,[{key:"backoffConfig",value:function(){return Object.assign(Rt.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){var N,W;return(N=(W=this.config.retryWhenThrottledOverride)!==null&&W!==void 0?W:Rt.retryWhenThrottledDefault)!==null&&N!==void 0?N:!1}},{key:"executeWithRetry",value:function(N,W){var L=this;return new Ot(function(){var ge=B.default(J.default.mark(function ae(Ce,we,$e){var Te,Le;return J.default.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:Te=new w.Retrier(L.backoffConfig()),Le=[502,503,504],W&&Le.push(429),$e(function(){Te.cancel(),Te.removeAllListeners()}),Te.on("attempt",B.default(J.default.mark(function je(){var De,Tt;return J.default.wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return Fe.prev=0,De=N(),$e(function(){De.cancel(),Te.cancel(),Te.removeAllListeners()}),Fe.next=5,De;case 5:Tt=Fe.sent,Te.succeeded(Tt),Fe.next=12;break;case 9:Fe.prev=9,Fe.t0=Fe.catch(0),Le.indexOf(Fe.t0.status)>-1||Fe.t0.message==="Twilsock disconnected"?Te.failed(Fe.t0):(Te.removeAllListeners(),Te.cancel(),we(Fe.t0));case 12:case"end":return Fe.stop()}},je,null,[[0,9]])}))),Te.on("succeeded",function(je){Ce(je)}),Te.on("cancelled",function(je){return we(je)}),Te.on("failed",function(je){return we(je)}),Te.start();case 9:case"end":return Ae.stop()}},ae)}));return function(ae,Ce,we){return ge.apply(this,arguments)}}())}},{key:"get",value:function(N){var W=this;return new Ot(function(){var L=B.default(J.default.mark(function ge(ae,Ce,we){var $e,Te,Le;return J.default.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return $e={"X-Twilio-Token":W.config.token},Te=W.executeWithRetry(function(){return W.transport.get(N,$e)},W.retryWhenThrottled()),G.trace("sending GET request to ",N," headers ",$e),we(function(){return Te.cancel()}),Ae.prev=4,Ae.next=7,Te;case 7:Le=Ae.sent,G.trace("response",Le),ae(Le),Ae.next=16;break;case 12:Ae.prev=12,Ae.t0=Ae.catch(4),G.debug("get() error ".concat(Ae.t0)),Ce(Ae.t0);case 16:case"end":return Ae.stop()}},ge,null,[[4,12]])}));return function(ge,ae,Ce){return L.apply(this,arguments)}}())}},{key:"post",value:function(N,W,L,ge,ae){var Ce=this,we={"X-Twilio-Token":this.config.token};(typeof FormData>"u"||!(L instanceof FormData))&&ge&&Object.assign(we,{"Content-Type":ge});var $e=new URL(N);return W&&$e.searchParams.append("Category",W),ae&&$e.searchParams.append("Filename",ae),new Ot(function(){var Te=B.default(J.default.mark(function Le(Oe,Ae,je){var De,Tt;return J.default.wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return De=Ce.transport.post($e.href,we,L),je(function(){return De.cancel()}),G.trace("sending POST request to ".concat(N," with headers ").concat(we)),Fe.prev=3,Fe.next=6,De;case 6:Tt=Fe.sent,Fe.next=17;break;case 9:if(Fe.prev=9,Fe.t0=Fe.catch(3),!(n.XMLHttpRequest===void 0&&L instanceof FormData)){Fe.next=14;break}return Ae(new TypeError("Posting FormData supported only with browser engine's FormData")),Fe.abrupt("return");case 14:return G.debug("post() error ".concat(Fe.t0)),Ae(Fe.t0),Fe.abrupt("return");case 17:G.trace("response",Tt),Oe(Tt);case 19:case"end":return Fe.stop()}},Le,null,[[3,9]])}));return function(Le,Oe,Ae){return Te.apply(this,arguments)}}())}}]),D}(),V="0.6.8",ee,re=ye.scope("");e.default=(ee=function(){function D(z,N,W){var L,ge,ae=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};j.default(this,D),this.options=ae,this.options.logLevel=(L=this.options.logLevel)!==null&&L!==void 0?L:"silent",this.config=new Rt(z,N,W,this.options),re.setLevel(this.options.logLevel),this.options.transport=(ge=this.options.transport)!==null&&ge!==void 0?ge:new Z,this.transport=this.options.transport,this.network=new K(this.config,this.transport)}return H.default(D,[{key:"updateToken",value:function(N){re.info("updateToken"),this.config.updateToken(N)}},{key:"get",value:function(N){var W=this;return new Ot(function(){var L=B.default(J.default.mark(function ge(ae,Ce,we){var $e,Te;return J.default.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return $e=W.network.get("".concat(W.config.mediaUrl,"/").concat(N)),we(function(){return $e.cancel()}),Oe.prev=2,Oe.next=5,$e;case 5:Te=Oe.sent,ae(new Dt(W.config,W.network,Te.body)),Oe.next=12;break;case 9:Oe.prev=9,Oe.t0=Oe.catch(2),Ce(Oe.t0);case 12:case"end":return Oe.stop()}},ge,null,[[2,9]])}));return function(ge,ae,Ce){return L.apply(this,arguments)}}())}},{key:"post",value:function(N,W,L,ge){var ae=this;return new Ot(function(){var Ce=B.default(J.default.mark(function we($e,Te,Le){var Oe,Ae;return J.default.wrap(function(De){for(;;)switch(De.prev=De.next){case 0:return Oe=ae.network.post(ae.config.mediaUrl,L!=null?L:"media",W,N,ge),Le(function(){return Oe.cancel()}),De.prev=2,De.next=5,Oe;case 5:Ae=De.sent,$e(new Dt(ae.config,ae.network,Ae.body)),De.next=12;break;case 9:De.prev=9,De.t0=De.catch(2),Te(De.t0);case 12:case"end":return De.stop()}},we,null,[[2,9]])}));return function(we,$e,Te){return Ce.apply(this,arguments)}}())}},{key:"postFormData",value:function(N,W){var L=this;return new Ot(function(){var ge=B.default(J.default.mark(function ae(Ce,we,$e){var Te,Le;return J.default.wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return Te=L.network.post(L.config.mediaUrl,W!=null?W:"media",N),$e(function(){return Te.cancel()}),Ae.prev=2,Ae.next=5,Te;case 5:Le=Ae.sent,Ce(new Dt(L.config,L.network,Le.body)),Ae.next=12;break;case 9:Ae.prev=9,Ae.t0=Ae.catch(2),we(Ae.t0);case 12:case"end":return Ae.stop()}},ae,null,[[2,9]])}));return function(ae,Ce,we){return ge.apply(this,arguments)}}())}},{key:"mediaSetGet",value:function(N){var W=this;return new Ot(function(){var L=B.default(J.default.mark(function ge(ae,Ce,we){var $e,Te,Le,Oe;return J.default.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return $e={command:"get",list:N.map(function(De){return{media_sid:De}})},Te=W.network.post("".concat(W.config.mediaSetUrl),null,$e,"application/json"),we(function(){return Te.cancel()}),je.prev=3,je.next=6,Te;case 6:Le=je.sent,Oe=Le.body.map(function(De){if(De.code!==200){Ce("Failed to obtain detailed information about Media items (failed SID ".concat(De.media_record.sid,")"));return}return new Dt(W.config,W.network,De.media_record)}),ae(Oe),je.next=14;break;case 11:je.prev=11,je.t0=je.catch(3),Ce(je.t0);case 14:case"end":return je.stop()}},ge,null,[[3,11]])}));return function(ge,ae,Ce){return L.apply(this,arguments)}}())}},{key:"mediaSetGetContentUrls",value:function(N){var W=this;return new Ot(function(){var L=B.default(J.default.mark(function ge(ae,Ce,we){var $e,Te,Le,Oe;return J.default.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return $e={command:"get",list:N.map(function(De){return{media_sid:De}})},Te=W.network.post("".concat(W.config.mediaSetUrl),null,$e,"application/json"),we(function(){return Te.cancel()}),je.prev=3,je.next=6,Te;case 6:Le=je.sent,Oe=new Map,Le.body.forEach(function(De){if(De.code!==200){Ce("Failed to obtain detailed information about Media items (failed SID ".concat(De.media_record.sid,")"));return}Oe.set(De.media_record.sid,De.media_record.links.content_direct_temporary)}),ae(Oe),je.next=15;break;case 12:je.prev=12,je.t0=je.catch(3),Ce(je.t0);case 15:case"end":return je.stop()}},ge,null,[[3,12]])}));return function(ge,ae,Ce){return L.apply(this,arguments)}}())}}]),D}(),xe.default(ee,"version",V),ee),Ve([R.validateTypes(R.nonEmptyString),$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",void 0)],e.default.prototype,"updateToken",null),Ve([R.validateTypesAsync(R.nonEmptyString),$t("design:type",Function),$t("design:paramtypes",[String]),$t("design:returntype",Ot)],e.default.prototype,"get",null),e.default=Ve([R.validateConstructorTypes(R.nonEmptyString,R.nonEmptyString,[R.nonEmptyString,R.literal(null)],[R.pureObject,"undefined"]),$t("design:paramtypes",[String,String,Object,Object])],e.default),e.CancellablePromise=Ot,e.Client=e.default,e.McsClient=e.default,e.McsMedia=Dt,e.Media=Dt})(T0);var z0=St,S5=Xt,$5=cn,T5=z0.aTypedArray,k5=z0.exportTypedArrayMethod;k5("at",function(n){var t=T5(this),r=S5(t),a=$5(n),i=a>=0?a:r+a;return i<0||i>=r?void 0:t[i]});var I5=Je,E5=Xe,R5=iS,C5=Lo,Uv="ArrayBuffer",wm=R5[Uv],O5=E5[Uv];I5({global:!0,constructor:!0,forced:O5!==wm},{ArrayBuffer:wm});C5(Uv);var A5=Je,V0=Ke,P5=Lr,M5=Qt,_m=Xt,N5=yv,Sm=Bt,Dv=We,L5=Sv,x5=Bo,$m=GS,j5=HS,Tm=Ci,km=zS,Xn=[],Im=V0(Xn.sort),U5=V0(Xn.push),D5=Dv(function(){Xn.sort(void 0)}),F5=Dv(function(){Xn.sort(null)}),B5=x5("sort"),K0=!Dv(function(){if(Tm)return Tm<70;if(!($m&&$m>3)){if(j5)return!0;if(km)return km<603;var e="",n,t,r,a;for(n=65;n<76;n++){switch(t=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)Xn.push({k:t+a,v:r})}for(Xn.sort(function(i,s){return s.v-i.v}),a=0;a<Xn.length;a++)t=Xn[a].k.charAt(0),e.charAt(e.length-1)!==t&&(e+=t);return e!=="DGBEFHACIJK"}}),q5=D5||!F5||!B5||!K0,W5=function(e){return function(n,t){return t===void 0?-1:n===void 0?1:e!==void 0?+e(n,t)||0:Sm(n)>Sm(t)?1:-1}};A5({target:"Array",proto:!0,forced:q5},{sort:function(n){n!==void 0&&P5(n);var t=M5(this);if(K0)return n===void 0?Im(t):Im(t,n);var r=[],a=_m(t),i,s;for(s=0;s<a;s++)s in t&&U5(r,t[s]);for(L5(r,W5(n)),i=_m(r),s=0;s<i;)t[s]=r[s++];for(;s<a;)N5(t,s++);return t}});var G5=Je,H5=Ke,z5=k0,V5=Qr,Em=Bt,K5=I0,Y5=H5("".indexOf);G5({target:"String",proto:!0,forced:!K5("includes")},{includes:function(n){return!!~Y5(Em(V5(this)),Em(z5(n)),arguments.length>1?arguments[1]:void 0)}});var dl={},Y0={exports:{}};(function(e){(function(n,t){e.exports?e.exports=t():n.log=t()})(dr,function(){var n=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function i(M,x){var j=M[x];if(typeof j.bind=="function")return j.bind(M);try{return Function.prototype.bind.call(j,M)}catch(H){return function(){return Function.prototype.apply.apply(j,[M,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(M){return M==="debug"&&(M="log"),typeof console===t?!1:M==="trace"&&r?s:console[M]!==void 0?i(console,M):console.log!==void 0?i(console,"log"):n}function u(M,x){for(var j=0;j<a.length;j++){var H=a[j];this[H]=j<M?n:this.methodFactory(H,M,x)}this.log=this.debug}function v(M,x,j){return function(){typeof console!==t&&(u.call(this,x,j),this[M].apply(this,arguments))}}function g(M,x,j){return o(M)||v.apply(this,arguments)}function m(M,x,j){var H=this,me;x=x==null?"WARN":x;var ne="loglevel";typeof M=="string"?ne+=":"+M:typeof M=="symbol"&&(ne=void 0);function Ie(J){var pe=(a[J]||"silent").toUpperCase();if(!(typeof window===t||!ne)){try{window.localStorage[ne]=pe;return}catch(F){}try{window.document.cookie=encodeURIComponent(ne)+"="+pe+";"}catch(F){}}}function Ee(){var J;if(!(typeof window===t||!ne)){try{J=window.localStorage[ne]}catch(de){}if(typeof J===t)try{var pe=window.document.cookie,F=pe.indexOf(encodeURIComponent(ne)+"=");F!==-1&&(J=/^([^;]+)/.exec(pe.slice(F))[1])}catch(de){}return H.levels[J]===void 0&&(J=void 0),J}}function xe(){if(!(typeof window===t||!ne)){try{window.localStorage.removeItem(ne);return}catch(J){}try{window.document.cookie=encodeURIComponent(ne)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(J){}}}H.name=M,H.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},H.methodFactory=j||g,H.getLevel=function(){return me},H.setLevel=function(J,pe){if(typeof J=="string"&&H.levels[J.toUpperCase()]!==void 0&&(J=H.levels[J.toUpperCase()]),typeof J=="number"&&J>=0&&J<=H.levels.SILENT){if(me=J,pe!==!1&&Ie(J),u.call(H,J,M),typeof console===t&&J<H.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+J},H.setDefaultLevel=function(J){x=J,Ee()||H.setLevel(J,!1)},H.resetLevel=function(){H.setLevel(x,!1),xe()},H.enableAll=function(J){H.setLevel(H.levels.TRACE,J)},H.disableAll=function(J){H.setLevel(H.levels.SILENT,J)};var B=Ee();B==null&&(B=x),H.setLevel(B,!1)}var _=new m,w={};_.getLogger=function(x){if(typeof x!="symbol"&&typeof x!="string"||x==="")throw new TypeError("You must supply a name when creating a logger.");var j=w[x];return j||(j=w[x]=new m(x,_.getLevel(),_.methodFactory)),j};var R=typeof window!==t?window.log:void 0;return _.noConflict=function(){return typeof window!==t&&window.log===_&&(window.log=R),_},_.getLoggers=function(){return w},_.default=_,_})})(Y0);var J5=Y0.exports;/*
@license
Copyright (c) 2022 Twilio Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


*/Object.defineProperty(dl,"__esModule",{value:!0});var Q5=J5;function X5(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var Vu=X5(Q5),Z5=function(n,t,r){return function(a,i,s){if(typeof s.value!="function"&&(s==null?void 0:s.get)===void 0)throw new Error("The deprecated decorator can only be applied to methods or getters");if(typeof s.value=="function"){var o=s.value;s.value=function(){Xf("The method ".concat(n," is deprecated").concat(t?", use "+t+" instead":"").concat(r?", "+r:"."));for(var v=arguments.length,g=new Array(v),m=0;m<v;m++)g[m]=arguments[m];return o.apply(this,g)};return}var u=s.get;s.get=function(){return Xf("The getter ".concat(n," is deprecated").concat(t?", use "+t+" instead":"").concat(r?", "+r:".")),u==null?void 0:u.apply(this)}}},Xf=function(n){var t=Vu.default.getLevel();Vu.default.setLevel("warn"),Vu.default.warn(n),Vu.default.setLevel(t)};dl.deprecated=Z5;dl.deprecationWarning=Xf;var eW=Je,tW=Sr.find,rW=Ud,Zf="find",J0=!0;Zf in[]&&Array(1)[Zf](function(){J0=!1});eW({target:"Array",proto:!0,forced:J0},{find:function(n){return tW(this,n,arguments.length>1?arguments[1]:void 0)}});rW(Zf);/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2019, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes javascript-state-machine under the following license.

    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes q under the following license.

    Copyright 2009â2014 Kristopher Michael Kowal. All rights reserved.
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to
    deal in the Software without restriction, including without limitation the
    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
    sell copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
    IN THE SOFTWARE.

This software includes platform.js under the following license.

    Copyright 2014 Benjamin Tan <https://d10.github.io/>
    Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n=Ys,t=ja,r=pn,a=hn,i=Ur,s=Ua,o=ua,u=yn,v=Zs,g=jr,m=tu,_=DP,w=Gt,R=Yd,M=tx,x=xi,j=qn,H=Zo,me=n0,ne=hr,Ie=T0,Ee=ji,xe=dl,B=tl;function J(E){return E&&typeof E=="object"&&"default"in E?E:{default:E}}function pe(E){if(E&&E.__esModule)return E;var C=Object.create(null);return E&&Object.keys(E).forEach(function(S){if(S!=="default"){var b=Object.getOwnPropertyDescriptor(E,S);Object.defineProperty(C,S,b.get?b:{enumerable:!0,get:function(){return E[S]}})}}),C.default=E,Object.freeze(C)}var F=J(n),de=J(t),Pe=J(r),Me=J(a),_e=J(i),he=J(s),Ye=J(o),ze=J(u),k=J(v),te=J(g),le=pe(m),ce=J(M),Ne=J(x),be=J(Ee);function X(E,C,S,b){var d=arguments.length,h=d<3?C:b===null?b=Object.getOwnPropertyDescriptor(C,S):b,c;if((typeof Reflect>"u"?"undefined":te.default(Reflect))==="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(E,C,S,b);else for(var f=E.length-1;f>=0;f--)(c=E[f])&&(h=(d<3?c(h):d>3?c(C,S,h):c(C,S))||h);return d>3&&h&&Object.defineProperty(C,S,h),h}function I(E,C){if((typeof Reflect>"u"?"undefined":te.default(Reflect))==="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,C)}function tt(E,C){return["".concat(new Date().toISOString()," Conversations ").concat(E,":")].concat(Array.from(C))}var Se=le.getLogger("twilio-conversations"),ut=function(){function E(C){ze.default(this,E),he.default(this,"prefix",""),this.prefix=C!=null&&C.length>0?C+" ":""}return Ye.default(E,[{key:"setLevel",value:function(S){Se.setLevel(S)}},{key:"trace",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.trace.apply(null,tt(this.prefix+"T",b))}},{key:"debug",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.debug.apply(null,tt(this.prefix+"D",b))}},{key:"info",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.info.apply(null,tt(this.prefix+"I",b))}},{key:"warn",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.warn.apply(null,tt(this.prefix+"W",b))}},{key:"error",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.error.apply(null,tt(this.prefix+"E",b))}}],[{key:"scope",value:function(S){return new E(S)}},{key:"setLevel",value:function(S){Se.setLevel(S)}},{key:"trace",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.trace.apply(null,tt("T",b))}},{key:"debug",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.debug.apply(null,tt("D",b))}},{key:"info",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.info.apply(null,tt("I",b))}},{key:"warn",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.warn.apply(null,tt("W",b))}},{key:"error",value:function(){for(var S=arguments.length,b=new Array(S),d=0;d<S;d++)b[d]=arguments[d];Se.error.apply(null,tt("E",b))}}]),E}();function bt(E,C){var S=Object.keys(E);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(E);C&&(b=b.filter(function(d){return Object.getOwnPropertyDescriptor(E,d).enumerable})),S.push.apply(S,b)}return S}function Re(E){for(var C=1;C<arguments.length;C++){var S=arguments[C]!=null?arguments[C]:{};C%2?bt(Object(S),!0).forEach(function(b){he.default(E,b,S[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(S)):bt(Object(S)).forEach(function(b){Object.defineProperty(E,b,Object.getOwnPropertyDescriptor(S,b))})}return E}var Ht=5,Ge="PT5S",se="PT5S",Be=100,nt=1e3,ve=4e3,Ot=3,Ve=!0,$t=Ye.default(function E(){var C,S,b,d,h,c,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;ze.default(this,E),he.default(this,"typingIndicatorTimeoutDefault",Ht*1e3);var p=f.Chat||f.IPMessaging||f||{};this.productId=p.productId,this.links={myConversations:l.links.my_conversations,conversations:l.links.conversations,users:l.links.users,currentUser:l.links.current_user,typing:l.links.typing,mediaService:l.links.media_service,mediaSetService:l.links.media_set_service,messagesReceipts:l.links.messages_receipts},this.limits={mediaAttachmentsCountLimit:l.options.media_attachments_count_limit,mediaAttachmentSizeLimitInMb:l.options.media_attachment_size_limit_in_mb,mediaAttachmentsTotalSizeLimitInMb:l.options.media_attachments_total_size_limit_in_mb,emailHistoriesAllowedContentTypes:l.options.email_histories_allowed_mime_types,emailBodiesAllowedContentTypes:l.options.email_bodies_allowed_mime_types},this.typingIndicatorTimeoutOverride=p.typingIndicatorTimeoutOverride,this.backoffConfiguration=Re({min:nt,max:ve,maxAttemptsCount:Ot},p.backoffConfigOverride),this.retryWhenThrottled=p.retryWhenThrottledOverride!==void 0?p.retryWhenThrottledOverride:Ve,this.userInfosToSubscribe=(C=(S=p.userInfosToSubscribeOverride)!==null&&S!==void 0?S:l.options.user_infos_to_subscribe)!==null&&C!==void 0?C:Be,this.reachabilityEnabled=l.options.reachability_enabled,this.userIdentity=l.identity,this.userInfo=l.sync_objects.my_user_info,this.myConversations=l.sync_objects.my_conversations;var $=(b=(d=p.httpCacheIntervalOverride)!==null&&d!==void 0?d:l.options.http_cache_interval)!==null&&b!==void 0?b:Ge;try{this.httpCacheInterval=_.toSeconds(_.parse($))}catch(A){y.error("Failed to parse http cache interval ".concat($,", using default value ").concat(Ge)),this.httpCacheInterval=_.toSeconds(_.parse(Ge))}var T=(h=(c=p.consumptionReportIntervalOverride)!==null&&c!==void 0?c:l.options.consumption_report_interval)!==null&&h!==void 0?h:se;try{this.consumptionReportInterval=_.toSeconds(_.parse(T))}catch(A){y.error("Failed to parse consumption report interval ".concat(T,", using default value ").concat(se)),this.consumptionReportInterval=_.toSeconds(_.parse(se))}});function xt(E){return JSON.parse(JSON.stringify(E))}function ye(E){return typeof E<"u"&&!isNaN(Number(E))?Number(E):null}function Ut(E){try{return new Date(E)}catch(C){return null}}function Zt(E,C,S){var b={};if(E)try{b=JSON.parse(E)}catch(d){S.warn(C,d)}return b}var Ze=function(){function E(C){ze.default(this,E),this.base=C.replace(/\/$/,""),this.args=[],this.paths=[]}return Ye.default(E,[{key:"arg",value:function(S,b){return typeof b<"u"&&this.args.push(encodeURIComponent(S)+"="+encodeURIComponent(b)),this}},{key:"path",value:function(S){return this.paths.push(encodeURIComponent(S)),this}},{key:"build",value:function(){var S=this.base;return this.paths.length&&(S+="/"+this.paths.join("/")),this.args.length&&(S+="?"+this.args.join("&")),S}}]),E}(),ft=w.custom(function(E){return[["string","number","boolean","object"].includes(te.default(E)),"a JSON type"]}),et=w.custom(function(E){return[["undefined","string","number","boolean","object"].includes(te.default(E)),"an optional JSON type"]});function He(E){var C=Et();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function Et(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var Rt=ut.scope("User"),Dt=function(E){Pe.default(S,E);var C=He(S);function S(b,d,h,c){var f;return ze.default(this,S),f=C.call(this),he.default(de.default(f),"promiseToFetch",null),he.default(de.default(f),"updated","updated"),he.default(de.default(f),"userSubscribed","userSubscribed"),he.default(de.default(f),"userUnsubscribed","userUnsubscribed"),f.services=c,f.subscribed="initializing",f.setMaxListeners(0),f.state={identity:b,entityName:d,friendlyName:null,attributes:{},online:null,notifiable:null},f._initializationPromise=new Promise(function(l){f._resolveInitializationPromise=l}),h!==null&&f._resolveInitialization(h,b,d,!1),f}return Ye.default(S,[{key:"identity",get:function(){return this.state.identity},set:function(d){this.state.identity=d}},{key:"entityName",set:function(d){this.state.entityName=d}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"isOnline",get:function(){return this.state.online}},{key:"isNotifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return this.subscribed=="subscribed"}},{key:"_update",value:function(){var b=F.default(k.default.mark(function h(c,f){var l,y;return k.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,this._initializationPromise;case 2:l=[],Rt.debug("User for",this.state.identity,"updated:",c,f),$.t0=c,$.next=$.t0==="friendlyName"?7:$.t0==="attributes"?9:$.t0==="reachability"?12:15;break;case 7:return this.state.friendlyName!==f.value&&(l.push("friendlyName"),this.state.friendlyName=f.value),$.abrupt("break",16);case 9:return y=Zt(f.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),Rt),ce.default(this.state.attributes,y)||(this.state.attributes=y,l.push("attributes")),$.abrupt("break",16);case 12:return this.state.online!==f.online&&(this.state.online=f.online,l.push("reachabilityOnline")),this.state.notifiable!==f.notifiable&&(this.state.notifiable=f.notifiable,l.push("reachabilityNotifiable")),$.abrupt("break",16);case 15:return $.abrupt("return");case 16:l.length>0&&this.emit("updated",{user:this,updateReasons:l});case 17:case"end":return $.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"_updateReachabilityInfo",value:function(){var b=F.default(k.default.mark(function h(c,f){var l=this;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this._initializationPromise;case 2:if(this.configuration.reachabilityEnabled){p.next=4;break}return p.abrupt("return",Promise.resolve());case 4:return p.abrupt("return",c.get("reachability").then(f).catch(function($){Rt.warn("Failed to get reachability info for ",l.state.identity,$)}));case 5:case"end":return p.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"_fetch",value:function(){var b=F.default(k.default.mark(function h(){var c=this;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._initializationPromise;case 2:if(this.state.entityName){l.next=4;break}return l.abrupt("return",this);case 4:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then(function(y){return c.entity=y,y.on("itemUpdated",function(p){return Rt.debug(c.state.entityName+" ("+c.state.identity+") itemUpdated: "+p.item.key),c._update(p.item.key,p.item.data)}),Promise.all([y.get("friendlyName").then(function(p){return c._update(p.key,p.data)}),y.get("attributes").then(function(p){return c._update(p.key,p.data)}),c._updateReachabilityInfo(y,function(p){return c._update(p.key,p.data)})])}).then(function(){return Rt.debug("Fetched for",c.identity),c.subscribed="subscribed",c.emit("userSubscribed",c),c}).catch(function(y){throw c.promiseToFetch=null,y}),l.abrupt("return",this.promiseToFetch);case 6:case"end":return l.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_ensureFetched",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._initializationPromise;case 2:return f.abrupt("return",this.promiseToFetch||this._fetch());case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"updateAttributes",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._initializationPromise;case 2:if(this.subscribed!="unsubscribed"){l.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return l.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(c)});case 6:return l.abrupt("return",this);case 7:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"updateFriendlyName",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._initializationPromise;case 2:if(this.subscribed!="unsubscribed"){l.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return l.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:c});case 6:return l.abrupt("return",this);case 7:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"unsubscribe",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._initializationPromise;case 2:if(!this.promiseToFetch){f.next=9;break}return f.next=5,this.promiseToFetch;case 5:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 9:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_resolveInitialization",value:function(d,h,c,f){this.configuration=d,this.identity=h,this.entityName=c,this.links={self:"".concat(this.configuration.links.users,"/").concat(encodeURIComponent(this.identity))},this._resolveInitializationPromise(),f&&this.emit("updated",{user:this,updateReasons:["friendlyName","attributes","reachabilityOnline","reachabilityNotifiable"]})}}]),S}(R.ReplayEventEmitter);X([w.validateTypesAsync(ft),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],Dt.prototype,"updateAttributes",null),X([w.validateTypesAsync(["string"]),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Dt.prototype,"updateFriendlyName",null);function Zr(E,C){var S=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(!S){if(Array.isArray(E)||(S=gn(E))||C){S&&(E=S);var b=0,d=function(){};return{s:d,n:function(){return b>=E.length?{done:!0}:{done:!1,value:E[b++]}},e:function(y){throw y},f:d}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h=!0,c=!1,f;return{s:function(){S=S.call(E)},n:function(){var y=S.next();return h=y.done,y},e:function(y){c=!0,f=y},f:function(){try{!h&&S.return!=null&&S.return()}finally{if(c)throw f}}}}function gn(E,C){if(E){if(typeof E=="string")return Fr(E,C);var S=Object.prototype.toString.call(E).slice(8,-1);if(S==="Object"&&E.constructor&&(S=E.constructor.name),S==="Map"||S==="Set")return Array.from(E);if(S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return Fr(E,C)}}function Fr(E,C){(C==null||C>E.length)&&(C=E.length);for(var S=0,b=new Array(C);S<C;S++)b[S]=E[S];return b}var lr=function(){function E(C,S){ze.default(this,E),this.configuration=C,this.services=S,this.cache=new Map,this.cacheLifetime=this.configuration.httpCacheInterval*100,this.cleanupCache()}return Ye.default(E,[{key:"isExpired",value:function(S){return!this.cacheLifetime||Date.now()-S>this.cacheLifetime}},{key:"cleanupCache",value:function(){var S=Zr(this.cache),b;try{for(S.s();!(b=S.n()).done;){var d=Ne.default(b.value,2),h=d[0],c=d[1];this.isExpired(c.timestamp)&&this.cache.delete(h)}}catch(f){S.e(f)}finally{S.f()}this.cache.size===0&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var S=this;this.timer=this.timer||setInterval(function(){return S.cleanupCache()},this.cacheLifetime*2)}},{key:"executeWithRetry",value:function(S){var b=this,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise(function(h,c){var f=[502,503,504];d&&f.push(429);var l=new j.Retrier(b.configuration.backoffConfiguration);l.on("attempt",function(){S().then(function(y){return l.succeeded(y)}).catch(function(y){f.indexOf(y.status)>-1||y.message==="Twilsock disconnected"?l.failed(y):(l.removeAllListeners(),l.cancel(),c(y))})}),l.on("succeeded",function(y){h(y)}),l.on("cancelled",function(y){return c(y)}),l.on("failed",function(y){return c(y)}),l.start()})}},{key:"get",value:function(){var C=F.default(k.default.mark(function b(d){var h=this,c,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(c=this.cache.get(d),!(c&&!this.isExpired(c.timestamp))){p.next=3;break}return p.abrupt("return",c.response);case 3:return f={},p.next=6,this.executeWithRetry(function(){return h.services.transport.get(d,f,h.configuration.productId)},this.configuration.retryWhenThrottled);case 6:return l=p.sent,this.cache.set(d,{response:l,timestamp:Date.now()}),this.pokeTimer(),p.abrupt("return",l);case 10:case"end":return p.stop()}},b,this)}));function S(b){return C.apply(this,arguments)}return S}()}]),E}(),dt=Ye.default(function E(){ze.default(this,E)});he.default(dt,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),he.default(dt,"NEW_MESSAGE","twilio.conversations.new_message"),he.default(dt,"ADDED_TO_CONVERSATION","twilio.conversations.added_to_conversation"),he.default(dt,"REMOVED_FROM_CONVERSATION","twilio.conversations.removed_from_conversation"),he.default(dt,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");function Q(E){var C=Z();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function Z(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var G=ut.scope("Participant"),K=function(E){Pe.default(S,E);var C=Q(S);function S(b,d,h,c,f){var l,y,p;if(ze.default(this,S),p=C.call(this),p.conversation=h,p.links=c,p.services=f,p.state={attributes:Zt(b.attributes,"Retrieved malformed attributes from the server for participant: "+d,G),dateCreated:b.dateCreated?Ut(b.dateCreated):null,dateUpdated:b.dateCreated?Ut(b.dateUpdated):null,sid:d,typingTimeout:null,isTyping:!1,identity:b.identity,roleSid:(l=b.roleSid)!==null&&l!==void 0?l:"",lastReadMessageIndex:Number.isInteger(b.lastConsumedMessageIndex)?b.lastConsumedMessageIndex:null,lastReadTimestamp:b.lastConsumptionTimestamp?Ut(b.lastConsumptionTimestamp):null,type:b.type||"chat",userInfo:b.userInfo,bindings:(y=b.bindings)!==null&&y!==void 0?y:{}},!b.identity&&!b.type)throw new Error("Received invalid Participant object from server: Missing identity or type of Participant.");return p}return Ye.default(S,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastReadMessageIndex",get:function(){return this.state.lastReadMessageIndex}},{key:"lastReadTimestamp",get:function(){return this.state.lastReadTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"bindings",get:function(){var d;return(d=this.state.bindings)!==null&&d!==void 0?d:{}}},{key:"_startTyping",value:function(d){var h=this;return this.state.typingTimeout&&clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.conversation.emit("typingStarted",this),this.state.typingTimeout=Number(setTimeout(function(){return h._endTyping()},d)),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.conversation.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(d){var h=[],c=Zt(d.attributes,"Retrieved malformed attributes from the server for participant: "+this.state.sid,G);d.attributes&&!ce.default(this.state.attributes,c)&&(this.state.attributes=c,h.push("attributes"));var f=Ut(d.dateUpdated);d.dateUpdated&&(f==null?void 0:f.getTime())!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=f,h.push("dateUpdated"));var l=Ut(d.dateCreated);if(d.dateCreated&&(l==null?void 0:l.getTime())!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=l,h.push("dateCreated")),d.roleSid&&this.state.roleSid!==d.roleSid&&(this.state.roleSid=d.roleSid,h.push("roleSid")),(Number.isInteger(d.lastConsumedMessageIndex)||d.lastConsumedMessageIndex===null)&&this.state.lastReadMessageIndex!==d.lastConsumedMessageIndex&&(this.state.lastReadMessageIndex=d.lastConsumedMessageIndex,h.push("lastReadMessageIndex")),d.lastConsumptionTimestamp){var y=new Date(d.lastConsumptionTimestamp);(!this.state.lastReadTimestamp||this.state.lastReadTimestamp.getTime()!==y.getTime())&&(this.state.lastReadTimestamp=y,h.push("lastReadTimestamp"))}return d.bindings&&!ce.default(this.state.bindings,d.bindings)&&(this.state.bindings=d.bindings,h.push("bindings")),h.length>0&&this.emit("updated",{participant:this,updateReasons:h}),this}},{key:"getUser",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.type=="chat"){f.next=2;break}throw new Error("Getting User is not supported for this Participant type: "+this.type);case 2:return f.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"remove",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",this.conversation.removeParticipant(this));case 1:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"updateAttributes",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(c)});case 2:return l.abrupt("return",this);case 3:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()}]),S}(R.ReplayEventEmitter);he.default(K,"typingStarted","typingStarted"),he.default(K,"typingEnded","typingEnded"),he.default(K,"updated","updated"),X([w.validateTypesAsync(ft),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],K.prototype,"updateAttributes",null);function V(E){var C=ee();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function ee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var re=ut.scope("Participants"),D=function(E){Pe.default(S,E);var C=V(S);function S(b,d,h,c,f){var l;return ze.default(this,S),l=C.call(this),he.default(de.default(l),"rosterEntityPromise",null),l.conversation=b,l.participants=d,l.links=h,l.configuration=c,l.services=f,l}return Ye.default(S,[{key:"unsubscribe",value:function(){var b=F.default(k.default.mark(function h(){var c;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.rosterEntityPromise){l.next=6;break}return l.next=3,this.rosterEntityPromise;case 3:c=l.sent,c.close(),this.rosterEntityPromise=null;case 6:case"end":return l.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"subscribe",value:function(d){var h=this,c=typeof d=="string"?this.services.syncClient.map({id:d,mode:"open_existing"}):Promise.resolve(d);return this.rosterEntityPromise=this.rosterEntityPromise||c.then(function(f){f.on("itemAdded",function(p){re.debug(h.conversation.sid+" itemAdded: "+p.item.key),h.upsertParticipant(p.item.key,p.item.data).then(function($){h.emit("participantJoined",$)})}),f.on("itemRemoved",function(p){re.debug(h.conversation.sid+" itemRemoved: "+p.key);var $=p.key;if(h.participants.has($)){var T=h.participants.get($);h.participants.delete($),T&&h.emit("participantLeft",T)}}),f.on("itemUpdated",function(p){re.debug(h.conversation.sid+" itemUpdated: "+p.item.key),h.upsertParticipant(p.item.key,p.item.data)});var l=[],y=function p($){return $.items.forEach(function(T){l.push(h.upsertParticipant(T.key,T.data))}),$.hasNextPage?$.nextPage().then(p):null};return f.getItems().then(y).then(function(){return Promise.all(l)}).then(function(){return f})}).catch(function(f){throw h.rosterEntityPromise=null,h.services.syncClient.connectionState!="disconnected"&&re.error("Failed to get roster object for conversation",h.conversation.sid,f),re.debug("ERROR: Failed to get roster object for conversation",h.conversation.sid,f),f})}},{key:"upsertParticipantFromResponse",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y,p,$,T,A,P;return k.default.wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return l=c.sid,y=c.attributes,p=c.date_created,$=c.date_updated,T=c.identity,A=c.role_sid,P=c.messaging_binding,Ue.next=3,this.upsertParticipant(l,{attributes:y,dateCreated:new Date(p),dateUpdated:new Date($),identity:T,roleSid:A,lastConsumedMessageIndex:null,lastConsumptionTimestamp:null,type:(f=P==null?void 0:P.type)!==null&&f!==void 0?f:"chat"});case 3:return Ue.abrupt("return",Ue.sent);case 4:case"end":return Ue.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"upsertParticipant",value:function(){var b=F.default(k.default.mark(function h(c,f){var l=this,y,p;return k.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(y=this.participants.get(c),!y){T.next=3;break}return T.abrupt("return",y._update(f));case 3:return p={self:"".concat(this.links.participants,"/").concat(c)},y=new K(f,c,this.conversation,p,this.services),this.participants.set(c,y),y.on("updated",function(A){return l.emit("participantUpdated",A)}),T.abrupt("return",y);case 8:case"end":return T.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"getParticipants",value:function(){var b=F.default(k.default.mark(function h(){var c=this;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var y=[];return c.participants.forEach(function(p){return y.push(p)}),y}):[]);case 1:case"end":return l.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getParticipantBySid",value:function(){var b=F.default(k.default.mark(function h(c){var f=this;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){var p=f.participants.get(c);if(!p)throw new Error("Participant with SID "+c+" was not found");return p}):null);case 1:case"end":return y.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getParticipantByIdentity",value:function(){var b=F.default(k.default.mark(function h(c){var f=this,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=null,p.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then(function(){if(f.participants.forEach(function($){$.identity===c&&(l=$)}),!l)throw new Error("Participant with identity "+c+" was not found");return l}):null);case 2:case"end":return p.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"add",value:function(){var b=F.default(k.default.mark(function h(c,f){return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:c,attributes:typeof f<"u"?JSON.stringify(f):void 0});case 2:return y.abrupt("return",y.sent);case 3:case"end":return y.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"addNonChatParticipant",value:function(){var b=F.default(k.default.mark(function h(c,f){var l,y,p,$,T=arguments;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return p=T.length>2&&T[2]!==void 0?T[2]:{},$=T.length>3&&T[3]!==void 0?T[3]:{},P.next=4,this.services.commandExecutor.mutateResource("post",this.links.participants,{attributes:typeof p<"u"?JSON.stringify(p):void 0,messaging_binding:{address:f,proxy_address:c,name:$==null||(l=$.email)===null||l===void 0?void 0:l.name,level:$==null||(y=$.email)===null||y===void 0?void 0:y.level}});case 4:return P.abrupt("return",P.sent);case 5:case"end":return P.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"remove",value:function(d){return this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(d))}}]),S}(R.ReplayEventEmitter),z=function(){function E(C,S){ze.default(this,E),he.default(this,"mcsMedia",null),this.services=S,C instanceof Ie.McsMedia&&(this.mcsMedia=C),this.state={sid:C.sid,category:C.category,filename:C.filename,contentType:C.contentType,size:C.size}}return Ye.default(E,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"category",get:function(){return this.state.category}},{key:"getContentTemporaryUrl",value:function(){var S=this;return new Ie.CancellablePromise(function(){var b=F.default(k.default.mark(function d(h,c,f){var l,y,p,$;return k.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(y=S._fetchMcsMedia(),p=(l=S.mcsMedia)===null||l===void 0?void 0:l.getContentUrl(),f(function(){y.cancel(),p&&p.cancel()}),A.prev=3,S.mcsMedia){A.next=9;break}return A.next=7,y;case 7:$=A.sent,p=$.getContentUrl();case 9:if(A.t0=h,!p){A.next=16;break}return A.next=13,p;case 13:A.t1=A.sent,A.next=17;break;case 16:A.t1=null;case 17:A.t2=A.t1,(0,A.t0)(A.t2),A.next=24;break;case 21:A.prev=21,A.t3=A.catch(3),c(A.t3);case 24:case"end":return A.stop()}},d,null,[[3,21]])}));return function(d,h,c){return b.apply(this,arguments)}}())}},{key:"_fetchMcsMedia",value:function(){var S=this;return new Ie.CancellablePromise(function(){var b=F.default(k.default.mark(function d(h,c,f){var l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(l=S.services.mcsClient.get(S.state.sid),!S.services.mcsClient){p.next=14;break}return f(function(){return l.cancel()}),p.prev=3,p.next=6,l;case 6:S.mcsMedia=p.sent,h(S.mcsMedia),p.next=13;break;case 10:p.prev=10,p.t0=p.catch(3),c(p.t0);case 13:return p.abrupt("return");case 14:c(new Error("Media Content Service is unavailable"));case 15:case"end":return p.stop()}},d,null,[[3,10]])}));return function(d,h,c){return b.apply(this,arguments)}}())}}]),E}(),N=function(){function E(C){ze.default(this,E),this.state=C}return Ye.default(E,[{key:"total",get:function(){return this.state.total}},{key:"sent",get:function(){return this.state.sent}},{key:"delivered",get:function(){return this.state.delivered}},{key:"read",get:function(){return this.state.read}},{key:"undelivered",get:function(){return this.state.undelivered}},{key:"failed",get:function(){return this.state.failed}},{key:"_update",value:function(S){this.state=S}},{key:"_isEquals",value:function(S){var b=this.total===S.total,d=this.sent===S.sent,h=this.delivered===S.delivered,c=this.read===S.read,f=this.undelivered===S.undelivered,l=this.failed===S.failed;return b&&d&&h&&c&&f&&l}}]),E}(),W=function(){function E(C,S,b,d){ze.default(this,E),this.state={prevToken:b,nextToken:d,source:S,items:C}}return Ye.default(E,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(new Error("No previous page"))}}]),E}(),L=Ye.default(function E(C){ze.default(this,E),this.sid=C.sid,this.messageSid=C.message_sid,this.conversationSid=C.conversation_sid,this.channelMessageSid=C.channel_message_sid,this.participantSid=C.participant_sid,this.status=C.status||"queued",this.errorCode=C.error_code||0,this.dateCreated=C.date_created,this.dateUpdated=C.date_updated});function ge(E,C){var S=Object.keys(E);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(E);C&&(b=b.filter(function(d){return Object.getOwnPropertyDescriptor(E,d).enumerable})),S.push.apply(S,b)}return S}function ae(E){for(var C=1;C<arguments.length;C++){var S=arguments[C]!=null?arguments[C]:{};C%2?ge(Object(S),!0).forEach(function(b){he.default(E,b,S[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(S)):ge(Object(S)).forEach(function(b){Object.defineProperty(E,b,Object.getOwnPropertyDescriptor(S,b))})}return E}function Ce(E){var C=we();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function we(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var $e=ut.scope("Message"),Te=function(E){Pe.default(S,E);var C=Ce(S);function S(b,d,h,c,f,l){var y,p,$,T,A;return ze.default(this,S),A=C.call(this),A.conversation=h,A.links=c,A.configuration=f,A.services=l,A.state={sid:d.sid,index:b,author:d.author,subject:d.subject,body:(y=d.text)!==null&&y!==void 0?y:null,timestamp:d.timestamp?new Date(d.timestamp):null,dateUpdated:d.dateUpdated?new Date(d.dateUpdated):null,lastUpdatedBy:(p=d.lastUpdatedBy)!==null&&p!==void 0?p:null,attributes:Zt(d.attributes,"Got malformed attributes for the message ".concat(d.sid),$e),type:($=d.type)!==null&&$!==void 0?$:"text",media:d.type==="media"&&d.media?new z(d.media,A.services):null,medias:d.type==="media"&&d.medias?d.medias.map(function(P){return new z(P,A.services)}):d.type==="media"&&d.media&&!d.medias?[new z(ae(ae({},d.media),{},{category:"media"}),A.services)]:null,participantSid:(T=d.memberSid)!==null&&T!==void 0?T:null,aggregatedDeliveryReceipt:d.delivery?new N(d.delivery):null},A}return Ye.default(S,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"subject",get:function(){return this.state.subject}},{key:"body",get:function(){return this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"attachedMedia",get:function(){return this.getMediaByCategories(["media"])}},{key:"participantSid",get:function(){return this.state.participantSid}},{key:"aggregatedDeliveryReceipt",get:function(){return this.state.aggregatedDeliveryReceipt}},{key:"getMediaByCategory",value:function(d){return this.getMediaByCategories(d)}},{key:"getMediaByCategories",value:function(d){var h;return((h=this.state.medias)!==null&&h!==void 0?h:[]).filter(function(c){return d.includes(c.category)})}},{key:"getEmailBody",value:function(){var d,h,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"text/plain";return(d=(h=this.getMediaByCategories(["body"]))===null||h===void 0?void 0:h.filter(function(f){return f.contentType==c}).shift())!==null&&d!==void 0?d:null}},{key:"getEmailHistory",value:function(){var d,h,c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"text/plain";return(d=(h=this.getMediaByCategories(["history"]))===null||h===void 0?void 0:h.filter(function(f){return f.contentType==c}).shift())!==null&&d!==void 0?d:null}},{key:"_update",value:function(d){var h=[];(d.text||typeof d.text=="string")&&d.text!==this.state.body&&(this.state.body=d.text,h.push("body")),d.subject&&d.subject!==this.state.subject&&(this.state.subject=d.subject,h.push("subject")),d.lastUpdatedBy&&d.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=d.lastUpdatedBy,h.push("lastUpdatedBy")),d.author&&d.author!==this.state.author&&(this.state.author=d.author,h.push("author")),d.dateUpdated&&new Date(d.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(d.dateUpdated),h.push("dateUpdated")),d.timestamp&&new Date(d.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(d.timestamp),h.push("dateCreated"));var c=Zt(d.attributes,"Got malformed attributes for the message ".concat(this.sid),$e);ce.default(this.state.attributes,c)||(this.state.attributes=c,h.push("attributes"));var f=d.delivery,l=this.state.aggregatedDeliveryReceipt,y=!!f&&!!f.total&&!!f.delivered&&!!f.failed&&!!f.read&&!!f.sent&&!!f.undelivered;y&&(l?l._isEquals(f)||(l._update(f),h.push("deliveryReceipt")):(this.state.aggregatedDeliveryReceipt=new N(f),h.push("deliveryReceipt"))),h.length>0&&this.emit("updated",{message:this,updateReasons:h})}},{key:"getParticipant",value:function(){var b=F.default(k.default.mark(function h(){var c=this,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(f=null,!this.state.participantSid){p.next=5;break}return p.next=4,this.conversation.getParticipantBySid(this.state.participantSid).catch(function(){return $e.debug('Participant with sid "'.concat(c.participantSid,'" not found for message ').concat(c.sid)),null});case 4:f=p.sent;case 5:if(!(!f&&this.state.author)){p.next=9;break}return p.next=8,this.conversation.getParticipantByIdentity(this.state.author).catch(function(){return $e.debug('Participant with identity "'.concat(c.author,'" not found for message ').concat(c.sid)),null});case 8:f=p.sent;case 9:if(!f){p.next=11;break}return p.abrupt("return",f);case 11:throw l="Participant with ",this.state.participantSid&&(l+="SID '"+this.state.participantSid+"' "),this.state.author&&(this.state.participantSid&&(l+="or "),l+="identity '"+this.state.author+"' "),l==="Participant with "&&(l="Participant "),l+="was not found",new Error(l);case 17:case"end":return p.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getDetailedDeliveryReceipts",value:function(){var b=F.default(k.default.mark(function h(){var c,f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._getDetailedDeliveryReceiptsPaginator();case 2:c=y.sent,f=c.items;case 4:if(!c.hasNextPage){y.next=11;break}return y.next=7,c.nextPage();case 7:c=y.sent,f=[].concat(be.default(f),be.default(c.items)),y.next=4;break;case 11:return y.abrupt("return",f);case 12:case"end":return y.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"remove",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return f.abrupt("return",this);case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"updateBody",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:c});case 2:return l.abrupt("return",this);case 3:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"updateAttributes",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:typeof c<"u"?JSON.stringify(c):void 0});case 2:return l.abrupt("return",this);case 3:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"attachTemporaryUrlsFor",value:function(){var b=F.default(k.default.mark(function h(c){var f=this,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(l=c==null?void 0:c.map(function($){return $.sid}),!(this.services.mcsClient&&l)){p.next=7;break}return p.next=4,this.services.mcsClient.mediaSetGet(l);case 4:return p.abrupt("return",p.sent.map(function($){return new z($,f.services)}));case 7:throw new Error("Media Content Service is unavailable");case 8:case"end":return p.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getTemporaryContentUrlsForMedia",value:function(d){var h=d.map(function(c){return c.sid});return this.getTemporaryContentUrlsForMediaSids(h)}},{key:"getTemporaryContentUrlsForMediaSids",value:function(d){var h=this;return new Ie.CancellablePromise(function(){var c=F.default(k.default.mark(function f(l,y,p){var $,T;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if($=h.services.mcsClient.mediaSetGetContentUrls(d!=null?d:[]),!(!h.services.mcsClient||!d)){P.next=4;break}return y(new Error("Media Content Service is unavailable")),P.abrupt("return");case 4:return p(function(){$.cancel()}),P.prev=5,P.next=8,$;case 8:T=P.sent,l(T),P.next=15;break;case 12:P.prev=12,P.t0=P.catch(5),y(P.t0);case 15:case"end":return P.stop()}},f,null,[[5,12]])}));return function(f,l,y){return c.apply(this,arguments)}}())}},{key:"getTemporaryContentUrlsForAttachedMedia",value:function(){var d,h=this.attachedMedia,c=(d=h==null?void 0:h.map(function(f){return f.sid}))!==null&&d!==void 0?d:[];return this.getTemporaryContentUrlsForMediaSids(c)}},{key:"_getDetailedDeliveryReceiptsPaginator",value:function(){var b=F.default(k.default.mark(function h(c){var f=this,l,y,p;return k.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return l=this.configuration.links.messagesReceipts.replace("%s",this.conversation.sid).replace("%s",this.sid),y=new Ze(l).arg("PageToken",c==null?void 0:c.pageToken).arg("PageSize",c==null?void 0:c.pageSize).build(),T.next=4,this.services.network.get(y);case 4:return p=T.sent,T.abrupt("return",new W(p.body.delivery_receipts.map(function(A){return new L(A)}),function(A,P){return f._getDetailedDeliveryReceiptsPaginator({pageToken:A,pageSize:P})},p.body.meta.previous_token,p.body.meta.next_token));case 6:case"end":return T.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()}]),S}(R.ReplayEventEmitter);he.default(Te,"updated","updated"),X([xe.deprecated("getMediaByCategory","getMediaByCategories"),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Array)],Te.prototype,"getMediaByCategory",null),X([w.validateTypes([w.nonEmptyString,"undefined"]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",z)],Te.prototype,"getEmailBody",null),X([w.validateTypes([w.nonEmptyString,"undefined"]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",z)],Te.prototype,"getEmailHistory",null),X([w.validateTypesAsync("string"),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],Te.prototype,"updateBody",null),X([w.validateTypesAsync(ft),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],Te.prototype,"updateAttributes",null),X([xe.deprecated("attachTemporaryUrlsFor","getTemporaryContentUrlsForMedia"),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Promise)],Te.prototype,"attachTemporaryUrlsFor",null),X([w.validateTypesAsync(w.nonEmptyArray("media",z)),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Ie.CancellablePromise)],Te.prototype,"getTemporaryContentUrlsForMedia",null),X([w.validateTypesAsync(w.nonEmptyArray("strings","string")),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Ie.CancellablePromise)],Te.prototype,"getTemporaryContentUrlsForMediaSids",null);function Le(E,C){var S=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(!S){if(Array.isArray(E)||(S=Oe(E))||C){S&&(E=S);var b=0,d=function(){};return{s:d,n:function(){return b>=E.length?{done:!0}:{done:!1,value:E[b++]}},e:function(y){throw y},f:d}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h=!0,c=!1,f;return{s:function(){S=S.call(E)},n:function(){var y=S.next();return h=y.done,y},e:function(y){c=!0,f=y},f:function(){try{!h&&S.return!=null&&S.return()}finally{if(c)throw f}}}}function Oe(E,C){if(E){if(typeof E=="string")return Ae(E,C);var S=Object.prototype.toString.call(E).slice(8,-1);if(S==="Object"&&E.constructor&&(S=E.constructor.name),S==="Map"||S==="Set")return Array.from(E);if(S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return Ae(E,C)}}function Ae(E,C){(C==null||C>E.length)&&(C=E.length);for(var S=0,b=new Array(C);S<C;S++)b[S]=E[S];return b}function je(E){var C=De();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function De(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var Tt=ut.scope("Messages"),yr=function(E){Pe.default(S,E);var C=je(S);function S(b,d,h){var c;return ze.default(this,S),c=C.call(this),c.conversation=b,c.configuration=d,c.services=h,c.messagesByIndex=new Map,c.messagesListPromise=null,c}return Ye.default(S,[{key:"subscribe",value:function(){var b=F.default(k.default.mark(function h(c){var f=this,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!this.messagesListPromise){p.next=2;break}return p.abrupt("return",this.messagesListPromise);case 2:return this.messagesListPromise=typeof c=="string"?this.services.syncClient.list({id:c,mode:"open_existing"}):Promise.resolve(c),p.prev=3,p.next=6,this.messagesListPromise;case 6:return l=p.sent,l.on("itemAdded",function($){Tt.debug("".concat(f.conversation.sid," itemAdded: ").concat($.item.index));var T={self:"".concat(f.conversation._links.messages,"/").concat($.item.data.sid),conversation:f.conversation._links.self,messages_receipts:"".concat(f.conversation._links.messages,"/").concat($.item.data.sid,"/Receipts")},A=new Te($.item.index,$.item.data,f.conversation,T,f.configuration,f.services);if(f.messagesByIndex.has(A.index)){Tt.debug("Message arrived, but is already known and ignored",f.conversation.sid,A.index);return}f.messagesByIndex.set(A.index,A),A.on("updated",function(P){return f.emit("messageUpdated",P)}),f.emit("messageAdded",A)}),l.on("itemRemoved",function($){Tt.debug("#{this.conversation.sid} itemRemoved: ".concat($.index));var T=$.index;if(f.messagesByIndex.has(T)){var A=f.messagesByIndex.get(T);if(!A)return;f.messagesByIndex.delete(A.index),A.removeAllListeners("updated"),f.emit("messageRemoved",A)}}),l.on("itemUpdated",function($){Tt.debug("".concat(f.conversation.sid," itemUpdated: ").concat($.item.index));var T=f.messagesByIndex.get($.item.index);T&&T._update($.item.data)}),p.abrupt("return",l);case 13:throw p.prev=13,p.t0=p.catch(3),this.messagesListPromise=null,this.services.syncClient.connectionState!=="disconnected"&&Tt.error("Failed to get messages object for conversation",this.conversation.sid,p.t0),Tt.debug("ERROR: Failed to get messages object for conversation",this.conversation.sid,p.t0),p.t0;case 19:case"end":return p.stop()}},h,this,[[3,13]])}));function d(h){return b.apply(this,arguments)}return d}()},{key:"unsubscribe",value:function(){var b=F.default(k.default.mark(function h(){var c;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.messagesListPromise){l.next=2;break}return l.abrupt("return");case 2:return l.next=4,this.messagesListPromise;case 4:c=l.sent,c.close(),this.messagesListPromise=null;case 7:case"end":return l.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"sendV2",value:function(d){var h=this;return Tt.debug("Sending message V2",d.mediaContent,d.attributes,d.emailOptions),new Ie.CancellablePromise(function(){var c=F.default(k.default.mark(function f(l,y,p){var $,T,A,P,ue,Ue,kt,qe,Yt,zt,er,O;return k.default.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:T=[],A=[],p(function(){A.forEach(function(ke){return ke.cancel()})}),P=Le(d.mediaContent),Y.prev=4,P.s();case 6:if((ue=P.n()).done){Y.next=25;break}return Ue=Ne.default(ue.value,2),kt=Ue[0],qe=Ue[1],Y.prev=8,Tt.debug("Adding media to a message as ".concat(qe instanceof FormData?"FormData":"SendMediaOptions"),qe),er=qe instanceof FormData?h.services.mcsClient.postFormData(qe,kt):h.services.mcsClient.post((Yt=qe.contentType)!==null&&Yt!==void 0?Yt:"",(zt=qe.media)!==null&&zt!==void 0?zt:"",kt,qe.filename),A.push(er),Y.t0=T,Y.next=15,er;case 15:Y.t1=Y.sent,Y.t0.push.call(Y.t0,Y.t1),Y.next=23;break;case 19:return Y.prev=19,Y.t2=Y.catch(8),y(Y.t2),Y.abrupt("return");case 23:Y.next=6;break;case 25:Y.next=30;break;case 27:Y.prev=27,Y.t3=Y.catch(4),P.e(Y.t3);case 30:return Y.prev=30,P.f(),Y.finish(30);case 33:return O=h.services.commandExecutor.mutateResource("post",h.conversation._links.messages,{body:d.text,subject:($=d.emailOptions)===null||$===void 0?void 0:$.subject,media_sids:T.map(function(ke){return ke.sid}),attributes:typeof d.attributes<"u"?JSON.stringify(d.attributes):void 0}),Y.prev=34,Y.t4=l,Y.next=38,O;case 38:Y.t5=Y.sent,(0,Y.t4)(Y.t5),Y.next=45;break;case 42:Y.prev=42,Y.t6=Y.catch(34),y(Y.t6);case 45:case"end":return Y.stop()}},f,null,[[4,27,30,33],[8,19],[34,42]])}));return function(f,l,y){return c.apply(this,arguments)}}())}},{key:"send",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y=arguments;return k.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return f=y.length>1&&y[1]!==void 0?y[1]:{},l=y.length>2?y[2]:void 0,Tt.debug("Sending text message",c,f,l),$.abrupt("return",this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{body:c!=null?c:"",attributes:typeof f<"u"?JSON.stringify(f):void 0,subject:l==null?void 0:l.subject}));case 4:case"end":return $.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"sendMedia",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y,p,$,T=arguments;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(y=T.length>1&&T[1]!==void 0?T[1]:{},p=T.length>2?T[2]:void 0,Tt.debug("Sending media message",c,y,p),Tt.debug("Sending media message as ".concat(c instanceof FormData?"FormData":"SendMediaOptions"),c,y),!(c instanceof FormData)){P.next=10;break}return P.next=7,this.services.mcsClient.postFormData(c);case 7:P.t0=P.sent,P.next=13;break;case 10:return P.next=12,this.services.mcsClient.post((f=c.contentType)!==null&&f!==void 0?f:"",(l=c.media)!==null&&l!==void 0?l:"","media",c.filename);case 12:P.t0=P.sent;case 13:return $=P.t0,P.next=16,this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{media_sids:[$.sid],attributes:typeof y<"u"?JSON.stringify(y):void 0});case 16:return P.abrupt("return",P.sent);case 17:case"end":return P.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getMessages",value:function(){var b=F.default(k.default.mark(function h(c,f){var l,y=arguments;return k.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return l=y.length>2&&y[2]!==void 0?y[2]:"backwards",$.abrupt("return",this._getMessages(c,f,l));case 2:case"end":return $.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"_wrapPaginator",value:function(d,h,c){var f=this,l=d==="desc",y=function(){return h.nextPage().then(function(T){return f._wrapPaginator(d,T,c)})},p=function(){return h.prevPage().then(function(T){return f._wrapPaginator(d,T,c)})};return c(h.items).then(function($){return{items:$.sort(function(T,A){return T.index-A.index}),hasPrevPage:l?h.hasNextPage:h.hasPrevPage,hasNextPage:l?h.hasPrevPage:h.hasNextPage,prevPage:l?y:p,nextPage:l?p:y}})}},{key:"_upsertMessage",value:function(d,h){var c=this,f=this.messagesByIndex.get(d);if(f)return f;var l={self:"".concat(this.conversation._links.messages,"/").concat(h.sid),conversation:this.conversation._links.self,messages_receipts:"".concat(this.conversation._links.messages,"/").concat(h.sid,"/Receipts")},y=new Te(d,h,this.conversation,l,this.configuration,this.services);return this.messagesByIndex.set(y.index,y),y.on("updated",function(p){return c.emit("messageUpdated",p)}),y}},{key:"_getMessages",value:function(){var b=F.default(k.default.mark(function h(){var c=this,f,l,y,p,$,T,A=arguments;return k.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return f=A.length>0&&A[0]!==void 0?A[0]:30,l=A.length>1&&A[1]!==void 0?A[1]:"end",y=A.length>2&&A[2]!==void 0?A[2]:"forward",p=y==="backwards"?"desc":"asc",ue.next=6,this.messagesListPromise;case 6:return $=ue.sent,ue.next=9,$==null?void 0:$.getItems({from:l!=="end"?l:void 0,pageSize:f,order:p,limit:f});case 9:return T=ue.sent,ue.next=12,this._wrapPaginator(p,T,function(Ue){return Promise.all(Ue.map(function(kt){return c._upsertMessage(kt.index,kt.data)}))});case 12:return ue.abrupt("return",ue.sent);case 13:case"end":return ue.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()}]),S}(R.ReplayEventEmitter),Fe=function(){function E(C){ze.default(this,E),he.default(this,"attributes",{}),he.default(this,"mediaContent",[]),he.default(this,"emailOptions",{}),this.messagesEntity=C}return Ye.default(E,[{key:"send",value:function(){var S=this;return new Ie.CancellablePromise(function(){var b=F.default(k.default.mark(function d(h,c,f){var l,y;return k.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return l=S.messagesEntity.sendV2(S),f(function(){return l.cancel()}),$.prev=2,$.next=5,l;case 5:y=$.sent,h(ye(y.index)),$.next=12;break;case 9:$.prev=9,$.t0=$.catch(2),c($.t0);case 12:case"end":return $.stop()}},d,null,[[2,9]])}));return function(d,h,c){return b.apply(this,arguments)}}())}}]),E}(),gr=function(){function E(C,S){ze.default(this,E),this.limits=C,this.message=new Fe(S),this.emailBodies=new Map,this.emailHistories=new Map}return Ye.default(E,[{key:"setBody",value:function(S){return this.message.text=S,this}},{key:"setSubject",value:function(S){return this.message.emailOptions.subject=S,this}},{key:"setAttributes",value:function(S){return this.message.attributes=S,this}},{key:"setEmailBody",value:function(S,b){return this.emailBodies.set(S,b),this}},{key:"setEmailHistory",value:function(S,b){return this.emailHistories.set(S,b),this}},{key:"addMedia",value:function(S){if(typeof FormData>"u"&&S instanceof FormData)throw new Error("Could not add FormData content whilst not in a browser");if(!(S instanceof FormData)){var b=S;if(!b.contentType||!b.media)throw new Error("Media content in SendMediaOptions must contain non-empty contentType and media")}return this.message.mediaContent.push(["media",S]),this}},{key:"build",value:function(){var S=this;if(this.emailBodies.forEach(function(b,d){if(!S.limits.emailBodiesAllowedContentTypes.includes(d))throw new Error("Unsupported email body content type ".concat(d))}),this.emailHistories.forEach(function(b,d){if(!S.limits.emailHistoriesAllowedContentTypes.includes(d))throw new Error("Unsupported email history content type ".concat(d))}),this.emailBodies.size>this.limits.emailBodiesAllowedContentTypes.length)throw new Error("Too many email bodies attached to the message (".concat(this.emailBodies.size," > ").concat(this.limits.emailBodiesAllowedContentTypes.length,")"));if(this.emailHistories.size>this.limits.emailHistoriesAllowedContentTypes.length)throw new Error("Too many email histories attached to the message (".concat(this.emailHistories.size," > ").concat(this.limits.emailHistoriesAllowedContentTypes.length,")"));if(this.message.mediaContent.length>this.limits.mediaAttachmentsCountLimit)throw new Error("Too many media attachments in the message (".concat(this.message.mediaContent.length," > ").concat(this.limits.mediaAttachmentsCountLimit,")"));return this.emailBodies.forEach(function(b){S.message.mediaContent.push(["body",b])}),this.emailHistories.forEach(function(b){S.message.mediaContent.push(["history",b])}),this.message}},{key:"buildAndSend",value:function(){return this.build().send()}},{key:"getPayloadContentType",value:function(S){return typeof FormData<"u"&&S instanceof FormData?S.get("Content-Type"):S.contentType}}]),E}();function da(E,C){var S=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(!S){if(Array.isArray(E)||(S=va(E))||C){S&&(E=S);var b=0,d=function(){};return{s:d,n:function(){return b>=E.length?{done:!0}:{done:!1,value:E[b++]}},e:function(y){throw y},f:d}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h=!0,c=!1,f;return{s:function(){S=S.call(E)},n:function(){var y=S.next();return h=y.done,y},e:function(y){c=!0,f=y},f:function(){try{!h&&S.return!=null&&S.return()}finally{if(c)throw f}}}}function va(E,C){if(E){if(typeof E=="string")return Ga(E,C);var S=Object.prototype.toString.call(E).slice(8,-1);if(S==="Object"&&E.constructor&&(S=E.constructor.name),S==="Map"||S==="Set")return Array.from(E);if(S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return Ga(E,C)}}function Ga(E,C){(C==null||C>E.length)&&(C=E.length);for(var S=0,b=new Array(C);S<C;S++)b[S]=E[S];return b}function Fi(E){var C=Br();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function Br(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var qr={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",uniqueName:"uniqueName",state:"state",bindings:"bindings"},lt=function(E){Pe.default(S,E);var C=Fi(S);function S(b,d,h,c,f){var l,y,p;ze.default(this,S),p=C.call(this),p.sid=d,p._links=h,p._configuration=c,p._services=f,p._entityName=b.channel,p._internalState={uniqueName:b.uniqueName||null,status:"notParticipating",attributes:(l=b.attributes)!==null&&l!==void 0?l:{},createdBy:b.createdBy,dateCreated:Ut(b.dateCreated),dateUpdated:Ut(b.dateUpdated),friendlyName:b.friendlyName||null,lastReadMessageIndex:Number.isInteger(b.lastConsumedMessageIndex)?b.lastConsumedMessageIndex:null,bindings:(y=b.bindings)!==null&&y!==void 0?y:{}},b.notificationLevel&&(p._internalState.notificationLevel=b.notificationLevel);var $={participants:p._links.participants};return p._participants=new Map,p._participantsEntity=new D(de.default(p),p._participants,$,p._configuration,p._services),p._participantsEntity.on("participantJoined",function(T){return p.emit("participantJoined",T)}),p._participantsEntity.on("participantLeft",function(T){return p.emit("participantLeft",T)}),p._participantsEntity.on("participantUpdated",function(T){return p.emit("participantUpdated",T)}),p._messagesEntity=new yr(de.default(p),c,f),p._messagesEntity.on("messageAdded",function(T){return p._onMessageAdded(T)}),p._messagesEntity.on("messageUpdated",function(T){return p.emit("messageUpdated",T)}),p._messagesEntity.on("messageRemoved",function(T){return p.emit("messageRemoved",T)}),p}return Ye.default(S,[{key:"uniqueName",get:function(){return this._internalState.uniqueName}},{key:"status",get:function(){return this._internalState.status}},{key:"friendlyName",get:function(){return this._internalState.friendlyName}},{key:"dateUpdated",get:function(){return this._internalState.dateUpdated}},{key:"dateCreated",get:function(){return this._internalState.dateCreated}},{key:"createdBy",get:function(){var d;return(d=this._internalState.createdBy)!==null&&d!==void 0?d:""}},{key:"attributes",get:function(){return this._internalState.attributes}},{key:"lastReadMessageIndex",get:function(){return this._internalState.lastReadMessageIndex}},{key:"lastMessage",get:function(){var d;return(d=this._internalState.lastMessage)!==null&&d!==void 0?d:void 0}},{key:"notificationLevel",get:function(){var d;return(d=this._internalState.notificationLevel)!==null&&d!==void 0?d:"default"}},{key:"bindings",get:function(){return this._internalState.bindings}},{key:"limits",get:function(){return this._configuration.limits}},{key:"state",get:function(){return this._internalState.state}},{key:"_statusSource",get:function(){return this._dataSource}},{key:"add",value:function(){var b=F.default(k.default.mark(function h(c,f){return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",this._participantsEntity.add(c,f!=null?f:{}));case 1:case"end":return y.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"addNonChatParticipant",value:function(){var b=F.default(k.default.mark(function h(c,f){var l,y,p=arguments;return k.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return l=p.length>2&&p[2]!==void 0?p[2]:{},y=p.length>3&&p[3]!==void 0?p[3]:{},T.abrupt("return",this._participantsEntity.addNonChatParticipant(c,f,l!=null?l:{},y!=null?y:{}));case 3:case"end":return T.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"advanceLastReadMessageIndex",value:function(){var b=F.default(k.default.mark(function h(c){var f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._subscribeStreams();case 2:if(!(c<((f=this.lastReadMessageIndex)!==null&&f!==void 0?f:0))){y.next=6;break}return y.next=5,this._setLastReadMessageIndex(this.lastReadMessageIndex);case 5:return y.abrupt("return",y.sent);case 6:return y.next=8,this._setLastReadMessageIndex(c);case 8:return y.abrupt("return",y.sent);case 9:case"end":return y.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"delete",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._services.commandExecutor.mutateResource("delete",this._links.self);case 2:return f.abrupt("return",this);case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getAttributes",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._subscribe();case 2:return f.abrupt("return",this.attributes);case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getMessages",value:function(){var b=F.default(k.default.mark(function h(c,f,l){return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this._subscribeStreams();case 2:return p.abrupt("return",this._messagesEntity.getMessages(c,f,l));case 3:case"end":return p.stop()}},h,this)}));function d(h,c,f){return b.apply(this,arguments)}return d}()},{key:"getParticipants",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._subscribeStreams();case 2:return f.abrupt("return",this._participantsEntity.getParticipants());case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getParticipantsCount",value:function(){var b=F.default(k.default.mark(function h(){var c,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=new Ze(this._configuration.links.conversations).path(this.sid).build(),p.next=3,this._services.network.get(f);case 3:return l=p.sent,p.abrupt("return",(c=l.body.participants_count)!==null&&c!==void 0?c:0);case 5:case"end":return p.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getParticipantBySid",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this._participantsEntity.getParticipantBySid(c));case 1:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getParticipantByIdentity",value:function(){var b=F.default(k.default.mark(function h(){var c,f=arguments;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return c=f.length>0&&f[0]!==void 0?f[0]:"",y.abrupt("return",this._participantsEntity.getParticipantByIdentity(c!=null?c:""));case 2:case"end":return y.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getMessagesCount",value:function(){var b=F.default(k.default.mark(function h(){var c,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=new Ze(this._configuration.links.conversations).path(this.sid).build(),p.next=3,this._services.network.get(f);case 3:return l=p.sent,p.abrupt("return",(c=l.body.messages_count)!==null&&c!==void 0?c:0);case 5:case"end":return p.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getUnreadMessagesCount",value:function(){var b=F.default(k.default.mark(function h(){var c,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return c=new Ze(this._configuration.links.myConversations).path(this.sid).build(),p.next=3,this._services.network.get(c);case 3:if(f=p.sent,f.body.conversation_sid===this.sid){p.next=6;break}throw new Error("Conversation was not found in the user conversations list");case 6:if(l=f.body.unread_messages_count,typeof l!="number"){p.next=9;break}return p.abrupt("return",l);case 9:return p.abrupt("return",null);case 10:case"end":return p.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"join",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._services.commandExecutor.mutateResource("post",this._links.participants,{identity:this._configuration.userIdentity});case 2:return f.abrupt("return",this);case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"leave",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this._internalState.status!=="joined"){f.next=3;break}return f.next=3,this._services.commandExecutor.mutateResource("delete","".concat(this._links.participants,"/").concat(this._configuration.userIdentity));case 3:return f.abrupt("return",this);case 4:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"removeParticipant",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._participantsEntity.remove(typeof c=="string"?c:c.sid);case 2:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"sendMessage",value:function(){var b=F.default(k.default.mark(function h(c,f,l){var y,p,$,T;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!(typeof c=="string"||c===null)){P.next=5;break}return P.next=3,this._messagesEntity.send(c,f,l);case 3:return $=P.sent,P.abrupt("return",(p=ye($.index))!==null&&p!==void 0?p:0);case 5:return P.next=7,this._messagesEntity.sendMedia(c,f,l);case 7:return T=P.sent,P.abrupt("return",(y=ye(T.index))!==null&&y!==void 0?y:0);case 9:case"end":return P.stop()}},h,this)}));function d(h,c,f){return b.apply(this,arguments)}return d}()},{key:"prepareMessage",value:function(){return new gr(this.limits,this._messagesEntity)}},{key:"setAllMessagesRead",value:function(){var b=F.default(k.default.mark(function h(){var c;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._subscribeStreams();case 2:return l.next=4,this.getMessages(1);case 4:if(c=l.sent,!(c.items.length>0)){l.next=7;break}return l.abrupt("return",this.advanceLastReadMessageIndex(c.items[0].index));case 7:return l.abrupt("return",0);case 8:case"end":return l.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"setAllMessagesUnread",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._subscribeStreams();case 2:return f.next=4,this._setLastReadMessageIndex(null);case 4:return f.abrupt("return",f.sent);case 5:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"setUserNotificationLevel",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{notification_level:c});case 2:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"typing",value:function(){return this._services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._services.commandExecutor.mutateResource("post",this._links.self,{attributes:c!==void 0?JSON.stringify(c):void 0});case 2:return l.abrupt("return",this);case 3:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"updateFriendlyName",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._internalState.friendlyName===c){l.next=3;break}return l.next=3,this._services.commandExecutor.mutateResource("post",this._links.self,{friendly_name:c});case 3:return l.abrupt("return",this);case 4:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"updateLastReadMessageIndex",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._subscribeStreams();case 2:return l.abrupt("return",this._setLastReadMessageIndex(c));case 3:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"updateUniqueName",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._internalState.uniqueName===c){l.next=4;break}return c||(c=""),l.next=4,this._services.commandExecutor.mutateResource("post",this._links.self,{unique_name:c});case 4:return l.abrupt("return",this);case 5:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"_subscribe",value:function(){var b=F.default(k.default.mark(function h(){var c=this;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this._entityPromise){l.next=2;break}return l.abrupt("return",this._entityPromise);case 2:return this._entityPromise=this._services.syncClient.document({id:this._entityName,mode:"open_existing"}),l.prev=3,l.next=6,this._entityPromise;case 6:return this._entity=l.sent,this._entity.on("updated",function(y){return c._update(y.data)}),this._entity.on("removed",function(){return c.emit("removed",c)}),this._update(this._entity.data),l.abrupt("return",this._entity);case 13:throw l.prev=13,l.t0=l.catch(3),this._entity=null,this._entityPromise=null,this._services.syncClient.connectionState!="disconnected"&&S._logger.error("Failed to get conversation object",l.t0),S._logger.debug("ERROR: Failed to get conversation object",l.t0),l.t0;case 20:case"end":return l.stop()}},h,this,[[3,13]])}));function d(){return b.apply(this,arguments)}return d}()},{key:"_fetchStreams",value:function(){var b=F.default(k.default.mark(function h(){var c,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this._subscribe();case 2:return S._logger.trace("_streamsAvailable, this.entity.data=",(c=this._entity)===null||c===void 0?void 0:c.data),l=(f=this._entity)===null||f===void 0?void 0:f.data,p.next=6,this._services.syncClient.list({id:l.messages,mode:"open_existing"});case 6:return this._messagesList=p.sent,p.next=9,this._services.syncClient.map({id:l.roster,mode:"open_existing"});case 9:this._participantsMap=p.sent;case 10:case"end":return p.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_subscribeStreams",value:function(){var b=F.default(k.default.mark(function h(){var c,f,l,y,p,$,T;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,this._subscribe();case 3:return S._logger.trace("_subscribeStreams, this.entity.data=",(c=this._entity)===null||c===void 0?void 0:c.data),p=(f=this._entity)===null||f===void 0?void 0:f.data,$=p.messages,T=p.roster,P.next=9,Promise.all([this._messagesEntity.subscribe((l=this._messagesList)!==null&&l!==void 0?l:$),this._participantsEntity.subscribe((y=this._participantsMap)!==null&&y!==void 0?y:T)]);case 9:P.next=16;break;case 11:throw P.prev=11,P.t0=P.catch(0),this._services.syncClient.connectionState!=="disconnected"&&S._logger.error("Failed to subscribe on conversation objects",this.sid,P.t0),S._logger.debug("ERROR: Failed to subscribe on conversation objects",this.sid,P.t0),P.t0;case 16:case"end":return P.stop()}},h,this,[[0,11]])}));function d(){return b.apply(this,arguments)}return d}()},{key:"_unsubscribe",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!this._entity){f.next=5;break}return f.next=3,this._entity.close();case 3:this._entity=null,this._entityPromise=null;case 5:return f.abrupt("return",Promise.all([this._participantsEntity.unsubscribe(),this._messagesEntity.unsubscribe()]));case 6:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_setStatus",value:function(d,h){var c=this;if(this._dataSource=h,this._internalState.status!==d){if(this._internalState.status=d,d==="joined"){this._subscribeStreams().catch(function(f){if(S._logger.debug("ERROR while setting conversation status "+d,f),c._services.syncClient.connectionState!=="disconnected")throw f});return}this._entityPromise&&this._unsubscribe().catch(function(f){if(S._logger.debug("ERROR while setting conversation status "+d,f),c._services.syncClient.connectionState!=="disconnected")throw f})}}},{key:"_update",value:function(d){var h,c,f,l,y;S._logger.trace("_update",d),S.preprocessUpdate(d,this.sid);for(var p=new Set,$=0,T=Object.keys(d);$<T.length;$++){var A=T[$],P=qr[A];if(P)switch(P){case qr.status:if(!d.status||d.status==="unknown"||this._internalState.status===d.status)break;this._internalState.status=d.status,p.add(P);break;case qr.attributes:if(ce.default(this._internalState.attributes,d.attributes))break;this._internalState.attributes=d.attributes,p.add(P);break;case qr.lastConsumedMessageIndex:if(d.lastConsumedMessageIndex===void 0||d.lastConsumedMessageIndex===this._internalState.lastReadMessageIndex)break;this._internalState.lastReadMessageIndex=d.lastConsumedMessageIndex,p.add("lastReadMessageIndex");break;case qr.lastMessage:if(this._internalState.lastMessage&&!d.lastMessage){delete this._internalState.lastMessage,p.add(P);break}this._internalState.lastMessage=this._internalState.lastMessage||{},((h=d.lastMessage)===null||h===void 0?void 0:h.index)!==void 0&&d.lastMessage.index!==this._internalState.lastMessage.index&&(this._internalState.lastMessage.index=d.lastMessage.index,p.add(P)),((c=d.lastMessage)===null||c===void 0?void 0:c.timestamp)!==void 0&&((f=this._internalState.lastMessage)===null||f===void 0||(l=f.dateCreated)===null||l===void 0?void 0:l.getTime())!==d.lastMessage.timestamp.getTime()&&(this._internalState.lastMessage.dateCreated=d.lastMessage.timestamp,p.add(P)),ce.default(this._internalState.lastMessage,{})&&delete this._internalState.lastMessage;break;case qr.state:var ue=d.state||void 0;if(ue!==void 0&&(ue.dateUpdated=new Date(ue.dateUpdated)),ce.default(this._internalState.state,ue))break;this._internalState.state=ue,p.add(P);break;case qr.bindings:if(ce.default(this._internalState.bindings,d.bindings))break;this._internalState.bindings=d.bindings,p.add(P);break;default:var Ue=d[A]instanceof Date,kt=Ue&&((y=this._internalState[P])===null||y===void 0?void 0:y.getTime())===d[A].getTime(),qe=!Ue&&this[P]===d[A];if(kt||qe)break;this._internalState[P]=d[A],p.add(P)}}p.size>0&&this.emit("updated",{conversation:this,updateReasons:be.default(p)})}},{key:"_onMessageAdded",value:function(d){var h=da(this._participants.values()),c;try{for(h.s();!(c=h.n()).done;){var f=c.value;if(f.identity===d.author){f._endTyping();break}}}catch(l){h.e(l)}finally{h.f()}this.emit("messageAdded",d)}},{key:"_setLastReadMessageIndex",value:function(){var b=F.default(k.default.mark(function h(c){var f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{last_read_message_index:c});case 2:return f=y.sent,y.abrupt("return",f.unread_messages_count);case 4:case"end":return y.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()}],[{key:"preprocessUpdate",value:function(d,h){try{typeof d.attributes=="string"?d.attributes=JSON.parse(d.attributes):d.attributes&&JSON.stringify(d.attributes)}catch(c){S._logger.warn("Retrieved malformed attributes from the server for conversation: "+h),d.attributes={}}try{d.dateCreated&&(d.dateCreated=new Date(d.dateCreated))}catch(c){S._logger.warn("Retrieved malformed dateCreated from the server for conversation: "+h),delete d.dateCreated}try{d.dateUpdated&&(d.dateUpdated=new Date(d.dateUpdated))}catch(c){S._logger.warn("Retrieved malformed dateUpdated from the server for conversation: "+h),delete d.dateUpdated}try{d.lastMessage&&d.lastMessage.timestamp&&(d.lastMessage.timestamp=new Date(d.lastMessage.timestamp))}catch(c){S._logger.warn("Retrieved malformed lastMessage.timestamp from the server for conversation: "+h),delete d.lastMessage.timestamp}}}]),S}(R.ReplayEventEmitter);he.default(lt,"participantJoined","participantJoined"),he.default(lt,"participantLeft","participantLeft"),he.default(lt,"participantUpdated","participantUpdated"),he.default(lt,"messageAdded","messageAdded"),he.default(lt,"messageRemoved","messageRemoved"),he.default(lt,"messageUpdated","messageUpdated"),he.default(lt,"typingEnded","typingEnded"),he.default(lt,"typingStarted","typingStarted"),he.default(lt,"updated","updated"),he.default(lt,"removed","removed"),he.default(lt,"_logger",ut.scope("Conversation")),X([w.validateTypesAsync(w.nonEmptyString,et),I("design:type",Function),I("design:paramtypes",[String,Object]),I("design:returntype",Promise)],lt.prototype,"add",null),X([w.validateTypesAsync(w.nonEmptyString,w.nonEmptyString,et),I("design:type",Function),I("design:paramtypes",[String,String,Object,Object]),I("design:returntype",Promise)],lt.prototype,"addNonChatParticipant",null),X([w.validateTypesAsync(w.nonNegativeInteger),I("design:type",Function),I("design:paramtypes",[Number]),I("design:returntype",Promise)],lt.prototype,"advanceLastReadMessageIndex",null),X([w.validateTypesAsync(["undefined",w.nonNegativeInteger],["undefined",w.nonNegativeInteger],["undefined",w.literal("backwards","forward")]),I("design:type",Function),I("design:paramtypes",[Number,Number,String]),I("design:returntype",Promise)],lt.prototype,"getMessages",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],lt.prototype,"getParticipantBySid",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],lt.prototype,"getParticipantByIdentity",null),X([w.validateTypesAsync([w.nonEmptyString,K]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],lt.prototype,"removeParticipant",null),X([w.validateTypesAsync(["string",FormData,w.literal(null),w.objectSchema("media options",{contentType:w.nonEmptyString,media:w.custom(function(E){var C=typeof E=="string"&&E.length>0||E instanceof Uint8Array||E instanceof ArrayBuffer;return typeof Blob=="function"&&(C=C||E instanceof Blob),[C,"a non-empty string, an instance of Buffer or an instance of Blob"]})})],et,["undefined",w.literal(null),w.objectSchema("email attributes",{subject:[w.nonEmptyString,"undefined"]})]),I("design:type",Function),I("design:paramtypes",[Object,Object,Object]),I("design:returntype",Promise)],lt.prototype,"sendMessage",null),X([w.validateTypesAsync(w.literal("default","muted")),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],lt.prototype,"setUserNotificationLevel",null),X([w.validateTypesAsync(ft),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],lt.prototype,"updateAttributes",null),X([w.validateTypesAsync("string"),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],lt.prototype,"updateFriendlyName",null),X([w.validateTypesAsync([w.literal(null),w.nonNegativeInteger]),I("design:type",Function),I("design:paramtypes",[Number]),I("design:returntype",Promise)],lt.prototype,"updateLastReadMessageIndex",null),X([w.validateTypesAsync(["string",w.literal(null)]),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],lt.prototype,"updateUniqueName",null);var Bi=function(){function E(){var C=this;ze.default(this,E),this._promise=new Promise(function(S,b){C._resolve=S,C._reject=b})}return Ye.default(E,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(S){this._resolve(S)}},{key:"set",value:function(S){this.current=S,this._resolve(S)}},{key:"fail",value:function(S){this._reject(S)}}]),E}();function qi(E,C){var S=typeof Symbol<"u"&&E[Symbol.iterator]||E["@@iterator"];if(!S){if(Array.isArray(E)||(S=Wi(E))||C){S&&(E=S);var b=0,d=function(){};return{s:d,n:function(){return b>=E.length?{done:!0}:{done:!1,value:E[b++]}},e:function(y){throw y},f:d}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h=!0,c=!1,f;return{s:function(){S=S.call(E)},n:function(){var y=S.next();return h=y.done,y},e:function(y){c=!0,f=y},f:function(){try{!h&&S.return!=null&&S.return()}finally{if(c)throw f}}}}function Wi(E,C){if(E){if(typeof E=="string")return mn(E,C);var S=Object.prototype.toString.call(E).slice(8,-1);if(S==="Object"&&E.constructor&&(S=E.constructor.name),S==="Map"||S==="Set")return Array.from(E);if(S==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S))return mn(E,C)}}function mn(E,C){(C==null||C>E.length)&&(C=E.length);for(var S=0,b=new Array(C);S<C;S++)b[S]=E[S];return b}function Ha(E,C){var S=Object.keys(E);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(E);C&&(b=b.filter(function(d){return Object.getOwnPropertyDescriptor(E,d).enumerable})),S.push.apply(S,b)}return S}function Gi(E){for(var C=1;C<arguments.length;C++){var S=arguments[C]!=null?arguments[C]:{};C%2?Ha(Object(S),!0).forEach(function(b){he.default(E,b,S[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(S)):Ha(Object(S)).forEach(function(b){Object.defineProperty(E,b,Object.getOwnPropertyDescriptor(S,b))})}return E}function kr(E){var C=Hi();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function Hi(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var Kt=ut.scope("Conversations"),zi=function(E){Pe.default(S,E);var C=kr(S);function S(b,d){var h;return ze.default(this,S),h=C.call(this),he.default(de.default(h),"conversations",new Map),he.default(de.default(h),"myConversationsRead",new Bi),he.default(de.default(h),"tombstones",new Set),he.default(de.default(h),"myConversationsFetched",!1),h.configuration=b,h.services=d,h}return Ye.default(S,[{key:"addConversation",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y,p,$,T,A,P,ue,Ue;return k.default.wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return p=typeof(c==null?void 0:c.attributes)<"u"?c.attributes:{},qe.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{friendly_name:c.friendlyName,unique_name:c.uniqueName,attributes:typeof p<"u"?JSON.stringify(p):void 0});case 3:if($=qe.sent,T=(f=$.sid)!==null&&f!==void 0?f:null,A=(l=(y=$.sync_objects)===null||y===void 0?void 0:y.conversation)!==null&&l!==void 0?l:null,P=Gi({self:$.url},$.links),ue=this.conversations.get(T),!ue){qe.next=12;break}return qe.next=11,ue._subscribe();case 11:return qe.abrupt("return",ue);case 12:return Ue=new lt({channel:A,entityName:"",uniqueName:"",attributes:null,createdBy:"",friendlyName:"",lastConsumedMessageIndex:0,dateCreated:null,dateUpdated:null},T,P,this.configuration,this.services),this.conversations.set(Ue.sid,Ue),this._registerForEvents(Ue),qe.next=17,Ue._subscribe();case 17:return this.emit("conversationAdded",Ue),qe.abrupt("return",Ue);case 19:case"end":return qe.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"fetchConversations",value:function(){var b=F.default(k.default.mark(function h(){var c=this,f,l,y,p,$,T,A;return k.default.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return ue.prev=0,ue.next=3,this._getMap();case 3:return f=ue.sent,f.on("itemAdded",function(Ue){Kt.debug("itemAdded: ".concat(Ue.item.key)),c._upsertConversation("sync",Ue.item.key,Ue.item.data)}),f.on("itemRemoved",function(Ue){Kt.debug("itemRemoved: ".concat(Ue.key));var kt=Ue.key;c.myConversationsFetched||c.tombstones.add(kt);var qe=c.conversations.get(kt);qe&&(qe.status==="joined"&&(qe._setStatus("notParticipating","sync"),c.emit("conversationLeft",qe)),c.conversations.delete(kt),c.emit("conversationRemoved",qe),qe.emit("removed",qe))}),f.on("itemUpdated",function(Ue){Kt.debug("itemUpdated: ".concat(Ue.item.key)),c._upsertConversation("sync",Ue.item.key,Ue.item.data)}),ue.next=9,this._fetchMyConversations();case 9:l=ue.sent,y=[],p=qi(l);try{for(p.s();!($=p.n()).done;)T=$.value,y.push(this._upsertConversation("rest",T.channel_sid,T))}catch(Ue){p.e(Ue)}finally{p.f()}return this.myConversationsRead.set(!0),ue.next=16,Promise.all(y);case 16:return this.myConversationsFetched=!0,this.tombstones.clear(),Kt.debug("The conversations list has been successfully fetched"),ue.abrupt("return",this);case 22:throw ue.prev=22,ue.t0=ue.catch(0),A="Failed to fetch the conversations list",this.services.syncClient.connectionState!=="disconnected"&&Kt.error(A,ue.t0),Kt.debug("ERROR: ".concat(A),ue.t0),ue.t0;case 28:case"end":return ue.stop()}},h,this,[[0,22]])}));function d(){return b.apply(this,arguments)}return d}()},{key:"getConversations",value:function(){var b=F.default(k.default.mark(function h(){var c=this,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this._getMap();case 2:return f=p.sent,p.next=5,f.getItems();case 5:return l=p.sent,p.abrupt("return",this._wrapPaginator(l,function($){return Promise.all($.map(function(T){return c._upsertConversation("sync",T.key,T.data)}))}));case 7:case"end":return p.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getConversation",value:function(){var b=F.default(k.default.mark(function h(c){var f=this,l,y,p;return k.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,this._getMap();case 2:return l=T.sent,T.next=5,l.getItems({key:c});case 5:return y=T.sent,p=y.items.map(function(A){return f._upsertConversation("sync",A.key,A.data)}),T.abrupt("return",p.length>0?p[0]:null);case 8:case"end":return T.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getConversationByUniqueName",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y,p,$;return k.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return f=new Ze(this.configuration.links.myConversations).path(c).build(),A.next=3,this.services.network.get(f);case 3:return l=A.sent,y=l.body,p=y.conversation_sid,$={entityName:null,lastConsumedMessageIndex:y.last_read_message_index,status:(y==null?void 0:y.status)||"unknown",friendlyName:y.friendly_name,dateUpdated:y.date_updated,dateCreated:y.date_created,uniqueName:y.unique_name,createdBy:y.created_by,attributes:y.attributes,channel:y.sync_objects.conversation,notificationLevel:y==null?void 0:y.notification_level,sid:p},A.abrupt("return",p?this._upsertConversation("sync",p,$):null);case 8:case"end":return A.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"peekConversation",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y,p;return k.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return f=new Ze(this.configuration.links.conversations).path(c).build(),T.next=3,this.services.network.get(f);case 3:return l=T.sent,y=l.body,p={entityName:null,status:(y==null?void 0:y.status)||"unknown",friendlyName:y.friendly_name,dateUpdated:y.date_updated,dateCreated:y.date_created,uniqueName:y.unique_name,createdBy:y.created_by,attributes:y.attributes,channel:"".concat(c,".channel"),sid:c},T.abrupt("return",this._upsertConversation("sync",c,p));case 7:case"end":return T.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"_getMap",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_wrapPaginator",value:function(){var b=F.default(k.default.mark(function h(c,f){var l=this,y;return k.default.wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,f(c.items);case 2:return y=$.sent,$.abrupt("return",{items:y.filter(function(T){return T!==null}),hasNextPage:c.hasNextPage,hasPrevPage:c.hasPrevPage,nextPage:function(){return c.nextPage().then(function(A){return l._wrapPaginator(A,f)})},prevPage:function(){return c.prevPage().then(function(A){return l._wrapPaginator(A,f)})}});case 4:case"end":return $.stop()}},h)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"_updateConversation",value:function(){var b=F.default(k.default.mark(function h(c,f,l){var y,p,$;return k.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(y=f._statusSource!==void 0&&c!==f._statusSource,p=c!=="rest"||f._statusSource==="sync",!(y&&p&&c!=="sync")){A.next=5;break}return Kt.trace("upsertConversation: conversation is known from sync and came from REST, ignoring",{sid:f.sid,data:l.status,conversation:f.status}),A.abrupt("return");case 5:if(!(l.status==="joined"&&f.status!=="joined")){A.next=15;break}return f._setStatus("joined",c),$={},typeof l.notificationLevel<"u"&&($.notificationLevel=l.notificationLevel),typeof l.lastConsumedMessageIndex<"u"&&($.lastConsumedMessageIndex=l.lastConsumedMessageIndex),ce.default($,{})||f._update($),A.next=13,f._subscribe();case 13:return this.emit("conversationJoined",f),A.abrupt("return");case 15:if(!(l.status==="notParticipating"&&f.status==="joined")){A.next=22;break}return f._setStatus("notParticipating",c),f._update(l),A.next=20,f._subscribe();case 20:return this.emit("conversationLeft",f),A.abrupt("return");case 22:if(l.status!=="notParticipating"){A.next=26;break}return A.next=25,f._subscribe();case 25:return A.abrupt("return");case 26:f._update(l);case 27:case"end":return A.stop()}},h,this)}));function d(h,c,f){return b.apply(this,arguments)}return d}()},{key:"_upsertConversation",value:function(){var b=F.default(k.default.mark(function h(c,f,l){var y,p,$,T;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(Kt.trace("upsertConversation called for ".concat(f),l),y=this.conversations.get(f),!y){P.next=9;break}return Kt.trace("upsertConversation: the conversation ".concat(y.sid," is known;")+"its status is known from the source ".concat(y._statusSource," ")+"and the update came from the source ".concat(c),y),P.next=6,this._updateConversation(c,y,l);case 6:return P.next=8,y._subscribe();case 8:return P.abrupt("return",y);case 9:if(!(c==="rest"&&this.tombstones.has(f))){P.next=12;break}return Kt.trace("upsertChannel: the conversation is deleted but reappeared again from REST, ignoring",f),P.abrupt("return",null);case 12:return Kt.trace("upsertConversation: creating a local conversation object with sid "+f,l),p="".concat(this.configuration.links.conversations,"/").concat(f),$={self:p,messages:"".concat(p,"/Messages"),participants:"".concat(p,"/Participants")},T=new lt(l,f,$,this.configuration,this.services),this.conversations.set(f,T),P.prev=17,P.next=20,T._subscribe();case 20:if(l.status!=="joined"){P.next=23;break}return P.next=23,T._fetchStreams();case 23:P.next=32;break;case 25:if(P.prev=25,P.t0=P.catch(17),P.t0.name==="SyncError"){P.next=29;break}throw P.t0;case 29:return Kt.trace("upsertChannel: the conversation is missing some Sync entity(ies), ignoring",f,P.t0),this.conversations.delete(f),P.abrupt("return",null);case 32:return this._registerForEvents(T),this.emit("conversationAdded",T),l.status==="joined"&&(T._setStatus("joined",c),this.emit("conversationJoined",T)),P.abrupt("return",T);case 36:case"end":return P.stop()}},h,this,[[17,25]])}));function d(h,c,f){return b.apply(this,arguments)}return d}()},{key:"_fetchMyConversations",value:function(){var b=F.default(k.default.mark(function h(){var c,f,l,y,p,$;return k.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:c=[],f=null;case 2:return y=new Ze(this.configuration.links.myConversations),f&&y.arg("PageToken",f),A.next=6,this.services.network.get(y.build());case 6:p=A.sent,$=(l=p.body)===null||l===void 0?void 0:l.conversations.map(function(P){return{descriptor:P,channel_sid:P.conversation_sid,status:P.status,channel:P.sync_objects.conversation,messages:P.sync_objects.messages,roster:"".concat(P.conversation_sid,".roster"),lastConsumedMessageIndex:P.last_read_message_index,notificationLevel:P.notification_level}}),f=p.body.meta.next_token,c=[].concat(be.default(c),be.default($));case 10:if(f){A.next=2;break}case 11:return A.abrupt("return",c);case 12:case"end":return A.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_onConversationRemoved",value:function(d){var h=this.conversations.get(d);h&&(this.conversations.delete(d),this.emit("conversationRemoved",h))}},{key:"_registerForEvents",value:function(d){var h=this;d.on("removed",function(){return h._onConversationRemoved(d.sid)}),d.on("updated",function(c){return h.emit("conversationUpdated",c)}),d.on("participantJoined",function(c){return h.emit("participantJoined",c)}),d.on("participantLeft",function(c){return h.emit("participantLeft",c)}),d.on("participantUpdated",function(c){return h.emit("participantUpdated",c)}),d.on("messageAdded",function(c){return h.emit("messageAdded",c)}),d.on("messageUpdated",function(c){return h.emit("messageUpdated",c)}),d.on("messageRemoved",function(c){return h.emit("messageRemoved",c)}),d.on("typingStarted",function(c){return h.emit("typingStarted",c)}),d.on("typingEnded",function(c){return h.emit("typingEnded",c)})}}]),S}(R.ReplayEventEmitter);function Vi(E){var C=Ki();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function Ki(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var Yi=function(E){Pe.default(S,E);var C=Vi(S);function S(b,d,h){var c;return ze.default(this,S),c=C.call(this),c.configuration=d,c.services=h,c.fifoStack=[],c.myself=b,c.myself.on("updated",function(f){return c.emit("userUpdated",f)}),c.myself.on("userSubscribed",function(){return c.emit("userSubscribed",c.myself)}),c.myself.on("userUnsubscribed",function(){c.emit("userUnsubscribed",c.myself),c.myself._ensureFetched()}),c.subscribedUsers=new Map,c}return Ye.default(S,[{key:"handleUnsubscribeUser",value:function(d){this.subscribedUsers.has(d.identity)&&this.subscribedUsers.delete(d.identity);var h=0,c=this.fifoStack.find(function(f,l){return f==d.identity?(h=l,!0):!1});c&&this.fifoStack.splice(h,1),this.emit("userUnsubscribed",d)}},{key:"handleSubscribeUser",value:function(d){if(!this.subscribedUsers.has(d.identity)){if(this.fifoStack.length>=this.configuration.userInfosToSubscribe){var h,c,f=this.fifoStack.shift();(h=this.subscribedUsers)===null||h===void 0||(c=h.get(f))===null||c===void 0||c.unsubscribe()}this.fifoStack.push(d.identity),this.subscribedUsers.set(d.identity,d),this.emit("userSubscribed",d)}}},{key:"getUser",value:function(){var b=F.default(k.default.mark(function h(c,f){var l,y=this,p,$;return k.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,this.myself._ensureFetched();case 2:if(c!=this.myself.identity){A.next=4;break}return A.abrupt("return",this.myself);case 4:if(p=this.subscribedUsers.get(c),!p){A.next=7;break}return A.abrupt("return",p);case 7:if(!((l=f)!==null&&l!==void 0)){A.next=11;break}A.next=14;break;case 11:return A.next=13,this.getSyncUniqueName(c);case 13:f=A.sent;case 14:return $=new Dt(c,f,this.configuration,this.services),$.on("updated",function(P){return y.emit("userUpdated",P)}),$.on("userSubscribed",function(){return y.handleSubscribeUser($)}),$.on("userUnsubscribed",function(){return y.handleUnsubscribeUser($)}),A.next=20,$._ensureFetched();case 20:return A.abrupt("return",$);case 21:case"end":return A.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"getSubscribedUsers",value:function(){var b=F.default(k.default.mark(function h(){var c;return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.myself._ensureFetched();case 2:return c=[this.myself],this.subscribedUsers.forEach(function(y){return c.push(y)}),l.abrupt("return",c);case 5:case"end":return l.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getSyncUniqueName",value:function(){var b=F.default(k.default.mark(function h(c){var f,l,y,p;return k.default.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return y=new Ze(this.configuration.links.users).path(c).build(),T.next=3,this.services.network.get(y);case 3:return p=T.sent,T.abrupt("return",(f=(l=p.body)===null||l===void 0?void 0:l.sync_objects.user_info_map)!==null&&f!==void 0?f:"");case 5:case"end":return T.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()}]),S}(R.ReplayEventEmitter),Wr=ut.scope("TypingIndicator"),Ji=function(){function E(C,S,b){ze.default(this,E),this.configuration=S,this.services=b,this.getConversation=C,this.serviceTypingTimeout=null,this.sentUpdates=new Map}return Ye.default(E,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var S=this;this.services.notificationClient.on("message",function(){var b=F.default(k.default.mark(function d(h,c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(h!==dt.TYPING_INDICATOR){l.next=3;break}return l.next=3,S._handleRemoteTyping(c);case 3:case"end":return l.stop()}},d)}));return function(d,h){return b.apply(this,arguments)}}())}},{key:"_handleRemoteTyping",value:function(){var C=F.default(k.default.mark(function b(d){var h=this;return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:Wr.trace("Got new typing indicator ",d),this.getConversation(d.channel_sid).then(function(l){l&&l._participants.forEach(function(y){if(y.identity===d.identity){var p=h.configuration.typingIndicatorTimeoutOverride?h.configuration.typingIndicatorTimeoutOverride+1e3:d.typing_timeout*1e3;y._startTyping(p)}})}).catch(function(l){throw Wr.error(l),l});case 2:case"end":return f.stop()}},b,this)}));function S(b){return C.apply(this,arguments)}return S}()},{key:"send",value:function(S){var b=this.sentUpdates.get(S);return b&&b>Date.now()-this.typingTimeout?Promise.resolve():(this.sentUpdates.set(S,Date.now()),this._send(S))}},{key:"_send",value:function(S){var b=this;Wr.trace("Sending typing indicator");var d=this.configuration.links.typing,h={"Content-Type":"application/x-www-form-urlencoded"},c="ChannelSid=".concat(S);return this.services.twilsockClient.post(d,h,c,this.configuration.productId).then(function(f){f.body.hasOwnProperty("typing_timeout")&&(b.serviceTypingTimeout=f.body.typing_timeout*1e3)}).catch(function(f){throw Wr.error("Failed to send typing indicator:",f),f})}}]),E}(),cr=Ye.default(function E(C){ze.default(this,E),this.title=C.title||null,this.body=C.body||null,this.sound=C.sound||null,this.badge=C.badge||null,this.action=C.action||null,this.type=C.type||null,this.data=C.data||{}}),Wn="2.2.1";function pa(E,C){var S=Object.keys(E);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(E);C&&(b=b.filter(function(d){return Object.getOwnPropertyDescriptor(E,d).enumerable})),S.push.apply(S,b)}return S}function Qi(E){for(var C=1;C<arguments.length;C++){var S=arguments[C]!=null?arguments[C]:{};C%2?pa(Object(S),!0).forEach(function(b){he.default(E,b,S[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(S)):pa(Object(S)).forEach(function(b){Object.defineProperty(E,b,Object.getOwnPropertyDescriptor(S,b))})}return E}var za=function(C){return C.replace(/(^\/+|\/+$)/g,"")},Xi=function(C){return C.status.code===202},Zi=function(){function E(C,S,b){ze.default(this,E),this._serviceUrl=C,this._services=S,this._productId=b}return Ye.default(E,[{key:"_preProcessUrl",value:function(S){var b=za(S);return/^https?:\/\//.test(S)?b:"".concat(za(this._serviceUrl),"/").concat(b)}},{key:"_makeRequest",value:function(){var C=F.default(k.default.mark(function b(d,h,c,f){var l,y,p,$;return k.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:l=this._preProcessUrl(h),y=Qi({"Content-Type":"application/json; charset=utf-8"},f||{}),A.t0=d,A.next=A.t0==="get"?5:A.t0==="post"?11:A.t0==="delete"?15:19;break;case 5:return $=l,c&&($+="?"+Object.entries(c).map(function(P){return P.map(encodeURIComponent).join("=")}).join("&")),A.next=9,this._services.transport.get($,y,this._productId);case 9:return p=A.sent,A.abrupt("break",19);case 11:return A.next=13,this._services.transport.post(l,y,JSON.stringify(c),this._productId);case 13:return p=A.sent,A.abrupt("break",19);case 15:return A.next=17,this._services.transport.delete(l,y,{},this._productId);case 17:return p=A.sent,A.abrupt("break",19);case 19:if(!(p.status.code<200||p.status.code>=300)){A.next=21;break}throw new Error("Request responded with a non-success code ".concat(p.status.code));case 21:return A.abrupt("return",p);case 22:case"end":return A.stop()}},b,this)}));function S(b,d,h,c){return C.apply(this,arguments)}return S}()},{key:"fetchResource",value:function(){var C=F.default(k.default.mark(function b(d,h){var c=this,f,l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=6,p.prev=1,p.next=4,new j.AsyncRetrier({min:50,max:1600,maxAttemptsCount:f}).run(function(){return c._makeRequest("get",d,h)});case 4:return l=p.sent,p.abrupt("return",l.body);case 8:throw p.prev=8,p.t0=p.catch(1),new Error('Fetch resource from "'.concat(d,'" failed.'));case 11:case"end":return p.stop()}},b,null,[[1,8]])}));function S(b,d){return C.apply(this,arguments)}return S}()},{key:"mutateResource",value:function(){var C=F.default(k.default.mark(function b(d,h,c){var f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._makeRequest(d,h,c,{"X-Twilio-Mutation-Id":B.v4()});case 2:if(f=y.sent,!Xi(f)){y.next=7;break}return y.next=6,this.fetchResource(f.body.resource_url);case 6:return y.abrupt("return",y.sent);case 7:return y.abrupt("return",f.body);case 8:case"end":return y.stop()}},b,this)}));function S(b,d,h){return C.apply(this,arguments)}return S}()}]),E}(),at;function Va(E,C){var S=Object.keys(E);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(E);C&&(b=b.filter(function(d){return Object.getOwnPropertyDescriptor(E,d).enumerable})),S.push.apply(S,b)}return S}function Gn(E){for(var C=1;C<arguments.length;C++){var S=arguments[C]!=null?arguments[C]:{};C%2?Va(Object(S),!0).forEach(function(b){he.default(E,b,S[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(S)):Va(Object(S)).forEach(function(b){Object.defineProperty(E,b,Object.getOwnPropertyDescriptor(S,b))})}return E}function ha(E){var C=bn();return function(){var b=_e.default(E),d;if(C){var h=_e.default(this).constructor;d=Reflect.construct(b,arguments,h)}else d=b.apply(this,arguments);return Me.default(this,d)}}function bn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(E){return!1}}var rt,Ka=Ye.default(function E(){ze.default(this,E)});e.Client=rt=(at=function(E){Pe.default(S,E);var C=ha(S);function S(b){var d,h,c,f,l,y,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ze.default(this,S),y=C.call(this),he.default(de.default(y),"version",Wn),he.default(de.default(y),"connectionState","unknown"),he.default(de.default(y),"parsePushNotification",rt.parsePushNotification),y._fpaToken=b!=null?b:"",y._options=p!=null?p:{},!y._options.disableDeepClone){var $=Gn(Gn({},y._options),{},{transport:void 0,twilsockClient:void 0});$=xt($),$.transport=y._options.transport,$.twilsockClient=y._options.twilsockClient,y._options=$}y._options.logLevel=(d=y._options.logLevel)!==null&&d!==void 0?d:"silent",rt._logger.setLevel(y._options.logLevel);var T=y._options.productId="ip_messaging";if(y._options.clientMetadata=y._options.clientMetadata||{},y._options.clientMetadata.hasOwnProperty("type")||(y._options.clientMetadata.type="conversations"),y._options.clientMetadata.hasOwnProperty("sdk")||(y._options.clientMetadata.sdk="JS",y._options.clientMetadata.sdkv=Wn),y._options.Sync=y._options.Sync||{},typeof y._options.Sync.enableSessionStorage>"u"&&(y._options.Sync.enableSessionStorage=!0),y._options.region&&(y._options.Sync.region=y._options.region),!b)throw new Error("A valid Twilio token should be provided");y._services=new Ka,y._myself=new Dt("","",null,y._services);var A=!y._options.twilsockClient;if(!y._options.initRegistrations){var P=new H.InitRegistration(T);rt.populateInitRegistrations(P),y._options.initRegistrations=[P]}y._services.twilsockClient=y._options.twilsockClient=(h=y._options.twilsockClient)!==null&&h!==void 0?h:new H.TwilsockClient(b,T,y._options),y._services.twilsockClient.on("tokenAboutToExpire",function(){return y.emit("tokenAboutToExpire")}),y._services.twilsockClient.on("tokenExpired",function(){return y.emit("tokenExpired")}),y._services.twilsockClient.on("connectionError",function(zt){return y.emit("connectionError",zt)}),y._services.twilsockClient.on("stateChanged",function(zt){rt._logger.debug("Handling stateChanged for ConversationsClient: new state ".concat(zt)),zt!==y.connectionState&&(y.connectionState=zt,y.emit("connectionStateChanged",y.connectionState))}),y._services.transport=y._options.transport=(c=y._options.transport)!==null&&c!==void 0?c:y._options.twilsockClient,y._services.notificationClient=y._options.notificationsClient=(f=y._options.notificationsClient)!==null&&f!==void 0?f:new me.Notifications(b,y._options),y._services.syncClient=y._options.syncClient=(l=y._options.syncClient)!==null&&l!==void 0?l:new ne.SyncClient(b,y._options);var ue=(p==null?void 0:p.Chat)||(p==null?void 0:p.IPMessaging)||p||{},Ue=ue.region||(p==null?void 0:p.region),kt=ue.apiUri||ue.typingUri||"https://aim.".concat(Ue||"us1",".twilio.com");y._services.commandExecutor=new Zi(kt,{transport:y._options.transport},T);var qe=function(er){y._rejectEnsureReady(er),y.emit("stateChanged","failed"),y.emit("initFailed",{error:er})},Yt=function(){qe({terminal:!0,message:"Twilsock has disconnected."})};return y._services.twilsockClient.once("connectionError",qe),y._services.twilsockClient.once("disconnected",Yt),y._services.twilsockClient.once("connected",F.default(k.default.mark(function zt(){var er,O;return k.default.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return rt._logger.debug("ConversationsClient started INITIALIZING"),y._services.twilsockClient.off("connectionError",qe),y._services.twilsockClient.off("disconnected",Yt),Y.prev=3,er="conversations.client.startup",y._services.twilsockClient.addPartialTelemetryEvent(new H.TelemetryEventDescription(er,"Conversations client startup",new Date),er,H.TelemetryPoint.Start),Y.next=8,y._initialize();case 8:y._services.twilsockClient.addPartialTelemetryEvent(new H.TelemetryEventDescription("","",new Date),er,H.TelemetryPoint.End),Y.next=17;break;case 11:Y.prev=11,Y.t0=Y.catch(3),O={terminal:!0,message:Y.t0.message},y._rejectEnsureReady(O),y.emit("stateChanged","failed"),y.emit("initFailed",{error:O});case 17:case"end":return Y.stop()}},zt,null,[[3,11]])}))),y._ensureReady=new Promise(function(zt,er){y._resolveEnsureReady=zt,y._rejectEnsureReady=er}).catch(function(){}),A&&y._services.twilsockClient.connect(),y}return Ye.default(S,[{key:"user",get:function(){return this._myself}},{key:"reachabilityEnabled",get:function(){if(!this._configuration)throw new Error("Reachability information could not yet be accessed as the client has not yet been initialized. Subscribe to the 'stateChanged' event to properly react to the client initialization.");return this._configuration.reachabilityEnabled}},{key:"token",get:function(){return this._fpaToken}},{key:"shutdown",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._ensureReady;case 2:return f.next=4,this._services.twilsockClient.disconnect();case 4:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"updateToken",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._ensureReady;case 2:if(rt._logger.info("updateToken"),this._fpaToken!==c){l.next=5;break}return l.abrupt("return",this);case 5:return l.next=7,this._services.twilsockClient.updateToken(c);case 7:return l.next=9,this._services.notificationClient.updateToken(c);case 9:return l.next=11,this._services.mcsClient.updateToken(c);case 11:return this._fpaToken=c,l.abrupt("return",this);case 13:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getConversationBySid",value:function(){var b=F.default(k.default.mark(function h(c){var f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return y.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return y.next=6,this._conversationsEntity.getConversation(c);case 6:if(f=y.sent,f){y.next=12;break}return y.next=10,this.peekConversationBySid(c);case 10:f=y.sent,f&&xe.deprecationWarning("The method getConversationBySid is deprecated to retrieve conversations you're not part of. Use peekConversationBySid instead.");case 12:if(f){y.next=14;break}throw new Error("Conversation with SID ".concat(c," was not found."));case 14:return y.abrupt("return",f);case 15:case"end":return y.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"peekConversationBySid",value:function(){var b=F.default(k.default.mark(function h(c){var f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return y.next=4,this._conversationsEntity.peekConversation(c);case 4:if(f=y.sent,f){y.next=7;break}throw new Error("Conversation with SID ".concat(c," was not found."));case 7:return y.abrupt("return",f);case 8:case"end":return y.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getConversationByUniqueName",value:function(){var b=F.default(k.default.mark(function h(c){var f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return y.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return y.next=6,this._conversationsEntity.getConversationByUniqueName(c);case 6:if(f=y.sent,f){y.next=9;break}throw new Error("Conversation with unique name ".concat(c," was not found."));case 9:return y.abrupt("return",f);case 10:case"end":return y.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getSubscribedConversations",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._ensureReady;case 2:return f.abrupt("return",this._conversationsPromise.then(function(l){return l.getConversations()}));case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"createConversation",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._ensureReady;case 2:return c=c||{},l.abrupt("return",this._conversationsPromise.then(function(y){return y.addConversation(c)}));case 4:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"setPushRegistrationId",value:function(){var b=F.default(k.default.mark(function h(c,f){return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._ensureReady;case 2:return this._subscribeToPushNotifications(c),this._services.notificationClient.setPushRegistrationId(c,f),y.next=6,this._services.notificationClient.commitChanges();case 6:case"end":return y.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"unsetPushRegistrationId",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._ensureReady;case 2:return this._unsubscribeFromPushNotifications(c),l.next=5,this._services.notificationClient.commitChanges();case 5:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"removePushRegistrations",value:function(){var b=F.default(k.default.mark(function h(c,f){return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._services.notificationClient.removeRegistrations(c,f);case 2:case"end":return y.stop()}},h,this)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"handlePushNotification",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._ensureReady;case 2:rt._logger.debug("handlePushNotification, notificationPayload=",c),this.emit("pushNotification",rt.parsePushNotification(c));case 4:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getUser",value:function(){var b=F.default(k.default.mark(function h(c){return k.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this._ensureReady;case 2:return l.abrupt("return",this._services.users.getUser(c));case 3:case"end":return l.stop()}},h,this)}));function d(h){return b.apply(this,arguments)}return d}()},{key:"getSubscribedUsers",value:function(){var b=F.default(k.default.mark(function h(){return k.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this._ensureReady;case 2:return f.abrupt("return",this._services.users.getSubscribedUsers());case 3:case"end":return f.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"getTemporaryContentUrlsForMediaSids",value:function(d){var h=this;return new Ie.CancellablePromise(function(){var c=F.default(k.default.mark(function f(l,y,p){var $,T;return k.default.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!(!h._services.mcsClient||!d)){P.next=3;break}return y(new Error("Media Content Service is unavailable")),P.abrupt("return");case 3:return $=h._services.mcsClient.mediaSetGetContentUrls(d),p(function(){$.cancel()}),P.prev=5,P.next=8,$;case 8:T=P.sent,l(T),P.next=15;break;case 12:P.prev=12,P.t0=P.catch(5),y(P.t0);case 15:case"end":return P.stop()}},f,null,[[5,12]])}));return function(f,l,y){return c.apply(this,arguments)}}())}},{key:"getTemporaryContentUrlsForMedia",value:function(d){var h=d.map(function(c){return c.sid});return this.getTemporaryContentUrlsForMediaSids(h)}},{key:"_initialize",value:function(){var b=F.default(k.default.mark(function h(){var c=this,f;return k.default.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this._services.commandExecutor.fetchResource("Client/v2/Configuration");case 2:return f=y.sent,this._configuration=new $t(this._options,f,rt._logger),this._myself._resolveInitialization(this._configuration,this._configuration.userIdentity,this._configuration.userInfo,!0),this._services.typingIndicator=new Ji(this.getConversationBySid.bind(this),this._configuration,this._services),this._services.network=new lr(this._configuration,this._services),this._services.users=new Yi(this._myself,this._configuration,this._services),this._services.users.on("userSubscribed",function(p){c.emit("userSubscribed",p)}),this._services.users.on("userUpdated",function(p){return c.emit("userUpdated",p)}),this._services.users.on("userUnsubscribed",function(p){c.emit("userUnsubscribed",p)}),this._conversationsEntity=new zi(this._configuration,this._services),this._conversationsEntity.on("conversationAdded",function(p){c.emit("conversationAdded",p)}),this._conversationsEntity.on("conversationRemoved",function(p){c.emit("conversationRemoved",p)}),this._conversationsEntity.on("conversationJoined",function(p){c.emit("conversationJoined",p)}),this._conversationsEntity.on("conversationLeft",function(p){c.emit("conversationLeft",p)}),this._conversationsEntity.on("conversationUpdated",function(p){return c.emit("conversationUpdated",p)}),this._conversationsEntity.on("participantJoined",function(p){c.emit("participantJoined",p)}),this._conversationsEntity.on("participantLeft",function(p){c.emit("participantLeft",p)}),this._conversationsEntity.on("participantUpdated",function(p){return c.emit("participantUpdated",p)}),this._conversationsEntity.on("messageAdded",function(p){return c.emit("messageAdded",p)}),this._conversationsEntity.on("messageUpdated",function(p){return c.emit("messageUpdated",p)}),this._conversationsEntity.on("messageRemoved",function(p){return c.emit("messageRemoved",p)}),this._conversationsEntity.on("typingStarted",function(p){return c.emit("typingStarted",p)}),this._conversationsEntity.on("typingEnded",function(p){return c.emit("typingEnded",p)}),this._conversationsPromise=this._conversationsEntity.fetchConversations().then(function(){return c._conversationsEntity}).catch(function(p){throw p}),y.next=28,this._services.users.myself._ensureFetched();case 28:rt._supportedPushChannels.forEach(function(p){return c._subscribeToPushNotifications(p)}),this._services.typingIndicator.initialize(),this._services.mcsClient=new Ie.McsClient(this._fpaToken,this._configuration.links.mediaService,this._configuration.links.mediaSetService,Gn(Gn({},this._options),{},{transport:void 0})),this._resolveEnsureReady(),this.emit("stateChanged","initialized"),this.emit("initialized");case 34:case"end":return y.stop()}},h,this)}));function d(){return b.apply(this,arguments)}return d}()},{key:"_subscribeToPushNotifications",value:function(d){var h=this;[dt.NEW_MESSAGE,dt.ADDED_TO_CONVERSATION,dt.REMOVED_FROM_CONVERSATION,dt.TYPING_INDICATOR,dt.CONSUMPTION_UPDATE].forEach(function(c){h._services.notificationClient.subscribe(d,c)})}},{key:"_unsubscribeFromPushNotifications",value:function(d){var h=this;[dt.NEW_MESSAGE,dt.ADDED_TO_CONVERSATION,dt.REMOVED_FROM_CONVERSATION,dt.TYPING_INDICATOR,dt.CONSUMPTION_UPDATE].forEach(function(c){h._services.notificationClient.unsubscribe(d,c)})}}],[{key:"create",value:function(){var b=F.default(k.default.mark(function h(c,f){var l;return k.default.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(f!=null&&f.twilsockClient)){p.next=2;break}throw new Error("Obsolete usage of ConversationsClient.create() factory method: if you pass twilsock from the outside then you must use ConversationsClient constructor and be prepared to work with uninitialized client.");case 2:return l=new rt(c,f),p.next=5,l._ensureReady;case 5:return p.abrupt("return",l);case 6:case"end":return p.stop()}},h)}));function d(h,c){return b.apply(this,arguments)}return d}()},{key:"parsePushNotification",value:function(d){if(rt._logger.debug("parsePushNotification, notificationPayload=",d),typeof d.aps<"u"){if(!d.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var h=rt._parsePushNotificationChatData(d),c=d.aps,f,l=null;if(typeof c.alert=="string")f=c.alert||null;else{var y,p;f=((y=c.alert)===null||y===void 0?void 0:y.body)||null,l=((p=c.alert)===null||p===void 0?void 0:p.title)||null}return new cr({title:l,body:f,sound:c.sound||null,badge:c.badge||null,action:c.category||null,type:d.twi_message_type,data:h})}if(typeof d.data<"u"){var $=d.data;if(!$.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var T=rt._parsePushNotificationChatData(d.data);return new cr({title:$.twi_title||null,body:$.twi_body||null,sound:$.twi_sound||null,badge:null,action:$.twi_action||null,type:$.twi_message_type,data:T})}throw new Error("Provided push notification payload is not Programmable Chat notification")}},{key:"_parsePushNotificationChatData",value:function(d){var h={};for(var c in rt._supportedPushDataFields){var f=d[c];if(!(typeof f>"u"||f===null)){if(c==="message_index"||c==="media_count"){var l=ye(f);l!==null&&(h[rt._supportedPushDataFields[c]]=l);continue}if(c==="media"){if(typeof f=="string")try{h[rt._supportedPushDataFields[c]]=JSON.parse(f)}catch(y){rt._logger.debug("Media message notification parsing error")}continue}h[rt._supportedPushDataFields[c]]=f}}return h}},{key:"populateInitRegistrations",value:function(d){d.populateInitRegistrations([dt.TYPING_INDICATOR]),ne.SyncClient.populateInitRegistrations(d)}}]),S}(R.ReplayEventEmitter),he.default(at,"conversationAdded","conversationAdded"),he.default(at,"conversationJoined","conversationJoined"),he.default(at,"conversationLeft","conversationLeft"),he.default(at,"conversationRemoved","conversationRemoved"),he.default(at,"conversationUpdated","conversationUpdated"),he.default(at,"participantJoined","participantJoined"),he.default(at,"participantLeft","participantLeft"),he.default(at,"participantUpdated","participantUpdated"),he.default(at,"messageAdded","messageAdded"),he.default(at,"messageRemoved","messageRemoved"),he.default(at,"messageUpdated","messageUpdated"),he.default(at,"tokenAboutToExpire","tokenAboutToExpire"),he.default(at,"tokenExpired","tokenExpired"),he.default(at,"typingEnded","typingEnded"),he.default(at,"typingStarted","typingStarted"),he.default(at,"pushNotification","pushNotification"),he.default(at,"userSubscribed","userSubscribed"),he.default(at,"userUnsubscribed","userUnsubscribed"),he.default(at,"userUpdated","userUpdated"),he.default(at,"stateChanged","stateChanged"),he.default(at,"initialized","initialized"),he.default(at,"initFailed","initFailed"),he.default(at,"connectionStateChanged","connectionStateChanged"),he.default(at,"connectionError","connectionError"),he.default(at,"version",Wn),he.default(at,"_logger",ut.scope("Client")),he.default(at,"_supportedPushChannels",["fcm","apn"]),he.default(at,"_supportedPushDataFields",{conversation_sid:"conversationSid",conversation_title:"conversationTitle",message_sid:"messageSid",message_index:"messageIndex",media_count:"mediaCount",media:"media"}),at),X([xe.deprecated("token"),I("design:type",String),I("design:paramtypes",[])],e.Client.prototype,"token",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"updateToken",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"getConversationBySid",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"peekConversationBySid",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"getConversationByUniqueName",null),X([w.validateTypesAsync(["undefined",w.objectSchema("conversation options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],e.Client.prototype,"createConversation",null),X([w.validateTypesAsync(w.literal("fcm","apn"),"string"),I("design:type",Function),I("design:paramtypes",[String,String]),I("design:returntype",Promise)],e.Client.prototype,"setPushRegistrationId",null),X([w.validateTypesAsync(w.literal("fcm","apn")),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"unsetPushRegistrationId",null),X([w.validateTypesAsync(w.literal("fcm","apn"),w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String,String]),I("design:returntype",Promise)],e.Client.prototype,"removePushRegistrations",null),X([w.validateTypesAsync(w.pureObject),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",Promise)],e.Client.prototype,"handlePushNotification",null),X([w.validateTypesAsync(w.nonEmptyString),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",Promise)],e.Client.prototype,"getUser",null),X([w.validateTypesAsync(w.nonEmptyArray("strings","string")),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Ie.CancellablePromise)],e.Client.prototype,"getTemporaryContentUrlsForMediaSids",null),X([w.validateTypesAsync(w.nonEmptyArray("media",z)),I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype",Ie.CancellablePromise)],e.Client.prototype,"getTemporaryContentUrlsForMedia",null),X([xe.deprecated("Client.create()","new Client()"),w.validateTypesAsync("string",["undefined",w.pureObject]),I("design:type",Function),I("design:paramtypes",[String,Object]),I("design:returntype",Promise)],e.Client,"create",null),X([w.validateTypes(w.pureObject),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",cr)],e.Client,"parsePushNotification",null),e.Client=rt=X([w.validateConstructorTypes(w.nonEmptyString,[w.pureObject,"undefined"]),I("design:paramtypes",[String,Object])],e.Client),Object.defineProperty(e,"CancellablePromise",{enumerable:!0,get:function(){return Ie.CancellablePromise}}),e.AggregatedDeliveryReceipt=N,e.Conversation=lt,e.DetailedDeliveryReceipt=L,e.Media=z,e.Message=Te,e.MessageBuilder=gr,e.NotificationTypes=dt,e.Participant=K,e.PushNotification=cr,e.RestPaginator=W,e.UnsentMessage=Fe,e.User=Dt})(ed);const nW=X0(ed),iW=Z0({__proto__:null,default:nW},[ed]);export{iW as b};
//# sourceMappingURL=browser-BWWtcJkb.js.map
