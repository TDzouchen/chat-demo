!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)
/*!
* Talkdesk Confidential
*
* Copyright (C) Talkdesk Inc. 2024
*
* The source code for this program is not published or otherwise divested
* of its trade secrets, irrespective of what has been deposited with the
* U.S. Copyright Office. Unauthorized copying of this file, via any medium
* is strictly prohibited.
*/}System.register(["./main-vendor-legacy-qgJC7JP4.js"],(function(t,n){"use strict";var r,i,a;return{setters:[function(e){r=e.c,i=e.o,a=e.g}],execute:function(){function n(e,t){for(var n=function(){var n=t[r];if("string"!=typeof n&&!Array.isArray(n)){var i=function(t){if("default"!==t&&!(t in e)){var r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}};for(var a in n)i(a)}},r=0;r<t.length;r++)n();return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var o={},s=function(e){return e&&e.Math===Math&&e},u=s("object"==("undefined"==typeof globalThis?"undefined":e(globalThis))&&globalThis)||s("object"==("undefined"==typeof window?"undefined":e(window))&&window)||s("object"==("undefined"==typeof self?"undefined":e(self))&&self)||s("object"==e(r)&&r)||s("object"==e(r)&&r)||function(){return this}()||Function("return this")(),c={},l=function(e){try{return!!e()}catch(t){return!0}},f=!l((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),d=!l((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),p=d,h=Function.prototype.call,v=p?h.bind(h):function(){return h.apply(h,arguments)},y={},m={}.propertyIsEnumerable,g=Object.getOwnPropertyDescriptor,b=g&&!m.call({1:2},1);y.f=b?function(e){var t=g(this,e);return!!t&&t.enumerable}:m;var w,k,x=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},_=d,S=Function.prototype,E=S.call,T=_&&S.bind.bind(E,E),R=_?T:function(e){return function(){return E.apply(e,arguments)}},I=R,C=I({}.toString),O=I("".slice),A=function(e){return O(C(e),8,-1)},P=l,j=A,M=Object,L=R("".split),N=P((function(){return!M("z").propertyIsEnumerable(0)}))?function(e){return"String"===j(e)?L(e,""):M(e)}:M,U=function(e){return null==e},F=U,D=TypeError,B=function(e){if(F(e))throw new D("Can't call method on "+e);return e},q=N,z=B,W=function(e){return q(z(e))},G="object"==("undefined"==typeof document?"undefined":e(document))&&document.all,$=void 0===G&&void 0!==G?function(e){return"function"==typeof e||e===G}:function(e){return"function"==typeof e},H=$,V=function(t){return"object"==e(t)?null!==t:H(t)},J=u,K=$,Q=function(e,t){return arguments.length<2?(n=J[e],K(n)?n:void 0):J[e]&&J[e][t];var n},Y=R({}.isPrototypeOf),X=u.navigator,Z=X&&X.userAgent,ee=Z?String(Z):"",te=u,ne=ee,re=te.process,ie=te.Deno,ae=re&&re.versions||ie&&ie.version,oe=ae&&ae.v8;oe&&(k=(w=oe.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!k&&ne&&(!(w=ne.match(/Edge\/(\d+)/))||w[1]>=74)&&(w=ne.match(/Chrome\/(\d+)/))&&(k=+w[1]);var se=k,ue=se,ce=l,le=u.String,fe=!!Object.getOwnPropertySymbols&&!ce((function(){var e=Symbol("symbol detection");return!le(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ue&&ue<41})),de=fe&&!Symbol.sham&&"symbol"==e(Symbol.iterator),pe=Q,he=$,ve=Y,ye=Object,me=de?function(t){return"symbol"==e(t)}:function(e){var t=pe("Symbol");return he(t)&&ve(t.prototype,ye(e))},ge=String,be=function(e){try{return ge(e)}catch(t){return"Object"}},we=$,ke=be,xe=TypeError,_e=function(e){if(we(e))return e;throw new xe(ke(e)+" is not a function")},Se=_e,Ee=U,Te=function(e,t){var n=e[t];return Ee(n)?void 0:Se(n)},Re=v,Ie=$,Ce=V,Oe=TypeError,Ae={exports:{}},Pe=u,je=Object.defineProperty,Me=function(e,t){try{je(Pe,e,{value:t,configurable:!0,writable:!0})}catch(n){Pe[e]=t}return t},Le=u,Ne=Me,Ue="__core-js_shared__",Fe=Ae.exports=Le[Ue]||Ne(Ue,{});(Fe.versions||(Fe.versions=[])).push({version:"3.38.0",mode:"global",copyright:"Â© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"});var De=Ae.exports,Be=De,qe=function(e,t){return Be[e]||(Be[e]=t||{})},ze=B,We=Object,Ge=function(e){return We(ze(e))},$e=Ge,He=R({}.hasOwnProperty),Ve=Object.hasOwn||function(e,t){return He($e(e),t)},Je=R,Ke=0,Qe=Math.random(),Ye=Je(1..toString),Xe=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ye(++Ke+Qe,36)},Ze=qe,et=Ve,tt=Xe,nt=fe,rt=de,it=u.Symbol,at=Ze("wks"),ot=rt?it.for||it:it&&it.withoutSetter||tt,st=function(e){return et(at,e)||(at[e]=nt&&et(it,e)?it[e]:ot("Symbol."+e)),at[e]},ut=v,ct=V,lt=me,ft=Te,dt=function(e,t){var n,r;if("string"===t&&Ie(n=e.toString)&&!Ce(r=Re(n,e)))return r;if(Ie(n=e.valueOf)&&!Ce(r=Re(n,e)))return r;if("string"!==t&&Ie(n=e.toString)&&!Ce(r=Re(n,e)))return r;throw new Oe("Can't convert object to primitive value")},pt=TypeError,ht=st("toPrimitive"),vt=function(e,t){if(!ct(e)||lt(e))return e;var n,r=ft(e,ht);if(r){if(void 0===t&&(t="default"),n=ut(r,e,t),!ct(n)||lt(n))return n;throw new pt("Can't convert object to primitive value")}return void 0===t&&(t="number"),dt(e,t)},yt=vt,mt=me,gt=function(e){var t=yt(e,"string");return mt(t)?t:t+""},bt=V,wt=u.document,kt=bt(wt)&&bt(wt.createElement),xt=function(e){return kt?wt.createElement(e):{}},_t=xt,St=!f&&!l((function(){return 7!==Object.defineProperty(_t("div"),"a",{get:function(){return 7}}).a})),Et=f,Tt=v,Rt=y,It=x,Ct=W,Ot=gt,At=Ve,Pt=St,jt=Object.getOwnPropertyDescriptor;c.f=Et?jt:function(e,t){if(e=Ct(e),t=Ot(t),Pt)try{return jt(e,t)}catch(n){}if(At(e,t))return It(!Tt(Rt.f,e,t),e[t])};var Mt={},Lt=f&&l((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Nt=V,Ut=String,Ft=TypeError,Dt=function(e){if(Nt(e))return e;throw new Ft(Ut(e)+" is not an object")},Bt=f,qt=St,zt=Lt,Wt=Dt,Gt=gt,$t=TypeError,Ht=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,Jt="enumerable",Kt="configurable",Qt="writable";Mt.f=Bt?zt?function(e,t,n){if(Wt(e),t=Gt(t),Wt(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Qt in n&&!n[Qt]){var r=Vt(e,t);r&&r[Qt]&&(e[t]=n.value,n={configurable:Kt in n?n[Kt]:r[Kt],enumerable:Jt in n?n[Jt]:r[Jt],writable:!1})}return Ht(e,t,n)}:Ht:function(e,t,n){if(Wt(e),t=Gt(t),Wt(n),qt)try{return Ht(e,t,n)}catch(r){}if("get"in n||"set"in n)throw new $t("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Yt=Mt,Xt=x,Zt=f?function(e,t,n){return Yt.f(e,t,Xt(1,n))}:function(e,t,n){return e[t]=n,e},en={exports:{}},tn=f,nn=Ve,rn=Function.prototype,an=tn&&Object.getOwnPropertyDescriptor,on=nn(rn,"name"),sn={EXISTS:on,PROPER:on&&"something"===function(){}.name,CONFIGURABLE:on&&(!tn||tn&&an(rn,"name").configurable)},un=$,cn=De,ln=R(Function.toString);un(cn.inspectSource)||(cn.inspectSource=function(e){return ln(e)});var fn,dn,pn,hn=cn.inspectSource,vn=$,yn=u.WeakMap,mn=vn(yn)&&/native code/.test(String(yn)),gn=Xe,bn=qe("keys"),wn=function(e){return bn[e]||(bn[e]=gn(e))},kn={},xn=mn,_n=u,Sn=V,En=Zt,Tn=Ve,Rn=De,In=wn,Cn=kn,On="Object already initialized",An=_n.TypeError,Pn=_n.WeakMap;if(xn||Rn.state){var jn=Rn.state||(Rn.state=new Pn);jn.get=jn.get,jn.has=jn.has,jn.set=jn.set,fn=function(e,t){if(jn.has(e))throw new An(On);return t.facade=e,jn.set(e,t),t},dn=function(e){return jn.get(e)||{}},pn=function(e){return jn.has(e)}}else{var Mn=In("state");Cn[Mn]=!0,fn=function(e,t){if(Tn(e,Mn))throw new An(On);return t.facade=e,En(e,Mn,t),t},dn=function(e){return Tn(e,Mn)?e[Mn]:{}},pn=function(e){return Tn(e,Mn)}}var Ln={set:fn,get:dn,has:pn,enforce:function(e){return pn(e)?dn(e):fn(e,{})},getterFor:function(e){return function(t){var n;if(!Sn(t)||(n=dn(t)).type!==e)throw new An("Incompatible receiver, "+e+" required");return n}}},Nn=R,Un=l,Fn=$,Dn=Ve,Bn=f,qn=sn.CONFIGURABLE,zn=hn,Wn=Ln.enforce,Gn=Ln.get,$n=String,Hn=Object.defineProperty,Vn=Nn("".slice),Jn=Nn("".replace),Kn=Nn([].join),Qn=Bn&&!Un((function(){return 8!==Hn((function(){}),"length",{value:8}).length})),Yn=String(String).split("String"),Xn=en.exports=function(e,t,n){"Symbol("===Vn($n(t),0,7)&&(t="["+Jn($n(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Dn(e,"name")||qn&&e.name!==t)&&(Bn?Hn(e,"name",{value:t,configurable:!0}):e.name=t),Qn&&n&&Dn(n,"arity")&&e.length!==n.arity&&Hn(e,"length",{value:n.arity});try{n&&Dn(n,"constructor")&&n.constructor?Bn&&Hn(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var r=Wn(e);return Dn(r,"source")||(r.source=Kn(Yn,"string"==typeof t?t:"")),e};Function.prototype.toString=Xn((function(){return Fn(this)&&Gn(this).source||zn(this)}),"toString");var Zn=en.exports,er=$,tr=Mt,nr=Zn,rr=Me,ir=function(e,t,n,r){r||(r={});var i=r.enumerable,a=void 0!==r.name?r.name:t;if(er(n)&&nr(n,a,r),r.global)i?e[t]=n:rr(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch(o){}i?e[t]=n:tr.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},ar={},or=Math.ceil,sr=Math.floor,ur=Math.trunc||function(e){var t=+e;return(t>0?sr:or)(t)},cr=function(e){var t=+e;return t!=t||0===t?0:ur(t)},lr=cr,fr=Math.max,dr=Math.min,pr=function(e,t){var n=lr(e);return n<0?fr(n+t,0):dr(n,t)},hr=cr,vr=Math.min,yr=function(e){var t=hr(e);return t>0?vr(t,9007199254740991):0},mr=yr,gr=function(e){return mr(e.length)},br=W,wr=pr,kr=gr,xr=function(e){return function(t,n,r){var i=br(t),a=kr(i);if(0===a)return!e&&-1;var o,s=wr(r,a);if(e&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},_r={includes:xr(!0),indexOf:xr(!1)},Sr=Ve,Er=W,Tr=_r.indexOf,Rr=kn,Ir=R([].push),Cr=function(e,t){var n,r=Er(e),i=0,a=[];for(n in r)!Sr(Rr,n)&&Sr(r,n)&&Ir(a,n);for(;t.length>i;)Sr(r,n=t[i++])&&(~Tr(a,n)||Ir(a,n));return a},Or=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ar=Cr,Pr=Or.concat("length","prototype");ar.f=Object.getOwnPropertyNames||function(e){return Ar(e,Pr)};var jr={};jr.f=Object.getOwnPropertySymbols;var Mr=Q,Lr=ar,Nr=jr,Ur=Dt,Fr=R([].concat),Dr=Mr("Reflect","ownKeys")||function(e){var t=Lr.f(Ur(e)),n=Nr.f;return n?Fr(t,n(e)):t},Br=Ve,qr=Dr,zr=c,Wr=Mt,Gr=function(e,t,n){for(var r=qr(t),i=Wr.f,a=zr.f,o=0;o<r.length;o++){var s=r[o];Br(e,s)||n&&Br(n,s)||i(e,s,a(t,s))}},$r=l,Hr=$,Vr=/#|\.prototype\./,Jr=function(e,t){var n=Qr[Kr(e)];return n===Xr||n!==Yr&&(Hr(t)?$r(t):!!t)},Kr=Jr.normalize=function(e){return String(e).replace(Vr,".").toLowerCase()},Qr=Jr.data={},Yr=Jr.NATIVE="N",Xr=Jr.POLYFILL="P",Zr=Jr,ei=u,ti=c.f,ni=Zt,ri=ir,ii=Me,ai=Gr,oi=Zr,si=function(t,n){var r,i,a,o,s,u=t.target,c=t.global,l=t.stat;if(r=c?ei:l?ei[u]||ii(u,{}):ei[u]&&ei[u].prototype)for(i in n){if(o=n[i],a=t.dontCallGetSet?(s=ti(r,i))&&s.value:r[i],!oi(c?i:u+(l?".":"#")+i,t.forced)&&void 0!==a){if(e(o)==e(a))continue;ai(o,a)}(t.sham||a&&a.sham)&&ni(o,"sham",!0),ri(r,i,o,t)}},ui=Mt.f,ci=Ve,li=st("toStringTag"),fi=function(e,t,n){e&&!n&&(e=e.prototype),e&&!ci(e,li)&&ui(e,li,{configurable:!0,value:t})},di=u,pi=fi;si({global:!0},{Reflect:{}}),pi(di.Reflect,"Reflect",!0);var hi=d,vi=Function.prototype,yi=vi.apply,mi=vi.call,gi="object"==("undefined"==typeof Reflect?"undefined":e(Reflect))&&Reflect.apply||(hi?mi.bind(yi):function(){return mi.apply(yi,arguments)}),bi=R([].slice),wi=R,ki=_e,xi=V,_i=Ve,Si=bi,Ei=d,Ti=Function,Ri=wi([].concat),Ii=wi([].join),Ci={},Oi=Ei?Ti.bind:function(e){var t=ki(this),n=t.prototype,r=Si(arguments,1),i=function(){var n=Ri(r,Si(arguments));return this instanceof i?function(e,t,n){if(!_i(Ci,t)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";Ci[t]=Ti("C,a","return new C("+Ii(r,",")+")")}return Ci[t](e,n)}(t,n.length,n):t.apply(e,n)};return xi(n)&&(i.prototype=n),i},Ai={};Ai[st("toStringTag")]="z";var Pi="[object z]"===String(Ai),ji=Pi,Mi=$,Li=A,Ni=st("toStringTag"),Ui=Object,Fi="Arguments"===Li(function(){return arguments}()),Di=ji?Li:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=Ui(e),Ni))?n:Fi?Li(t):"Object"===(r=Li(t))&&Mi(t.callee)?"Arguments":r},Bi=R,qi=l,zi=$,Wi=Di,Gi=hn,$i=function(){},Hi=Q("Reflect","construct"),Vi=/^\s*(?:class|function)\b/,Ji=Bi(Vi.exec),Ki=!Vi.test($i),Qi=function(e){if(!zi(e))return!1;try{return Hi($i,[],e),!0}catch(t){return!1}},Yi=function(e){if(!zi(e))return!1;switch(Wi(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ki||!!Ji(Vi,Gi(e))}catch(t){return!0}};Yi.sham=!0;var Xi=!Hi||qi((function(){var e;return Qi(Qi.call)||!Qi(Object)||!Qi((function(){e=!0}))||e}))?Yi:Qi,Zi=Xi,ea=be,ta=TypeError,na=function(e){if(Zi(e))return e;throw new ta(ea(e)+" is not a constructor")},ra={},ia=Cr,aa=Or,oa=Object.keys||function(e){return ia(e,aa)},sa=f,ua=Lt,ca=Mt,la=Dt,fa=W,da=oa;ra.f=sa&&!ua?Object.defineProperties:function(e,t){la(e);for(var n,r=fa(t),i=da(t),a=i.length,o=0;a>o;)ca.f(e,n=i[o++],r[n]);return e};var pa,ha=Q("document","documentElement"),va=Dt,ya=ra,ma=Or,ga=kn,ba=ha,wa=xt,ka="prototype",xa="script",_a=wn("IE_PROTO"),Sa=function(){},Ea=function(e){return"<"+xa+">"+e+"</"+xa+">"},Ta=function(e){e.write(Ea("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ra=function(){try{pa=new ActiveXObject("htmlfile")}catch(i){}var e,t,n;Ra="undefined"!=typeof document?document.domain&&pa?Ta(pa):(t=wa("iframe"),n="java"+xa+":",t.style.display="none",ba.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Ea("document.F=Object")),e.close(),e.F):Ta(pa);for(var r=ma.length;r--;)delete Ra[ka][ma[r]];return Ra()};ga[_a]=!0;var Ia=Object.create||function(e,t){var n;return null!==e?(Sa[ka]=va(e),n=new Sa,Sa[ka]=null,n[_a]=e):n=Ra(),void 0===t?n:ya.f(n,t)},Ca=si,Oa=gi,Aa=Oi,Pa=na,ja=Dt,Ma=V,La=Ia,Na=l,Ua=Q("Reflect","construct"),Fa=Object.prototype,Da=[].push,Ba=Na((function(){function e(){}return!(Ua((function(){}),[],e)instanceof e)})),qa=!Na((function(){Ua((function(){}))})),za=Ba||qa;Ca({target:"Reflect",stat:!0,forced:za,sham:za},{construct:function(e,t){Pa(e),ja(t);var n=arguments.length<3?e:Pa(arguments[2]);if(qa&&!Ba)return Ua(e,t,n);if(e===n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return Oa(Da,r,t),new(Oa(Aa,e,r))}var i=n.prototype,a=La(Ma(i)?i:Fa),o=Oa(e,a,t);return Ma(o)?o:a}});var Wa=Ge,Ga=oa;si({target:"Object",stat:!0,forced:l((function(){Ga(1)}))},{keys:function(e){return Ga(Wa(e))}});var $a=Di,Ha=String,Va=function(e){if("Symbol"===$a(e))throw new TypeError("Cannot convert a Symbol value to a string");return Ha(e)},Ja={},Ka=A,Qa=W,Ya=ar.f,Xa=bi,Za="object"==("undefined"==typeof window?"undefined":e(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Ja.f=function(e){return Za&&"Window"===Ka(e)?function(e){try{return Ya(e)}catch(t){return Xa(Za)}}(e):Ya(Qa(e))};var eo=Zn,to=Mt,no=function(e,t,n){return n.get&&eo(n.get,t,{getter:!0}),n.set&&eo(n.set,t,{setter:!0}),to.f(e,t,n)},ro={},io=st;ro.f=io;var ao=u,oo=ao,so=Ve,uo=ro,co=Mt.f,lo=function(e){var t=oo.Symbol||(oo.Symbol={});so(t,e)||co(t,e,{value:uo.f(e)})},fo=v,po=Q,ho=st,vo=ir,yo=A,mo=R,go=function(e){if("Function"===yo(e))return mo(e)},bo=_e,wo=d,ko=go(go.bind),xo=function(e,t){return bo(e),void 0===t?e:wo?ko(e,t):function(){return e.apply(t,arguments)}},_o=A,So=Array.isArray||function(e){return"Array"===_o(e)},Eo=So,To=Xi,Ro=V,Io=st("species"),Co=Array,Oo=function(e){var t;return Eo(e)&&(t=e.constructor,(To(t)&&(t===Co||Eo(t.prototype))||Ro(t)&&null===(t=t[Io]))&&(t=void 0)),void 0===t?Co:t},Ao=function(e,t){return new(Oo(e))(0===t?0:t)},Po=xo,jo=N,Mo=Ge,Lo=gr,No=Ao,Uo=R([].push),Fo=function(e){var t=1===e,n=2===e,r=3===e,i=4===e,a=6===e,o=7===e,s=5===e||a;return function(u,c,l,f){for(var d,p,h=Mo(u),v=jo(h),y=Lo(v),m=Po(c,l),g=0,b=f||No,w=t?b(u,y):n||o?b(u,0):void 0;y>g;g++)if((s||g in v)&&(p=m(d=v[g],g,h),e))if(t)w[g]=p;else if(p)switch(e){case 3:return!0;case 5:return d;case 6:return g;case 2:Uo(w,d)}else switch(e){case 4:return!1;case 7:Uo(w,d)}return a?-1:r||i?i:w}},Do={forEach:Fo(0),map:Fo(1),filter:Fo(2),some:Fo(3),every:Fo(4),find:Fo(5),findIndex:Fo(6),filterReject:Fo(7)},Bo=si,qo=u,zo=v,Wo=R,Go=f,$o=fe,Ho=l,Vo=Ve,Jo=Y,Ko=Dt,Qo=W,Yo=gt,Xo=Va,Zo=x,es=Ia,ts=oa,ns=ar,rs=Ja,is=jr,as=c,os=Mt,ss=ra,us=y,cs=ir,ls=no,fs=qe,ds=kn,ps=Xe,hs=st,vs=ro,ys=lo,ms=function(){var e=po("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=ho("toPrimitive");t&&!t[r]&&vo(t,r,(function(e){return fo(n,this)}),{arity:1})},gs=fi,bs=Ln,ws=Do.forEach,ks=wn("hidden"),xs="Symbol",_s="prototype",Ss=bs.set,Es=bs.getterFor(xs),Ts=Object[_s],Rs=qo.Symbol,Is=Rs&&Rs[_s],Cs=qo.RangeError,Os=qo.TypeError,As=qo.QObject,Ps=as.f,js=os.f,Ms=rs.f,Ls=us.f,Ns=Wo([].push),Us=fs("symbols"),Fs=fs("op-symbols"),Ds=fs("wks"),Bs=!As||!As[_s]||!As[_s].findChild,qs=function(e,t,n){var r=Ps(Ts,t);r&&delete Ts[t],js(e,t,n),r&&e!==Ts&&js(Ts,t,r)},zs=Go&&Ho((function(){return 7!==es(js({},"a",{get:function(){return js(this,"a",{value:7}).a}})).a}))?qs:js,Ws=function(e,t){var n=Us[e]=es(Is);return Ss(n,{type:xs,tag:e,description:t}),Go||(n.description=t),n},Gs=function(e,t,n){e===Ts&&Gs(Fs,t,n),Ko(e);var r=Yo(t);return Ko(n),Vo(Us,r)?(n.enumerable?(Vo(e,ks)&&e[ks][r]&&(e[ks][r]=!1),n=es(n,{enumerable:Zo(0,!1)})):(Vo(e,ks)||js(e,ks,Zo(1,es(null))),e[ks][r]=!0),zs(e,r,n)):js(e,r,n)},$s=function(e,t){Ko(e);var n=Qo(t),r=ts(n).concat(Ks(n));return ws(r,(function(t){Go&&!zo(Hs,n,t)||Gs(e,t,n[t])})),e},Hs=function(e){var t=Yo(e),n=zo(Ls,this,t);return!(this===Ts&&Vo(Us,t)&&!Vo(Fs,t))&&(!(n||!Vo(this,t)||!Vo(Us,t)||Vo(this,ks)&&this[ks][t])||n)},Vs=function(e,t){var n=Qo(e),r=Yo(t);if(n!==Ts||!Vo(Us,r)||Vo(Fs,r)){var i=Ps(n,r);return!i||!Vo(Us,r)||Vo(n,ks)&&n[ks][r]||(i.enumerable=!0),i}},Js=function(e){var t=Ms(Qo(e)),n=[];return ws(t,(function(e){Vo(Us,e)||Vo(ds,e)||Ns(n,e)})),n},Ks=function(e){var t=e===Ts,n=Ms(t?Fs:Qo(e)),r=[];return ws(n,(function(e){!Vo(Us,e)||t&&!Vo(Ts,e)||Ns(r,Us[e])})),r};$o||(Rs=function(){if(Jo(Is,this))throw new Os("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Xo(arguments[0]):void 0,t=ps(e),n=function(e){var r=void 0===this?qo:this;r===Ts&&zo(n,Fs,e),Vo(r,ks)&&Vo(r[ks],t)&&(r[ks][t]=!1);var i=Zo(1,e);try{zs(r,t,i)}catch(a){if(!(a instanceof Cs))throw a;qs(r,t,i)}};return Go&&Bs&&zs(Ts,t,{configurable:!0,set:n}),Ws(t,e)},cs(Is=Rs[_s],"toString",(function(){return Es(this).tag})),cs(Rs,"withoutSetter",(function(e){return Ws(ps(e),e)})),us.f=Hs,os.f=Gs,ss.f=$s,as.f=Vs,ns.f=rs.f=Js,is.f=Ks,vs.f=function(e){return Ws(hs(e),e)},Go&&(ls(Is,"description",{configurable:!0,get:function(){return Es(this).description}}),cs(Ts,"propertyIsEnumerable",Hs,{unsafe:!0}))),Bo({global:!0,constructor:!0,wrap:!0,forced:!$o,sham:!$o},{Symbol:Rs}),ws(ts(Ds),(function(e){ys(e)})),Bo({target:xs,stat:!0,forced:!$o},{useSetter:function(){Bs=!0},useSimple:function(){Bs=!1}}),Bo({target:"Object",stat:!0,forced:!$o,sham:!Go},{create:function(e,t){return void 0===t?es(e):$s(es(e),t)},defineProperty:Gs,defineProperties:$s,getOwnPropertyDescriptor:Vs}),Bo({target:"Object",stat:!0,forced:!$o},{getOwnPropertyNames:Js}),ms(),gs(Rs,xs),ds[ks]=!0;var Qs=fe&&!!Symbol.for&&!!Symbol.keyFor,Ys=si,Xs=Q,Zs=Ve,eu=Va,tu=qe,nu=Qs,ru=tu("string-to-symbol-registry"),iu=tu("symbol-to-string-registry");Ys({target:"Symbol",stat:!0,forced:!nu},{for:function(e){var t=eu(e);if(Zs(ru,t))return ru[t];var n=Xs("Symbol")(t);return ru[t]=n,iu[n]=t,n}});var au=si,ou=Ve,su=me,uu=be,cu=Qs,lu=qe("symbol-to-string-registry");au({target:"Symbol",stat:!0,forced:!cu},{keyFor:function(e){if(!su(e))throw new TypeError(uu(e)+" is not a symbol");if(ou(lu,e))return lu[e]}});var fu=So,du=$,pu=A,hu=Va,vu=R([].push),yu=si,mu=Q,gu=gi,bu=v,wu=R,ku=l,xu=$,_u=me,Su=bi,Eu=function(e){if(du(e))return e;if(fu(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?vu(n,i):"number"!=typeof i&&"Number"!==pu(i)&&"String"!==pu(i)||vu(n,hu(i))}var a=n.length,o=!0;return function(e,t){if(o)return o=!1,t;if(fu(this))return t;for(var r=0;r<a;r++)if(n[r]===e)return t}}},Tu=fe,Ru=String,Iu=mu("JSON","stringify"),Cu=wu(/./.exec),Ou=wu("".charAt),Au=wu("".charCodeAt),Pu=wu("".replace),ju=wu(1..toString),Mu=/[\uD800-\uDFFF]/g,Lu=/^[\uD800-\uDBFF]$/,Nu=/^[\uDC00-\uDFFF]$/,Uu=!Tu||ku((function(){var e=mu("Symbol")("stringify detection");return"[null]"!==Iu([e])||"{}"!==Iu({a:e})||"{}"!==Iu(Object(e))})),Fu=ku((function(){return'"\\udf06\\ud834"'!==Iu("\udf06\ud834")||'"\\udead"'!==Iu("\udead")})),Du=function(e,t){var n=Su(arguments),r=Eu(t);if(xu(r)||void 0!==e&&!_u(e))return n[1]=function(e,t){if(xu(r)&&(t=bu(r,this,Ru(e),t)),!_u(t))return t},gu(Iu,null,n)},Bu=function(e,t,n){var r=Ou(n,t-1),i=Ou(n,t+1);return Cu(Lu,e)&&!Cu(Nu,i)||Cu(Nu,e)&&!Cu(Lu,r)?"\\u"+ju(Au(e,0),16):e};Iu&&yu({target:"JSON",stat:!0,arity:3,forced:Uu||Fu},{stringify:function(e,t,n){var r=Su(arguments),i=gu(Uu?Du:Iu,null,r);return Fu&&"string"==typeof i?Pu(i,Mu,Bu):i}});var qu=jr,zu=Ge;si({target:"Object",stat:!0,forced:!fe||l((function(){qu.f(1)}))},{getOwnPropertySymbols:function(e){var t=qu.f;return t?t(zu(e)):[]}});var Wu=l,Gu=se,$u=st("species"),Hu=function(e){return Gu>=51||!Wu((function(){var t=[];return(t.constructor={})[$u]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Vu=Do.filter;si({target:"Array",proto:!0,forced:!Hu("filter")},{filter:function(e){return Vu(this,e,arguments.length>1?arguments[1]:void 0)}});var Ju=si,Ku=l,Qu=W,Yu=c.f,Xu=f;Ju({target:"Object",stat:!0,forced:!Xu||Ku((function(){Yu(1)})),sham:!Xu},{getOwnPropertyDescriptor:function(e,t){return Yu(Qu(e),t)}});var Zu=f,ec=Mt,tc=x,nc=function(e,t,n){Zu?ec.f(e,t,tc(0,n)):e[t]=n},rc=Dr,ic=W,ac=c,oc=nc;si({target:"Object",stat:!0,sham:!f},{getOwnPropertyDescriptors:function(e){for(var t,n,r=ic(e),i=ac.f,a=rc(r),o={},s=0;a.length>s;)void 0!==(n=i(r,t=a[s++]))&&oc(o,t,n);return o}});var sc={exports:{}};!function(e){function t(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,u,"next",e)}function u(e){t(o,i,a,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports}(sc);var uc=sc.exports,cc={exports:{}};!function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}(cc);var lc=cc.exports,fc={exports:{}},dc={exports:{}};!function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(dc);var pc=dc.exports;!function(e){var t=pc;e.exports=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&t(e,n)},e.exports.__esModule=!0,e.exports.default=e.exports}(fc);var hc=fc.exports,vc={exports:{}},yc={exports:{}};!function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(yc);var mc=yc.exports;!function(e){var t=mc.default,n=lc;e.exports=function(e,r){if(r&&("object"==t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(vc);var gc=vc.exports,bc={exports:{}};!function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(bc);var wc=bc.exports,kc={exports:{}},xc={exports:{}},_c={exports:{}};!function(e){var t=mc.default;e.exports=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(_c);var Sc=_c.exports;!function(e){var t=mc.default,n=Sc;e.exports=function(e){var r=n(e,"string");return"symbol"==t(r)?r:r+""},e.exports.__esModule=!0,e.exports.default=e.exports}(xc);var Ec=xc.exports;!function(e){var t=Ec;e.exports=function(e,n,r){return(n=t(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports}(kc);var Tc=kc.exports,Rc={exports:{}};!function(e){var t=Ec;function n(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}(Rc);var Ic=Rc.exports,Cc={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports}(Cc);var Oc=Cc.exports,Ac=Di,Pc=Pi?{}.toString:function(){return"[object "+Ac(this)+"]"};Pi||ir(Object.prototype,"toString",Pc,{unsafe:!0});var jc,Mc,Lc,Nc,Uc=u,Fc=ee,Dc=A,Bc=function(e){return Fc.slice(0,e.length)===e},qc=Bc("Bun/")?"BUN":Bc("Cloudflare-Workers")?"CLOUDFLARE":Bc("Deno/")?"DENO":Bc("Node.js/")?"NODE":Uc.Bun&&"string"==typeof Bun.version?"BUN":Uc.Deno&&"object"==e(Deno.version)?"DENO":"process"===Dc(Uc.process)?"NODE":Uc.window&&Uc.document?"BROWSER":"REST",zc="NODE"===qc,Wc=R,Gc=_e,$c=V,Hc=function(e){return $c(e)||null===e},Vc=String,Jc=TypeError,Kc=function(e,t,n){try{return Wc(Gc(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(r){}},Qc=V,Yc=B,Xc=function(e){if(Hc(e))return e;throw new Jc("Can't set "+Vc(e)+" as a prototype")},Zc=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Kc(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(r){}return function(n,r){return Yc(n),Xc(r),Qc(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0),el=Q,tl=no,nl=f,rl=st("species"),il=function(e){var t=el(e);nl&&t&&!t[rl]&&tl(t,rl,{configurable:!0,get:function(){return this}})},al=Y,ol=TypeError,sl=function(e,t){if(al(t,e))return e;throw new ol("Incorrect invocation")},ul=Dt,cl=na,ll=U,fl=st("species"),dl=function(e,t){var n,r=ul(e).constructor;return void 0===r||ll(n=ul(r)[fl])?t:cl(n)},pl=TypeError,hl=function(e,t){if(e<t)throw new pl("Not enough arguments");return e},vl=/(?:ipad|iphone|ipod).*applewebkit/i.test(ee),yl=u,ml=gi,gl=xo,bl=$,wl=Ve,kl=l,xl=ha,_l=bi,Sl=xt,El=hl,Tl=vl,Rl=zc,Il=yl.setImmediate,Cl=yl.clearImmediate,Ol=yl.process,Al=yl.Dispatch,Pl=yl.Function,jl=yl.MessageChannel,Ml=yl.String,Ll=0,Nl={},Ul="onreadystatechange";kl((function(){jc=yl.location}));var Fl=function(e){if(wl(Nl,e)){var t=Nl[e];delete Nl[e],t()}},Dl=function(e){return function(){Fl(e)}},Bl=function(e){Fl(e.data)},ql=function(e){yl.postMessage(Ml(e),jc.protocol+"//"+jc.host)};Il&&Cl||(Il=function(e){El(arguments.length,1);var t=bl(e)?e:Pl(e),n=_l(arguments,1);return Nl[++Ll]=function(){ml(t,void 0,n)},Mc(Ll),Ll},Cl=function(e){delete Nl[e]},Rl?Mc=function(e){Ol.nextTick(Dl(e))}:Al&&Al.now?Mc=function(e){Al.now(Dl(e))}:jl&&!Tl?(Nc=(Lc=new jl).port2,Lc.port1.onmessage=Bl,Mc=gl(Nc.postMessage,Nc)):yl.addEventListener&&bl(yl.postMessage)&&!yl.importScripts&&jc&&"file:"!==jc.protocol&&!kl(ql)?(Mc=ql,yl.addEventListener("message",Bl,!1)):Mc=Ul in Sl("script")?function(e){xl.appendChild(Sl("script"))[Ul]=function(){xl.removeChild(this),Fl(e)}}:function(e){setTimeout(Dl(e),0)});var zl={set:Il,clear:Cl},Wl=u,Gl=f,$l=Object.getOwnPropertyDescriptor,Hl=function(e){if(!Gl)return Wl[e];var t=$l(Wl,e);return t&&t.value},Vl=function(){this.head=null,this.tail=null};Vl.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Jl,Kl,Ql,Yl,Xl,Zl=Vl,ef=/ipad|iphone|ipod/i.test(ee)&&"undefined"!=typeof Pebble,tf=/web0s(?!.*chrome)/i.test(ee),nf=u,rf=Hl,af=xo,of=zl.set,sf=Zl,uf=vl,cf=ef,lf=tf,ff=zc,df=nf.MutationObserver||nf.WebKitMutationObserver,pf=nf.document,hf=nf.process,vf=nf.Promise,yf=rf("queueMicrotask");if(!yf){var mf=new sf,gf=function(){var e,t;for(ff&&(e=hf.domain)&&e.exit();t=mf.get();)try{t()}catch(n){throw mf.head&&Jl(),n}e&&e.enter()};uf||ff||lf||!df||!pf?!cf&&vf&&vf.resolve?((Yl=vf.resolve(void 0)).constructor=vf,Xl=af(Yl.then,Yl),Jl=function(){Xl(gf)}):ff?Jl=function(){hf.nextTick(gf)}:(of=af(of,nf),Jl=function(){of(gf)}):(Kl=!0,Ql=pf.createTextNode(""),new df(gf).observe(Ql,{characterData:!0}),Jl=function(){Ql.data=Kl=!Kl}),yf=function(e){mf.head||Jl(),mf.add(e)}}var bf=yf,wf=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},kf=u.Promise,xf=u,_f=kf,Sf=$,Ef=Zr,Tf=hn,Rf=st,If=qc,Cf=se;_f&&_f.prototype;var Of=Rf("species"),Af=!1,Pf=Sf(xf.PromiseRejectionEvent),jf=Ef("Promise",(function(){var e=Tf(_f),t=e!==String(_f);if(!t&&66===Cf)return!0;if(!Cf||Cf<51||!/native code/.test(e)){var n=new _f((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[Of]=r,!(Af=n.then((function(){}))instanceof r))return!0}return!(t||"BROWSER"!==If&&"DENO"!==If||Pf)})),Mf={CONSTRUCTOR:jf,REJECTION_EVENT:Pf,SUBCLASSING:Af},Lf={},Nf=_e,Uf=TypeError,Ff=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new Uf("Bad Promise constructor");t=e,n=r})),this.resolve=Nf(t),this.reject=Nf(n)};Lf.f=function(e){return new Ff(e)};var Df,Bf,qf,zf=si,Wf=zc,Gf=u,$f=v,Hf=ir,Vf=Zc,Jf=fi,Kf=il,Qf=_e,Yf=$,Xf=V,Zf=sl,ed=dl,td=zl.set,nd=bf,rd=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(n){}},id=wf,ad=Zl,od=Ln,sd=kf,ud=Lf,cd="Promise",ld=Mf.CONSTRUCTOR,fd=Mf.REJECTION_EVENT,dd=Mf.SUBCLASSING,pd=od.getterFor(cd),hd=od.set,vd=sd&&sd.prototype,yd=sd,md=vd,gd=Gf.TypeError,bd=Gf.document,wd=Gf.process,kd=ud.f,xd=kd,_d=!!(bd&&bd.createEvent&&Gf.dispatchEvent),Sd="unhandledrejection",Ed=function(e){var t;return!(!Xf(e)||!Yf(t=e.then))&&t},Td=function(e,t){var n,r,i,a=t.value,o=1===t.state,s=o?e.ok:e.fail,u=e.resolve,c=e.reject,l=e.domain;try{s?(o||(2===t.rejection&&Ad(t),t.rejection=1),!0===s?n=a:(l&&l.enter(),n=s(a),l&&(l.exit(),i=!0)),n===e.promise?c(new gd("Promise-chain cycle")):(r=Ed(n))?$f(r,n,u,c):u(n)):c(a)}catch(f){l&&!i&&l.exit(),c(f)}},Rd=function(e,t){e.notified||(e.notified=!0,nd((function(){for(var n,r=e.reactions;n=r.get();)Td(n,e);e.notified=!1,t&&!e.rejection&&Cd(e)})))},Id=function(e,t,n){var r,i;_d?((r=bd.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Gf.dispatchEvent(r)):r={promise:t,reason:n},!fd&&(i=Gf["on"+e])?i(r):e===Sd&&rd("Unhandled promise rejection",n)},Cd=function(e){$f(td,Gf,(function(){var t,n=e.facade,r=e.value;if(Od(e)&&(t=id((function(){Wf?wd.emit("unhandledRejection",r,n):Id(Sd,n,r)})),e.rejection=Wf||Od(e)?2:1,t.error))throw t.value}))},Od=function(e){return 1!==e.rejection&&!e.parent},Ad=function(e){$f(td,Gf,(function(){var t=e.facade;Wf?wd.emit("rejectionHandled",t):Id("rejectionhandled",t,e.value)}))},Pd=function(e,t,n){return function(r){e(t,r,n)}},jd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Rd(e,!0))},Md=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new gd("Promise can't be resolved itself");var r=Ed(t);r?nd((function(){var n={done:!1};try{$f(r,t,Pd(Md,n,e),Pd(jd,n,e))}catch(i){jd(n,i,e)}})):(e.value=t,e.state=1,Rd(e,!1))}catch(i){jd({done:!1},i,e)}}};if(ld&&(md=(yd=function(e){Zf(this,md),Qf(e),$f(Df,this);var t=pd(this);try{e(Pd(Md,t),Pd(jd,t))}catch(n){jd(t,n)}}).prototype,(Df=function(e){hd(this,{type:cd,done:!1,notified:!1,parent:!1,reactions:new ad,rejection:!1,state:0,value:void 0})}).prototype=Hf(md,"then",(function(e,t){var n=pd(this),r=kd(ed(this,yd));return n.parent=!0,r.ok=!Yf(e)||e,r.fail=Yf(t)&&t,r.domain=Wf?wd.domain:void 0,0===n.state?n.reactions.add(r):nd((function(){Td(r,n)})),r.promise})),Bf=function(){var e=new Df,t=pd(e);this.promise=e,this.resolve=Pd(Md,t),this.reject=Pd(jd,t)},ud.f=kd=function(e){return e===yd||undefined===e?new Bf(e):xd(e)},Yf(sd)&&vd!==Object.prototype)){qf=vd.then,dd||Hf(vd,"then",(function(e,t){var n=this;return new yd((function(e,t){$f(qf,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete vd.constructor}catch(NB){}Vf&&Vf(vd,md)}zf({global:!0,constructor:!0,wrap:!0,forced:ld},{Promise:yd}),Jf(yd,cd,!1),Kf(cd);var Ld={},Nd=Ld,Ud=st("iterator"),Fd=Array.prototype,Dd=function(e){return void 0!==e&&(Nd.Array===e||Fd[Ud]===e)},Bd=Di,qd=Te,zd=U,Wd=Ld,Gd=st("iterator"),$d=function(e){if(!zd(e))return qd(e,Gd)||qd(e,"@@iterator")||Wd[Bd(e)]},Hd=v,Vd=_e,Jd=Dt,Kd=be,Qd=$d,Yd=TypeError,Xd=function(e,t){var n=arguments.length<2?Qd(e):t;if(Vd(n))return Jd(Hd(n,e));throw new Yd(Kd(e)+" is not iterable")},Zd=v,ep=Dt,tp=Te,np=function(e,t,n){var r,i;ep(e);try{if(!(r=tp(e,"return"))){if("throw"===t)throw n;return n}r=Zd(r,e)}catch(NB){i=!0,r=NB}if("throw"===t)throw n;if(i)throw r;return ep(r),n},rp=xo,ip=v,ap=Dt,op=be,sp=Dd,up=gr,cp=Y,lp=Xd,fp=$d,dp=np,pp=TypeError,hp=function(e,t){this.stopped=e,this.result=t},vp=hp.prototype,yp=function(t,n,r){var i,a,o,s,u,c,l,f=r&&r.that,d=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_RECORD),h=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),y=rp(n,f),m=function(e){return i&&dp(i,"normal",e),new hp(!0,e)},g=function(e){return d?(ap(e),v?y(e[0],e[1],m):y(e[0],e[1])):v?y(e,m):y(e)};if(p)i=t.iterator;else if(h)i=t;else{if(!(a=fp(t)))throw new pp(op(t)+" is not iterable");if(sp(a)){for(o=0,s=up(t);s>o;o++)if((u=g(t[o]))&&cp(vp,u))return u;return new hp(!1)}i=lp(t,a)}for(c=p?t.next:i.next;!(l=ip(c,i)).done;){try{u=g(l.value)}catch(NB){dp(i,"throw",NB)}if("object"==e(u)&&u&&cp(vp,u))return u}return new hp(!1)},mp=st("iterator"),gp=!1;try{var bp=0,wp={next:function(){return{done:!!bp++}},return:function(){gp=!0}};wp[mp]=function(){return this},Array.from(wp,(function(){throw 2}))}catch(NB){}var kp=function(e,t){try{if(!t&&!gp)return!1}catch(NB){return!1}var n=!1;try{var r={};r[mp]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(NB){}return n},xp=kf,_p=Mf.CONSTRUCTOR||!kp((function(e){xp.all(e).then(void 0,(function(){}))})),Sp=v,Ep=_e,Tp=Lf,Rp=wf,Ip=yp;si({target:"Promise",stat:!0,forced:_p},{all:function(e){var t=this,n=Tp.f(t),r=n.resolve,i=n.reject,a=Rp((function(){var n=Ep(t.resolve),a=[],o=0,s=1;Ip(e,(function(e){var u=o++,c=!1;s++,Sp(n,t,e).then((function(e){c||(c=!0,a[u]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var Cp=si,Op=Mf.CONSTRUCTOR,Ap=kf,Pp=Q,jp=$,Mp=ir,Lp=Ap&&Ap.prototype;if(Cp({target:"Promise",proto:!0,forced:Op,real:!0},{catch:function(e){return this.then(void 0,e)}}),jp(Ap)){var Np=Pp("Promise").prototype.catch;Lp.catch!==Np&&Mp(Lp,"catch",Np,{unsafe:!0})}var Up=v,Fp=_e,Dp=Lf,Bp=wf,qp=yp;si({target:"Promise",stat:!0,forced:_p},{race:function(e){var t=this,n=Dp.f(t),r=n.reject,i=Bp((function(){var i=Fp(t.resolve);qp(e,(function(e){Up(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var zp=Lf;si({target:"Promise",stat:!0,forced:Mf.CONSTRUCTOR},{reject:function(e){var t=zp.f(this);return(0,t.reject)(e),t.promise}});var Wp=Dt,Gp=V,$p=Lf,Hp=si,Vp=Mf.CONSTRUCTOR,Jp=function(e,t){if(Wp(e),Gp(t)&&t.constructor===e)return t;var n=$p.f(e);return(0,n.resolve)(t),n.promise};Q("Promise"),Hp({target:"Promise",stat:!0,forced:Vp},{resolve:function(e){return Jp(this,e)}});var Kp=Do.map;si({target:"Array",proto:!0,forced:!Hu("map")},{map:function(e){return Kp(this,e,arguments.length>1?arguments[1]:void 0)}});var Qp={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Yp=xt("span").classList,Xp=Yp&&Yp.constructor&&Yp.constructor.prototype,Zp=Xp===Object.prototype?void 0:Xp,eh=l,th=function(e,t){var n=[][e];return!!n&&eh((function(){n.call(null,t||function(){return 1},1)}))},nh=Do.forEach,rh=th("forEach")?[].forEach:function(e){return nh(this,e,arguments.length>1?arguments[1]:void 0)},ih=u,ah=Qp,oh=Zp,sh=rh,uh=Zt,ch=function(e){if(e&&e.forEach!==sh)try{uh(e,"forEach",sh)}catch(NB){e.forEach=sh}};for(var lh in ah)ah[lh]&&ch(ih[lh]&&ih[lh].prototype);ch(oh);var fh={exports:{}};!function(e){var t=mc.default;function n(){e.exports=n=function(){return i},e.exports.__esModule=!0,e.exports.default=e.exports;var r,i={},a=Object.prototype,o=a.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",f=u.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(r){d=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof w?t:w,a=Object.create(i.prototype),o=new j(r||[]);return s(a,"_invoke",{value:C(e,n,o)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}i.wrap=p;var v="suspendedStart",y="suspendedYield",m="executing",g="completed",b={};function w(){}function k(){}function x(){}var _={};d(_,c,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(M([])));E&&E!==a&&o.call(E,c)&&(_=E);var T=x.prototype=w.prototype=Object.create(_);function R(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,n){function r(i,a,s,u){var c=h(e[i],e,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==t(f)&&o.call(f,"__await")?n.resolve(f.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):n.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,u)}))}u(c.arg)}var i;s(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,i){r(e,t,n,i)}))}return i=i?i.then(a,a):a()}})}function C(e,t,n){var i=v;return function(a,o){if(i===m)throw Error("Generator is already running");if(i===g){if("throw"===a)throw o;return{value:r,done:!0}}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var u=O(s,n);if(u){if(u===b)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===v)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=m;var c=h(e,t,n);if("normal"===c.type){if(i=n.done?g:y,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=g,n.method="throw",n.arg=c.arg)}}}function O(e,t){var n=t.method,i=e.iterator[n];if(i===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=r,O(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var a=h(i,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,b;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,b):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function t(){for(;++i<e.length;)if(o.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=r,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return k.prototype=x,s(T,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:k,configurable:!0}),k.displayName=d(x,f,"GeneratorFunction"),i.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,d(e,f,"GeneratorFunction")),e.prototype=Object.create(T),e},i.awrap=function(e){return{__await:e}},R(I.prototype),d(I.prototype,l,(function(){return this})),i.AsyncIterator=I,i.async=function(e,t,n,r,a){void 0===a&&(a=Promise);var o=new I(p(e,t,n,r),a);return i.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},R(T),d(T,f,"Generator"),d(T,c,(function(){return this})),d(T,"toString",(function(){return"[object Generator]"})),i.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},i.values=M,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return s.type="throw",s.arg=e,t.next=n,i&&(t.method="next",t.arg=r),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),b}},i}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}(fh);var dh=(0,fh.exports)(),ph=dh;try{regeneratorRuntime=dh}catch(UB){"object"===("undefined"==typeof globalThis?"undefined":e(globalThis))?globalThis.regeneratorRuntime=dh:Function("r","regeneratorRuntime = r")(dh)}var hh=TypeError,vh=function(e){if(e>9007199254740991)throw hh("Maximum allowed index exceeded");return e},yh=si,mh=l,gh=So,bh=V,wh=Ge,kh=gr,xh=vh,_h=nc,Sh=Ao,Eh=Hu,Th=se,Rh=st("isConcatSpreadable"),Ih=Th>=51||!mh((function(){var e=[];return e[Rh]=!1,e.concat()[0]!==e})),Ch=function(e){if(!bh(e))return!1;var t=e[Rh];return void 0!==t?!!t:gh(e)};yh({target:"Array",proto:!0,arity:1,forced:!Ih||!Eh("concat")},{concat:function(e){var t,n,r,i,a,o=wh(this),s=Sh(o,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Ch(a=-1===t?o:arguments[t]))for(i=kh(a),xh(u+i),n=0;n<i;n++,u++)n in a&&_h(s,u,a[n]);else xh(u+1),_h(s,u++,a);return s.length=u,s}});var Oh=Dt,Ah=np,Ph=xo,jh=v,Mh=Ge,Lh=function(e,t,n,r){try{return r?t(Oh(n)[0],n[1]):t(n)}catch(NB){Ah(e,"throw",NB)}},Nh=Dd,Uh=Xi,Fh=gr,Dh=nc,Bh=Xd,qh=$d,zh=Array,Wh=function(e){var t=Mh(e),n=Uh(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=Ph(i,r>2?arguments[2]:void 0));var o,s,u,c,l,f,d=qh(t),p=0;if(!d||this===zh&&Nh(d))for(o=Fh(t),s=n?new this(o):zh(o);o>p;p++)f=a?i(t[p],p):t[p],Dh(s,p,f);else for(s=n?new this:[],l=(c=Bh(t,d)).next;!(u=jh(l,c)).done;p++)f=a?Lh(c,i,[u.value,p],!0):u.value,Dh(s,p,f);return s.length=p,s},Gh=Wh;si({target:"Array",stat:!0,forced:!kp((function(e){Array.from(e)}))},{from:Gh});var $h,Hh,Vh,Jh=R,Kh=cr,Qh=Va,Yh=B,Xh=Jh("".charAt),Zh=Jh("".charCodeAt),ev=Jh("".slice),tv=function(e){return function(t,n){var r,i,a=Qh(Yh(t)),o=Kh(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=Zh(a,o))<55296||r>56319||o+1===s||(i=Zh(a,o+1))<56320||i>57343?e?Xh(a,o):r:e?ev(a,o,o+2):i-56320+(r-55296<<10)+65536}},nv={codeAt:tv(!1),charAt:tv(!0)},rv=!l((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),iv=Ve,av=$,ov=Ge,sv=rv,uv=wn("IE_PROTO"),cv=Object,lv=cv.prototype,fv=sv?cv.getPrototypeOf:function(e){var t=ov(e);if(iv(t,uv))return t[uv];var n=t.constructor;return av(n)&&t instanceof n?n.prototype:t instanceof cv?lv:null},dv=l,pv=$,hv=V,vv=fv,yv=ir,mv=st("iterator"),gv=!1;[].keys&&("next"in(Vh=[].keys())?(Hh=vv(vv(Vh)))!==Object.prototype&&($h=Hh):gv=!0);var bv=!hv($h)||dv((function(){var e={};return $h[mv].call(e)!==e}));bv&&($h={}),pv($h[mv])||yv($h,mv,(function(){return this}));var wv={IteratorPrototype:$h,BUGGY_SAFARI_ITERATORS:gv},kv=wv.IteratorPrototype,xv=Ia,_v=x,Sv=fi,Ev=Ld,Tv=function(){return this},Rv=function(e,t,n,r){var i=t+" Iterator";return e.prototype=xv(kv,{next:_v(+!r,n)}),Sv(e,i,!1),Ev[i]=Tv,e},Iv=si,Cv=v,Ov=$,Av=Rv,Pv=fv,jv=Zc,Mv=fi,Lv=Zt,Nv=ir,Uv=Ld,Fv=sn.PROPER,Dv=sn.CONFIGURABLE,Bv=wv.IteratorPrototype,qv=wv.BUGGY_SAFARI_ITERATORS,zv=st("iterator"),Wv="keys",Gv="values",$v="entries",Hv=function(){return this},Vv=function(e,t,n,r,i,a,o){Av(n,t,r);var s,u,c,l=function(e){if(e===i&&v)return v;if(!qv&&e&&e in p)return p[e];switch(e){case Wv:case Gv:case $v:return function(){return new n(this,e)}}return function(){return new n(this)}},f=t+" Iterator",d=!1,p=e.prototype,h=p[zv]||p["@@iterator"]||i&&p[i],v=!qv&&h||l(i),y="Array"===t&&p.entries||h;if(y&&(s=Pv(y.call(new e)))!==Object.prototype&&s.next&&(Pv(s)!==Bv&&(jv?jv(s,Bv):Ov(s[zv])||Nv(s,zv,Hv)),Mv(s,f,!0)),Fv&&i===Gv&&h&&h.name!==Gv&&(Dv?Lv(p,"name",Gv):(d=!0,v=function(){return Cv(h,this)})),i)if(u={values:l(Gv),keys:a?v:l(Wv),entries:l($v)},o)for(c in u)(qv||d||!(c in p))&&Nv(p,c,u[c]);else Iv({target:t,proto:!0,forced:qv||d},u);return p[zv]!==v&&Nv(p,zv,v,{name:i}),Uv[t]=v,u},Jv=function(e,t){return{value:e,done:t}},Kv=nv.charAt,Qv=Va,Yv=Ln,Xv=Vv,Zv=Jv,ey="String Iterator",ty=Yv.set,ny=Yv.getterFor(ey);Xv(String,"String",(function(e){ty(this,{type:ey,string:Qv(e),index:0})}),(function(){var e,t=ny(this),n=t.string,r=t.index;return r>=n.length?Zv(void 0,!0):(e=Kv(n,r),t.index+=e.length,Zv(e,!1))}));var ry={exports:{}};!function(t){var n,i;n=r,i=function(){var t=function(){},n="undefined",r=("undefined"==typeof window?"undefined":e(window))!==n&&e(window.navigator)!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],a={},o=null;function s(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function u(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var r=this.getLevel(),a=0;a<i.length;a++){var o=i[a];this[o]=a<r?t:this.methodFactory(o,r,this.name)}if(this.log=this.debug,("undefined"==typeof console?"undefined":e(console))===n&&r<this.levels.SILENT)return"No console available for logging"}function l(t){return function(){("undefined"==typeof console?"undefined":e(console))!==n&&(c.call(this),this[t].apply(this,arguments))}}function f(i,a,o){return function(i){return"debug"===i&&(i="log"),("undefined"==typeof console?"undefined":e(console))!==n&&("trace"===i&&r?u:void 0!==console[i]?s(console,i):void 0!==console.log?s(console,"log"):t)}(i)||l.apply(this,arguments)}function d(t,r){var s,u,l,d=this,p="loglevel";function h(){var t;if(("undefined"==typeof window?"undefined":e(window))!==n&&p){try{t=window.localStorage[p]}catch(o){}if(e(t)===n)try{var r=window.document.cookie,i=encodeURIComponent(p),a=r.indexOf(i+"=");-1!==a&&(t=/^([^;]+)/.exec(r.slice(a+i.length+1))[1])}catch(o){}return void 0===d.levels[t]&&(t=void 0),t}}function v(e){var t=e;if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=d.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof t?p+=":"+t:"symbol"===e(t)&&(p=void 0),d.name=t,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=r||f,d.getLevel=function(){return null!=l?l:null!=u?u:s},d.setLevel=function(t,r){return l=v(t),!1!==r&&function(t){var r=(i[t]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":e(window))!==n&&p){try{return void(window.localStorage[p]=r)}catch(a){}try{window.document.cookie=encodeURIComponent(p)+"="+r+";"}catch(a){}}}(l),c.call(d)},d.setDefaultLevel=function(e){u=v(e),h()||d.setLevel(e,!1)},d.resetLevel=function(){l=null,function(){if(("undefined"==typeof window?"undefined":e(window))!==n&&p){try{window.localStorage.removeItem(p)}catch(t){}try{window.document.cookie=encodeURIComponent(p)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(t){}}}(),c.call(d)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)},d.rebuild=function(){if(o!==d&&(s=v(o.getLevel())),c.call(d),o===d)for(var e in a)a[e].rebuild()},s=v(o?o.getLevel():"WARN");var y=h();null!=y&&(l=v(y)),c.call(d)}(o=new d).getLogger=function(t){if("symbol"!==e(t)&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var n=a[t];return n||(n=a[t]=new d(t,o.methodFactory)),n};var p=("undefined"==typeof window?"undefined":e(window))!==n?window.log:void 0;return o.noConflict=function(){return("undefined"==typeof window?"undefined":e(window))!==n&&window.log===o&&(window.log=p),o},o.getLoggers=function(){return a},o.default=o,o},t.exports?t.exports=i():n.log=i()}(ry);var iy=ry.exports,ay="\\d+(?:[\\.,]\\d+)?",oy="(".concat(ay,"W)"),sy="(".concat(ay,"Y)?(").concat(ay,"M)?(").concat(ay,"D)?"),uy="T(".concat(ay,"H)?(").concat(ay,"M)?(").concat(ay,"S)?"),cy="P(?:".concat(oy,"|").concat(sy,"(?:").concat(uy,")?)"),ly=["weeks","years","months","days","hours","minutes","seconds"],fy=new RegExp(cy),dy=function(e){return e.match(fy).slice(1).reduce((function(e,t,n){return e[ly[n]]=parseFloat(t)||0,e}),{})},py=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+1e3*e.seconds),r.setDate(r.getDate()+7*e.weeks),r},hy=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return(py(e,r).getTime()-r.getTime())/1e3},vy={end:py,toSeconds:hy,pattern:fy,parse:dy},yy=Object.freeze(Object.defineProperty({__proto__:null,default:vy,end:py,parse:dy,pattern:fy,toSeconds:hy},Symbol.toStringTag,{value:"Module"})),my=i(yy),gy=st,by=Ia,wy=Mt.f,ky=gy("unscopables"),xy=Array.prototype;void 0===xy[ky]&&wy(xy,ky,{configurable:!0,value:by(null)});var _y=function(e){xy[ky][e]=!0},Sy=W,Ey=_y,Ty=Ld,Ry=Ln,Iy=Mt.f,Cy=Vv,Oy=Jv,Ay=f,Py="Array Iterator",jy=Ry.set,My=Ry.getterFor(Py),Ly=Cy(Array,"Array",(function(e,t){jy(this,{type:Py,target:Sy(e),index:0,kind:t})}),(function(){var e=My(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,Oy(void 0,!0);switch(e.kind){case"keys":return Oy(n,!1);case"values":return Oy(t[n],!1)}return Oy([n,t[n]],!1)}),"values"),Ny=Ty.Arguments=Ty.Array;if(Ey("keys"),Ey("values"),Ey("entries"),Ay&&"values"!==Ny.name)try{Iy(Ny,"name",{value:"values"})}catch(NB){}var Uy=u,Fy=Qp,Dy=Zp,By=Ly,qy=Zt,zy=fi,Wy=st("iterator"),Gy=By.values,$y=function(e,t){if(e){if(e[Wy]!==Gy)try{qy(e,Wy,Gy)}catch(NB){e[Wy]=Gy}if(zy(e,t,!0),Fy[t])for(var n in By)if(e[n]!==By[n])try{qy(e,n,By[n])}catch(NB){e[n]=By[n]}}};for(var Hy in Fy)$y(Uy[Hy]&&Uy[Hy].prototype,Hy);$y(Dy,"DOMTokenList");var Vy=$,Jy=V,Ky=Zc,Qy=function(e,t,n){var r,i;return Ky&&Vy(r=t.constructor)&&r!==n&&Jy(i=r.prototype)&&i!==n.prototype&&Ky(e,i),e},Yy=R(1..valueOf),Xy=B,Zy=Va,em="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",tm=R("".replace),nm=RegExp("^["+em+"]+"),rm=RegExp("(^|[^"+em+"])["+em+"]+$"),im=function(e){return function(t){var n=Zy(Xy(t));return 1&e&&(n=tm(n,nm,"")),2&e&&(n=tm(n,rm,"$1")),n}},am={start:im(1),end:im(2),trim:im(3)},om=si,sm=f,um=u,cm=ao,lm=R,fm=Zr,dm=Ve,pm=Qy,hm=Y,vm=me,ym=vt,mm=l,gm=ar.f,bm=c.f,wm=Mt.f,km=Yy,xm=am.trim,_m="Number",Sm=um[_m];cm[_m];var Em=Sm.prototype,Tm=um.TypeError,Rm=lm("".slice),Im=lm("".charCodeAt),Cm=function(e){var t,n,r,i,a,o,s,u,c=ym(e,"number");if(vm(c))throw new Tm("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=xm(c),43===(t=Im(c,0))||45===t){if(88===(n=Im(c,2))||120===n)return NaN}else if(48===t){switch(Im(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(o=(a=Rm(c,2)).length,s=0;s<o;s++)if((u=Im(a,s))<48||u>i)return NaN;return parseInt(a,r)}return+c},Om=fm(_m,!Sm(" 0o1")||!Sm("0b1")||Sm("+0x1")),Am=function(e){var t,n=arguments.length<1?0:Sm(function(e){var t=ym(e,"number");return"bigint"==typeof t?t:Cm(t)}(e));return hm(Em,t=this)&&mm((function(){km(t)}))?pm(Object(n),this,Am):n};Am.prototype=Em,Om&&(Em.constructor=Am),om({global:!0,constructor:!0,wrap:!0,forced:Om},{Number:Am});Om&&function(e,t){for(var n,r=sm?gm(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)dm(t,n=r[i])&&!dm(e,n)&&wm(e,n,bm(t,n))}(cm[_m],Sm);var Pm,jm,Mm=Dt,Lm=function(){var e=Mm(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Nm=l,Um=u.RegExp,Fm=Nm((function(){var e=Um("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),Dm=Fm||Nm((function(){return!Um("a","y").sticky})),Bm=Fm||Nm((function(){var e=Um("^r","gy");return e.lastIndex=2,null!==e.exec("str")})),qm={BROKEN_CARET:Bm,MISSED_STICKY:Dm,UNSUPPORTED_Y:Fm},zm=l,Wm=u.RegExp,Gm=zm((function(){var e=Wm(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})),$m=l,Hm=u.RegExp,Vm=$m((function(){var e=Hm("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Jm=v,Km=R,Qm=Va,Ym=Lm,Xm=qm,Zm=Ia,eg=Ln.get,tg=Gm,ng=Vm,rg=qe("native-string-replace",String.prototype.replace),ig=RegExp.prototype.exec,ag=ig,og=Km("".charAt),sg=Km("".indexOf),ug=Km("".replace),cg=Km("".slice),lg=(jm=/b*/g,Jm(ig,Pm=/a/,"a"),Jm(ig,jm,"a"),0!==Pm.lastIndex||0!==jm.lastIndex),fg=Xm.BROKEN_CARET,dg=void 0!==/()??/.exec("")[1];(lg||dg||fg||tg||ng)&&(ag=function(e){var t,n,r,i,a,o,s,u=this,c=eg(u),l=Qm(e),f=c.raw;if(f)return f.lastIndex=u.lastIndex,t=Jm(ag,f,l),u.lastIndex=f.lastIndex,t;var d=c.groups,p=fg&&u.sticky,h=Jm(Ym,u),v=u.source,y=0,m=l;if(p&&(h=ug(h,"y",""),-1===sg(h,"g")&&(h+="g"),m=cg(l,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==og(l,u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,y++),n=new RegExp("^(?:"+v+")",h)),dg&&(n=new RegExp("^"+v+"$(?!\\s)",h)),lg&&(r=u.lastIndex),i=Jm(ig,p?n:u,m),p?i?(i.input=cg(i.input,y),i[0]=cg(i[0],y),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:lg&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),dg&&i&&i.length>1&&Jm(rg,i[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&d)for(i.groups=o=Zm(null),a=0;a<d.length;a++)o[(s=d[a])[0]]=i[s[1]];return i});var pg=ag;si({target:"RegExp",proto:!0,forced:/./.exec!==pg},{exec:pg});var hg=v,vg=ir,yg=pg,mg=l,gg=st,bg=Zt,wg=gg("species"),kg=RegExp.prototype,xg=function(e,t,n,r){var i=gg(e),a=!mg((function(){var t={};return t[i]=function(){return 7},7!==""[e](t)})),o=a&&!mg((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[wg]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!a||!o||n){var s=/./[i],u=t(i,""[e],(function(e,t,n,r,i){var o=t.exec;return o===yg||o===kg.exec?a&&!i?{done:!0,value:hg(s,t,n,r)}:{done:!0,value:hg(e,n,t,r)}:{done:!1}}));vg(String.prototype,e,u[0]),vg(kg,i,u[1])}r&&bg(kg[i],"sham",!0)},_g=nv.charAt,Sg=function(e,t,n){return t+(n?_g(e,t).length:1)},Eg=R,Tg=Ge,Rg=Math.floor,Ig=Eg("".charAt),Cg=Eg("".replace),Og=Eg("".slice),Ag=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Pg=/\$([$&'`]|\d{1,2})/g,jg=v,Mg=Dt,Lg=$,Ng=A,Ug=pg,Fg=TypeError,Dg=function(e,t){var n=e.exec;if(Lg(n)){var r=jg(n,e,t);return null!==r&&Mg(r),r}if("RegExp"===Ng(e))return jg(Ug,e,t);throw new Fg("RegExp#exec called on incompatible receiver")},Bg=gi,qg=v,zg=R,Wg=xg,Gg=l,$g=Dt,Hg=$,Vg=U,Jg=cr,Kg=yr,Qg=Va,Yg=B,Xg=Sg,Zg=Te,eb=function(e,t,n,r,i,a){var o=n+e.length,s=r.length,u=Pg;return void 0!==i&&(i=Tg(i),u=Ag),Cg(a,u,(function(a,u){var c;switch(Ig(u,0)){case"$":return"$";case"&":return e;case"`":return Og(t,0,n);case"'":return Og(t,o);case"<":c=i[Og(u,1,-1)];break;default:var l=+u;if(0===l)return a;if(l>s){var f=Rg(l/10);return 0===f?a:f<=s?void 0===r[f-1]?Ig(u,1):r[f-1]+Ig(u,1):a}c=r[l-1]}return void 0===c?"":c}))},tb=Dg,nb=st("replace"),rb=Math.max,ib=Math.min,ab=zg([].concat),ob=zg([].push),sb=zg("".indexOf),ub=zg("".slice),cb="$0"==="a".replace(/./,"$0"),lb=!!/./[nb]&&""===/./[nb]("a","$0"),fb=!Gg((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));Wg("replace",(function(e,t,n){var r=lb?"$":"$0";return[function(e,n){var r=Yg(this),i=Vg(e)?void 0:Zg(e,nb);return i?qg(i,e,r,n):qg(t,Qg(r),e,n)},function(e,i){var a=$g(this),o=Qg(e);if("string"==typeof i&&-1===sb(i,r)&&-1===sb(i,"$<")){var s=n(t,a,o,i);if(s.done)return s.value}var u=Hg(i);u||(i=Qg(i));var c,l=a.global;l&&(c=a.unicode,a.lastIndex=0);for(var f,d=[];null!==(f=tb(a,o))&&(ob(d,f),l);){""===Qg(f[0])&&(a.lastIndex=Xg(o,Kg(a.lastIndex),c))}for(var p,h="",v=0,y=0;y<d.length;y++){for(var m,g=Qg((f=d[y])[0]),b=rb(ib(Jg(f.index),o.length),0),w=[],k=1;k<f.length;k++)ob(w,void 0===(p=f[k])?p:String(p));var x=f.groups;if(u){var _=ab([g],w,b,o);void 0!==x&&ob(_,x),m=Qg(Bg(i,void 0,_))}else m=eb(g,o,b,w,x,i);b>=v&&(h+=ub(o,v,b)+m,v=b+g.length)}return h+ub(o,v)}]}),!fb||!cb||lb);var db=si,pb=N,hb=W,vb=th,yb=R([].join);db({target:"Array",proto:!0,forced:pb!==Object||!vb("join",",")},{join:function(e){return yb(hb(this),void 0===e?",":e)}});var mb={},gb=f,bb=sn.EXISTS,wb=R,kb=no,xb=Function.prototype,_b=wb(xb.toString),Sb=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Eb=wb(Sb.exec);gb&&!bb&&kb(xb,"name",{configurable:!0,get:function(){try{return Eb(Sb,_b(this))[1]}catch(NB){return""}}});var Tb={exports:{}},Rb={exports:{}};!function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports}(Rb);var Ib=Rb.exports,Cb={exports:{}};!function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports}(Cb);var Ob=Cb.exports,Ab={exports:{}},Pb={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports}(Pb);var jb=Pb.exports;!function(e){var t=jb;e.exports=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}(Ab);var Mb=Ab.exports,Lb={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(Lb);var Nb=Lb.exports;!function(e){var t=Ib,n=Ob,r=Mb,i=Nb;e.exports=function(e,a){return t(e)||n(e,a)||r(e,a)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(Tb);var Ub=Tb.exports,Fb=si,Db=So,Bb=Xi,qb=V,zb=pr,Wb=gr,Gb=W,$b=nc,Hb=st,Vb=bi,Jb=Hu("slice"),Kb=Hb("species"),Qb=Array,Yb=Math.max;Fb({target:"Array",proto:!0,forced:!Jb},{slice:function(e,t){var n,r,i,a=Gb(this),o=Wb(a),s=zb(e,o),u=zb(void 0===t?o:t,o);if(Db(a)&&(n=a.constructor,(Bb(n)&&(n===Qb||Db(n.prototype))||qb(n)&&null===(n=n[Kb]))&&(n=void 0),n===Qb||void 0===n))return Vb(a,s,u);for(r=new(void 0===n?Qb:n)(Yb(u-s,0)),i=0;s<u;s++,i++)s in a&&$b(r,i,a[s]);return r.length=i,r}});var Xb,Zb,ew=si,tw=v,nw=$,rw=Dt,iw=Va,aw=(Xb=!1,(Zb=/[ac]/).exec=function(){return Xb=!0,/./.exec.apply(this,arguments)},!0===Zb.test("abc")&&Xb),ow=/./.test;ew({target:"RegExp",proto:!0,forced:!aw},{test:function(e){var t=rw(this),n=iw(e),r=t.exec;if(!nw(r))return tw(ow,t,n);var i=tw(r,t,n);return null!==i&&(rw(i),!0)}});var sw=si,uw=f,cw=R,lw=Ve,fw=$,dw=Y,pw=Va,hw=no,vw=Gr,yw=u.Symbol,mw=yw&&yw.prototype;if(uw&&fw(yw)&&(!("description"in mw)||void 0!==yw().description)){var gw={},bw=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:pw(arguments[0]),t=dw(mw,this)?new yw(e):void 0===e?yw():yw(e);return""===e&&(gw[t]=!0),t};vw(bw,yw),bw.prototype=mw,mw.constructor=bw;var ww="Symbol(description detection)"===String(yw("description detection")),kw=cw(mw.valueOf),xw=cw(mw.toString),_w=/^Symbol\((.*)\)[^)]+$/,Sw=cw("".replace),Ew=cw("".slice);hw(mw,"description",{configurable:!0,get:function(){var e=kw(this);if(lw(gw,e))return"";var t=xw(e),n=ww?Ew(t,7,-1):Sw(t,_w,"$1");return""===n?void 0:n}}),sw({global:!0,constructor:!0,forced:!0},{Symbol:bw})}lo("iterator");var Tw={exports:{}},Rw={exports:{}};!function(e){var t=jb;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(Rw);var Iw=Rw.exports,Cw={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports}(Cw);var Ow=Cw.exports,Aw={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}(Aw);var Pw=Aw.exports;!function(e){var t=Iw,n=Ow,r=Mb,i=Pw;e.exports=function(e){return t(e)||n(e)||r(e)||i()},e.exports.__esModule=!0,e.exports.default=e.exports}(Tw);var jw=Tw.exports,Mw=_r.includes,Lw=_y;si({target:"Array",proto:!0,forced:l((function(){return!Array(1).includes()}))},{includes:function(e){return Mw(this,e,arguments.length>1?arguments[1]:void 0)}}),Lw("includes");var Nw=V,Uw=Math.floor,Fw=Number.isInteger||function(e){return!Nw(e)&&isFinite(e)&&Uw(e)===e};si({target:"Number",stat:!0},{isInteger:Fw});var Dw=f,Bw=l,qw=R,zw=fv,Ww=oa,Gw=W,$w=qw(y.f),Hw=qw([].push),Vw=Dw&&Bw((function(){var e=Object.create(null);return e[2]=2,!$w(e,2)})),Jw=function(e){return function(t){for(var n,r=Gw(t),i=Ww(r),a=Vw&&null===zw(r),o=i.length,s=0,u=[];o>s;)n=i[s++],Dw&&!(a?n in r:$w(r,n))||Hw(u,e?[n,r[n]]:r[n]);return u}},Kw={entries:Jw(!0),values:Jw(!1)}.entries;si({target:"Object",stat:!0},{entries:function(e){return Kw(e)}}),
/*
      @license
      Copyright (c) 2021 Twilio Inc.

      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


      */
Object.defineProperty(mb,"__esModule",{value:!0});var Qw=Ub,Yw=jw,Xw=Ic,Zw=Oc,ek=hc,tk=gc,nk=wc;function rk(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}var ik=rk(mc),ak=rk(Qw),ok=rk(Yw),sk=rk(Xw),uk=rk(Zw),ck=rk(ek),lk=rk(tk),fk=rk(nk),dk=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}},pk=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return dk((function(e){for(var n=!1,r=[],i=0,a=t;i<a.length;i++){var o=a[i];"string"!=typeof o?(n=n||e instanceof o,r.push("an instance of ".concat(o.name))):(n=n||ik.default(e)===o,r.push("of type ".concat(o)))}return[n,r]}))};function hk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fk.default(e);if(t){var i=fk.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return lk.default(this,n)}}function vk(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return yk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yk(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function yk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mk=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=vk(t.entries());try{for(r.s();!(n=r.n()).done;){var i=ak.default(n.value,2),a=i[0],o=i[1],s=kk(e[a],o),u=ak.default(s,4),c=u[0],l=u[1],f=u[2],d=u[3];if(!c)throw new Error("Argument ".concat(a+1," is expected to be ").concat(f).concat(d," but got ").concat(l))}}catch(p){r.e(p)}finally{r.f()}},gk=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(ik.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===ik.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=ik.default(e)),n},bk=function(e){var t,n=[],r=vk(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(wk(i))}}catch(a){r.e(a)}finally{r.f()}return n},wk=function(e){var t,n=[],r=vk(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(pk(i))}}catch(a){r.e(a)}finally{r.f()}return n},kk=function(e,t){var n,r,i=[],a=!1,o=vk(e);try{for(o.s();!(r=o.n()).done;){var s,u=vk(r.value.checks);try{for(u.s();!(s=u.n()).done;){var c=(0,s.value)(t),l=ak.default(c,3),f=l[0],d=l[1],p=l[2];a=a||f,!n&&p&&(n=p),d&&(i=[].concat(ok.default(i),"string"==typeof d?[d]:ok.default(d)))}}catch(y){u.e(y)}finally{u.f()}}}catch(y){o.e(y)}finally{o.f()}if(a)return[!0];var h=n||gk(t),v=i.length-1;return[!1,h,v>0?"".concat(i.slice(0,v).join(", ")," or ").concat(i[v]):i.join(", "),v>1?";":","]};function xk(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _k(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Sk=dk((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),Ek=dk((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),Tk=dk((function(e){return["object"===ik.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function Rk(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ik(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ik(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ik(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}mb.array=function(e,t){return dk((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=Rk(n.entries());try{for(i.s();!(r=i.n()).done;){var a=ak.default(r.value,2),o=a[0],s=a[1],u=kk(wk(t),s),c=ak.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(o," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(o," is ").concat(f,")")]}}catch(p){i.e(p)}finally{i.f()}return[!0]}))},mb.custom=dk,mb.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return dk((function(e){for(var n=!1,r=[],i=0,a=t;i<a.length;i++){var o=a[i];n=n||e===o,r.push("string"==typeof o?'"'.concat(o,'"'):"".concat(o))}return[n,r]}))},mb.nonEmptyArray=function(e,t){return dk((function(n){if(!Array.isArray(n)||n.length<1)return[!1,"a non-empty array of ".concat(e)];var r,i=xk(n.entries());try{for(i.s();!(r=i.n()).done;){var a=ak.default(r.value,2),o=a[0],s=a[1],u=kk(wk(t),s),c=ak.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid non-empty array of ".concat(e," (index ").concat(o," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(o," is ").concat(f,")")]}}catch(p){i.e(p)}finally{i.f()}return[!0]}))},mb.nonEmptyString=Sk,mb.nonNegativeInteger=Ek,mb.objectSchema=function(e,t){return dk((function(n){if("object"!==ik.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var a=ak.default(i[r],2),o=a[0],s=a[1],u=kk(wk(s),n[o]),c=ak.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(o,'" should be ').concat(d,")"),"malformed ".concat(e,' (key "').concat(o,'" is ').concat(f,")")]}return[!0]}))},mb.pureObject=Tk,mb.runtimeTypeValidation=mk,mb.stringifyReceivedType=gk,mb.type=pk,mb.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=bk(t);return function(e){return function(e){ck.default(n,e);var t=hk(n);function n(){uk.default(this,n);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return mk(r,i),t.call.apply(t,[this].concat(i))}return sk.default(n)}(e)}},mb.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=bk(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return mk(r,t),i.apply(this,t)}}},mb.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=bk(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{mk(r,t)}catch(a){return Promise.reject(a)}return i.apply(this,t)}}};var Ck={},Ok={exports:{}},Ak={exports:{}};!function(e){var t=wc;e.exports=function(e,n){for(;!{}.hasOwnProperty.call(e,n)&&null!==(e=t(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports}(Ak);var Pk=Ak.exports;!function(e){var t=Pk;function n(){return e.exports=n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,n,r){var i=t(e,n);if(i){var a=Object.getOwnPropertyDescriptor(i,n);return a.get?a.get.call(arguments.length<3?e:r):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports,n.apply(null,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}(Ok);var jk=Ok.exports;
/*
      @license
      Copyright (c) 2021 Twilio Inc.

      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

      */Object.defineProperty(Ck,"__esModule",{value:!0});var Mk=Oc,Lk=Ic,Nk=lc,Uk=jk,Fk=hc,Dk=gc,Bk=wc,qk=Tc;function zk(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}var Wk=zk(jw),Gk=zk(Mk),$k=zk(Lk),Hk=zk(Nk),Vk=zk(Uk),Jk=zk(Fk),Kk=zk(Dk),Qk=zk(Bk),Yk=zk(qk);function Xk(){}function Zk(){Zk.init.call(this)}function ex(e){return void 0===e._maxListeners?Zk.defaultMaxListeners:e._maxListeners}function tx(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new Xk,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=ex(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function nx(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function rx(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function ix(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function ax(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qk.default(e);if(t){var i=Qk.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Kk.default(this,n)}}Xk.prototype=Object.create(null),Zk.EventEmitter=Zk,Zk.usingDomains=!1,Zk.prototype.domain=void 0,Zk.prototype._events=void 0,Zk.prototype._maxListeners=void 0,Zk.defaultMaxListeners=10,Zk.init=function(){this.domain=null,Zk.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Xk,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Zk.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Zk.prototype.getMaxListeners=function(){return ex(this)},Zk.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=ix(e,r),a=0;a<r;++a)i[a].call(n)}(n,l,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=ix(e,i),o=0;o<i;++o)a[o].call(n,r)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=ix(e,a),s=0;s<a;++s)o[s].call(n,r,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=ix(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=ix(e,i),o=0;o<i;++o)a[o].apply(n,r)}(n,l,this,i)}return!0},Zk.prototype.addListener=function(e,t){return tx(this,e,t,!1)},Zk.prototype.on=Zk.prototype.addListener,Zk.prototype.prependListener=function(e,t){return tx(this,e,t,!0)},Zk.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,nx(this,e,t)),this},Zk.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,nx(this,e,t)),this},Zk.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Xk:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Xk,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},Zk.prototype.off=function(e,t){return this.removeListener(e,t)},Zk.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Xk,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Xk:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Xk,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Zk.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},Zk.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):rx.call(e,t)},Zk.prototype.listenerCount=rx,Zk.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var ox=function(e){Jk.default(n,e);var t=ax(n);function n(){var e;return Gk.default(this,n),e=t.call(this),Yk.default(Hk.default(e),"eventHistory",new Map),e}return $k.default(n,[{key:"on",value:function(e,t){return Vk.default(Qk.default(n.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return Vk.default(Qk.default(n.prototype),"once",this).call(this,e,t)}},{key:"off",value:function(e,t){return Vk.default(Qk.default(n.prototype),"off",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return this.eventHistory.set(e,i),(t=Vk.default(Qk.default(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}},{key:"addListener",value:function(e,t){return Vk.default(Qk.default(n.prototype),"addListener",this).call(this,e,t)}},{key:"removeListener",value:function(e,t){return Vk.default(Qk.default(n.prototype),"removeListener",this).call(this,e,t)}},{key:"addListenerWithReplay",value:function(e,t){var n=this.eventHistory.get(e);return void 0!==n&&t.apply(void 0,Wk.default(n)),this.addListener(e,t)}},{key:"onWithReplay",value:function(e,t){return this.addListenerWithReplay(e,t)}},{key:"onceWithReplay",value:function(e,t){var r=this.eventHistory.get(e);return void 0!==r?(t.apply(void 0,Wk.default(r)),this):Vk.default(Qk.default(n.prototype),"once",this).call(this,e,t)}}]),n}(Zk);Ck.ReplayEventEmitter=ox;var sx={exports:{}};!function(t,n){var i="__lodash_hash_undefined__",a=1,o=2,s=9007199254740991,u="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",f="[object Boolean]",d="[object Date]",p="[object Error]",h="[object Function]",v="[object GeneratorFunction]",y="[object Map]",m="[object Number]",g="[object Null]",b="[object Object]",w="[object Promise]",k="[object Proxy]",x="[object RegExp]",_="[object Set]",S="[object String]",E="[object Symbol]",T="[object Undefined]",R="[object WeakMap]",I="[object ArrayBuffer]",C="[object DataView]",O=/^\[object .+?Constructor\]$/,A=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[u]=P[c]=P[I]=P[f]=P[C]=P[d]=P[p]=P[h]=P[y]=P[m]=P[b]=P[x]=P[_]=P[S]=P[R]=!1;var j="object"==e(r)&&r&&r.Object===Object&&r,M="object"==("undefined"==typeof self?"undefined":e(self))&&self&&self.Object===Object&&self,L=j||M||Function("return this")(),N=n&&!n.nodeType&&n,U=N&&t&&!t.nodeType&&t,F=U&&U.exports===N,D=F&&j.process,B=function(){try{return D&&D.binding&&D.binding("util")}catch(e){}}(),q=B&&B.isTypedArray;function z(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function W(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function G(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var $,H,V=Array.prototype,J=Function.prototype,K=Object.prototype,Q=L["__core-js_shared__"],Y=J.toString,X=K.hasOwnProperty,Z=function(){var e=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ee=K.toString,te=RegExp("^"+Y.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=F?L.Buffer:void 0,re=L.Symbol,ie=L.Uint8Array,ae=K.propertyIsEnumerable,oe=V.splice,se=re?re.toStringTag:void 0,ue=Object.getOwnPropertySymbols,ce=ne?ne.isBuffer:void 0,le=($=Object.keys,H=Object,function(e){return $(H(e))}),fe=De(L,"DataView"),de=De(L,"Map"),pe=De(L,"Promise"),he=De(L,"Set"),ve=De(L,"WeakMap"),ye=De(Object,"create"),me=We(fe),ge=We(de),be=We(pe),we=We(he),ke=We(ve),xe=re?re.prototype:void 0,_e=xe?xe.valueOf:void 0;function Se(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Re(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Te;++t<n;)this.add(e[t])}function Ie(e){var t=this.__data__=new Ee(e);this.size=t.size}function Ce(e,t){var n=He(e),r=!n&&$e(e),i=!n&&!r&&Ve(e),a=!n&&!r&&!i&&Xe(e),o=n||r||i||a,s=o?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=s.length;for(var c in e)!X.call(e,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ze(c,u))||s.push(c);return s}function Oe(e,t){for(var n=e.length;n--;)if(Ge(e[n][0],t))return n;return-1}function Ae(e){return null==e?void 0===e?T:g:se&&se in Object(e)?function(e){var t=X.call(e,se),n=e[se];try{e[se]=void 0;var r=!0}catch(a){}var i=ee.call(e);r&&(t?e[se]=n:delete e[se]);return i}(e):function(e){return ee.call(e)}(e)}function Pe(e){return Ye(e)&&Ae(e)==u}function je(e,t,n,r,i){return e===t||(null==e||null==t||!Ye(e)&&!Ye(t)?e!=e&&t!=t:function(e,t,n,r,i,s){var l=He(e),h=He(t),v=l?c:qe(e),g=h?c:qe(t),w=(v=v==u?b:v)==b,k=(g=g==u?b:g)==b,T=v==g;if(T&&Ve(e)){if(!Ve(t))return!1;l=!0,w=!1}if(T&&!w)return s||(s=new Ie),l||Xe(e)?Ne(e,t,n,r,i,s):function(e,t,n,r,i,s,u){switch(n){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case I:return!(e.byteLength!=t.byteLength||!s(new ie(e),new ie(t)));case f:case d:case m:return Ge(+e,+t);case p:return e.name==t.name&&e.message==t.message;case x:case S:return e==t+"";case y:var c=W;case _:var l=r&a;if(c||(c=G),e.size!=t.size&&!l)return!1;var h=u.get(e);if(h)return h==t;r|=o,u.set(e,t);var v=Ne(c(e),c(t),r,i,s,u);return u.delete(e),v;case E:if(_e)return _e.call(e)==_e.call(t)}return!1}(e,t,v,n,r,i,s);if(!(n&a)){var R=w&&X.call(e,"__wrapped__"),O=k&&X.call(t,"__wrapped__");if(R||O){var A=R?e.value():e,P=O?t.value():t;return s||(s=new Ie),i(A,P,n,r,s)}}if(!T)return!1;return s||(s=new Ie),function(e,t,n,r,i,o){var s=n&a,u=Ue(e),c=u.length,l=Ue(t),f=l.length;if(c!=f&&!s)return!1;var d=c;for(;d--;){var p=u[d];if(!(s?p in t:X.call(t,p)))return!1}var h=o.get(e);if(h&&o.get(t))return h==t;var v=!0;o.set(e,t),o.set(t,e);var y=s;for(;++d<c;){var m=e[p=u[d]],g=t[p];if(r)var b=s?r(g,m,p,t,e,o):r(m,g,p,e,t,o);if(!(void 0===b?m===g||i(m,g,n,r,o):b)){v=!1;break}y||(y="constructor"==p)}if(v&&!y){var w=e.constructor,k=t.constructor;w==k||!("constructor"in e)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof k&&k instanceof k||(v=!1)}return o.delete(e),o.delete(t),v}(e,t,n,r,i,s)}(e,t,n,r,je,i))}function Me(e){return!(!Qe(e)||function(e){return!!Z&&Z in e}(e))&&(Je(e)?te:O).test(We(e))}function Le(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||K,t!==r)return le(e);var t,n,r,i=[];for(var a in Object(e))X.call(e,a)&&"constructor"!=a&&i.push(a);return i}function Ne(e,t,n,r,i,s){var u=n&a,c=e.length,l=t.length;if(c!=l&&!(u&&l>c))return!1;var f=s.get(e);if(f&&s.get(t))return f==t;var d=-1,p=!0,h=n&o?new Re:void 0;for(s.set(e,t),s.set(t,e);++d<c;){var v=e[d],y=t[d];if(r)var m=u?r(y,v,d,t,e,s):r(v,y,d,e,t,s);if(void 0!==m){if(m)continue;p=!1;break}if(h){if(!z(t,(function(e,t){if(a=t,!h.has(a)&&(v===e||i(v,e,n,r,s)))return h.push(t);var a}))){p=!1;break}}else if(v!==y&&!i(v,y,n,r,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function Ue(e){return function(e,t,n){var r=t(e);return He(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Ze,Be)}function Fe(t,n){var r=t.__data__;return function(t){var n=e(t);return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}(n)?r["string"==typeof n?"string":"hash"]:r.map}function De(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Me(n)?n:void 0}Se.prototype.clear=function(){this.__data__=ye?ye(null):{},this.size=0},Se.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Se.prototype.get=function(e){var t=this.__data__;if(ye){var n=t[e];return n===i?void 0:n}return X.call(t,e)?t[e]:void 0},Se.prototype.has=function(e){var t=this.__data__;return ye?void 0!==t[e]:X.call(t,e)},Se.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ye&&void 0===t?i:t,this},Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(e){var t=this.__data__,n=Oe(t,e);return!(n<0)&&(n==t.length-1?t.pop():oe.call(t,n,1),--this.size,!0)},Ee.prototype.get=function(e){var t=this.__data__,n=Oe(t,e);return n<0?void 0:t[n][1]},Ee.prototype.has=function(e){return Oe(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var n=this.__data__,r=Oe(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Te.prototype.clear=function(){this.size=0,this.__data__={hash:new Se,map:new(de||Ee),string:new Se}},Te.prototype.delete=function(e){var t=Fe(this,e).delete(e);return this.size-=t?1:0,t},Te.prototype.get=function(e){return Fe(this,e).get(e)},Te.prototype.has=function(e){return Fe(this,e).has(e)},Te.prototype.set=function(e,t){var n=Fe(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Re.prototype.add=Re.prototype.push=function(e){return this.__data__.set(e,i),this},Re.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.clear=function(){this.__data__=new Ee,this.size=0},Ie.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ie.prototype.get=function(e){return this.__data__.get(e)},Ie.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ee){var r=n.__data__;if(!de||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Te(r)}return n.set(e,t),this.size=n.size,this};var Be=ue?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}(ue(e),(function(t){return ae.call(e,t)})))}:function(){return[]},qe=Ae;function ze(e,t){return!!(t=null==t?s:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function We(e){if(null!=e){try{return Y.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Ge(e,t){return e===t||e!=e&&t!=t}(fe&&qe(new fe(new ArrayBuffer(1)))!=C||de&&qe(new de)!=y||pe&&qe(pe.resolve())!=w||he&&qe(new he)!=_||ve&&qe(new ve)!=R)&&(qe=function(e){var t=Ae(e),n=t==b?e.constructor:void 0,r=n?We(n):"";if(r)switch(r){case me:return C;case ge:return y;case be:return w;case we:return _;case ke:return R}return t});var $e=Pe(function(){return arguments}())?Pe:function(e){return Ye(e)&&X.call(e,"callee")&&!ae.call(e,"callee")},He=Array.isArray;var Ve=ce||function(){return!1};function Je(e){if(!Qe(e))return!1;var t=Ae(e);return t==h||t==v||t==l||t==k}function Ke(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function Qe(t){var n=e(t);return null!=t&&("object"==n||"function"==n)}function Ye(t){return null!=t&&"object"==e(t)}var Xe=q?function(e){return function(t){return e(t)}}(q):function(e){return Ye(e)&&Ke(e.length)&&!!P[Ae(e)]};function Ze(e){return null!=(t=e)&&Ke(t.length)&&!Je(t)?Ce(e):Le(e);var t}t.exports=function(e,t){return je(e,t)}}(sx,sx.exports);var ux=sx.exports,cx={exports:{}},lx=l((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),fx=l,dx=V,px=A,hx=lx,vx=Object.isExtensible,yx=fx((function(){vx(1)}))||hx?function(e){return!!dx(e)&&((!hx||"ArrayBuffer"!==px(e))&&(!vx||vx(e)))}:vx,mx=!l((function(){return Object.isExtensible(Object.preventExtensions({}))})),gx=si,bx=R,wx=kn,kx=V,xx=Ve,_x=Mt.f,Sx=ar,Ex=Ja,Tx=yx,Rx=mx,Ix=!1,Cx=Xe("meta"),Ox=0,Ax=function(e){_x(e,Cx,{value:{objectID:"O"+Ox++,weakData:{}}})},Px=cx.exports={enable:function(){Px.enable=function(){},Ix=!0;var e=Sx.f,t=bx([].splice),n={};n[Cx]=1,e(n).length&&(Sx.f=function(n){for(var r=e(n),i=0,a=r.length;i<a;i++)if(r[i]===Cx){t(r,i,1);break}return r},gx({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Ex.f}))},fastKey:function(t,n){if(!kx(t))return"symbol"==e(t)?t:("string"==typeof t?"S":"P")+t;if(!xx(t,Cx)){if(!Tx(t))return"F";if(!n)return"E";Ax(t)}return t[Cx].objectID},getWeakData:function(e,t){if(!xx(e,Cx)){if(!Tx(e))return!0;if(!t)return!1;Ax(e)}return e[Cx].weakData},onFreeze:function(e){return Rx&&Ix&&Tx(e)&&!xx(e,Cx)&&Ax(e),e}};wx[Cx]=!0;var jx=cx.exports,Mx=si,Lx=u,Nx=R,Ux=Zr,Fx=ir,Dx=jx,Bx=yp,qx=sl,zx=$,Wx=U,Gx=V,$x=l,Hx=kp,Vx=fi,Jx=Qy,Kx=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=r?"set":"add",o=Lx[e],s=o&&o.prototype,u=o,c={},l=function(e){var t=Nx(s[e]);Fx(s,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(i&&!Gx(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return i&&!Gx(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(i&&!Gx(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(Ux(e,!zx(o)||!(i||s.forEach&&!$x((function(){(new o).entries().next()})))))u=n.getConstructor(t,e,r,a),Dx.enable();else if(Ux(e,!0)){var f=new u,d=f[a](i?{}:-0,1)!==f,p=$x((function(){f.has(1)})),h=Hx((function(e){new o(e)})),v=!i&&$x((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));h||((u=t((function(e,t){qx(e,s);var n=Jx(new o,e,u);return Wx(t)||Bx(t,n[a],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=u),(p||v)&&(l("delete"),l("has"),r&&l("get")),(v||d)&&l(a),i&&s.clear&&delete s.clear}return c[e]=u,Mx({global:!0,constructor:!0,forced:u!==o},c),Vx(u,e),i||n.setStrong(u,e,r),u},Qx=ir,Yx=function(e,t,n){for(var r in t)Qx(e,r,t[r],n);return e},Xx=Ia,Zx=no,e_=Yx,t_=xo,n_=sl,r_=U,i_=yp,a_=Vv,o_=Jv,s_=il,u_=f,c_=jx.fastKey,l_=Ln.set,f_=Ln.getterFor,d_={getConstructor:function(e,t,n,r){var i=e((function(e,i){n_(e,a),l_(e,{type:t,index:Xx(null),first:void 0,last:void 0,size:0}),u_||(e.size=0),r_(i)||i_(i,e[r],{that:e,AS_ENTRIES:n})})),a=i.prototype,o=f_(t),s=function(e,t,n){var r,i,a=o(e),s=u(e,t);return s?s.value=n:(a.last=s={index:i=c_(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),u_?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},u=function(e,t){var n,r=o(e),i=c_(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key===t)return n};return e_(a,{clear:function(){for(var e=o(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=void 0),t=t.next;e.first=e.last=void 0,e.index=Xx(null),u_?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),r=u(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first===r&&(n.first=i),n.last===r&&(n.last=a),u_?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=o(this),r=t_(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),e_(a,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),u_&&Zx(a,"size",{configurable:!0,get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=f_(t),a=f_(r);a_(e,t,(function(e,t){l_(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?o_("keys"===t?n.key:"values"===t?n.value:[n.key,n.value],!1):(e.target=void 0,o_(void 0,!0))}),n?"entries":"values",!n,!0),s_(t)}};Kx("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),d_);var p_={};
/*
      @license
      Copyright (c) 2016, Twilio, Inc.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted, provided that the above
      copyright notice and this permission notice appear in all copies.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
      WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
      MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
      SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
      WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
      OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
      CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

      */Object.defineProperty(p_,"__esModule",{value:!0});var h_=Ic,v_=lc,y_=hc,m_=gc,g_=wc,b_=Tc;function w_(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}var k_=w_(Oc),x_=w_(h_),__=w_(v_),S_=w_(y_),E_=w_(m_),T_=w_(g_),R_=w_(b_);function I_(){}function C_(){C_.init.call(this)}function O_(e){return void 0===e._maxListeners?C_.defaultMaxListeners:e._maxListeners}function A_(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new I_,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=O_(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function P_(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function j_(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function M_(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function L_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T_.default(e);if(t){var i=T_.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E_.default(this,n)}}I_.prototype=Object.create(null),C_.EventEmitter=C_,C_.usingDomains=!1,C_.prototype.domain=void 0,C_.prototype._events=void 0,C_.prototype._maxListeners=void 0,C_.defaultMaxListeners=10,C_.init=function(){this.domain=null,C_.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new I_,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C_.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},C_.prototype.getMaxListeners=function(){return O_(this)},C_.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=M_(e,r),a=0;a<r;++a)i[a].call(n)}(n,l,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=M_(e,i),o=0;o<i;++o)a[o].call(n,r)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=M_(e,a),s=0;s<a;++s)o[s].call(n,r,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=M_(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=M_(e,i),o=0;o<i;++o)a[o].apply(n,r)}(n,l,this,i)}return!0},C_.prototype.addListener=function(e,t){return A_(this,e,t,!1)},C_.prototype.on=C_.prototype.addListener,C_.prototype.prependListener=function(e,t){return A_(this,e,t,!0)},C_.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,P_(this,e,t)),this},C_.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,P_(this,e,t)),this},C_.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new I_:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new I_,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},C_.prototype.off=function(e,t){return this.removeListener(e,t)},C_.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new I_,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new I_:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new I_,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},C_.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},C_.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):j_.call(e,t)},C_.prototype.listenerCount=j_,C_.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var N_=function(e){S_.default(n,e);var t=L_(n);function n(e){var r;return k_.default(this,n),r=t.call(this),R_.default(__.default(r),"timeout",null),R_.default(__.default(r),"startTimestamp",-1),r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return x_.default(n,[{key:"attempt",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt count limit reached"));var n=this.nextDelay(e);if(n=this.randomize(n),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+n)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((function(){return t.attempt()}),n)}},{key:"cleanup",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}},{key:"succeeded",value:function(e){this.emit("succeeded",e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}}]),n}(C_),U_=function(e){S_.default(n,e);var t=L_(n);function n(e){var r;return k_.default(this,n),r=t.call(this),R_.default(__.default(r),"resolve",(function(){})),R_.default(__.default(r),"reject",(function(){})),r.retrier=new N_(e),r}return x_.default(n,[{key:"run",value:function(e){var t=this;return this.retrier.on("attempt",(function(){e().then((function(e){return t.retrier.succeeded(e)})).catch((function(e){return t.retrier.failed(e)}))})),this.retrier.on("succeeded",(function(e){return t.resolve(e)})),this.retrier.on("cancelled",(function(){return t.reject(new Error("Cancelled"))})),this.retrier.on("failed",(function(e){return t.reject(e)})),new Promise((function(e,n){t.resolve=e,t.reject=n,t.retrier.start()}))}},{key:"cancel",value:function(){this.retrier.cancel()}}]),n}(C_);function F_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T_.default(e);if(t){var i=T_.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E_.default(this,n)}}function D_(e){return null!=e}var B_=function(e){S_.default(n,e);var t=F_(n);function n(e){var r;k_.default(this,n),r=t.call(this),R_.default(__.default(r),"backoffDelay",0),R_.default(__.default(r),"nextBackoffDelay",0),R_.default(__.default(r),"backoffNumber",0),R_.default(__.default(r),"timeoutID",null),R_.default(__.default(r),"maxNumberOfRetry",-1);var i=e=e||{},a=i.initialDelay,o=i.maxDelay,s=i.randomisationFactor,u=i.factor;if(D_(a)&&a<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(D_(o)&&o<=1)throw new Error("The maximal timeout must be greater than 1.");if(D_(s)&&(s<0||s>1))throw new Error("The randomisation factor must be between 0 and 1.");if(D_(u)&&u<=1)throw new Error("Exponential factor should be greater than 1.");if(r.initialDelay=a||100,r.maxDelay=o||1e4,r.maxDelay<=r.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");return r.randomisationFactor=s||0,r.factor=u||2,r.reset(),r}return x_.default(n,[{key:"backoff",value:function(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}},{key:"reset",value:function(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}},{key:"failAfter",value:function(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}},{key:"next",value:function(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}},{key:"onBackoff",value:function(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}],[{key:"exponential",value:function(e){return new n(e)}}]),n}(C_);p_.AsyncRetrier=U_,p_.Backoff=B_,p_.Retrier=N_;var q_={},z_=v,W_=Ve,G_=Y,$_=Lm,H_=RegExp.prototype,V_=sn.PROPER,J_=ir,K_=Dt,Q_=Va,Y_=l,X_=function(e){var t=e.flags;return void 0!==t||"flags"in H_||W_(e,"flags")||!G_(H_,e)?t:z_($_,e)},Z_="toString",eS=RegExp.prototype,tS=eS[Z_],nS=Y_((function(){return"/a/b"!==tS.call({source:"a",flags:"b"})})),rS=V_&&tS.name!==Z_;(nS||rS)&&J_(eS,Z_,(function(){var e=K_(this);return"/"+Q_(e.source)+"/"+Q_(X_(e))}),{unsafe:!0});var iS={};
/*
      @license
      Copyright (c) 2021 Twilio Inc.

      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


      */Object.defineProperty(iS,"__esModule",{value:!0});var aS=Ub,oS=jw,sS=Oc,uS=hc,cS=gc,lS=wc;function fS(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}var dS=fS(mc),pS=fS(aS),hS=fS(oS),vS=fS(sS),yS=fS(uS),mS=fS(cS),gS=fS(lS),bS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}};function wS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kS(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function kS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xS=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return bS((function(e){var n,r=!1,i=[],a=wS(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;"string"!=typeof o?(r=r||e instanceof o,i.push("an instance of ".concat(o.name))):(r=r||dS.default(e)===o,i.push("of type ".concat(o)))}}catch(s){a.e(s)}finally{a.f()}return[r,i]}))};function _S(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return SS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SS(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function SS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ES=bS((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),TS=bS((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),RS=bS((function(e){return["object"===dS.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function IS(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=gS.default(e);if(t){var i=gS.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return mS.default(this,n)}}function CS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return OS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OS(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function OS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var AS=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=CS(t.entries());try{for(r.s();!(n=r.n()).done;){var i=pS.default(n.value,2),a=i[0],o=i[1],s=LS(e[a],o),u=pS.default(s,4),c=u[0],l=u[1],f=u[2],d=u[3];if(!c)throw new Error("Argument ".concat(a+1," is expected to be ").concat(f).concat(d," but got ").concat(l))}}catch(p){r.e(p)}finally{r.f()}},PS=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(dS.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===dS.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=dS.default(e)),n},jS=function(e){var t,n=[],r=CS(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(MS(i))}}catch(a){r.e(a)}finally{r.f()}return n},MS=function(e){var t,n=[],r=CS(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(xS(i))}}catch(a){r.e(a)}finally{r.f()}return n},LS=function(e,t){var n,r,i=[],a=!1,o=CS(e);try{for(o.s();!(r=o.n()).done;){var s,u=CS(r.value.checks);try{for(u.s();!(s=u.n()).done;){var c=(0,s.value)(t),l=pS.default(c,3),f=l[0],d=l[1],p=l[2];a=a||f,!n&&p&&(n=p),d&&(i=[].concat(hS.default(i),"string"==typeof d?[d]:hS.default(d)))}}catch(y){u.e(y)}finally{u.f()}}}catch(y){o.e(y)}finally{o.f()}if(a)return[!0];var h=n||PS(t),v=i.length-1;return[!1,h,v>0?"".concat(i.slice(0,v).join(", ")," or ").concat(i[v]):i.join(", "),v>1?";":","]};function NS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return US(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return US(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function US(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}iS.array=function(e,t){return bS((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=NS(n.entries());try{for(i.s();!(r=i.n()).done;){var a=pS.default(r.value,2),o=a[0],s=a[1],u=LS(MS(t),s),c=pS.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(o," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(o," is ").concat(f,")")]}}catch(p){i.e(p)}finally{i.f()}return[!0]}))},iS.custom=bS,iS.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return bS((function(e){var n,r=!1,i=[],a=_S(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r=r||e===o,i.push("string"==typeof o?'"'.concat(o,'"'):"".concat(o))}}catch(s){a.e(s)}finally{a.f()}return[r,i]}))},iS.nonEmptyString=ES,iS.nonNegativeInteger=TS,iS.objectSchema=function(e,t){return bS((function(n){if("object"!==dS.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var a=pS.default(i[r],2),o=a[0],s=a[1],u=LS(MS(s),n[o]),c=pS.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(o,'" should be ').concat(d,")"),"malformed ".concat(e,' (key "').concat(o,'" is ').concat(f,")")]}return[!0]}))},iS.pureObject=RS,iS.runtimeTypeValidation=AS,iS.stringifyReceivedType=PS,iS.type=xS,iS.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jS(t);return function(e){return function(e){yS.default(n,e);var t=IS(n);function n(){vS.default(this,n);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return AS(r,i),t.call.apply(t,[this].concat(i))}return n}(e)}},iS.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jS(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return AS(r,t),i.apply(this,t)}}},iS.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=jS(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{AS(r,t)}catch(a){return Promise.reject(a)}return i.apply(this,t)}}},Kx("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),d_);var FS={exports:{}};!function(t){var n;n=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){var r=n(0);e.exports={build:function(e,t){var n,i,a,o=t.plugins;for(n=0,i=o.length;n<i;n++)(a=o[n]).methods&&r(e,a.methods),a.properties&&Object.defineProperties(e,a.properties)},hook:function(e,t,n){var r,i,a,o,s=e.config.plugins,u=[e.context];for(n&&(u=u.concat(n)),r=0,i=s.length;r<i;r++)o=s[r],(a=s[r][t])&&a.apply(o,u)}}},function(e,t,n){function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(t,n,r){var i=r(0),a=r(2);function o(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}i(o.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=a.prepended("onEnter",e),this.lifecycle.onLeave[e]=a.prepended("onLeave",e),this.lifecycle.on[e]=a.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=a.prepended("onBefore",e),this.lifecycle.onAfter[e]=a.prepended("onAfter",e),this.lifecycle.on[e]=a.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(t){return"string"==typeof t?this.mapTransition(i({},this.defaults.init,{to:t,active:!0})):"object"===e(t)?this.mapTransition(i({},this.defaults.init,t,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(t){return"function"==typeof t?t:"object"===e(t)?function(){return t}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,a,o=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||o],a=r.to||o,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:a})},transitionFor:function(e,t){var n=this.defaults.wildcard;return this.map[e][t]||this.map[n][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),t.exports=o},function(e,t,n){var r=n(0),i=n(6),a=n(1),o=[null,[]];function s(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(s.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,a=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),a?this.observersForEvent(i.onLeave.state):o,a?this.observersForEvent(i.onLeave[t]):o,this.observersForEvent(i.on.transition),a?["doTransit",[this]]:o,a?this.observersForEvent(i.onEnter.state):o,a?this.observersForEvent(i.onEnter[n]):o,a?this.observersForEvent(i.on[n]):o,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],o=e[0][1],s=e[0][2];if(t[0].event=i,i&&s&&i!==n&&a.hook(this,"lifecycle",t),0===o.length)return e.shift(),this.observeEvents(e,t,i,r);var u=o.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=s},function(t,n,r){var i=r(0),a=r(2),o=r(1),s=r(3),u=r(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},l={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function f(e){return d(this||{},e)}function d(e,t){return p(e,new s(t,f)),e._fsm(),e}function p(t,n){if("object"!==e(t)||Array.isArray(t))throw Error("StateMachine can only be applied to objects");o.build(t,n),Object.defineProperties(t,l),i(t,c),i(t,n.methods),n.allTransitions().forEach((function(e){t[a(e)]=function(){return this._fsm.fire(e,[].slice.call(arguments))}})),t._fsm=function(){this._fsm=new u(this,n),this._fsm.init(arguments)}}f.version="3.0.1",f.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new s(t,f);return p(e.prototype,n),e.prototype._fsm.config=n,e},f.apply=d,f.defaults={wildcard:"*",init:{name:"init",from:"none"}},t.exports=f},function(e,t,n){e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},t.exports=n()}(FS);var DS=FS.exports,BS={exports:{}},qS="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(qS){var zS=new Uint8Array(16);BS.exports=function(){return qS(zS),zS}}else{var WS=new Array(16);BS.exports=function(){for(var e,t=0;t<16;t++)3&t||(e=4294967296*Math.random()),WS[t]=e>>>((3&t)<<3)&255;return WS}}for(var GS=BS.exports,$S=[],HS=0;HS<256;++HS)$S[HS]=(HS+256).toString(16).substr(1);var VS,JS,KS=function(e,t){var n=t||0,r=$S;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},QS=GS,YS=KS,XS=0,ZS=0;var eE=function(e,t,n){var r=t&&n||0,i=t||[],a=(e=e||{}).node||VS,o=void 0!==e.clockseq?e.clockseq:JS;if(null==a||null==o){var s=QS();null==a&&(a=VS=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=JS=16383&(s[6]<<8|s[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:ZS+1,l=u-XS+(c-ZS)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||u>XS)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");XS=u,ZS=c,JS=o;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var d=u/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=255&d,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var p=0;p<6;++p)i[r+p]=a[p];return t||YS(i)},tE=GS,nE=KS;var rE=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||tE)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[r+a]=i[a];return t||nE(i)},iE=eE,aE=rE,oE=aE;oE.v1=iE,oE.v4=aE;var sE,uE,cE,lE=oE,fE={exports:{}},dE="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,pE=dE,hE=f,vE=u,yE=$,mE=V,gE=Ve,bE=Di,wE=be,kE=Zt,xE=ir,_E=no,SE=Y,EE=fv,TE=Zc,RE=st,IE=Xe,CE=Ln.enforce,OE=Ln.get,AE=vE.Int8Array,PE=AE&&AE.prototype,jE=vE.Uint8ClampedArray,ME=jE&&jE.prototype,LE=AE&&EE(AE),NE=PE&&EE(PE),UE=Object.prototype,FE=vE.TypeError,DE=RE("toStringTag"),BE=IE("TYPED_ARRAY_TAG"),qE="TypedArrayConstructor",zE=pE&&!!TE&&"Opera"!==bE(vE.opera),WE=!1,GE={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},$E={BigInt64Array:8,BigUint64Array:8},HE=function(e){var t=EE(e);if(mE(t)){var n=OE(t);return n&&gE(n,qE)?n[qE]:HE(t)}},VE=function(e){if(!mE(e))return!1;var t=bE(e);return gE(GE,t)||gE($E,t)};for(sE in GE)(cE=(uE=vE[sE])&&uE.prototype)?CE(cE)[qE]=uE:zE=!1;for(sE in $E)(cE=(uE=vE[sE])&&uE.prototype)&&(CE(cE)[qE]=uE);if((!zE||!yE(LE)||LE===Function.prototype)&&(LE=function(){throw new FE("Incorrect invocation")},zE))for(sE in GE)vE[sE]&&TE(vE[sE],LE);if((!zE||!NE||NE===UE)&&(NE=LE.prototype,zE))for(sE in GE)vE[sE]&&TE(vE[sE].prototype,NE);if(zE&&EE(ME)!==NE&&TE(ME,NE),hE&&!gE(NE,DE))for(sE in WE=!0,_E(NE,DE,{configurable:!0,get:function(){return mE(this)?this[BE]:void 0}}),GE)vE[sE]&&kE(vE[sE],BE,sE);var JE={NATIVE_ARRAY_BUFFER_VIEWS:zE,TYPED_ARRAY_TAG:WE&&BE,aTypedArray:function(e){if(VE(e))return e;throw new FE("Target is not a typed array")},aTypedArrayConstructor:function(e){if(yE(e)&&(!TE||SE(LE,e)))return e;throw new FE(wE(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(hE){if(n)for(var i in GE){var a=vE[i];if(a&&gE(a.prototype,e))try{delete a.prototype[e]}catch(NB){try{a.prototype[e]=t}catch(o){}}}NE[e]&&!n||xE(NE,e,n?t:zE&&PE[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(hE){if(TE){if(n)for(r in GE)if((i=vE[r])&&gE(i,e))try{delete i[e]}catch(NB){}if(LE[e]&&!n)return;try{return xE(LE,e,n?t:zE&&LE[e]||t)}catch(NB){}}for(r in GE)!(i=vE[r])||i[e]&&!n||xE(i,e,t)}},getTypedArrayConstructor:HE,isView:function(e){if(!mE(e))return!1;var t=bE(e);return"DataView"===t||gE(GE,t)||gE($E,t)},isTypedArray:VE,TypedArray:LE,TypedArrayPrototype:NE},KE=u,QE=l,YE=kp,XE=JE.NATIVE_ARRAY_BUFFER_VIEWS,ZE=KE.ArrayBuffer,eT=KE.Int8Array,tT=!XE||!QE((function(){eT(1)}))||!QE((function(){new eT(-1)}))||!YE((function(e){new eT,new eT(null),new eT(1.5),new eT(e)}),!0)||QE((function(){return 1!==new eT(new ZE(2),1,void 0).length})),nT=cr,rT=yr,iT=RangeError,aT=function(e){if(void 0===e)return 0;var t=nT(e),n=rT(t);if(t!==n)throw new iT("Wrong length or index");return n},oT=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1},sT=Math.abs,uT=2220446049250313e-31,cT=1/uT,lT=function(e,t,n,r){var i=+e,a=sT(i),o=oT(i);if(a<r)return o*function(e){return e+cT-cT}(a/r/t)*r*t;var s=(1+t/uT)*a,u=s-(s-a);return u>n||u!=u?o*(1/0):o*u},fT=Math.fround||function(e){return lT(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)},dT=Array,pT=Math.abs,hT=Math.pow,vT=Math.floor,yT=Math.log,mT=Math.LN2,gT={pack:function(e,t,n){var r,i,a,o=dT(n),s=8*n-t-1,u=(1<<s)-1,c=u>>1,l=23===t?hT(2,-24)-hT(2,-77):0,f=e<0||0===e&&1/e<0?1:0,d=0;for((e=pT(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=vT(yT(e)/mT),e*(a=hT(2,-r))<1&&(r--,a*=2),(e+=r+c>=1?l/a:l*hT(2,1-c))*a>=2&&(r++,a/=2),r+c>=u?(i=0,r=u):r+c>=1?(i=(e*a-1)*hT(2,t),r+=c):(i=e*hT(2,c-1)*hT(2,t),r=0));t>=8;)o[d++]=255&i,i/=256,t-=8;for(r=r<<t|i,s+=t;s>0;)o[d++]=255&r,r/=256,s-=8;return o[d-1]|=128*f,o},unpack:function(e,t){var n,r=e.length,i=8*r-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=r-1,c=e[u--],l=127&c;for(c>>=7;s>0;)l=256*l+e[u--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[u--],s-=8;if(0===l)l=1-o;else{if(l===a)return n?NaN:c?-1/0:1/0;n+=hT(2,t),l-=o}return(c?-1:1)*n*hT(2,l-t)}},bT=Ge,wT=pr,kT=gr,xT=function(e){for(var t=bT(this),n=kT(t),r=arguments.length,i=wT(r>1?arguments[1]:void 0,n),a=r>2?arguments[2]:void 0,o=void 0===a?n:wT(a,n);o>i;)t[i++]=e;return t},_T=u,ST=R,ET=f,TT=dE,RT=Zt,IT=no,CT=Yx,OT=l,AT=sl,PT=cr,jT=yr,MT=aT,LT=fT,NT=gT,UT=fv,FT=Zc,DT=xT,BT=bi,qT=Qy,zT=Gr,WT=fi,GT=Ln,$T=sn.PROPER,HT=sn.CONFIGURABLE,VT="ArrayBuffer",JT="DataView",KT="prototype",QT="Wrong index",YT=GT.getterFor(VT),XT=GT.getterFor(JT),ZT=GT.set,eR=_T[VT],tR=eR,nR=tR&&tR[KT],rR=_T[JT],iR=rR&&rR[KT],aR=Object.prototype,oR=_T.Array,sR=_T.RangeError,uR=ST(DT),cR=ST([].reverse),lR=NT.pack,fR=NT.unpack,dR=function(e){return[255&e]},pR=function(e){return[255&e,e>>8&255]},hR=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},vR=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},yR=function(e){return lR(LT(e),23,4)},mR=function(e){return lR(e,52,8)},gR=function(e,t,n){IT(e[KT],t,{configurable:!0,get:function(){return n(this)[t]}})},bR=function(e,t,n,r){var i=XT(e),a=MT(n),o=!!r;if(a+t>i.byteLength)throw new sR(QT);var s=i.bytes,u=a+i.byteOffset,c=BT(s,u,u+t);return o?c:cR(c)},wR=function(e,t,n,r,i,a){var o=XT(e),s=MT(n),u=r(+i),c=!!a;if(s+t>o.byteLength)throw new sR(QT);for(var l=o.bytes,f=s+o.byteOffset,d=0;d<t;d++)l[f+d]=u[c?d:t-d-1]};if(TT){var kR=$T&&eR.name!==VT;OT((function(){eR(1)}))&&OT((function(){new eR(-1)}))&&!OT((function(){return new eR,new eR(1.5),new eR(NaN),1!==eR.length||kR&&!HT}))?kR&&HT&&RT(eR,"name",VT):((tR=function(e){return AT(this,nR),qT(new eR(MT(e)),this,tR)})[KT]=nR,nR.constructor=tR,zT(tR,eR)),FT&&UT(iR)!==aR&&FT(iR,aR);var xR=new rR(new tR(2)),_R=ST(iR.setInt8);xR.setInt8(0,2147483648),xR.setInt8(1,2147483649),!xR.getInt8(0)&&xR.getInt8(1)||CT(iR,{setInt8:function(e,t){_R(this,e,t<<24>>24)},setUint8:function(e,t){_R(this,e,t<<24>>24)}},{unsafe:!0})}else nR=(tR=function(e){AT(this,nR);var t=MT(e);ZT(this,{type:VT,bytes:uR(oR(t),0),byteLength:t}),ET||(this.byteLength=t,this.detached=!1)})[KT],iR=(rR=function(e,t,n){AT(this,iR),AT(e,nR);var r=YT(e),i=r.byteLength,a=PT(t);if(a<0||a>i)throw new sR("Wrong offset");if(a+(n=void 0===n?i-a:jT(n))>i)throw new sR("Wrong length");ZT(this,{type:JT,buffer:e,byteLength:n,byteOffset:a,bytes:r.bytes}),ET||(this.buffer=e,this.byteLength=n,this.byteOffset=a)})[KT],ET&&(gR(tR,"byteLength",YT),gR(rR,"buffer",XT),gR(rR,"byteLength",XT),gR(rR,"byteOffset",XT)),CT(iR,{getInt8:function(e){return bR(this,1,e)[0]<<24>>24},getUint8:function(e){return bR(this,1,e)[0]},getInt16:function(e){var t=bR(this,2,e,arguments.length>1&&arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=bR(this,2,e,arguments.length>1&&arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return vR(bR(this,4,e,arguments.length>1&&arguments[1]))},getUint32:function(e){return vR(bR(this,4,e,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(e){return fR(bR(this,4,e,arguments.length>1&&arguments[1]),23)},getFloat64:function(e){return fR(bR(this,8,e,arguments.length>1&&arguments[1]),52)},setInt8:function(e,t){wR(this,1,e,dR,t)},setUint8:function(e,t){wR(this,1,e,dR,t)},setInt16:function(e,t){wR(this,2,e,pR,t,arguments.length>2&&arguments[2])},setUint16:function(e,t){wR(this,2,e,pR,t,arguments.length>2&&arguments[2])},setInt32:function(e,t){wR(this,4,e,hR,t,arguments.length>2&&arguments[2])},setUint32:function(e,t){wR(this,4,e,hR,t,arguments.length>2&&arguments[2])},setFloat32:function(e,t){wR(this,4,e,yR,t,arguments.length>2&&arguments[2])},setFloat64:function(e,t){wR(this,8,e,mR,t,arguments.length>2&&arguments[2])}});WT(tR,VT),WT(rR,JT);var SR={ArrayBuffer:tR,DataView:rR},ER=cr,TR=RangeError,RR=function(e){var t=ER(e);if(t<0)throw new TR("The argument can't be less than 0");return t},IR=RangeError,CR=function(e,t){var n=RR(e);if(n%t)throw new IR("Wrong offset");return n},OR=Math.round,AR=Di,PR=vt,jR=TypeError,MR=function(e){var t=PR(e,"number");if("number"==typeof t)throw new jR("Can't convert number to bigint");return BigInt(t)},LR=xo,NR=v,UR=na,FR=Ge,DR=gr,BR=Xd,qR=$d,zR=Dd,WR=function(e){var t=AR(e);return"BigInt64Array"===t||"BigUint64Array"===t},GR=JE.aTypedArrayConstructor,$R=MR,HR=gr,VR=function(e,t,n){for(var r=0,i=arguments.length>2?n:HR(t),a=new e(i);i>r;)a[r]=t[r++];return a},JR=si,KR=u,QR=v,YR=f,XR=tT,ZR=JE,eI=SR,tI=sl,nI=x,rI=Zt,iI=Fw,aI=yr,oI=aT,sI=CR,uI=function(e){var t=OR(e);return t<0?0:t>255?255:255&t},cI=gt,lI=Ve,fI=Di,dI=V,pI=me,hI=Ia,vI=Y,yI=Zc,mI=ar.f,gI=function(e){var t,n,r,i,a,o,s,u,c=UR(this),l=FR(e),f=arguments.length,d=f>1?arguments[1]:void 0,p=void 0!==d,h=qR(l);if(h&&!zR(h))for(u=(s=BR(l,h)).next,l=[];!(o=NR(u,s)).done;)l.push(o.value);for(p&&f>2&&(d=LR(d,arguments[2])),n=DR(l),r=new(GR(c))(n),i=WR(r),t=0;n>t;t++)a=p?d(l[t],t):l[t],r[t]=i?$R(a):+a;return r},bI=Do.forEach,wI=il,kI=no,xI=Mt,_I=c,SI=VR,EI=Qy,TI=Ln.get,RI=Ln.set,II=Ln.enforce,CI=xI.f,OI=_I.f,AI=KR.RangeError,PI=eI.ArrayBuffer,jI=PI.prototype,MI=eI.DataView,LI=ZR.NATIVE_ARRAY_BUFFER_VIEWS,NI=ZR.TYPED_ARRAY_TAG,UI=ZR.TypedArray,FI=ZR.TypedArrayPrototype,DI=ZR.isTypedArray,BI="BYTES_PER_ELEMENT",qI="Wrong length",zI=function(e,t){kI(e,t,{configurable:!0,get:function(){return TI(this)[t]}})},WI=function(e){var t;return vI(jI,e)||"ArrayBuffer"===(t=fI(e))||"SharedArrayBuffer"===t},GI=function(e,t){return DI(e)&&!pI(t)&&t in e&&iI(+t)&&t>=0},$I=function(e,t){return t=cI(t),GI(e,t)?nI(2,e[t]):OI(e,t)},HI=function(e,t,n){return t=cI(t),!(GI(e,t)&&dI(n)&&lI(n,"value"))||lI(n,"get")||lI(n,"set")||n.configurable||lI(n,"writable")&&!n.writable||lI(n,"enumerable")&&!n.enumerable?CI(e,t,n):(e[t]=n.value,e)};YR?(LI||(_I.f=$I,xI.f=HI,zI(FI,"buffer"),zI(FI,"byteOffset"),zI(FI,"byteLength"),zI(FI,"length")),JR({target:"Object",stat:!0,forced:!LI},{getOwnPropertyDescriptor:$I,defineProperty:HI}),fE.exports=function(e,t,n){var r=e.match(/\d+/)[0]/8,i=e+(n?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=KR[i],u=s,c=u&&u.prototype,l={},f=function(e,t){CI(e,t,{get:function(){return function(e,t){var n=TI(e);return n.view[a](t*r+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=TI(e);a.view[o](t*r+a.byteOffset,n?uI(i):i,!0)}(this,t,e)},enumerable:!0})};LI?XR&&(u=t((function(e,t,n,i){return tI(e,c),EI(dI(t)?WI(t)?void 0!==i?new s(t,sI(n,r),i):void 0!==n?new s(t,sI(n,r)):new s(t):DI(t)?SI(u,t):QR(gI,u,t):new s(oI(t)),e,u)})),yI&&yI(u,UI),bI(mI(s),(function(e){e in u||rI(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,n,i){tI(e,c);var a,o,s,l=0,d=0;if(dI(t)){if(!WI(t))return DI(t)?SI(u,t):QR(gI,u,t);a=t,d=sI(n,r);var p=t.byteLength;if(void 0===i){if(p%r)throw new AI(qI);if((o=p-d)<0)throw new AI(qI)}else if((o=aI(i)*r)+d>p)throw new AI(qI);s=o/r}else s=oI(t),a=new PI(o=s*r);for(RI(e,{buffer:a,byteOffset:d,byteLength:o,length:s,view:new MI(a)});l<s;)f(e,l++)})),yI&&yI(u,UI),c=u.prototype=hI(FI)),c.constructor!==u&&rI(c,"constructor",u),II(c).TypedArrayConstructor=u,NI&&rI(c,NI,i);var d=u!==s;l[i]=u,JR({global:!0,constructor:!0,forced:d,sham:!LI},l),BI in u||rI(u,BI,r),BI in c||rI(c,BI,r),wI(i)}):fE.exports=function(){},(0,fE.exports)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var VI=be,JI=TypeError,KI=function(e,t){if(!delete e[t])throw new JI("Cannot delete property "+VI(t)+" of "+VI(e))},QI=Ge,YI=pr,XI=gr,ZI=KI,eC=Math.min,tC=[].copyWithin||function(e,t){var n=QI(this),r=XI(n),i=YI(e,r),a=YI(t,r),o=arguments.length>2?arguments[2]:void 0,s=eC((void 0===o?r:YI(o,r))-a,r-i),u=1;for(a<i&&i<a+s&&(u=-1,a+=s-1,i+=s-1);s-- >0;)a in n?n[i]=n[a]:ZI(n,i),i+=u,a+=u;return n},nC=JE,rC=R(tC),iC=nC.aTypedArray;(0,nC.exportTypedArrayMethod)("copyWithin",(function(e,t){return rC(iC(this),e,t,arguments.length>2?arguments[2]:void 0)}));var aC=Do.every,oC=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("every",(function(e){return aC(oC(this),e,arguments.length>1?arguments[1]:void 0)}));var sC=xT,uC=MR,cC=Di,lC=v,fC=l,dC=JE.aTypedArray,pC=JE.exportTypedArrayMethod,hC=R("".slice);pC("fill",(function(e){var t=arguments.length;dC(this);var n="Big"===hC(cC(this),0,3)?uC(e):+e;return lC(sC,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),fC((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var vC=dl,yC=JE.aTypedArrayConstructor,mC=JE.getTypedArrayConstructor,gC=function(e){return yC(vC(e,mC(e)))},bC=VR,wC=gC,kC=Do.filter,xC=function(e,t){return bC(wC(e),t)},_C=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("filter",(function(e){var t=kC(_C(this),e,arguments.length>1?arguments[1]:void 0);return xC(this,t)}));var SC=Do.find,EC=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("find",(function(e){return SC(EC(this),e,arguments.length>1?arguments[1]:void 0)}));var TC=Do.findIndex,RC=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("findIndex",(function(e){return TC(RC(this),e,arguments.length>1?arguments[1]:void 0)}));var IC=Do.forEach,CC=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("forEach",(function(e){IC(CC(this),e,arguments.length>1?arguments[1]:void 0)}));var OC=_r.includes,AC=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("includes",(function(e){return OC(AC(this),e,arguments.length>1?arguments[1]:void 0)}));var PC=_r.indexOf,jC=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("indexOf",(function(e){return PC(jC(this),e,arguments.length>1?arguments[1]:void 0)}));var MC=u,LC=l,NC=R,UC=JE,FC=Ly,DC=st("iterator"),BC=MC.Uint8Array,qC=NC(FC.values),zC=NC(FC.keys),WC=NC(FC.entries),GC=UC.aTypedArray,$C=UC.exportTypedArrayMethod,HC=BC&&BC.prototype,VC=!LC((function(){HC[DC].call([1])})),JC=!!HC&&HC.values&&HC[DC]===HC.values&&"values"===HC.values.name,KC=function(){return qC(GC(this))};$C("entries",(function(){return WC(GC(this))}),VC),$C("keys",(function(){return zC(GC(this))}),VC),$C("values",KC,VC||!JC,{name:"values"}),$C(DC,KC,VC||!JC,{name:"values"});var QC=JE.aTypedArray,YC=JE.exportTypedArrayMethod,XC=R([].join);YC("join",(function(e){return XC(QC(this),e)}));var ZC=gi,eO=W,tO=cr,nO=gr,rO=th,iO=Math.min,aO=[].lastIndexOf,oO=!!aO&&1/[1].lastIndexOf(1,-0)<0,sO=rO("lastIndexOf"),uO=oO||!sO?function(e){if(oO)return ZC(aO,this,arguments)||0;var t=eO(this),n=nO(t);if(0===n)return-1;var r=n-1;for(arguments.length>1&&(r=iO(r,tO(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:aO,cO=gi,lO=uO,fO=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return cO(lO,fO(this),t>1?[e,arguments[1]]:[e])}));var dO=Do.map,pO=gC,hO=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("map",(function(e){return dO(hO(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(pO(e))(t)}))}));var vO=_e,yO=Ge,mO=N,gO=gr,bO=TypeError,wO="Reduce of empty array with no initial value",kO=function(e){return function(t,n,r,i){var a=yO(t),o=mO(a),s=gO(a);if(vO(n),0===s&&r<2)throw new bO(wO);var u=e?s-1:0,c=e?-1:1;if(r<2)for(;;){if(u in o){i=o[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw new bO(wO)}for(;e?u>=0:s>u;u+=c)u in o&&(i=n(i,o[u],u,a));return i}},xO={left:kO(!1),right:kO(!0)},_O=xO.left,SO=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return _O(SO(this),e,t,t>1?arguments[1]:void 0)}));var EO=xO.right,TO=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return EO(TO(this),e,t,t>1?arguments[1]:void 0)}));var RO=JE.aTypedArray,IO=JE.exportTypedArrayMethod,CO=Math.floor;IO("reverse",(function(){for(var e,t=this,n=RO(t).length,r=CO(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t}));var OO=u,AO=v,PO=JE,jO=gr,MO=CR,LO=Ge,NO=l,UO=OO.RangeError,FO=OO.Int8Array,DO=FO&&FO.prototype,BO=DO&&DO.set,qO=PO.aTypedArray,zO=PO.exportTypedArrayMethod,WO=!NO((function(){var e=new Uint8ClampedArray(2);return AO(BO,e,{length:1,0:3},1),3!==e[1]})),GO=WO&&PO.NATIVE_ARRAY_BUFFER_VIEWS&&NO((function(){var e=new FO(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));zO("set",(function(e){qO(this);var t=MO(arguments.length>1?arguments[1]:void 0,1),n=LO(e);if(WO)return AO(BO,this,n,t);var r=this.length,i=jO(n),a=0;if(i+t>r)throw new UO("Wrong length");for(;a<i;)this[t+a]=n[a++]}),!WO||GO);var $O=gC,HO=bi,VO=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("slice",(function(e,t){for(var n=HO(VO(this),e,t),r=$O(this),i=0,a=n.length,o=new r(a);a>i;)o[i]=n[i++];return o}),l((function(){new Int8Array(1).slice()})));var JO=Do.some,KO=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("some",(function(e){return JO(KO(this),e,arguments.length>1?arguments[1]:void 0)}));var QO=bi,YO=Math.floor,XO=function(e,t){var n=e.length;if(n<8)for(var r,i,a=1;a<n;){for(i=a,r=e[a];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==a++&&(e[i]=r)}else for(var o=YO(n/2),s=XO(QO(e,0,o),t),u=XO(QO(e,o),t),c=s.length,l=u.length,f=0,d=0;f<c||d<l;)e[f+d]=f<c&&d<l?t(s[f],u[d])<=0?s[f++]:u[d++]:f<c?s[f++]:u[d++];return e},ZO=XO,eA=ee.match(/firefox\/(\d+)/i),tA=!!eA&&+eA[1],nA=/MSIE|Trident/.test(ee),rA=ee.match(/AppleWebKit\/(\d+)\./),iA=!!rA&&+rA[1],aA=go,oA=l,sA=_e,uA=ZO,cA=tA,lA=nA,fA=se,dA=iA,pA=JE.aTypedArray,hA=JE.exportTypedArrayMethod,vA=u.Uint16Array,yA=vA&&aA(vA.prototype.sort),mA=!(!yA||oA((function(){yA(new vA(2),null)}))&&oA((function(){yA(new vA(2),{})}))),gA=!!yA&&!oA((function(){if(fA)return fA<74;if(cA)return cA<67;if(lA)return!0;if(dA)return dA<602;var e,t,n=new vA(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(yA(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));hA("sort",(function(e){return void 0!==e&&sA(e),gA?yA(this,e):uA(pA(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!gA||mA);var bA=yr,wA=pr,kA=gC,xA=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("subarray",(function(e,t){var n=xA(this),r=n.length,i=wA(e,r);return new(kA(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,bA((void 0===t?r:wA(t,r))-i))}));var _A=gi,SA=JE,EA=l,TA=bi,RA=u.Int8Array,IA=SA.aTypedArray,CA=SA.exportTypedArrayMethod,OA=[].toLocaleString,AA=!!RA&&EA((function(){OA.call(new RA(1))}));CA("toLocaleString",(function(){return _A(OA,AA?TA(IA(this)):IA(this),TA(arguments))}),EA((function(){return[1,2].toLocaleString()!==new RA([1,2]).toLocaleString()}))||!EA((function(){RA.prototype.toLocaleString.call([1,2])})));var PA=JE.exportTypedArrayMethod,jA=l,MA=R,LA=u.Uint8Array,NA=LA&&LA.prototype||{},UA=[].toString,FA=MA([].join);jA((function(){UA.call({})}))&&(UA=function(){return FA(this)});var DA=NA.toString!==UA;PA("toString",UA,DA);var BA=v,qA=R,zA=xg,WA=Dt,GA=U,$A=B,HA=dl,VA=Sg,JA=yr,KA=Va,QA=Te,YA=Dg,XA=l,ZA=qm.UNSUPPORTED_Y,eP=Math.min,tP=qA([].push),nP=qA("".slice),rP=!XA((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),iP="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length;zA("split",(function(e,t,n){var r="0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:BA(t,this,e,n)}:t;return[function(t,n){var i=$A(this),a=GA(t)?void 0:QA(t,e);return a?BA(a,t,i,n):BA(r,KA(i),t,n)},function(e,i){var a=WA(this),o=KA(e);if(!iP){var s=n(r,a,o,i,r!==t);if(s.done)return s.value}var u=HA(a,RegExp),c=a.unicode,l=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(ZA?"g":"y"),f=new u(ZA?"^(?:"+a.source+")":a,l),d=void 0===i?4294967295:i>>>0;if(0===d)return[];if(0===o.length)return null===YA(f,o)?[o]:[];for(var p=0,h=0,v=[];h<o.length;){f.lastIndex=ZA?0:h;var y,m=YA(f,ZA?nP(o,h):o);if(null===m||(y=eP(JA(f.lastIndex+(ZA?h:0)),o.length))===p)h=VA(o,h,c);else{if(tP(v,nP(o,p,h)),v.length===d)return v;for(var g=1;g<=m.length-1;g++)if(tP(v,m[g]),v.length===d)return v;h=p=y}}return tP(v,nP(o,p)),v}]}),iP||!rP,ZA);var aP={exports:{}},oP={exports:{}};!function(e){e.exports=function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}},e.exports.__esModule=!0,e.exports.default=e.exports}(oP);var sP=oP.exports,uP={exports:{}},cP={exports:{}};!function(e){function t(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(n){}return(e.exports=t=function(){return!!n},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(cP);var lP=cP.exports;!function(e){var t=lP,n=pc;e.exports=function(e,r,i){if(t())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,r);var o=new(e.bind.apply(e,a));return i&&n(o,i.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports}(uP);var fP=uP.exports;!function(e){var t=wc,n=pc,r=sP,i=fP;function a(o){var s="function"==typeof Map?new Map:void 0;return e.exports=a=function(e){if(null===e||!r(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==s){if(s.has(e))return s.get(e);s.set(e,a)}function a(){return i(e,arguments,t(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),n(a,e)},e.exports.__esModule=!0,e.exports.default=e.exports,a(o)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports}(aP);var dP=aP.exports,pP={exports:{}};!function(t,n){(function(){var i={function:!0,object:!0}["undefined"==typeof window?"undefined":e(window)]&&window||this,a=n,o=t&&!t.nodeType&&t,s=a&&o&&"object"==e(r)&&r;!s||s.global!==s&&s.window!==s&&s.self!==s||(i=s);var u=Math.pow(2,53)-1,c=/\bOpera/,l=Object.prototype,f=l.hasOwnProperty,d=l.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function h(e){return e=b(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function v(e,t){for(var n in e)f.call(e,n)&&t(e[n],n,e)}function y(e){return null==e?p(e):d.call(e).slice(8,-1)}function m(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function g(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=u)for(;++n<r;)t(e[n],n,e);else v(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function b(e){return String(e).replace(/^ +| +$/g,"")}var w=function t(n){var r=i,a=n&&"object"==e(n)&&"String"!=y(n);a&&(r=n,n=null);var o=r.navigator||{},s=o.userAgent||"";n||(n=s);var u,l,f=a?!!o.likeChrome:/\bChrome\b/.test(n)&&!/internal|\n/i.test(d.toString()),p="Object",w=a?p:"ScriptBridgingProxyObject",k=a?p:"Environment",x=a&&r.java?"JavaPackage":y(r.java),_=a?p:"RuntimeObject",S=/\bJava/.test(x)&&r.java,E=S&&y(r.environment)==k,T=S?"a":"Î±",R=S?"b":"Î²",I=r.document||{},C=r.operamini||r.opera,O=c.test(O=a&&C?C["[[Class]]"]:y(C))?O:C=null,A=n,P=[],j=null,M=n==s,L=M&&C&&"function"==typeof C.version&&C.version(),N=g([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,t){return e||RegExp("\\b"+(t.pattern||m(t))+"\\b","i").exec(n)&&(t.label||t)})),U=function(e){return g(e,(function(e,t){return e||RegExp("\\b"+(t.pattern||m(t))+"\\b","i").exec(n)&&(t.label||t)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=q([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return g(e,(function(e,t,r){return e||(t[F]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+m(r)+"(?:\\b|\\w*\\d)","i").exec(n))&&r}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),B=function(e){return g(e,(function(e,t){var r=t.pattern||m(t);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(n))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),h(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,t.label||t)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function q(e){return g(e,(function(e,t){var r=t.pattern||m(t);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(n)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(n)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(n))&&((e=String(t.label&&!RegExp(r,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=h(e[0].replace(RegExp(r,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function z(e){return g(e,(function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(n)||0)[1]||null}))}if(N&&(N=[N]),/\bAndroid\b/.test(B)&&!F&&(u=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(n))&&(F=b(u[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!F?F=q([D]):D&&F&&(F=F.replace(RegExp("^("+m(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+m(D)+")[-_.]?(\\w)","i"),D+" $2")),(u=/\bGoogle TV\b/.exec(F))&&(F=u[0]),/\bSimulator\b/i.test(n)&&(F=(F?F+" ":"")+"Simulator"),"Opera Mini"==U&&/\bOPiOS\b/.test(n)&&P.push("running in Turbo/Uncompressed mode"),"IE"==U&&/\blike iPhone OS\b/.test(n)?(D=(u=t(n.replace(/like iPhone OS/,""))).manufacturer,F=u.product):/^iP/.test(F)?(U||(U="Safari"),B="iOS"+((u=/ OS ([\d_]+)/i.exec(n))?" "+u[1].replace(/_/g,"."):"")):"Konqueror"==U&&/^Linux\b/i.test(B)?B="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(U)&&!/\bMobile Safari\b/i.test(n)||/\bVita\b/.test(F))||/\bAndroid\b/.test(B)&&/^Chrome/.test(U)&&/\bVersion\//i.test(n)?(U="Android Browser",B=/\bAndroid\b/.test(B)?B:"Android"):"Silk"==U?(/\bMobi/i.test(n)||(B="Android",P.unshift("desktop mode")),/Accelerated *= *true/i.test(n)&&P.unshift("accelerated")):"UC Browser"==U&&/\bUCWEB\b/.test(n)?P.push("speed mode"):"PaleMoon"==U&&(u=/\bFirefox\/([\d.]+)\b/.exec(n))?P.push("identifying as Firefox "+u[1]):"Firefox"==U&&(u=/\b(Mobile|Tablet|TV)\b/i.exec(n))?(B||(B="Firefox OS"),F||(F=u[1])):!U||(u=!/\bMinefield\b/i.test(n)&&/\b(?:Firefox|Safari)\b/.exec(U))?(U&&!F&&/[\/,]|^[^(]+?\)/.test(n.slice(n.indexOf(u+"/")+8))&&(U=null),(u=F||D||B)&&(F||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(B))&&(U=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(B)?B:u)+" Browser")):"Electron"==U&&(u=(/\bChrome\/([\d.]+)\b/.exec(n)||0)[1])&&P.push("Chromium "+u),L||(L=z(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",m(U),"(?:Firefox|Minefield|NetFront)"])),(u=("iCab"==N&&parseFloat(L)>3?"WebKit":/\bOpera\b/.test(U)&&(/\bOPR\b/.test(n)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(n)&&!/^(?:Trident|EdgeHTML)$/.test(N)&&"WebKit"||!N&&/\bMSIE\b/i.test(n)&&("Mac OS"==B?"Tasman":"Trident")||"WebKit"==N&&/\bPlayStation\b(?! Vita\b)/i.test(U)&&"NetFront")&&(N=[u]),"IE"==U&&(u=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(n)||0)[1])?(U+=" Mobile",B="Windows Phone "+(/\+$/.test(u)?u:u+".x"),P.unshift("desktop mode")):/\bWPDesktop\b/i.test(n)?(U="IE Mobile",B="Windows Phone 8.x",P.unshift("desktop mode"),L||(L=(/\brv:([\d.]+)/.exec(n)||0)[1])):"IE"!=U&&"Trident"==N&&(u=/\brv:([\d.]+)/.exec(n))&&(U&&P.push("identifying as "+U+(L?" "+L:"")),U="IE",L=u[1]),M){if(function(t,n){var r=null!=t?e(t[n]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!t[n])}(r,"global"))if(S&&(A=(u=S.lang.System).getProperty("os.arch"),B=B||u.getProperty("os.name")+" "+u.getProperty("os.version")),E){try{L=r.require("ringo/engine").version.join("."),U="RingoJS"}catch(G){(u=r.system)&&u.global.system==r.system&&(U="Narwhal",B||(B=u[0].os||null))}U||(U="Rhino")}else"object"==e(r.process)&&!r.process.browser&&(u=r.process)&&("object"==e(u.versions)&&("string"==typeof u.versions.electron?(P.push("Node "+u.versions.node),U="Electron",L=u.versions.electron):"string"==typeof u.versions.nw&&(P.push("Chromium "+L,"Node "+u.versions.node),U="NW.js",L=u.versions.nw)),U||(U="Node.js",A=u.arch,B=u.platform,L=(L=/[\d.]+/.exec(u.version))?L[0]:null));else y(u=r.runtime)==w?(U="Adobe AIR",B=u.flash.system.Capabilities.os):y(u=r.phantom)==_?(U="PhantomJS",L=(u=u.version||null)&&u.major+"."+u.minor+"."+u.patch):"number"==typeof I.documentMode&&(u=/\bTrident\/(\d+)/i.exec(n))?(L=[L,I.documentMode],(u=+u[1]+4)!=L[1]&&(P.push("IE "+L[1]+" mode"),N&&(N[1]=""),L[1]=u),L="IE"==U?String(L[1].toFixed(1)):L[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(U)&&(P.push("masking as "+U+" "+L),U="IE",L="11.0",N=["Trident"],B="Windows");B=B&&h(B)}if(L&&(u=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(L)||/(?:alpha|beta)(?: ?\d)?/i.exec(n+";"+(M&&o.appMinorVersion))||/\bMinefield\b/i.test(n)&&"a")&&(j=/b/i.test(u)?"beta":"alpha",L=L.replace(RegExp(u+"\\+?$"),"")+("beta"==j?R:T)+(/\d+\+?/.exec(u)||"")),"Fennec"==U||"Firefox"==U&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(B))U="Firefox Mobile";else if("Maxthon"==U&&L)L=L.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(B=null),"Xbox 360"==F&&/\bIEMobile\b/.test(n)&&P.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(U)&&(!U||F||/Browser|Mobi/.test(U))||"Windows CE"!=B&&!/Mobi/i.test(n))if("IE"==U&&M)try{null===r.external&&P.unshift("platform preview")}catch(G){P.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(n))&&(u=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(n)||0)[1]||L)?(B=((u=[u,/BB10/.test(n)])[1]?(F=null,D="BlackBerry"):"Device Software")+" "+u[0],L=null):this!=v&&"Wii"!=F&&(M&&C||/Opera/.test(U)&&/\b(?:MSIE|Firefox)\b/i.test(n)||"Firefox"==U&&/\bOS X (?:\d+\.){2,}/.test(B)||"IE"==U&&(B&&!/^Win/.test(B)&&L>5.5||/\bWindows XP\b/.test(B)&&L>8||8==L&&!/\bTrident\b/.test(n)))&&!c.test(u=t.call(v,n.replace(c,"")+";"))&&u.name&&(u="ing as "+u.name+((u=u.version)?" "+u:""),c.test(U)?(/\bIE\b/.test(u)&&"Mac OS"==B&&(B=null),u="identify"+u):(u="mask"+u,U=O?h(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(u)&&(B=null),M||(L=null)),N=["Presto"],P.push(u));else U+=" Mobile";(u=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(n)||0)[1])&&(u=[parseFloat(u.replace(/\.(\d)$/,".0$1")),u],"Safari"==U&&"+"==u[1].slice(-1)?(U="WebKit Nightly",j="alpha",L=u[1].slice(0,-1)):L!=u[1]&&L!=(u[2]=(/\bSafari\/([\d.]+\+?)/i.exec(n)||0)[1])||(L=null),u[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(n)||0)[1],537.36==u[0]&&537.36==u[2]&&parseFloat(u[1])>=28&&"WebKit"==N&&(N=["Blink"]),M&&(f||u[1])?(N&&(N[1]="like Chrome"),u=u[1]||((u=u[0])<530?1:u<532?2:u<532.05?3:u<533?4:u<534.03?5:u<534.07?6:u<534.1?7:u<534.13?8:u<534.16?9:u<534.24?10:u<534.3?11:u<535.01?12:u<535.02?"13+":u<535.07?15:u<535.11?16:u<535.19?17:u<536.05?18:u<536.1?19:u<537.01?20:u<537.11?"21+":u<537.13?23:u<537.18?24:u<537.24?25:u<537.36?26:"Blink"!=N?"27":"28")):(N&&(N[1]="like Safari"),u=(u=u[0])<400?1:u<500?2:u<526?3:u<533?4:u<534?"4+":u<535?5:u<537?6:u<538?7:u<601?8:u<602?9:u<604?10:u<606?11:u<608?12:"12"),N&&(N[1]+=" "+(u+="number"==typeof u?".x":/[.+]/.test(u)?"":"+")),"Safari"==U&&(!L||parseInt(L)>45)?L=u:"Chrome"==U&&/\bHeadlessChrome/i.test(n)&&P.unshift("headless")),"Opera"==U&&(u=/\bzbov|zvav$/.exec(B))?(U+=" ",P.unshift("desktop mode"),"zvav"==u?(U+="Mini",L=null):U+="Mobile",B=B.replace(RegExp(" *"+u+"$"),"")):"Safari"==U&&/\bChrome\b/.exec(N&&N[1])?(P.unshift("desktop mode"),U="Chrome Mobile",L=null,/\bOS X\b/.test(B)?(D="Apple",B="iOS 4.3+"):B=null):/\bSRWare Iron\b/.test(U)&&!L&&(L=z("Chrome")),L&&0==L.indexOf(u=/[\d.]+$/.exec(B))&&n.indexOf("/"+u+"-")>-1&&(B=b(B.replace(u,""))),B&&-1!=B.indexOf(U)&&!RegExp(U+" OS").test(B)&&(B=B.replace(RegExp(" *"+m(U)+" *"),"")),N&&!/\b(?:Avant|Nook)\b/.test(U)&&(/Browser|Lunascape|Maxthon/.test(U)||"Safari"!=U&&/^iOS/.test(B)&&/\bSafari\b/.test(N[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(U)&&N[1])&&(u=N[N.length-1])&&P.push(u),P.length&&(P=["("+P.join("; ")+")"]),D&&F&&F.indexOf(D)<0&&P.push("on "+D),F&&P.push((/^on /.test(P[P.length-1])?"":"on ")+F),B&&(u=/ ([\d.+]+)$/.exec(B),l=u&&"/"==B.charAt(B.length-u[0].length-1),B={architecture:32,family:u&&!l?B.replace(u[0],""):B,version:u?u[1]:null,toString:function(){var e=this.version;return this.family+(e&&!l?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(u=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(B&&(B.architecture=64,B.family=B.family.replace(RegExp(" *"+u),"")),U&&(/\bWOW64\b/i.test(n)||M&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(n))&&P.unshift("32-bit")):B&&/^OS X/.test(B.family)&&"Chrome"==U&&parseFloat(L)>=39&&(B.architecture=64),n||(n=null);var W={};return W.description=n,W.layout=N&&N[0],W.manufacturer=D,W.name=U,W.prerelease=j,W.product=F,W.ua=n,W.version=U&&L,W.os=B||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=t,W.toString=function(){return this.description||""},W.version&&P.unshift(L),W.name&&P.unshift(U),B&&U&&(B!=String(B).split(" ")[0]||B!=U.split(" ")[0]&&!F)&&P.push(F?"("+B+")":"on "+B),P.length&&(W.description=P.join(" ")),W}();a&&o?v(w,(function(e,t){a[t]=e})):i.platform=w}).call(r)}(pP,pP.exports);var hP=pP.exports,vP=v,yP=Dt,mP=U,gP=yr,bP=Va,wP=B,kP=Te,xP=Sg,_P=Dg;xg("match",(function(e,t,n){return[function(t){var n=wP(this),r=mP(t)?void 0:kP(t,e);return r?vP(r,t,n):new RegExp(t)[e](bP(n))},function(e){var r=yP(this),i=bP(e),a=n(t,r,i);if(a.done)return a.value;if(!r.global)return _P(r,i);var o=r.unicode;r.lastIndex=0;for(var s,u=[],c=0;null!==(s=_P(r,i));){var l=bP(s[0]);u[c]=l,""===l&&(r.lastIndex=xP(i,gP(r.lastIndex),o)),c++}return 0===c?null:u}]}));var SP=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},EP=v,TP=Dt,RP=U,IP=B,CP=SP,OP=Va,AP=Te,PP=Dg;xg("search",(function(e,t,n){return[function(t){var n=IP(this),r=RP(t)?void 0:AP(t,e);return r?EP(r,t,n):new RegExp(t)[e](OP(n))},function(e){var r=TP(this),i=OP(e),a=n(t,r,i);if(a.done)return a.value;var o=r.lastIndex;CP(o,0)||(r.lastIndex=0);var s=PP(r,i);return CP(r.lastIndex,o)||(r.lastIndex=o),null===s?-1:s.index}]}));var jP=f,MP=So,LP=TypeError,NP=Object.getOwnPropertyDescriptor,UP=jP&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(NB){return NB instanceof TypeError}}(),FP=si,DP=Ge,BP=pr,qP=cr,zP=gr,WP=UP?function(e,t){if(MP(e)&&!NP(e,"length").writable)throw new LP("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},GP=vh,$P=Ao,HP=nc,VP=KI,JP=Hu("splice"),KP=Math.max,QP=Math.min;FP({target:"Array",proto:!0,forced:!JP},{splice:function(e,t){var n,r,i,a,o,s,u=DP(this),c=zP(u),l=BP(e,c),f=arguments.length;for(0===f?n=r=0:1===f?(n=0,r=c-l):(n=f-2,r=QP(KP(qP(t),0),c-l)),GP(c+n-r),i=$P(u,r),a=0;a<r;a++)(o=l+a)in u&&HP(i,a,u[o]);if(i.length=r,n<r){for(a=l;a<c-r;a++)s=a+n,(o=a+r)in u?u[s]=u[o]:VP(u,s);for(a=c;a>c-r+n;a--)VP(u,a-1)}else if(n>r)for(a=c-r;a>l;a--)s=a+n-1,(o=a+r-1)in u?u[s]=u[o]:VP(u,s);for(a=0;a<n;a++)u[a+l]=arguments[a+2];return WP(u,c-r+n),i}}),
/*
      @license
      The following license applies to all parts of this software except as
      documented below.

          Copyright (c) 2016, Twilio, inc.
          All rights reserved.

          Redistribution and use in source and binary forms, with or without
          modification, are permitted provided that the following conditions are
          met:

            1. Redistributions of source code must retain the above copyright
               notice, this list of conditions and the following disclaimer.

            2. Redistributions in binary form must reproduce the above copyright
               notice, this list of conditions and the following disclaimer in
               the documentation and/or other materials provided with the
               distribution.

            3. Neither the name of Twilio nor the names of its contributors may
               be used to endorse or promote products derived from this software
               without specific prior written permission.

          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
          "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
          LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
          A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
          HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
          SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
          LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
          DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
          THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
          (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
          OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

      This software includes javascript-state-machine under the following license.

          Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

          Permission is hereby granted, free of charge, to any person obtaining a copy
          of this software and associated documentation files (the "Software"), to deal
          in the Software without restriction, including without limitation the rights
          to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the Software is
          furnished to do so, subject to the following conditions:

          The above copyright notice and this permission notice shall be included in all
          copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
          IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
          FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
          AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
          LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
          OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

      This software includes loglevel under the following license.

          Copyright (c) 2013 Tim Perry

          Permission is hereby granted, free of charge, to any person
          obtaining a copy of this software and associated documentation
          files (the "Software"), to deal in the Software without
          restriction, including without limitation the rights to use,
          copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the
          Software is furnished to do so, subject to the following
          conditions:

          The above copyright notice and this permission notice shall be
          included in all copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
          EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
          OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
          NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
          HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
          WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
          FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
          OTHER DEALINGS IN THE SOFTWARE.


      */
function(t){var n=void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Object.defineProperty(t,"__esModule",{value:!0});var r=Ic,i=lc,a=jk,o=hc,s=gc,u=wc,c=Oc,l=Tc,f=ph,d=mc,p=iS,h=iy,v=DS,y=lE,m=dP,g=p_,b=hP;function w(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}function k(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var x=w(uc),_=w(r),S=w(i),E=w(a),T=w(o),R=w(s),I=w(u),C=w(c),O=w(l),A=w(f),P=w(d),j=k(h),M=k(v),L=w(m),N=k(b);function U(){}function F(){F.init.call(this)}function D(e){return void 0===e._maxListeners?F.defaultMaxListeners:e._maxListeners}function B(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new U,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=D(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function q(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function z(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function W(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}U.prototype=Object.create(null),F.EventEmitter=F,F.usingDomains=!1,F.prototype.domain=void 0,F.prototype._events=void 0,F.prototype._maxListeners=void 0,F.defaultMaxListeners=10,F.init=function(){this.domain=null,F.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new U,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},F.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},F.prototype.getMaxListeners=function(){return D(this)},F.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=W(e,r),a=0;a<r;++a)i[a].call(n)}(n,l,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=W(e,i),o=0;o<i;++o)a[o].call(n,r)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=W(e,a),s=0;s<a;++s)o[s].call(n,r,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=W(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=W(e,i),o=0;o<i;++o)a[o].apply(n,r)}(n,l,this,i)}return!0},F.prototype.addListener=function(e,t){return B(this,e,t,!1)},F.prototype.on=F.prototype.addListener,F.prototype.prependListener=function(e,t){return B(this,e,t,!0)},F.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,q(this,e,t)),this},F.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,q(this,e,t)),this},F.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new U:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new U,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},F.prototype.off=function(e,t){return this.removeListener(e,t)},F.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new U,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new U:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new U,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},F.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},F.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):z.call(e,t)},F.prototype.listenerCount=z,F.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var G=j.getLogger("twilsock");function $(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var H=function(){function e(t){C.default(this,e),O.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?" "+t+":":""}return _.default(e,[{key:"setLevel",value:function(e){G.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.trace.apply(null,$("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.debug.apply(null,$("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.info.apply(null,$("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.warn.apply(null,$("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.error.apply(null,$("E",t))}}],[{key:"setLevel",value:function(e){G.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.trace.apply(null,$("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.debug.apply(null,$("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.info.apply(null,$("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.warn.apply(null,$("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.error.apply(null,$("E",t))}}]),e}(),V=new H(""),J="0.12.2",K=function(){function e(t,n,r){C.default(this,e),O.default(this,"confirmedCapabilities",new Set),this.activeGrant=n,this._token=t;var i=r.region||"us1",a="wss://tsock.".concat(i,".twilio.com/v3/wsconnect"),o=r.twilsock||r.Twilsock||{};this.url=o.uri||a,this._continuationToken=r.continuationToken?r.continuationToken:null,this.logLevel=r.logLevel?r.logLevel:"error",this.retryPolicy=r.retryPolicy?r.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=r.clientMetadata?r.clientMetadata:{},this.clientMetadata.ver=J,this.initRegistrations=r.initRegistrations?r.initRegistrations:null,this.tweaks=r.tweaks?r.tweaks:null}return _.default(e,[{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}},{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}}]),e}(),Q=function e(t){C.default(this,e),this.id=t||"TM".concat(y.v4())};function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var X=function(e){T.default(n,e);var t=Y(n);function n(e,r,i,a,o){var s;return C.default(this,n),s=t.call(this),O.default(S.default(s),"method","init"),s.token=e,s.continuation_token=r,s.metadata=i,s.registrations=a,s.tweaks=o,s.capabilities=["client_update","offline_storage","telemetry.v1"],s}return n}(Q);function Z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ee=function(e){T.default(n,e);var t=Z(n);function n(e,r,i,a,o,s,u){var c;return C.default(this,n),(c=t.call(this,e)).continuationToken=r,c.continuationTokenStatus=a,c.offlineStorage=o,c.initRegistrations=s,c.debugInfo=u,c.confirmedCapabilities=i,c}return n}(Q);function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ne=function(e){T.default(n,e);var t=te(n);function n(e){var r;return C.default(this,n),r=t.call(this),O.default(S.default(r),"method","update"),r.token=e,r}return n}(Q);function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ie=function(e){T.default(n,e);var t=re(n);function n(e,r,i){var a;return C.default(this,n),a=t.call(this),O.default(S.default(a),"method","message"),a.active_grant=e,a.payload_type=r,a.http_request=i,a}return n}(Q);function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var oe=function(e){T.default(n,e);var t=ae(n);function n(e){var r;return C.default(this,n),r=t.call(this,e),O.default(S.default(r),"method","reply"),O.default(S.default(r),"payload_type","application/json"),O.default(S.default(r),"status",{code:200,status:"OK"}),r}return n}(Q);function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var ue=function(e){T.default(n,e);var t=se(n);function n(){var e;return C.default(this,n),e=t.call(this),O.default(S.default(e),"method","close"),e}return n}(Q);function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var le=function e(t,n,r,i,a,o){C.default(this,e),this.start=t,this.end=n,this.title=r,this.details=i,this.id=a,this.type=o},fe=function(e){T.default(n,e);var t=ce(n);function n(e){var r;return C.default(this,n),r=t.call(this),O.default(S.default(r),"method","telemetry.v1"),r.events=e,r}return n}(Q);function de(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})).length}function pe(e){var t=Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join("").replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}));return decodeURIComponent(t)}function he(e){return JSON.parse(pe(e))}var ve=function(){function e(){C.default(this,e)}return _.default(e,null,[{key:"parse",value:function(e){var t,n,r=new Uint8Array(e),i=function(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(r);if("TWILSOCK"!==i.protocol||"V3.0"!==i.version)return V.error("unsupported protocol: ".concat(i.protocol," ver ").concat(i.version)),null;try{t=he(r.subarray(i.size,i.size+i.headerSize))}catch(s){return V.error("failed to parse message header",s,e),null}if(V.debug("message received: ",t.method),V.trace("message received: ",t),t.payload_size>0){var a=2+i.size+i.headerSize,o=t.payload_size;if(t.hasOwnProperty("payload_type")&&0!==t.payload_type.indexOf("application/json"))0===t.payload_type.indexOf("text/plain")&&(n=pe(r.subarray(a,a+o)));else try{n=he(r.subarray(a,a+o))}catch(s){return V.error("failed to parse message body",s,e),null}}return{method:t.method,header:t,payload:n}}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=de(t);var n=JSON.stringify(e),r="TWILSOCK V3.0 "+de(n);V.debug("send request:",r+n+t);var i,a,o=(i=encodeURIComponent(r+"\r\n"+n+"\r\n"+t).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})),a=new Uint8Array(i.length),Array.prototype.forEach.call(i,(function(e,t){a[t]=e.charCodeAt(0)})),a);return o.buffer}}]),e}();function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var me=function(e){T.default(n,e);var t=ye(n);function n(e){return C.default(this,n),t.call(this,e)}return n}(L.default(Error));function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var be=function(e){T.default(n,e);var t=ge(n);function n(e,r){var i;return C.default(this,n),(i=t.call(this,e)).reply=r,i}return n}(me);function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){O.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var _e=function(e){T.default(n,e);var t=xe(n);function n(e){var r;return C.default(this,n),r=t.call(this),O.default(S.default(r),"newBackoff",null),O.default(S.default(r),"usedBackoff",null),O.default(S.default(r),"retrier",null),r.options=e?ke({},e):{},r}return _.default(n,[{key:"inProgress",get:function(){return!!this.retrier}},{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");var e,t;this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():null===(e=this.retrier)||void 0===e||e.failed(new Error):null===(t=this.retrier)||void 0===t||t.failed(new Error)}},{key:"cancel",value:function(){var e;null===(e=this.retrier)||void 0===e||e.cancel()}},{key:"cleanRetrier",value:function(){var e,t;null===(e=this.retrier)||void 0===e||e.removeAllListeners(),null===(t=this.retrier)||void 0===t||t.cancel(),this.retrier=null}},{key:"getRetryPolicy",value:function(){var e=ke({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new g.Retrier(t),this.retrier.once("attempt",(function(){var t,n;null===(t=e.retrier)||void 0===t||t.on("attempt",(function(){return e.emit("attempt")})),null===(n=e.retrier)||void 0===n||n.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(function(t){return e.emit("failed",t)})),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}]),n}(F);function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Ee=function(e){T.default(i,e);var t,n,r=Se(i);function i(e,t,n){var a;C.default(this,i),a=r.call(this),O.default(S.default(a),"disconnectingTimer",null),O.default(S.default(a),"disconnectedPromiseResolve",null),O.default(S.default(a),"terminalStates",["disconnected","rejected"]),O.default(S.default(a),"tokenExpiredSasCode",20104),O.default(S.default(a),"terminationReason","Connection is not initialized"),a.websocket=e,a.websocket.on("connected",(function(){return a.fsm.socketConnected()})),a.websocket.on("disconnected",(function(){return a.fsm.socketClosed()})),a.websocket.on("message",(function(e){return a.onIncomingMessage(e)})),a.websocket.on("socketError",(function(e){return a.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null})})),a.transport=t,a.config=n,a.retrier=new _e(n.retryPolicy),a.retrier.on("attempt",(function(){return a.retry()})),a.retrier.on("failed",(function(e){V.warn("Retrying failed: ".concat(e.message)),a.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(function(){V.debug("Browser reported connectivity state: online"),a.resetBackoff(),a.fsm.systemOnline()})),window.addEventListener("offline",(function(){V.debug("Browser reported connectivity state: offline"),a.websocket.close(),a.fsm.socketClosed()})));var o=M.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){a.setupSocket(),a.emit("connecting")},onEnterInitialising:function(){a.sendInit()},onLeaveInitialising:function(){a.cancelInit()},onEnterUpdating:function(){a.sendUpdate()},onLeaveUpdating:function(){a.cancelUpdate()},onEnterRetrying:function(){a.initRetry(),a.emit("connecting")},onEnterConnected:function(){a.resetBackoff(),a.onConnected()},onUserUpdateToken:function(){a.resetBackoff()},onTokenRejected:function(){a.resetBackoff(),a.closeSocket(!0),a.finalizeSocket()},onUserDisconnect:function(){a.closeSocket(!0)},onEnterDisconnecting:function(){a.startDisconnectTimer()},onLeaveDisconnecting:function(){a.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){a.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){a.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){a.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){a.cancelDisconnectTimer()},onDisconnected:function(){a.resetBackoff(),a.finalizeSocket()},onReceiveClose:function(){a.onCloseReceived()},onReceiveOffload:function(e,t){V.debug("onreceiveoffload: ",t),a.modifyBackoff(t.body),a.onCloseReceived()},onUnsupported:function(){a.closeSocket(!0),a.finalizeSocket()},onError:function(e,t){a.closeSocket(t),a.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&a.changeState(e)},onInvalidTransition:function(e,t,n){V.warn("FSM: unexpected transition",t,n)}}});return a.fsm=new o,a}return _.default(i,[{key:"changeState",value:function(e){V.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){V.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){V.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"startDisconnectTimer",value:function(){var e=this;V.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((function(){V.debug("disconnecting is timed out"),e.closeSocket(!0)}),3e3)}},{key:"cancelDisconnectTimer",value:function(){V.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";default:return"disconnected"}}},{key:"initRetry",value:function(){V.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(V.trace("retry"),this.websocket.close(),this.fsm.userRetry()):V.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){V.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){V.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=ve.parse(e);if(t){var n=t.method,r=t.header,i=t.payload;if("reply"!==n&&this.confirmReceiving(r),"notification"===n)this.emit("message",r.message_type,i);else if("reply"===r.method)this.transport.processReply({id:r.id,status:r.status,header:r,body:i});else if("client_update"===r.method)"token_about_to_expire"===r.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===r.method)if(308===r.status.code)V.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:r.status.status,body:i});else if(406===r.status.code){var a="Server closed connection because can't parse protocol: ".concat(JSON.stringify(r.status));this.emitReplyConnectionError(a,r,!0),V.error(a),this.fsm.receiveFatalClose()}else 417===r.status.code?(V.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(r.status))),this.fsm.receiveFatalClose(r.status.status)):410===r.status.code?(V.warn("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status),this.emit("tokenExpired")):401===r.status.code?(V.error("Server closed connection: ".concat(JSON.stringify(r.status))),this.fsm.receiveClose(r.status.status)):(V.warn("unexpected message: ",r.status),this.fsm.receiveOffload({status:r.status.status,body:null}))}}},{key:"sendInit",value:(n=x.default(A.default.mark((function e(){var t,n;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.trace("sendInit"),e.prev=1,this.emit("beforeSendInit"),e.next=5,this.transport.sendInit();case 5:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.config.confirmedCapabilities=t.confirmedCapabilities,this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0 instanceof be?(n=!1,V.warn("Init rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),this.emit("sendInitFailed"),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(n=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0),this.emitReplyConnectionError(e.t0.message,e.t0.reply,n)):(this.terminationReason=e.t0.message,this.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(e.t0.message,"\n").concat(JSON.stringify(e.t0,null,2)),httpStatusCode:null,errorCode:null}),this.fsm.initError(!0)),this.emit("tokenUpdated",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(){return n.apply(this,arguments)})},{key:"sendUpdate",value:(t=x.default(A.default.mark((function e(){var t,n,r;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.trace("sendUpdate"),t=new ne(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:n=e.sent,this.fsm.updateSuccess(n.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof be?(r=!1,V.warn("Token update rejected by server: ".concat(JSON.stringify(e.t0.reply.status))),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(r=!0,this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status),this.emitReplyConnectionError(e.t0.message,e.t0.reply,r)):(this.emit("error",!1,e.t0.message,null,null),this.fsm.updateError(e.t0)),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(){return t.apply(this,arguments)})},{key:"emitReplyConnectionError",value:function(e,t,n){var r=t.status&&t.status.description?t.status.description:e,i=t.status.code,a=t.status&&t.status.errorCode?t.status.errorCode:null;n&&(this.terminationReason=r),this.emit("connectionError",{terminal:n,message:"Connection error: ".concat(r),httpStatusCode:i,errorCode:a})}},{key:"cancelInit",value:function(){V.trace("cancelInit")}},{key:"cancelUpdate",value:function(){V.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){V.trace("confirmReceiving");try{this.transport.send(new oe(e.id))}catch(t){V.debug("failed to confirm packet receiving",t)}}},{key:"closeSocket",value:function(e){var t=this;V.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((function(){return t.fsm.socketClosed()}),0)}},{key:"connect",value:function(){V.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return V.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()}))}},{key:"updateToken",value:function(e){var t=this;return V.trace("updateToken:",e),new Promise((function(e,n){t.once("tokenUpdated",(function(t){t?n(t):e()})),t.fsm.userUpdateToken()}))}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}},{key:"getTerminationReason",get:function(){return this.terminationReason}},{key:"onCloseReceived",value:function(){this.websocket.close()}}]),i}(F),Te=function(){function e(){C.default(this,e)}return _.default(e,null,[{key:"getMetadata",value:function(e){var t,n,r,i,a,o,s,u,c=e&&e.clientMetadata?e.clientMetadata:{},l={env:null!==(t=N.name)&&void 0!==t?t:"unknown",envv:null!==(n=N.version)&&void 0!==n?n:"unknown",os:null!==(r=null===(i=N.os)||void 0===i?void 0:i.family)&&void 0!==r?r:"unknown",osv:null!==(a=null===(o=N.os)||void 0===o?void 0:o.version)&&void 0!==a?a:"unknown",osa:null!==(s=null===(u=N.os)||void 0===u?void 0:u.architecture)&&void 0!==s?s:"unknown",sdk:"js-default"},f={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((function(e){return e in c||e in l})).forEach((function(e){return f[e]=e in c?c[e]:l[e]})),f}}]),e}();var Re=function(){function e(t,n){var r=this;C.default(this,e),this.config=n,this.activeRequests=new Map,this.channel=t,this.channel.on("reply",(function(e){return r.processReply(e)})),this.channel.on("disconnected",(function(){r.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new me("disconnected"))})),r.activeRequests.clear()}))}var t;return _.default(e,[{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"processReply",value:function(e){var t,n=this.activeRequests.get(e.id);n&&(clearTimeout(n.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?n.resolve(e):(n.reject(new be("Transport failure: "+e.status.status,e)),V.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout((function(){V.trace("request",e,"is timed out"),n(new me("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,r)}},{key:"shutdown",value:function(){this.activeRequests.forEach((function(e){clearTimeout(e.timeout),e.reject(new me("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}},{key:"sendInit",value:(t=x.default(A.default.mark((function e(){var t,n,r;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.trace("sendInit"),t=Te.getMetadata(this.config),n=new X(this.config.token,this.config.continuationToken,t,this.config.initRegistrations,this.config.tweaks),e.next=5,this.sendWithReply(n);case 5:return r=e.sent,e.abrupt("return",new ee(r.id,r.header.continuation_token,new Set(r.header.capabilities),r.header.continuation_token_status,r.header.offline_storage,r.header.init_registrations,r.header.debug_info));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sendClose",value:function(){var e=new ue;this.send(e)}},{key:"sendWithReply",value:function(e,t){var n=this;return new Promise((function(r,i){var a=n.send(e,t);n.storeRequest(a,r,i)}))}},{key:"send",value:function(e,t){e.id=e.id||"TM".concat(y.v4());var n=ve.createPacket(e,function(e){switch(P.default(e)){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(r){throw V.debug("failed to send ",e,r),V.trace(r.stack),r}}}]),e}();function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Ce=function(e){T.default(r,e);var t=Ie(r);function r(e){var i;return C.default(this,r),i=t.call(this),O.default(S.default(i),"socket",null),i.url=e,i.url=e,i.WebSocket=n.WebSocket||n.MozWebSocket||{},i}return _.default(r,[{key:"isConnected",get:function(){return!!this.socket&&1===this.socket.readyState}},{key:"connect",value:function(){var e,t=this;V.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(n){return V.debug("Socket error: ".concat(this.url)),void this.emit("socketError",n)}e.binaryType="arraybuffer",e.onopen=function(){V.debug("socket opened ".concat(t.url)),t.emit("connected")},e.onclose=function(e){V.debug("socket closed",e),t.emit("disconnected",e)},e.onerror=function(e){V.debug("Socket error:",e),t.emit("socketError",e)},e.onmessage=function(e){t.emit("message",e.data)},this.socket=e}},{key:"send",value:function(e){return this.socket&&this.socket.send(e)}},{key:"close",value:function(){if(V.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}]),r}(F);function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Ae=function(e){T.default(u,e);var t,n,r,i,a,o,s=Oe(u);function u(e){var t;return C.default(this,u),(t=s.call(this)).transport=e,t.registrations=new Map,t.registrationsInProgress=new Map,t}return _.default(u,[{key:"putNotificationContext",value:(o=x.default(A.default.mark((function e(t,n){var r;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r,n);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"deleteNotificationContext",value:(a=x.default(A.default.mark((function e(t){var n;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateRegistration",value:(i=x.default(A.default.mark((function e(t,n){var r,i;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.debug("update registration for context",t),(r=this.registrationsInProgress.get(t))||(r=new Set,this.registrationsInProgress.set(t,r)),i=y.v4(),r.add(i),e.prev=5,e.next=8,this.putNotificationContext(t,n);case 8:V.debug("registration attempt succeeded for context",n),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),V.warn("registration attempt failed for context",n),V.debug(e.t0),r.delete(i),0===r.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e,t){return i.apply(this,arguments)})},{key:"updateRegistrations",value:(r=x.default(A.default.mark((function e(){var t,n=this;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V.trace("refreshing ".concat(this.registrations.size," registrations")),t=[],this.registrations.forEach((function(e,r){t.push(n.updateRegistration(r,e))})),e.next=5,Promise.all(t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setNotificationsContext",value:(n=x.default(A.default.mark((function e(t,n){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}throw new me("Invalid arguments provided");case 2:return this.registrations.set(t,n),e.next=5,this.updateRegistration(t,n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeNotificationsContext",value:(t=x.default(A.default.mark((function e(t){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),u}(F);function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var je=function(e){T.default(n,e);var t=Pe(n);function n(e,r,i){var a;return C.default(this,n),(a=t.call(this,r)).status=e,a.description=r,a.body=i,a}return n}(me);function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Le=function(e){T.default(n,e);var t=Me(n);function n(e){return C.default(this,n),t.call(this,e)}return n}(me);function Ne(e,t){var n=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:{}};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map((function(e){return e.split("=")})).reduce((function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e}),{})}return n}throw new me("Incorrect URI: "+e)}(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}var Ue=function(){function e(t,n,r){C.default(this,e),this.config=r,this.transport=t,this.pendingMessages=[],this.twilsock=n}var t;return _.default(e,[{key:"saveMessage",value:function(e){var t=this;return new Promise((function(n,r){var i={message:e,resolve:n,reject:r,alreadyRejected:!1,timeout:setTimeout((function(){V.debug("request is timed out"),r(new me("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),i.alreadyRejected=!0}),2e4)};t.pendingMessages.push(i)}))}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var n=t.message;e.actualSend(n).then((function(e){return t.resolve(e)})).catch((function(e){return t.reject(e)})),clearTimeout(t.timeout)}catch(r){return V.debug("Failed to send pending message",r),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){var e=this;this.pendingMessages.forEach((function(t){t.reject(new Le("Unable to connect: "+e.twilsock.getTerminationReason)),t.alreadyRejected=!0,clearTimeout(t.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:(t=x.default(A.default.mark((function e(t){var n,r,i,a,o,s,u,c;return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.to,i=t.headers,a=t.body,o=null!==(n=t.grant)&&void 0!==n?n:this.config.activeGrant,s={host:r.host,path:r.path,method:r.method,params:r.params,headers:i},u=new ie(o,i["Content-Type"]||"application/json",s),V.trace("Sending upstream message",u),e.next=9,this.transport.sendWithReply(u,a);case 9:if(c=e.sent,V.trace("Received upstream message response",c),!((f=c)&&f.header&&f.header.http_status)||(l=c.header.http_status.code)>=200&&l<300){e.next=13;break}throw new je(c.header.http_status.code,c.header.http_status.status,c.body);case 13:return e.abrupt("return",{status:c.header.http_status,headers:c.header.http_headers,body:c.body});case 14:case"end":return e.stop()}var l,f}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new Le("Unable to connect: "+this.twilsock.getTerminationReason));var a=function(e,t,n,r,i){return{to:Ne(e,t),headers:n,body:r,grant:i}}(e,t,n,r,i);return this.twilsock.isConnected?this.actualSend(a):this.saveMessage(a)}}]),e}(),Fe=function(){function e(){var t=this;C.default(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return _.default(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}(),De=function(){function e(t){C.default(this,e),this.id=t}return _.default(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new me('Field "storage_id" is missing')}}]),e}(),Be=function(){function e(){return C.default(this,e),O.default(this,"initializedFlag","twilio_twilsock_token_storage"),O.default(this,"tokenStoragePrefix","twilio_continuation_token_"),e._instance||(this.initialize(),e._instance=this),e._instance}return _.default(e,[{key:"sessionStorage",value:function(){try{return n.sessionStorage}catch(e){return null}}},{key:"window",value:function(){try{return n.window}catch(e){return null}}},{key:"storeToken",value:function(e,t){this.canStore()&&this.sessionStorage.setItem(this.getKeyName(t),e)}},{key:"getStoredToken",value:function(e){return this.canStore()?this.sessionStorage.getItem(this.getKeyName(e)):null}},{key:"initialize",value:function(){var e=this;if(this.canStore()){this.sessionStorage.getItem(this.initializedFlag)&&this.clear(),this.sessionStorage.setItem(this.initializedFlag,"true");var t=this.sessionStorage.removeItem;this.window.addEventListener("unload",(function(){t(e.initializedFlag)}))}}},{key:"clear",value:function(){if(this.canStore()){for(var e=[],t=0;t<this.sessionStorage.length;t++){var n=this.sessionStorage.key(t);n&&0===n.indexOf(this.tokenStoragePrefix)&&e.push(n)}var r=this.sessionStorage.removeItem;e.forEach((function(e){return r(e)})),r(this.initializedFlag)}}},{key:"getKeyName",value:function(e){return"".concat(this.tokenStoragePrefix).concat(e)}},{key:"canStore",value:function(){return!!(this.sessionStorage&&this.sessionStorage.length&&this.window)}}]),e}();O.default(Be,"_instance",null);var qe,ze,We=new Be,Ge=function(){function e(t,n,r,i,a,o){C.default(this,e),this.title=t,this.details=n,this.start=r,this.type=a,this.id=o,this.end=i}return _.default(e,[{key:"toTelemetryEvent",value:function(){var e=new Date,t=this.start,n=this.end?this.end:e;if(n<t){var r=n;n=t,t=r}var i=t.getTime()-e.getTime(),a=n.getTime()-e.getTime();return new le(i,a,this.title,this.details,this.id,this.type)}}]),e}();t.TelemetryPoint=void 0,(qe=t.TelemetryPoint||(t.TelemetryPoint={}))[qe.Start=0]="Start",qe[qe.End=1]="End",t.EventSendingLimitation=void 0,(ze=t.EventSendingLimitation||(t.EventSendingLimitation={}))[ze.MinEventsPortion=0]="MinEventsPortion",ze[ze.AnyEvents=1]="AnyEvents",ze[ze.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished";var $e=function(){function e(t,n){C.default(this,e),O.default(this,"minEventsPortionToSend",50),O.default(this,"maxEventsPortionToSend",100),O.default(this,"pendingEvents",new Map),O.default(this,"readyEvents",[]),O.default(this,"hasInitializationFinished",!1),O.default(this,"_canSendTelemetry",!1),this.config=t,this.packetInterface=n}return _.default(e,[{key:"isTelemetryEnabled",get:function(){return this.config.confirmedCapabilities.has("telemetry.v1")}},{key:"canSendTelemetry",get:function(){return this._canSendTelemetry&&this.isTelemetryEnabled},set:function(e){V.debug("TelemetryTracker.canSendTelemetry: ".concat(e," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(t.EventSendingLimitation.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}},{key:"addTelemetryEvent",value:function(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}},{key:"addPartialEvent",value:function(e,n,r){V.debug("Adding ".concat(r===t.TelemetryPoint.Start?"starting":"ending"," timepoint for '").concat(n,"' event"));var i=this.pendingEvents.has(n);if(r===t.TelemetryPoint.Start)i&&V.debug("Overwriting starting point for '".concat(n,"' event")),this.pendingEvents.set(n,e);else{if(!i)return void V.info("Could not find started event for '".concat(n,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(n),e)),this.pendingEvents.delete(n)}}},{key:"getTelemetryToSend",value:function(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==t.EventSendingLimitation.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==t.EventSendingLimitation.AnyEventsIncludingUnfinished):[]}},{key:"getTelemetryPortion",value:function(e){var t=this,n=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,n);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach((function(e,n){if(!(r.length>=t.maxEventsPortionToSend)){var i=t.pendingEvents.get(n);t.pendingEvents.delete(n),r.push(new Ge("[UNFINISHED] ".concat(i.title),i.details,i.start,null,i.type,i.id))}})),r}},{key:"merge",value:function(e,t){return new Ge(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}},{key:"sendTelemetryIfMinimalPortionCollected",value:function(){this.sendTelemetry(t.EventSendingLimitation.MinEventsPortion)}},{key:"sendTelemetry",value:function(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new fe(t.map((function(e){return e.toTelemetryEvent()}))))}catch(n){V.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(n,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}}]),e}();function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I.default(e);if(t){var i=I.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return R.default(this,n)}}var Ve=function e(){C.default(this,e)};O.default(Ve,"TWILSOCK_CONNECT","twilsock.sdk.connect"),O.default(Ve,"TWILSOCK_INIT","twilsock.sdk.init"),t.TwilsockClient=function(e){T.default(f,e);var n,r,i,a,o,s,u,c,l=He(f);function f(e,n,r){var i;C.default(this,f),i=l.call(this),O.default(S.default(i),"version",J),O.default(S.default(i),"offlineStorageDeferred",new Fe),r.continuationToken=r.continuationToken?r.continuationToken:We.getStoredToken(n);var a=i.config=new K(e,n,r);V.setLevel(a.logLevel);var o=new Ce(a.url),s=new Re(o,a);return i.channel=new Ee(o,s,a),i.registrations=new Ae(s),i.upstream=new Ue(s,i.channel,a),i.telemetryTracker=new $e(a,s),i.channel.on("initialized",(function(){return i.telemetryTracker.canSendTelemetry=!0})),o.on("disconnected",(function(){return i.telemetryTracker.canSendTelemetry=!1})),i.registrations.on("registered",(function(e){return i.emit("registered",e)})),i.channel.on("message",(function(e,t){return setTimeout((function(){return i.emit("message",e,t)}),0)})),i.channel.on("stateChanged",(function(e){return setTimeout((function(){return i.emit("stateChanged",e)}),0)})),i.channel.on("connectionError",(function(e){return setTimeout((function(){return i.emit("connectionError",e)}),0)})),i.channel.on("tokenAboutToExpire",(function(){return setTimeout((function(){return i.emit("tokenAboutToExpire")}),0)})),i.channel.on("tokenExpired",(function(){return setTimeout((function(){return i.emit("tokenExpired")}),0)})),i.channel.on("connected",(function(){return i.registrations.updateRegistrations()})),i.channel.on("connected",(function(){return i.upstream.sendPendingMessages()})),i.channel.on("connected",(function(){return setTimeout((function(){return i.emit("connected")}),0)})),i.channel.on("beforeConnect",(function(){return i.telemetryTracker.addPartialEvent(new Ge("Establish WebSocket connection","",new Date),Ve.TWILSOCK_CONNECT,t.TelemetryPoint.Start)})),i.channel.on("connected",(function(){return i.telemetryTracker.addPartialEvent(new Ge("Establish WebSocket connection","",new Date,new Date),Ve.TWILSOCK_CONNECT,t.TelemetryPoint.End)})),i.channel.on("beforeSendInit",(function(){return i.telemetryTracker.addPartialEvent(new Ge("Send Twilsock init","",new Date),Ve.TWILSOCK_INIT,t.TelemetryPoint.Start)})),i.channel.on("initialized",(function(){return i.telemetryTracker.addPartialEvent(new Ge("Send Twilsock init","Succeeded",new Date,new Date),Ve.TWILSOCK_INIT,t.TelemetryPoint.End)})),i.channel.on("sendInitFailed",(function(){return i.telemetryTracker.addPartialEvent(new Ge("Send Twilsock init","Failed",new Date,new Date),Ve.TWILSOCK_INIT,t.TelemetryPoint.End)})),i.channel.on("initialized",(function(e){i.handleStorageId(n,e),We.storeToken(e.continuationToken,n),setTimeout((function(){return i.emit("initialized",e)}),0)})),i.channel.on("disconnected",(function(){return setTimeout((function(){return i.emit("disconnected")}),0)})),i.channel.on("disconnected",(function(){return i.upstream.rejectPendingMessages()})),i.channel.on("disconnected",(function(){return i.offlineStorageDeferred.fail(new me("Client disconnected"))})),i.offlineStorageDeferred.promise.catch((function(){})),i}return _.default(f,[{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return V.debug("Emitting ".concat(e.toString(),"(").concat(r.map((function(e){return JSON.stringify(e)})).join(", "),")")),(t=E.default(I.default(f.prototype),"emit",this)).call.apply(t,[this,e].concat(r))}},{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(De.create(t.offlineStorage[e])),V.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(n){this.offlineStorageDeferred.fail(new me("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(n,".")))}else this.offlineStorageDeferred.fail(new me("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new me("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}},{key:"updateToken",value:(c=x.default(A.default.mark((function e(t){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V.trace("updating token '".concat(t,"'")),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.next=6,this.channel.updateToken(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setNotificationsContext",value:(u=x.default(A.default.mark((function e(t,n){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.setNotificationsContext(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"removeNotificationsContext",value:(s=x.default(A.default.mark((function e(t){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.registrations.removeNotificationsContext(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:(o=x.default(A.default.mark((function e(){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.telemetryTracker.sendTelemetry(t.EventSendingLimitation.AnyEventsIncludingUnfinished),e.next=3,this.channel.disconnect();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"get",value:(a=x.default(A.default.mark((function e(n,r,i){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.telemetryTracker.sendTelemetry(t.EventSendingLimitation.AnyEvents),e.next=3,this.upstream.send("GET",n,r,void 0,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"post",value:(i=x.default(A.default.mark((function e(n,r,i,a){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.telemetryTracker.sendTelemetry(t.EventSendingLimitation.AnyEvents),e.next=3,this.upstream.send("POST",n,r,i,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"put",value:(r=x.default(A.default.mark((function e(n,r,i,a){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.telemetryTracker.sendTelemetry(t.EventSendingLimitation.AnyEvents),e.next=3,this.upstream.send("PUT",n,r,i,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"delete",value:(n=x.default(A.default.mark((function e(n,r,i,a){return A.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.telemetryTracker.sendTelemetry(t.EventSendingLimitation.AnyEvents),e.next=3,this.upstream.send("DELETE",n,r,i,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"addTelemetryEvent",value:function(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},{key:"addPartialTelemetryEvent",value:function(e,n,r){this.telemetryTracker.addPartialEvent(e,n,r),r===t.TelemetryPoint.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}}]),f}(F),t.TwilsockClient=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":P.default(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([p.validateConstructorTypes(p.nonEmptyString,p.nonEmptyString,[p.pureObject,"undefined",p.literal(null)]),function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":P.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[String,String,Object])],t.TwilsockClient);var Je=function(){function e(t){C.default(this,e),this.product=t,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}return _.default(e,[{key:"populateInitRegistrations",value:function(e){var t=new Set(this.message_types);for(var n in e)t.add(e[n]);this.message_types=Array.from(t)}}]),e}();t.InitRegistration=Je,t.TelemetryEventDescription=Ge,t.TelemetryTracker=$e,t.TransportUnavailableError=Le,t.Twilsock=t.TwilsockClient,t.TwilsockError=me}(q_);var YP={},XP=f,ZP=R,ej=v,tj=l,nj=oa,rj=jr,ij=y,aj=Ge,oj=N,sj=Object.assign,uj=Object.defineProperty,cj=ZP([].concat),lj=!sj||tj((function(){if(XP&&1!==sj({b:1},sj(uj({},"a",{enumerable:!0,get:function(){uj(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!==sj({},e)[n]||nj(sj({},t)).join("")!==r}))?function(e,t){for(var n=aj(e),r=arguments.length,i=1,a=rj.f,o=ij.f;r>i;)for(var s,u=oj(arguments[i++]),c=a?cj(nj(u),a(u)):nj(u),l=c.length,f=0;l>f;)s=c[f++],XP&&!ej(o,u,s)||(n[s]=u[s]);return n}:sj,fj=lj;si({target:"Object",stat:!0,arity:2,forced:Object.assign!==fj},{assign:fj}),
/*
      @license
      The MIT License (MIT)

      Copyright (c) 2016 Twilio Inc.

      Permission is hereby granted, free of charge, to any person obtaining a copy
      of this software and associated documentation files (the "Software"), to deal
      in the Software without restriction, including without limitation the rights
      to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
      copies of the Software, and to permit persons to whom the Software is
      furnished to do so, subject to the following conditions:

      The above copyright notice and this permission notice shall be included in all
      copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
      OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
      SOFTWARE.

      */
function(t){Object.defineProperty(t,"__esModule",{value:!0});var n=Oc,r=Ic,i=hc,a=gc,o=wc,s=ph,u=mc,c=q_,l=lc,f=Tc,d=p_,p=Ub,h=jw,v=iy,y=lE,m=mb;function g(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}function b(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var w=g(uc),k=g(n),x=g(r),_=g(i),S=g(a),E=g(o),T=g(s),R=g(u),I=g(l),C=g(f),O=g(p),A=g(h),P=b(v),j=b(y);function M(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":R.default(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function L(e,t){if("object"===("undefined"==typeof Reflect?"undefined":R.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function N(){}function U(){U.init.call(this)}function F(e){return void 0===e._maxListeners?U.defaultMaxListeners:e._maxListeners}function D(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new N,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=F(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function B(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function q(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function z(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}N.prototype=Object.create(null),U.EventEmitter=U,U.usingDomains=!1,U.prototype.domain=void 0,U.prototype._events=void 0,U.prototype._maxListeners=void 0,U.defaultMaxListeners=10,U.init=function(){this.domain=null,U.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new N,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},U.prototype.getMaxListeners=function(){return F(this)},U.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=z(e,r),a=0;a<r;++a)i[a].call(n)}(n,l,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=z(e,i),o=0;o<i;++o)a[o].call(n,r)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=z(e,a),s=0;s<a;++s)o[s].call(n,r,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=z(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=z(e,i),o=0;o<i;++o)a[o].apply(n,r)}(n,l,this,i)}return!0},U.prototype.addListener=function(e,t){return D(this,e,t,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(e,t){return D(this,e,t,!0)},U.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,B(this,e,t)),this},U.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,B(this,e,t)),this},U.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new N:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new N,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},U.prototype.off=function(e,t){return this.removeListener(e,t)},U.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new N,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new N:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new N,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},U.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},U.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):q.call(e,t)},U.prototype.listenerCount=q,U.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var W=P.getLogger("twilio-notificatiions");function G(e,t){return["".concat((new Date).toISOString()," Twilio.Notifications ").concat(e,":")].concat(Array.from(t))}var $=function(){function e(){k.default(this,e)}return x.default(e,[{key:"setLevel",value:function(e){W.setLevel(e)}},{key:"trace",value:function(){if(W.getLevel()==W.levels.TRACE){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W.debug.apply(null,G("T",t))}}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W.debug.apply(null,G("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W.info.apply(null,G("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W.warn.apply(null,G("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W.error.apply(null,G("E",t))}}]),e}(),H=new $;function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var J=x.default((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;k.default(this,e),this.token=t,this.notificationId=n,this.messageTypes=r}));function K(e,t){var n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[].concat(A.default(A.default(e).filter((function(e){return!t.has(e)}))),A.default(A.default(t).filter((function(t){return!e.has(t)}))))}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}var Q=function(e){_.default(r,e);var t,n=V(r);function r(e){var t;return k.default(this,r),t=n.call(this),C.default(I.default(t),"desiredState",new J),C.default(I.default(t),"currentState",new J),C.default(I.default(t),"_hasActiveAttempt",!1),t.channelType=e,t}return x.default(r,[{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e}},{key:"isActive",value:function(){return""!==this.desiredState.notificationId}},{key:"subscribe",value:function(e){this.desiredState.messageTypes.has(e)?H.debug("message type '".concat(e,"' for channel ").concat(this.channelType," is already registered")):this.desiredState.messageTypes.add(e)}},{key:"unsubscribe",value:function(e){this.desiredState.messageTypes.has(e)&&this.desiredState.messageTypes.delete(e)}},{key:"updateToken",value:function(e){this.desiredState.token=e}},{key:"commitChanges",value:(t=w.default(T.default.mark((function e(){var t,n,r,i,a,o;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._hasActiveAttempt){e.next=3;break}throw H.error("One registration attempt is already in progress"),new Error("One registration attempt is already in progress");case 3:if(t=K(this.desiredState,this.currentState),n=O.default(t,2),r=n[0],i=n[1],r){e.next=6;break}return e.abrupt("return");case 6:if(this.currentState.notificationId||i.delete("notificationId"),H.trace("Persisting ".concat(this.channelType," registration"),i,this.desiredState),e.prev=8,this._hasActiveAttempt=!0,(a=new J).token=this.desiredState.token,a.notificationId=this.desiredState.notificationId,a.messageTypes=new Set(this.desiredState.messageTypes),!(a.messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(a,i);case 17:o=e.sent,this.currentState.token=o.token,this.currentState.notificationId=o.notificationId,this.currentState.messageTypes=new Set(o.messageTypes),this.emit("stateChanged",this.channelType,"registered",this.currentState),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=a.token,this.currentState.notificationId=a.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged",this.channelType,"unregistered",this.currentState);case 30:e.next=35;break;case 32:throw e.prev=32,e.t0=e.catch(8),e.t0;case 35:return e.prev=35,this._hasActiveAttempt=!1,e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[8,32,35,38]])}))),function(){return t.apply(this,arguments)})}]),r}(U);function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var X={min:2e3,max:12e4,randomness:.2},Z=function(e){_.default(a,e);var t,n,r,i=Y(a);function a(e,t,n,r){var o;return k.default(this,a),o=i.call(this,e),C.default(I.default(o),"registrationId",null),o.context=t,o.twilsock=n,o.registrarUrl=r,o}return x.default(a,[{key:"updateRegistration",value:(r=w.default(T.default.mark((function e(t,n){var r,i,a,o,s,u=this;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=6;break}throw H.error("No push notification ID for registration"),new Error("No push notification ID for registration");case 6:return H.trace("Registering",this.channelType,t),r={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(t.messageTypes),data:{registration_id:t.notificationId}},i=this.context.productId,a="".concat(this.registrarUrl,"?productId=").concat(i),o={"Content-Type":"application/json"},H.trace("Creating registration for channel ".concat(this.channelType)),e.prev=12,e.next=15,new d.AsyncRetrier(X).run((function(){return u.twilsock.post(a,o,r,i)}));case 15:s=e.sent,this.registrationId=s.body.id,H.debug("Registration created: ",s),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(12),H.error("Registration failed: ",e.t0),e.t0;case 24:return e.abrupt("return",t);case 25:case"end":return e.stop()}}),e,this,[[12,20]])}))),function(e,t){return r.apply(this,arguments)})},{key:"removeRegistration",value:(n=w.default(T.default.mark((function e(){var t,n,r,i=this;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return t=this.context.productId,n="".concat(this.registrarUrl,"/").concat(this.registrationId,"?productId=").concat(t),r={"Content-Type":"application/json"},H.trace("Removing registration for ".concat(this.channelType)),e.prev=6,e.next=9,new d.AsyncRetrier(Object.assign(X,{maxAttemptsCount:3})).run((function(){return i.twilsock.delete(n,r,{},t)}));case 9:this.registrationId=null,this.currentState.notificationId="",H.debug("Registration removed for ".concat(this.channelType)),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(6),H.error("Failed to remove registration ",this.channelType,e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(){return n.apply(this,arguments)})},{key:"sendDeviceRemoveRequest",value:(t=w.default(T.default.mark((function e(t){var n,r,i,a,o=this;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=2;break}throw new Error("Empty registration ID");case 2:return n=this.context.productId,r="".concat(this.registrarUrl,"?productId=").concat(n),i={"Content-Type":"application/json"},a={binding_type:this.channelType,address:t},e.prev=6,H.trace("Removing old registrations for ".concat(this.channelType)),e.next=10,new d.AsyncRetrier(Object.assign(X,{maxAttemptsCount:3})).run((function(){return o.twilsock.delete(r,i,a,n)}));case 10:this.registrationId=null,this.currentState.notificationId="",H.debug("Registration removed for ".concat(this.channelType)),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(6),H.error("Failed to remove registration ",this.channelType,e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e){return t.apply(this,arguments)})}]),a}(Q);function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var te,ne=function(e){_.default(a,e);var t,n,r,i=ee(a);function a(e,t,n){var r;return k.default(this,a),r=i.call(this,"twilsock"),C.default(I.default(r),"contextId",j.v4()),r.productId=e,r.platform=t,r.twilsock=n,r}return x.default(a,[{key:"updateRegistration",value:(r=w.default(T.default.mark((function e(t,n){var r,i;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.has("messageType")){e.next=2;break}return e.abrupt("return",t);case 2:return r=Array.from(t.messageTypes),i={product_id:this.productId,notification_protocol_version:4,endpoint_platform:this.platform,message_types:r},e.prev=4,e.next=7,this.twilsock.setNotificationsContext(this.contextId,i);case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(4),H.error("Failed to update twilsock notification context: ".concat(e.t0)),e.t0;case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e,t){return r.apply(this,arguments)})},{key:"removeRegistration",value:(n=w.default(T.default.mark((function e(){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.twilsock.removeNotificationsContext(this.contextId);case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),H.error("Failed to remove twilsock notification context: ".concat(e.t0)),e.t0;case 9:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return n.apply(this,arguments)})},{key:"sendDeviceRemoveRequest",value:(t=w.default(T.default.mark((function e(t){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),a}(Q);function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var i=E.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S.default(this,n)}}var ie=m.literal("apn","fcm","twilsock");t.Notifications=te=function(e){_.default(a,e);var t,n,r,i=re(a);function a(e){var t,n,r,o,s,u,l,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};k.default(this,a),l=i.call(this),f.logLevel=null!==(t=f.logLevel)&&void 0!==t?t:"error",H.setLevel(f.logLevel);var d=null!==(n=f.productId)&&void 0!==n?n:"notifications",p=!f.twilsockClient,h=f.twilsockClient=null!==(r=f.twilsockClient)&&void 0!==r?r:new c.TwilsockClient(e,d,f),v=null!==(o=f.notifications)&&void 0!==o?o:{},y=null!==(s=null!==(u=v.region)&&void 0!==u?u:f.region)&&void 0!==s?s:"us1",m="https://ers.".concat(y,".twilio.com/v1/registrations"),g=v.ersUrl||m;l.connectors=new Map;var b=te._detectPlatform();return l.connectors.set("apn",new Z("apn",{protocolVersion:4,productId:d,platform:b},h,g)),l.connectors.set("fcm",new Z("fcm",{protocolVersion:3,productId:d,platform:b},h,g)),l.connectors.set("twilsock",new ne(d,b,h)),h.on("stateChanged",(function(e){return l.emit("transportState",e)})),l._connector("twilsock").on("stateChanged",(function(e,t,n){return l.emit("stateChanged",e,t,n)})),l._connector("apn").on("stateChanged",(function(e,t,n){return l.emit("stateChanged",e,t,n)})),l._connector("fcm").on("stateChanged",(function(e,t,n){return l.emit("stateChanged",e,t,n)})),h.on("message",(function(e,t){return l._routeMessage(e,t)})),l.updateToken(e),p&&(h.connect(),l.twilsock=h),l}return x.default(a,[{key:"shutdown",value:(r=w.default(T.default.mark((function e(){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectors.clear(),!this.twilsock){e.next=4;break}return e.next=4,this.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setPushRegistrationId",value:function(e,t){H.debug("Set ".concat(e," push registration id '").concat(t,"'")),this._connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){H.debug("Add ".concat(e," subscriptions for message type ").concat(t)),this._connector(e).subscribe(t)}},{key:"unsubscribe",value:function(e,t){H.debug("Remove ".concat(e," subscriptions for message type ").concat(t)),this._connector(e).unsubscribe(t)}},{key:"updateToken",value:function(e){this.connectors.forEach((function(t){return t.updateToken(e)}))}},{key:"commitChanges",value:(n=w.default(T.default.mark((function e(){var t;return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.connectors.forEach((function(e){e.isActive()&&t.push(e.commitChanges())})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeRegistrations",value:(t=w.default(T.default.mark((function e(t,n){return T.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._connector(t).sendDeviceRemoveRequest(n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"_routeMessage",value:function(e,t){H.debug("Notification message arrived: ",e,t),this.emit("message",e,t)}},{key:"_connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: ".concat(e));return t}}],[{key:"_detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),a}(U),M([m.validateTypes(ie,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",void 0)],t.Notifications.prototype,"setPushRegistrationId",null),M([m.validateTypes(ie,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",void 0)],t.Notifications.prototype,"subscribe",null),M([m.validateTypes(ie,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",void 0)],t.Notifications.prototype,"unsubscribe",null),M([m.validateTypes(m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String]),L("design:returntype",void 0)],t.Notifications.prototype,"updateToken",null),M([m.validateTypesAsync(ie,m.nonEmptyString),L("design:type",Function),L("design:paramtypes",[String,String]),L("design:returntype",Promise)],t.Notifications.prototype,"removeRegistrations",null),t.Notifications=te=M([m.validateConstructorTypes(m.nonEmptyString,[m.pureObject,"undefined",m.literal(null)]),L("design:paramtypes",[String,Object])],t.Notifications)}(YP);var dj={},pj={};
/*
      @license
      Copyright (c) 2021 Twilio Inc.

      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


      */
Object.defineProperty(pj,"__esModule",{value:!0});var hj=Ub,vj=jw,yj=Oc,mj=hc,gj=gc,bj=wc;function wj(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}var kj=wj(mc),xj=wj(hj),_j=wj(vj),Sj=wj(yj),Ej=wj(mj),Tj=wj(gj),Rj=wj(bj),Ij=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{checks:t}};function Cj(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Oj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oj(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Oj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Aj=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ij((function(e){var n,r=!1,i=[],a=Cj(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;"string"!=typeof o?(r=r||e instanceof o,i.push("an instance of ".concat(o.name))):(r=r||kj.default(e)===o,i.push("of type ".concat(o)))}}catch(s){a.e(s)}finally{a.f()}return[r,i]}))};function Pj(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return jj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jj(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function jj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Mj=Ij((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),Lj=Ij((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),Nj=Ij((function(e){return["object"===kj.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function Uj(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Rj.default(e);if(t){var i=Rj.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tj.default(this,n)}}function Fj(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Dj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dj(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Dj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Bj=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var n,r=Fj(t.entries());try{for(r.s();!(n=r.n()).done;){var i=xj.default(n.value,2),a=i[0],o=i[1],s=Gj(e[a],o),u=xj.default(s,4),c=u[0],l=u[1],f=u[2],d=u[3];if(!c)throw new Error("Argument ".concat(a+1," is expected to be ").concat(f).concat(d," but got ").concat(l))}}catch(p){r.e(p)}finally{r.f()}},qj=function(e){var t,n,r;(["undefined","boolean","number","bigint","string"].includes(kj.default(e))&&(n="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===kj.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(n=null===e?"null":"instance of ".concat(null==e||null===(r=e.constructor)||void 0===r?void 0:r.name));return n||(n=kj.default(e)),n},zj=function(e){var t,n=[],r=Fj(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(Wj(i))}}catch(a){r.e(a)}finally{r.f()}return n},Wj=function(e){var t,n=[],r=Fj(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?n.push(i):n.push(Aj(i))}}catch(a){r.e(a)}finally{r.f()}return n},Gj=function(e,t){var n,r,i=[],a=!1,o=Fj(e);try{for(o.s();!(r=o.n()).done;){var s,u=Fj(r.value.checks);try{for(u.s();!(s=u.n()).done;){var c=(0,s.value)(t),l=xj.default(c,3),f=l[0],d=l[1],p=l[2];a=a||f,!n&&p&&(n=p),d&&(i=[].concat(_j.default(i),"string"==typeof d?[d]:_j.default(d)))}}catch(y){u.e(y)}finally{u.f()}}}catch(y){o.e(y)}finally{o.f()}if(a)return[!0];var h=n||qj(t),v=i.length-1;return[!1,h,v>0?"".concat(i.slice(0,v).join(", ")," or ").concat(i[v]):i.join(", "),v>1?";":","]};function $j(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Hj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hj(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Hj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}pj.array=function(e,t){return Ij((function(n){if(!Array.isArray(n))return[!1,"an array of ".concat(e)];var r,i=$j(n.entries());try{for(i.s();!(r=i.n()).done;){var a=xj.default(r.value,2),o=a[0],s=a[1],u=Gj(Wj(t),s),c=xj.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(o," should be ").concat(d,")"),"malformed array of ".concat(e," (index ").concat(o," is ").concat(f,")")]}}catch(p){i.e(p)}finally{i.f()}return[!0]}))},pj.custom=Ij,pj.literal=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ij((function(e){var n,r=!1,i=[],a=Pj(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r=r||e===o,i.push("string"==typeof o?'"'.concat(o,'"'):"".concat(o))}}catch(s){a.e(s)}finally{a.f()}return[r,i]}))},pj.nonEmptyString=Mj,pj.nonNegativeInteger=Lj,pj.objectSchema=function(e,t){return Ij((function(n){if("object"!==kj.default(n)||null===n||Array.isArray(n))return[!1,"valid ".concat(e," (should be a pure object)")];for(var r=0,i=Object.entries(t);r<i.length;r++){var a=xj.default(i[r],2),o=a[0],s=a[1],u=Gj(Wj(s),n[o]),c=xj.default(u,3),l=c[0],f=c[1],d=c[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(o,'" should be ').concat(d,")"),"malformed ".concat(e,' (key "').concat(o,'" is ').concat(f,")")]}return[!0]}))},pj.pureObject=Nj,pj.runtimeTypeValidation=Bj,pj.stringifyReceivedType=qj,pj.type=Aj,pj.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=zj(t);return function(e){return function(e){Ej.default(n,e);var t=Uj(n);function n(){Sj.default(this,n);for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return Bj(r,i),t.call.apply(t,[this].concat(i))}return n}(e)}},pj.validateTypes=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=zj(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Bj(r,t),i.apply(this,t)}}},pj.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=zj(t);return function(e,t,n){if("function"!=typeof n.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=n.value;n.value=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];try{Bj(r,t)}catch(a){return Promise.reject(a)}return i.apply(this,t)}}},
/*
      @license
      The following license applies to all parts of this software except as
      documented below.

          Copyright (c) 2016, Twilio, inc.
          All rights reserved.

          Redistribution and use in source and binary forms, with or without
          modification, are permitted provided that the following conditions are
          met:

            1. Redistributions of source code must retain the above copyright
               notice, this list of conditions and the following disclaimer.

            2. Redistributions in binary form must reproduce the above copyright
               notice, this list of conditions and the following disclaimer in
               the documentation and/or other materials provided with the
               distribution.

            3. Neither the name of Twilio nor the names of its contributors may
               be used to endorse or promote products derived from this software
               without specific prior written permission.

          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
          "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
          LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
          A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
          HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
          SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
          LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
          DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
          THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
          (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
          OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

      This software includes loglevel under the following license.

          Copyright (c) 2013 Tim Perry

          Permission is hereby granted, free of charge, to any person
          obtaining a copy of this software and associated documentation
          files (the "Software"), to deal in the Software without
          restriction, including without limitation the rights to use,
          copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the
          Software is furnished to do so, subject to the following
          conditions:

          The above copyright notice and this permission notice shall be
          included in all copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
          EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
          OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
          NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
          HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
          WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
          FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
          OTHER DEALINGS IN THE SOFTWARE.

      This software includes Backoff library under the following license

          Copyright (C) 2012 Mathieu Turcotte

          Permission is hereby granted, free of charge, to any person obtaining a copy of
          this software and associated documentation files (the "Software"), to deal in
          the Software without restriction, including without limitation the rights to
          use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
          of the Software, and to permit persons to whom the Software is furnished to do
          so, subject to the following conditions:

          The above copyright notice and this permission notice shall be included in all
          copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
          IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
          FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
          AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
          LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
          OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
          SOFTWARE.

      This software includes Event-to-Promise library under the following license

          Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

          Permission to use, copy, modify, and/or distribute this software for any purpose
          with or without fee is hereby granted, provided that the above copyright notice
          and this permission notice appear in all copies.

          THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
          REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
          FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
          INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
          OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
          TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
          THIS SOFTWARE.

      */
Object.defineProperty(dj,"__esModule",{value:!0});var Vj=Oc,Jj=Ic,Kj=lc,Qj=hc,Yj=gc,Xj=wc,Zj=Tc,eM=ph,tM=mc,nM=pj,rM=q_,iM=dP,aM=iy,oM=Ub,sM=p_,uM=lE,cM=jk,lM=hP;function fM(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}function dM(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var pM=fM(uc),hM=fM(Vj),vM=fM(Jj),yM=fM(Kj),mM=fM(Qj),gM=fM(Yj),bM=fM(Xj),wM=fM(Zj),kM=fM(eM),xM=fM(tM),_M=fM(iM),SM=dM(aM),EM=fM(oM),TM=dM(uM),RM=fM(cM),IM=dM(lM);function CM(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":xM.default(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function OM(e,t){if("object"===("undefined"==typeof Reflect?"undefined":xM.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function AM(){}function PM(){PM.init.call(this)}function jM(e){return void 0===e._maxListeners?PM.defaultMaxListeners:e._maxListeners}function MM(e,t,n,r){var i,a,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new AM,e._eventsCount=0),o){if("function"==typeof o?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=jM(e))&&i>0&&o.length>i){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,s=u,"function"==typeof console.warn?console.warn(s):console.log(s)}}else o=a[t]=n,++e._eventsCount;return e}function LM(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}function NM(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function UM(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}AM.prototype=Object.create(null),PM.EventEmitter=PM,PM.usingDomains=!1,PM.prototype.domain=void 0,PM.prototype._events=void 0,PM.prototype._maxListeners=void 0,PM.defaultMaxListeners=10,PM.init=function(){this.domain=null,PM.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new AM,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},PM.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},PM.prototype.getMaxListeners=function(){return jM(this)},PM.prototype.emit=function(e){var t,n,r,i,a,o,s,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(s=this.domain,u){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=o[e]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=UM(e,r),a=0;a<r;++a)i[a].call(n)}(n,l,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=UM(e,i),o=0;o<i;++o)a[o].call(n,r)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=UM(e,a),s=0;s<a;++s)o[s].call(n,r,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,s=UM(e,o),u=0;u<o;++u)s[u].call(n,r,i,a)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=UM(e,i),o=0;o<i;++o)a[o].apply(n,r)}(n,l,this,i)}return!0},PM.prototype.addListener=function(e,t){return MM(this,e,t,!1)},PM.prototype.on=PM.prototype.addListener,PM.prototype.prependListener=function(e,t){return MM(this,e,t,!0)},PM.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,LM(this,e,t)),this},PM.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,LM(this,e,t)),this},PM.prototype.removeListener=function(e,t){var n,r,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new AM:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new AM,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,i);r.removeListener&&this.emit("removeListener",e,o||t)}return this},PM.prototype.off=function(e,t){return this.removeListener(e,t)},PM.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new AM,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new AM:delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new AM,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},PM.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},PM.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):NM.call(e,t)},PM.prototype.listenerCount=NM,PM.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var FM=function(){function e(t){hM.default(this,e),this.base=t,this.args=new Array,this.paths=new Array}return vM.default(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();function DM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}var BM=function(e){mM.default(n,e);var t=DM(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return hM.default(this,n),(r=t.call(this)).name=r.constructor.name,r.message="".concat(e," (status: ").concat(i,", code: ").concat(a,")"),r.status=i,r.code=a,r}return n}(_M.default(Error)),qM=function(e){mM.default(n,e);var t=DM(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;return hM.default(this,n),(r=t.call(this,e,i,a)).body=o,r}return n}(BM);function zM(e){return JSON.parse(JSON.stringify(e))}function WM(e){if(!(void 0===e||GM(e)))throw new BM("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function GM(e){return function(e){return!isNaN(parseInt(e))&&isFinite(e)}(e)&&e>0}var $M=SM.getLogger("twilio-sync");function HM(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}var VM=function(e){$M.setLevel(e)},JM=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];$M.trace.apply(null,HM("T",t))},KM=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];$M.debug.apply(null,HM("D",t))},QM=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];$M.warn.apply(null,HM("W",t))},YM=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];$M.error.apply(null,HM("E",t))};var XM=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};hM.default(this,e);var n,r,i,a=t.region||"us1",o="https://cds.".concat(a,".twilio.com"),s=t.cdsUri||o;this.settings={subscriptionsUri:s+"/v4/Subscriptions",documentsUri:s+"/v3/Documents",listsUri:s+"/v3/Lists",mapsUri:s+"/v3/Maps",streamsUri:s+"/v3/Streams",insightsUri:s+"/v3/Insights",sessionStorageEnabled:(n=t.Sync,r="enableSessionStorage",i=!0,n&&void 0!==n[r]?n[r]:i),productId:t.productId}}return vM.default(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}},{key:"productId",get:function(){return this.settings.productId}}]),e}();function ZM(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return eL(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eL(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function eL(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var tL=function(){function e(t){hM.default(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return vM.default(e,[{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}},{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new BM("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}}]),e}(),nL=function(){function e(t){var n=this;hM.default(this,e),wM.default(this,"isConnected",!1),wM.default(this,"maxBatchSize",100),wM.default(this,"subscriptionTtlTimer",null),wM.default(this,"pendingPokeReason",null),this.services=t,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=sM.Backoff.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),KM("All subscriptions resolved."))}))}var t;return vM.default(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i,a=[],o=ZM(e);try{for(o.s();!(i=o.n()).done;){var s=EM.default(i.value,2),u=s[0],c=s[1];if(!t.get(u)&&n!==c.pendingAction&&!c.rejectedWithError&&(a.push(c),r&&a.length>=r))break}}catch(l){o.e(l)}finally{o.f()}return a}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){this.backoff.backoff()}},{key:"applyNewSubscriptionUpdateBatch",value:(t=pM.default(kM.default.mark((function e(t,n){var r,i,a,o,s,u,c,l,f,d,p,h,v=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return KM("Twilsock connection (required for subscription) not ready; waitingâ¦"),this.backoff.reset(),e.abrupt("return");case 4:n=this.processLocalActions(t,n),r=(new Date).getTime(),i=ZM(n);try{for(i.s();!(a=i.n()).done;)o=a.value,this.recordActionAttemptOn(o,t,r)}catch(y){i.e(y)}finally{i.f()}return s=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=10,e.next=13,this.request(t,r,s,n);case 13:u=e.sent,c=u.body.max_batch_size,!isNaN(parseInt(c))&&isFinite(c)&&c>0&&(this.maxBatchSize=c),this.subscriptionTtlTimer||(l=u.body.ttl_in_s,!isNaN(parseFloat(l))&&isFinite(l)&&l>0&&(this.subscriptionTtlTimer=setTimeout((function(){return v.onSubscriptionTtlElapsed()}),1e3*l))),"establish"===t&&(f=u.body.estimated_delivery_in_ms,!isNaN(parseFloat(f))&&isFinite(f)&&f>0?setTimeout((function(){return v.verifyPokeDelivery(r,f,n)}),f):YM("Invalid timeout: ".concat(f)),n.filter((function(e){return e.pendingCorrelationId===r})).forEach((function(e){return e.setSubscriptionState("response_in_flight")}))),this.backoff.reset(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(10),d=ZM(n);try{for(d.s();!(p=d.n()).done;)h=p.value,this.recordActionFailureOn(h,t)}catch(y){d.e(y)}finally{d.f()}e.t0 instanceof rM.TransportUnavailableError?(KM("Twilsock connection (required for subscription) not ready (c:".concat(r,"); waitingâ¦")),this.backoff.reset()):(KM("Failed an attempt to ".concat(t," subscriptions (c:").concat(r,"); retrying"),e.t0),this.persist());case 26:case"end":return e.stop()}}),e,this,[[10,21]])}))),function(e,n){return t.apply(this,arguments)})},{key:"verifyPokeDelivery",value:function(e,t,n){var r=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),a=i?(new Date).getTime()-i:t;a>=t?(n.filter((function(t){return t.pendingCorrelationId===e})).forEach((function(e){e.updatePending(null,null),e.retryCount++,r.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((function(){return r.verifyPokeDelivery(e,t,n)}),t-a)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter((function(e){return!e.rejectedWithError})):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{var r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n,r){var i=r.map((function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}})),a=r.filter((function(e){return e.retryCount>0})).length;KM("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var o={event_protocol_version:4,action:e,correlation_id:t,retried_requests:a,ttl_in_s:-1,requests:i};return"ttl"===n&&(o.reason=n),this.services.network.post(this.services.config.subscriptionsUri,o)}},{key:"add",value:function(e,t){KM("Establishing intent to subscribe to ".concat(e));var n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new tL(t)),this.persist())}},{key:"remove",value:function(e){KM("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){JM("Subscriptions received",e);var n=e.event_type,r=void 0!==e.events?e.events:[e.event],i=e.correlation_id;i&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(i,(new Date).getTime());var a,o=ZM(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=void 0;switch(e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(s,i);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(s,i);break;case"subscription_failed":this.applySubscriptionFailedMessage(s,i);break;case(u=n.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var c=void 0;switch(u[0]){case"map_":c=s.map_sid;break;case"list_":c=s.list_sid;break;case"document_":c=s.document_sid;break;case"stream_":c=s.stream_sid;break;case"live_query_":c=s.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:c=void 0}this.applyEventToSubscribedEntity(c,s,n,t);break;default:KM("Dropping unknown message type ".concat(n))}}}catch(l){o.e(l)}finally{o.f()}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(KM("Event Replay for subscription to ".concat(n," (c:").concat(t,") interrupted; continuing eagerly.")),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(KM("Event Replay for subscription to ".concat(n," (c:").concat(t,") completed. Subscription is ready.")),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):KM("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):KM("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(YM("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,n,r){if(e){var i;r=r||(i=this.persisted.get(e))&&i.isEstablished;var a=this.subscriptions.get(e);a?(t.type=n,a.update(t,r)):KM("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){KM("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,n=[],r=ZM(this.persisted.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}this.persisted.clear();for(var a=0,o=n;a<o.length;a++){var s=o[a];this.persisted.set(s.sid,s)}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();function rL(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function iL(e){return e.body?e.body.code:0}function aL(e){return 409===e.status?new qM(rL(e),e.status,iL(e),e.body):e.status?new BM(rL(e),e.status,iL(e)):e instanceof rM.TransportUnavailableError?e:new BM(e.message,0,0)}var oL=function(){function e(t,n,r){hM.default(this,e),this.clientInfo=t,this.config=n,this.transport=r}return vM.default(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+TM.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){var a=[502,503,504];n&&a.push(429);var o=new sM.Retrier(t.backoffConfig());o.on("attempt",(function(){e().then((function(e){return o.succeeded(e)})).catch((function(e){if(a.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);o.failed(aL(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?o.failed(aL(e)):(o.removeAllListeners(),o.cancel(),i(aL(e)))}))})),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(aL(e))})),o.on("failed",(function(e){return i(aL(e))})),o.start()}))}},{key:"get",value:function(e){var t=this,n=this.createHeaders();return KM("GET",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.get(e,n,t.config.productId)}),!0)}},{key:"post",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.createHeaders();return null!=n&&(a["If-Match"]=n),KM("POST",e,"ID:",a["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.post(e,a,t,r.config.productId)}),i)}},{key:"put",value:function(e,t,n){var r=this,i=this.createHeaders();return null!=n&&(i["If-Match"]=n),KM("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((function(){return r.transport.put(e,i,t,r.config.productId)}),!1)}},{key:"delete",value:function(e){var t=this,n=this.createHeaders();return KM("DELETE",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((function(){return t.transport.delete(e,n,t.config.productId)}),!1)}}]),e}(),sL=function(){function e(t,n){hM.default(this,e),this.config=t,this.storageId=null;try{this.storage=n||sessionStorage}catch(r){}}return vM.default(e,[{key:"storageKey",value:function(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(r){}}},{key:"update",value:function(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(n){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(n){}return null}},{key:"_apply",value:function(e,t){var n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}]),e}();function uL(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return cL(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cL(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function cL(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var lL=function(){function e(t,n){hM.default(this,e),this.services=t,this.removalHandler=n,this.subscriptionState="none",this._attachedListeners=new Map}return vM.default(e,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}},{key:"_subscribe",value:function(){this.services.router._subscribe(this.sid,this)}},{key:"_unsubscribe",value:function(){this.services.router._unsubscribe(this.sid)}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}},{key:"attach",value:function(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}},{key:"detach",value:function(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}},{key:"broadcastEventToListeners",value:function(e,t){var n,r=uL(this._attachedListeners.values());try{for(r.s();!(n=r.n()).done;){n.value.emit(e,t)}}catch(i){r.e(i)}finally{r.f()}}}]),e}(),fL=function(){function e(t){hM.default(this,e),wM.default(this,"queuedRequests",[]),wM.default(this,"isRequestInFlight",!1),this.inputMergingFunction=t}return vM.default(e,[{key:"add",value:function(e,t){var n=this,r=new Promise((function(r,i){return n.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:i})}));return this.wakeupQueue(),r}},{key:"squashAndAdd",value:function(e,t){var n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map((function(e){return e.input})).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach((function(e){return i.then(e.resolve,e.reject)})),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then((function(t){e.isRequestInFlight=!1,e.wakeupQueue()}))}}}]),e}(),dL=function(){function e(t){hM.default(this,e),wM.default(this,"queueByNamespaceKey",new Map),this.inputReducer=t}var t,n,r;return vM.default(e,[{key:"add",value:(r=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.add(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"squashAndAdd",value:(n=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,(function(e){return e.squashAndAdd(n,r)})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"invokeQueueMethod",value:(t=pM.default(kM.default.mark((function e(t,n){var r,i;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new fL(this.inputReducer)),r=this.queueByNamespaceKey.get(t),i=n(r),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function pL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}var hL=function(e){mM.default(n,e);var t=pL(n);function n(){var e;return hM.default(this,n),(e=t.call(this)).closed=!1,e.uuid=uM.v4(),e}return vM.default(n,[{key:"listenerUuid",get:function(){return this.uuid}},{key:"close",value:function(){this.removeAllListeners(),this.closed=!0}},{key:"ensureNotClosed",value:function(){if(this.closed)throw new Error("Invalid operation on closed object")}}]),n}(PM);function vL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}var yL=function(e){mM.default(f,e);var t,n,r,i,a,o,s,u,c,l=vL(f);function f(e,t,n){var r;hM.default(this,f),r=l.call(this,e,n),wM.default(yM.default(r),"isDeleted",!1);return r.updateMergingQueue=new fL((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.descriptor=t,r.descriptor.data=r.descriptor.data||{},r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return vM.default(f,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":if(e.id<=this.lastEventId){JM("Document update skipped, current:",this.lastEventId,", remote:",e.id);break}var t=void 0!==this.descriptor.data?zM(this.descriptor.data):null;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{data:e.document_data,isLocal:!1,previousData:t}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data});break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:(c=pM.default(kM.default.mark((function e(t,n){var r,i=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(r,(function(e){return i._setUnconditionally(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"mutate",value:(u=pM.default(kM.default.mark((function e(t,n){var r,i=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||{},e.abrupt("return",this.updateMergingQueue.add(r,(function(e){return i._setWithIfMatch(t,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"update",value:(s=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate((function(e){return Object.assign(e,t)}),n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"setTtl",value:(o=pM.default(kM.default.mark((function e(t){var n;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({ttl:t});case 2:n=e.sent,this.descriptor.date_expires=n.date_expires;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setUnconditionally",value:(a=pM.default(kM.default.mark((function e(t,n){var r;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:n});case 2:return r=e.sent,this._handleSuccessfulUpdateResult(r),e.abrupt("return",this.descriptor.data);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_setWithIfMatch",value:(i=pM.default(kM.default.mark((function e(t,n){var r,i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t(zM(this.descriptor.data)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:r,revision:i,ttl:n});case 6:return a=e.sent,this._handleSuccessfulUpdateResult(a),e.abrupt("return",this.descriptor.data);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.descriptor.data);case 23:case"end":return e.stop()}}),e,this,[[3,11]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_handleSuccessfulUpdateResult",value:function(e){if(!(e.last_event_id<=this.descriptor.last_event_id)){var t=void 0!==this.descriptor.data?zM(this.descriptor.data):null;this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:t})}}},{key:"_postUpdateToServer",value:(r=pM.default(kM.default.mark((function e(t){var n,r,i;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return n={data:t.data},void 0!==t.ttl&&(n.ttl=t.ttl),r=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,n,r);case 7:return i=e.sent,e.abrupt("return",{revision:i.body.revision,data:t.data,last_event_id:i.body.last_event_id,date_updated:i.body.date_updated,date_expires:i.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.reject(new BM("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e){return r.apply(this,arguments)})},{key:"_softSync",value:(n=pM.default(kM.default.mark((function e(){var t=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then((function(e){var n={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(n),t})).catch((function(e){404===e.status?t.onRemoved(!1):YM("Can't get updates for ".concat(t.sid,":"),e)})));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onRemoved",value:function(e){if(!this.isDeleted){var t=void 0!==this.descriptor.data?zM(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e,previousData:t})}}},{key:"removeDocument",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",Promise.reject(new BM("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"document"}}]),f}(lL),mL=function(e){mM.default(s,e);var t,n,r,i,a,o=vL(s);function s(e){var t;return hM.default(this,s),(t=o.call(this)).syncDocumentImpl=e,t.syncDocumentImpl.attach(yM.default(t)),t}return vM.default(s,[{key:"uri",get:function(){return this.syncDocumentImpl.uri}},{key:"revision",get:function(){return this.syncDocumentImpl.revision}},{key:"lastEventId",get:function(){return this.syncDocumentImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncDocumentImpl.dateExpires}},{key:"type",get:function(){return yL.type}},{key:"sid",get:function(){return this.syncDocumentImpl.sid}},{key:"data",get:function(){return this.syncDocumentImpl.data}},{key:"dateUpdated",get:function(){return this.syncDocumentImpl.dateUpdated}},{key:"uniqueName",get:function(){return this.syncDocumentImpl.uniqueName}},{key:"set",value:(a=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.set(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"mutate",value:(i=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.mutate(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"update",value:(r=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.update(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setTtl",value:(n=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeDocument",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncDocumentImpl.removeDocument());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){RM.default(bM.default(s.prototype),"close",this).call(this),this.syncDocumentImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return yL.type}}]),s}(hL);wM.default(mL,"removed","removed"),wM.default(mL,"updated","updated"),CM([nM.validateTypesAsync(nM.pureObject,["undefined",nM.objectSchema("document metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object,Object]),OM("design:returntype",Promise)],mL.prototype,"set",null),CM([nM.validateTypesAsync("function",["undefined",nM.objectSchema("document metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Function,Object]),OM("design:returntype",Promise)],mL.prototype,"mutate",null),CM([nM.validateTypesAsync(nM.pureObject,["undefined",nM.objectSchema("document metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object,Object]),OM("design:returntype",Promise)],mL.prototype,"update",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],mL.prototype,"setTtl",null);var gL=function(){function e(t){hM.default(this,e),this.descriptor=t}return vM.default(e,[{key:"uri",get:function(){return this.descriptor.uri}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.lastEventId}},{key:"dateUpdated",get:function(){return this.descriptor.dateUpdated}},{key:"dateExpires",get:function(){return this.descriptor.dateExpires}},{key:"index",get:function(){return this.descriptor.index}},{key:"data",get:function(){return this.descriptor.data}},{key:"update",value:function(e,t,n,r){return this.descriptor.lastEventId=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.dateUpdated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.dateExpires=e}}]),e}(),bL=function(){function e(t,n,r,i){hM.default(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}var t,n;return vM.default(e,[{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}},{key:"nextPage",value:(n=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"prevPage",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function wL(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kL(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kL(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function kL(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var xL=function(){function e(t,n){hM.default(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return vM.default(e,[{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}},{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}]),e}(),_L=function(){function e(t,n){hM.default(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return vM.default(e,[{key:"size",get:function(){return this.count}},{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new xL(e,t);if(this.count++,this.root){for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,a=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(a))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}else this.root=n}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var a=r||i;n||a?n&&!a?this.root=a:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var o=t.left;o.right;)o=o.right;if(t.left===o)t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!0};else{var s=o.parent,u=o.left;s.right=u,u&&(u.parent=s),t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.left=t.left,o.left.parent=o,o.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:Symbol.iterator,value:kM.default.mark((function e(){var t,n,r;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=wL(this.getIterator()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"getIterator",value:kM.default.mark((function e(){var t,n,r,i=arguments;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.left)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)||null===t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.right){e.next=21;break}for(n=n.right;n.left;)n=n.left;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.left===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.left===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))},{key:"getReverseIterator",value:kM.default.mark((function e(){var t,n,r,i=arguments;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:null,n=this.root;case 2:if(!n){e.next=8;break}if(!this.isEqual(t,n.key)&&(null!==t||n.right)){e.next=5;break}return e.abrupt("break",8);case 5:n=this.isLessThan(t,n.key)&&null!==t?n.left:n.right,e.next=2;break;case 8:if(n){e.next=10;break}return e.abrupt("return",null);case 10:r=!0;case 11:if(!r){e.next=29;break}return e.next=14,[n.key,n.value];case 14:if(r=!1,!n.left){e.next=21;break}for(n=n.left;n.right;)n=n.right;r=!0,e.next=27;break;case 21:if(!n.parent){e.next=26;break}r=n.parent.right===n,n=n.parent,e.next=27;break;case 26:return e.abrupt("break",37);case 27:e.next=35;break;case 29:if(!n.parent){e.next=34;break}r=n.parent.right===n,n=n.parent,e.next=35;break;case 34:return e.abrupt("break",37);case 35:e.next=11;break;case 37:return e.abrupt("return",null);case 38:case"end":return e.stop()}}),e,this)}))}]),e}();function SL(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return EL(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return EL(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function EL(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var TL=function(){function e(t,n){hM.default(this,e),this.value=t,this.revision=n||0}return vM.default(e,[{key:"isValid",get:function(){return!0}}]),e}(),RL=function(){function e(t){hM.default(this,e),this.revision=t}return vM.default(e,[{key:"isValid",get:function(){return!1}}]),e}(),IL=function(){function e(){hM.default(this,e),this.items=new _L}return vM.default(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new TL(t,n)),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.items.get(e);(!r||r.revision<t||r&&!0===n)&&this.items.set(e,new RL(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}},{key:"forEach",value:function(e){if(this.items){var t,n=SL(this.items);try{for(n.s();!(t=n.n()).done;){var r=EM.default(t.value,2),i=r[0],a=r[1];a.isValid&&e(i,a.value)}}catch(o){n.e(o)}finally{n.f()}}}}]),e}();function CL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}var OL=function(e){mM.default(y,e);var t,n,r,i,a,o,s,u,c,l,f,d,p,h,v=CL(y);function y(e,t,n){var r;hM.default(this,y);return(r=v.call(this,e,n)).updateMergingQueue=new dL((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new IL,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),r}return vM.default(y,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"_addOrUpdateItemOnServer",value:(h=pM.default(kM.default.mark((function e(t,n,r,i){var a,o;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={data:n},void 0!==i&&(a.ttl=i),e.next=4,this.services.network.post(t,a,r);case 4:return(o=e.sent).body.data=n,o.body.date_updated=new Date(o.body.date_updated),e.abrupt("return",o.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"push",value:(p=pM.default(kM.default.mark((function e(t,n){var r,i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n||{}).ttl,e.next=3,this._addOrUpdateItemOnServer(this.links.items,t,void 0,r);case 3:return i=e.sent,a=Number(i.index),this._handleItemMutated(a,i.url,i.last_event_id,i.revision,t,i.date_updated,i.date_expires,!0,!1),e.abrupt("return",this.cache.get(a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"set",value:(d=pM.default(kM.default.mark((function e(t,n,r){var i,a=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return a._updateItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"_updateItemUnconditionally",value:(f=pM.default(kM.default.mark((function e(t,n,r){var i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return i=e.sent,e.next=5,this._addOrUpdateItemOnServer(i.uri,n,void 0,r);case 5:return a=e.sent,this._handleItemMutated(t,a.url,a.last_event_id,a.revision,a.data,a.date_updated,a.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"_updateItemWithIfMatch",value:(l=pM.default(kM.default.mark((function e(t,n,r){var i,a,o,s;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(i=e.sent,!(a=n(zM(i.data)))){e.next=25;break}return o=i.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(i.uri,a,o,r);case 9:return s=e.sent,this._handleItemMutated(t,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,n,r));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=pM.default(kM.default.mark((function e(t,n,r){var i,a=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return a._updateItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=pM.default(kM.default.mark((function e(t){var n,r,i;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=zM(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:function(){var e=pM.default(kM.default.mark((function e(t){var n;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(o=pM.default(kM.default.mark((function e(t){var n;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new BM("No item with index ".concat(t," found"),404,54151);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"queryItems",value:function(){var e=pM.default(kM.default.mark((function e(t){var n,r,i,a,o=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new FM(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.index)?o._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(Number(e.index),new gL({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,data:e.data}),e.last_event_id),o.cache.get(e.index)})),a=r.body.meta,e.abrupt("return",new bL(i,(function(e){return o.queryItems({pageToken:e})}),a.previous_token,a.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(a=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return WM((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getContext",value:(i=pM.default(kM.default.mark((function e(){var t;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setTtl",value:(r=pM.default(kM.default.mark((function e(t){var n,r;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=pM.default(kM.default.mark((function e(t,n){var r,i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:a=e.sent,r.updateDateExpires(a.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,a,o,s,u){if(this.shouldIgnoreEvent(e,n))JM("Item ".concat(e," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(n));else{this._updateRootDateUpdated(a);var c=this.cache.get(e);if(!c){var l=new gL({index:e,uri:t,lastEventId:n,revision:r,data:i,dateUpdated:a,dateExpires:o});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=zM(c.data);c.update(n,r,i,a),this.cache.store(e,c,n),void 0!==o&&c.updateDateExpires(o),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",a={item:e,isLocal:!t};n||(a.previousItemData=r),this.broadcastEventToListeners(i,a)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,previousItemData:n})}},{key:"_handleContextUpdate",value:function(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(JM("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}],[{key:"type",get:function(){return"list"}}]),y}(lL),AL=function(e){mM.default(p,e);var t,n,r,i,a,o,s,u,c,l,f,d=CL(p);function p(e){var t;return hM.default(this,p),(t=d.call(this)).syncListImpl=e,t.syncListImpl.attach(yM.default(t)),t}return vM.default(p,[{key:"uri",get:function(){return this.syncListImpl.uri}},{key:"revision",get:function(){return this.syncListImpl.revision}},{key:"lastEventId",get:function(){return this.syncListImpl.lastEventId}},{key:"links",get:function(){return this.syncListImpl.links}},{key:"dateExpires",get:function(){return this.syncListImpl.dateExpires}},{key:"type",get:function(){return OL.type}},{key:"sid",get:function(){return this.syncListImpl.sid}},{key:"uniqueName",get:function(){return this.syncListImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncListImpl.dateUpdated}},{key:"push",value:(f=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.push(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"set",value:(l=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"mutate",value:(c=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"update",value:(u=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"remove",value:(s=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"get",value:(o=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getContext",value:(a=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getContext());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getItems",value:(i=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeList",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncListImpl.removeList());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){RM.default(bM.default(p.prototype),"close",this).call(this),this.syncListImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return OL.type}}]),p}(hL);wM.default(AL,"itemAdded","itemAdded"),wM.default(AL,"itemUpdated","itemUpdated"),wM.default(AL,"itemRemoved","itemRemoved"),wM.default(AL,"removed","removed"),CM([nM.validateTypesAsync(nM.pureObject,["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object,Object]),OM("design:returntype",Promise)],AL.prototype,"push",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger,nM.pureObject,["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Number,Object,Object]),OM("design:returntype",Promise)],AL.prototype,"set",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger,"function",["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Number,Function,Object]),OM("design:returntype",Promise)],AL.prototype,"mutate",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger,nM.pureObject,["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Number,Object,Object]),OM("design:returntype",Promise)],AL.prototype,"update",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],AL.prototype,"remove",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],AL.prototype,"get",null),CM([nM.validateTypesAsync(["undefined",nM.objectSchema("query options",{from:[nM.nonNegativeInteger,"undefined"],pageSize:[nM.custom((function(e){return[GM(e),"a positive integer"]})),"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],AL.prototype,"getItems",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],AL.prototype,"setTtl",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger,nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number,Number]),OM("design:returntype",Promise)],AL.prototype,"setItemTtl",null);var PL=function(){function e(t){hM.default(this,e),this.descriptor=t}return vM.default(e,[{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"data",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"update",value:function(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}}]),e}();function jL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}var ML=function(e){mM.default(h,e);var t,n,r,i,a,o,s,u,c,l,f,d,p=jL(h);function h(e,t,n){var r;hM.default(this,h);return(r=p.call(this,e,n)).updateMergingQueue=new dL((function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e})),r.cache=new IL,r.descriptor=t,r.descriptor.date_updated=new Date(r.descriptor.date_updated),t.items&&t.items.forEach((function(e){e.date_updated=new Date(e.date_updated),r.cache.store(e.key,new PL(e),e.last_event_id)})),r}return vM.default(h,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"set",value:(d=pM.default(kM.default.mark((function e(t,n,r){var i,a=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,(function(e){return a._putItemUnconditionally(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"get",value:function(){var e=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new BM("SyncMapItem key may not be empty",400,54209);case 2:if(!this.cache.has(t)){e.next=6;break}return e.abrupt("return",this.cache.get(t));case 6:return e.abrupt("return",this._getItemFromServer(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:(f=pM.default(kM.default.mark((function e(t){var n;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((n=e.sent).items.length<1)){e.next=7;break}throw new BM("The specified Map Item does not exist",404,54201);case 7:return e.abrupt("return",n.items[0]);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"mutate",value:(l=pM.default(kM.default.mark((function e(t,n,r){var i,a=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r||{},e.abrupt("return",this.updateMergingQueue.add(t,i,(function(e){return a._putItemWithIfMatch(t,n,e.ttl)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"update",value:(c=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,(function(e){return Object.assign(e,n)}),r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"_putItemUnconditionally",value:(u=pM.default(kM.default.mark((function e(t,n,r){var i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,n,void 0,r);case 2:return i=e.sent,a=i.item,this._handleItemMutated(a.key,a.url,a.last_event_id,a.revision,a.data,a.date_updated,a.date_expires,i.added,!1),e.abrupt("return",this.cache.get(a.key));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"_putItemWithIfMatch",value:(s=pM.default(kM.default.mark((function e(t,n,r){var i,a,o,s,u;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch((function(e){if(404===e.status)return new PL({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e}));case 2:if(i=e.sent,!(a=n(zM(i.data)))){e.next=26;break}return o=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,a,o,r);case 9:return s=e.sent,u=s.item,this._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,s.added,!1),e.abrupt("return",this.cache.get(u.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,n,r));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e,t,n){return s.apply(this,arguments)})},{key:"_putItemToServer",value:(o=pM.default(kM.default.mark((function e(t,n,r,i){var a,o,s,u,c;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new FM(this.links.items).pathSegment(t).build(),o={data:n},void 0!==i&&(o.ttl=i),e.prev=3,e.next=6,this.services.network.put(a,o,r);case 6:return s=e.sent,(u=s.body).data=n,u.date_updated=new Date(u.date_updated),c=201===s.status.code,e.abrupt("return",{added:c,item:u});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"remove",value:(a=pM.default(kM.default.mark((function e(t){var n,r,i;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return n=e.sent,r=zM(n.data),e.next=6,this.services.network.delete(n.uri);case 6:i=e.sent,this._handleItemRemoved(t,i.body.last_event_id,r,new Date(i.body.date_updated),!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"queryItems",value:function(){var e=pM.default(kM.default.mark((function e(t){var n,r,i,a,o=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},n=new FM(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(n);case 4:return r=e.sent,i=r.body.items.map((function(e){return e.date_updated=new Date(e.date_updated),o.cache.get(e.key)?o._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):o.cache.store(e.key,new PL(e),e.last_event_id),o.cache.get(e.key)})),a=r.body.meta,e.abrupt("return",new bL(i,(function(e){return o.queryItems({pageToken:e})}),a.previous_token,a.next_token));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:(i=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return WM((t=t||{}).pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,n,r,i,a,o,s,u){if(this.shouldIgnoreEvent(e,n))JM("SyncMapItem ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(a);var c=this.cache.get(e);if(!c){var l=new PL({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:a,date_expires:o});return this.cache.store(e,l,n),void this.emitItemMutationEvent(l,u,s)}var f=zM(c.data);c.update(n,r,i,a),this.cache.store(e,c,n),void 0!==o&&c.updateDateExpires(o),this.emitItemMutationEvent(c,u,!1,f)}}},{key:"emitItemMutationEvent",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n?"itemAdded":"itemUpdated",a={item:e,isLocal:!t};n||(a.previousItemData=r),this.broadcastEventToListeners(i,a)}},{key:"_handleItemRemoved",value:function(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,previousItemData:n})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}},{key:"setTtl",value:(r=pM.default(kM.default.mark((function e(t){var n,r;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=pM.default(kM.default.mark((function e(t,n){var r,i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,i={ttl:n},e.next=6,this.services.network.post(r.uri,i);case 6:a=e.sent,r.updateDateExpires(a.body.date_expires);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"type",get:function(){return"map"}}]),h}(lL),LL=function(e){mM.default(f,e);var t,n,r,i,a,o,s,u,c,l=jL(f);function f(e){var t;return hM.default(this,f),(t=l.call(this)).syncMapImpl=e,t.syncMapImpl.attach(yM.default(t)),t}return vM.default(f,[{key:"uri",get:function(){return this.syncMapImpl.uri}},{key:"links",get:function(){return this.syncMapImpl.links}},{key:"revision",get:function(){return this.syncMapImpl.revision}},{key:"lastEventId",get:function(){return this.syncMapImpl.lastEventId}},{key:"dateExpires",get:function(){return this.syncMapImpl.dateExpires}},{key:"type",get:function(){return ML.type}},{key:"sid",get:function(){return this.syncMapImpl.sid}},{key:"uniqueName",get:function(){return this.syncMapImpl.uniqueName}},{key:"dateUpdated",get:function(){return this.syncMapImpl.dateUpdated}},{key:"set",value:(c=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.set(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"get",value:(u=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.get(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"mutate",value:(s=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.mutate(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"update",value:(o=pM.default(kM.default.mark((function e(t,n,r){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.update(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"remove",value:(a=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.remove(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getItems",value:(i=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.getItems(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setTtl",value:(r=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setItemTtl",value:(n=pM.default(kM.default.mark((function e(t,n){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncMapImpl.setItemTtl(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"removeMap",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.next=3,this.syncMapImpl.removeMap();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){RM.default(bM.default(f.prototype),"close",this).call(this),this.syncMapImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return ML.type}}]),f}(hL);function NL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}wM.default(LL,"itemAdded","itemAdded"),wM.default(LL,"itemUpdated","itemUpdated"),wM.default(LL,"itemRemoved","itemRemoved"),wM.default(LL,"removed","removed"),CM([nM.validateTypesAsync("string",nM.pureObject,["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[String,Object,Object]),OM("design:returntype",Promise)],LL.prototype,"set",null),CM([nM.validateTypesAsync("string"),OM("design:type",Function),OM("design:paramtypes",[String]),OM("design:returntype",Promise)],LL.prototype,"get",null),CM([nM.validateTypesAsync("string","function",["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[String,Function,Object]),OM("design:returntype",Promise)],LL.prototype,"mutate",null),CM([nM.validateTypesAsync("string",nM.pureObject,["undefined",nM.objectSchema("item metadata",{ttl:[nM.nonNegativeInteger,"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[String,Object,Object]),OM("design:returntype",Promise)],LL.prototype,"update",null),CM([nM.validateTypesAsync("string"),OM("design:type",Function),OM("design:paramtypes",[String]),OM("design:returntype",Promise)],LL.prototype,"remove",null),CM([nM.validateTypesAsync(["undefined",nM.objectSchema("query options",{from:["string","undefined"],pageSize:[nM.custom((function(e){return[GM(e),"a positive integer"]})),"undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],LL.prototype,"getItems",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],LL.prototype,"setTtl",null),CM([nM.validateTypesAsync("string",nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[String,Number]),OM("design:returntype",Promise)],LL.prototype,"setItemTtl",null);var UL=function(e){mM.default(a,e);var t,n,r,i=NL(a);function a(e,t,n){var r;return hM.default(this,a),(r=i.call(this,e,n)).descriptor=t,r}return vM.default(a,[{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"publishMessage",value:(r=pM.default(kM.default.mark((function e(t){var n,r,i,a;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.next=3,this.services.network.post(this.links.messages,n);case 3:return r=e.sent,i=r.body,a=this._handleMessagePublished(i.sid,t,!1),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=pM.default(kM.default.mark((function e(t){var n,r;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={ttl:t},e.next=4,this.services.network.post(this.uri,n);case 4:r=e.sent,this.descriptor.date_expires=r.body.date_expires,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),404===e.t0.status&&this.onRemoved(!1),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,n){var r={sid:e,data:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}],[{key:"type",get:function(){return"stream"}}]),a}(lL);CM([nM.validateTypesAsync(nM.pureObject),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],UL.prototype,"publishMessage",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],UL.prototype,"setTtl",null);var FL=function(e){mM.default(a,e);var t,n,r,i=NL(a);function a(e){var t;return hM.default(this,a),(t=i.call(this)).syncStreamImpl=e,t.syncStreamImpl.attach(yM.default(t)),t}return vM.default(a,[{key:"uri",get:function(){return this.syncStreamImpl.uri}},{key:"links",get:function(){return this.syncStreamImpl.links}},{key:"dateExpires",get:function(){return this.syncStreamImpl.dateExpires}},{key:"type",get:function(){return UL.type}},{key:"lastEventId",get:function(){return null}},{key:"sid",get:function(){return this.syncStreamImpl.sid}},{key:"uniqueName",get:function(){return this.syncStreamImpl.uniqueName}},{key:"publishMessage",value:(r=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.publishMessage(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setTtl",value:(n=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.setTtl(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"removeStream",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.ensureNotClosed(),e.abrupt("return",this.syncStreamImpl.removeStream());case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){RM.default(bM.default(a.prototype),"close",this).call(this),this.syncStreamImpl.detach(this.listenerUuid)}}],[{key:"type",get:function(){return UL.type}}]),a}(hL);wM.default(FL,"messagePublished","messagePublished"),wM.default(FL,"removed","removed"),CM([nM.validateTypesAsync(nM.pureObject),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],FL.prototype,"publishMessage",null),CM([nM.validateTypesAsync(nM.nonNegativeInteger),OM("design:type",Function),OM("design:paramtypes",[Number]),OM("design:returntype",Promise)],FL.prototype,"setTtl",null);var DL=function e(t){hM.default(this,e),this.sdk="js",this.sdkVer=t,this.os=IM.os.family,this.osVer=IM.os.version,this.pl=IM.name,this.plVer=IM.version},BL=function(){function e(){hM.default(this,e),this.names=new Map,this.entities=new Map}return vM.default(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();function qL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}var zL=function(e){mM.default(n,e);var t=qL(n);function n(e,r,i,a){var o;return hM.default(this,n),(o=t.call(this,r,i)).descriptor=e,o.cache=new IL,a&&a.forEach((function(e){o.cache.store(e.key,{key:e.key,value:e.data},e.revision)})),o}return vM.default(n,[{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return n.type}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"onRemoved",value:function(){}},{key:"getItems",value:function(){var e={};return this.cache.forEach((function(t,n){e[t]=n.value})),e}},{key:"_update",value:function(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}},{key:"handleItemMutated",value:function(e,t,n){if(this.shouldIgnoreEvent(e,n))JM("Item ".concat(e," update skipped, revision: ").concat(n));else{var r={key:e,value:t};this.cache.store(e,r,n),this.broadcastEventToListeners("itemUpdated",r)}}},{key:"handleItemRemoved",value:function(e,t){var n=null===t;this.shouldIgnoreEvent(e,t)?JM("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,n),this.broadcastEventToListeners("itemRemoved",{key:e}))}},{key:"handleBatchUpdate",value:function(e){var t=this,n={};for(var r in null!=e&&e.forEach((function(e){n[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach((function(e,r){var i=n[e];null!=i?t.handleItemMutated(e,i.data,i.revision):t.handleItemRemoved(e,null),delete n[e]})),n)this.handleItemMutated(r,n[r].data,n[r].revision)}},{key:"shouldIgnoreEvent",value:function(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}],[{key:"type",get:function(){return"live_query"}}]),n}(lL);function WL(e){return GL.apply(this,arguments)}function GL(){return GL=pM.default(kM.default.mark((function e(t){var n,r,i,a,o,s;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.network,r=t.queryString,i=t.uri,a=t.type,null!=r){e.next=3;break}throw new BM("Invalid query",400,54507);case 3:return o={query_string:r},a===$L.type&&(o.type=a),e.next=7,n.post(i,o,void 0,!0);case 7:return s=e.sent,e.abrupt("return",s.body);case 9:case"end":return e.stop()}}),e)}))),GL.apply(this,arguments)}var $L=function(e){mM.default(n,e);var t=qL(n);function n(e){var r;return hM.default(this,n),(r=t.call(this)).liveQueryImpl=e,r.liveQueryImpl.attach(yM.default(r)),r}return vM.default(n,[{key:"type",get:function(){return zL.type}},{key:"lastEventId",get:function(){return this.liveQueryImpl.lastEventId}},{key:"sid",get:function(){return this.liveQueryImpl.sid}},{key:"close",value:function(){RM.default(bM.default(n.prototype),"close",this).call(this),this.liveQueryImpl.detach(this.listenerUuid)}},{key:"getItems",value:function(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}],[{key:"type",get:function(){return zL.type}}]),n}(hL);wM.default($L,"itemUpdated","itemUpdated"),wM.default($L,"itemRemoved","itemRemoved");var HL=function(e){mM.default(i,e);var t,n,r=qL(i);function i(e){var t;return hM.default(this,i),t=r.call(this),wM.default(yM.default(t),"queryExpression",null),wM.default(yM.default(t),"items",{}),Object.assign(yM.default(t),e),t.updateIndexName(e.indexName),t}return vM.default(i,[{key:"type",get:function(){return i.type}},{key:"search",value:(n=pM.default(kM.default.mark((function e(t){var n=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.items={},e.abrupt("return",WL({network:this.network,uri:this.queryUri,queryString:t}).then((function(e){n.queryExpression=t,e.items&&e.items.forEach((function(e){n.items[e.key]=e.data})),n.emit("searchResult",n.getItems())})).catch((function(e){throw YM("Error '".concat(e.message,"' while executing query '").concat(t,"'")),n.queryExpression=null,e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"subscribe",value:(t=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.queryExpression){e.next=2;break}return e.abrupt("return",Promise.reject(new BM("Invalid query",400,54507)));case 2:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getItems",value:function(){return this.items}},{key:"updateIndexName",value:function(e){this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new FM(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}],[{key:"type",get:function(){return"instant_query"}}]),i}(PM);wM.default(HL,"searchResult","searchResult"),CM([nM.validateTypesAsync("string"),OM("design:type",Function),OM("design:paramtypes",[String]),OM("design:returntype",Promise)],HL.prototype,"search",null),CM([nM.validateTypes(nM.nonEmptyString),OM("design:type",Function),OM("design:paramtypes",[String]),OM("design:returntype",void 0)],HL.prototype,"updateIndexName",null);function VL(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bM.default(e);if(t){var i=bM.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return gM.default(this,n)}}function JL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JL(Object(n),!0).forEach((function(t){wM.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var QL="3.1.0";function YL(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};var t=e.mode||(e.id?"open_or_create":"create_new");return KL(KL({},e),{},{mode:t})}return{mode:"create_new"}}var XL="com.twilio.rtd.cds.document",ZL="com.twilio.rtd.cds.list",eN="com.twilio.rtd.cds.map",tN="twilio.sync.event",nN=function(e){mM.default(m,e);var t,n,r,i,a,o,s,u,c,l,f,d,p,h,v,y=VL(m);function m(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(hM.default(this,m),t=y.call(this),!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")?VM(n.logLevel):VM("silent");var r=n.productId=n.productId||"data_sync";n.clientMetadata=n.clientMetadata||{},n.clientMetadata.hasOwnProperty("type")||(n.clientMetadata.type="sync"),n.clientMetadata.hasOwnProperty("sdk")||(n.clientMetadata.sdk="JS",n.clientMetadata.sdkv=QL);var i=!n.twilsockClient;if(!n.initRegistrations){var a=new rM.InitRegistration(r);m.populateInitRegistrations(a),n.initRegistrations=[a]}var o=n.twilsockClient=n.twilsockClient||new rM.Twilsock(e,r,n);o.on("tokenAboutToExpire",(function(e){return t.emit("tokenAboutToExpire",e)})),o.on("tokenExpired",(function(){return t.emit("tokenExpired")})),o.on("connectionError",(function(e){return t.emit("connectionError",e)})),o.on("stateChanged",(function(e){t.emit("connectionStateChanged",e),t.services.subscriptions.onConnectionStateChanged("connected"===e)})),o.on("message",(function(e,n){return t._routeMessage(e,n)}));var s=new XM(n),u=new oL(new DL(QL),s,o),c=new sL(s);return t.services={config:s,twilsock:o,network:u,storage:c,router:yM.default(t),subscriptions:null},t.services.subscriptions=new nL(t.services),t.entities=new BL,i&&o.connect(),t}return vM.default(m,[{key:"_routeMessage",value:function(e,t){switch(JM("Notification type:",e,"content:",t),e){case XL:case ZL:case eN:this.services.subscriptions.acceptMessage(t,!1);break;case tN:this.services.subscriptions.acceptMessage(t,!0)}}},{key:"_subscribe",value:function(e,t){this.services.subscriptions.add(e,t)}},{key:"_unsubscribe",value:function(e){this.services.subscriptions.remove(e)}},{key:"connectionState",get:function(){return this.services.twilsock.state}},{key:"ensureReady",value:(v=pM.default(kM.default.mark((function e(){var t;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),QM("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return v.apply(this,arguments)})},{key:"storeRootInSessionCache",value:function(e,t,n){if(this.services.config.sessionStorageEnabled&&t){var r=zM(n);e!==AL.type&&e!==LL.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:(h=pM.default(kM.default.mark((function e(t,n){var r,i,a,o=arguments;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]&&o[2],n){e.next=3;break}throw new BM("Cannot get entity without id",404);case 3:return i=new FM(t).pathSegment(n).queryParam("Include",r?"items":void 0).build(),e.next=6,this.services.network.get(i);case 6:return a=e.sent,e.abrupt("return",a.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"_createDocument",value:function(e,t,n){var r={unique_name:e,data:t||{}};return void 0!==n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then((function(e){return e.body.data=r.data,e.body}))}},{key:"_getDocument",value:(p=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(mL.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"_createList",value:function(e,t,n,r){var i={unique_name:e,purpose:t,context:n};return void 0!==r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then((function(e){return e.body}))}},{key:"_getList",value:(d=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(AL.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"_createMap",value:function(e,t){var n={unique_name:e};return void 0!==t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then((function(e){return e.body}))}},{key:"_getMap",value:(f=pM.default(kM.default.mark((function e(t){var n,r=arguments;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],e.abrupt("return",this.readRootFromSessionCache(LL.type,t)||this._get(this.services.config.mapsUri,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"_getStream",value:(l=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(FL.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"_createStream",value:(c=pM.default(kM.default.mark((function e(t,n){var r,i;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={unique_name:t},void 0!==n&&(r.ttl=n),e.next=4,this.services.network.post(this.services.config.streamsUri,r);case 4:return i=e.sent,e.abrupt("return",i.body);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache($L.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}},{key:"document",value:(u=pM.default(kM.default.mark((function e(t){var n,r,i,a,o=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=YL(t)).mode){e.next=9;break}return e.next=6,this._createDocument(n.id,n.data,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,mL.type))){e.next=14;break}return e.abrupt("return",new mL(i));case 14:return e.prev=14,e.next=17,this._getDocument(n.id);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createDocument(n.id,n.data,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.document(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(mL.type,n.id,r),a=new yL(this.services,r,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new mL(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return u.apply(this,arguments)})},{key:"map",value:(s=pM.default(kM.default.mark((function e(t){var n,r,i,a,o=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=YL(t)).mode){e.next=9;break}return e.next=6,this._createMap(n.id,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,LL.type))){e.next=14;break}return e.abrupt("return",new LL(i));case 14:return e.prev=14,e.next=17,this._getMap(n.id,n.includeItems);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createMap(n.id,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.map(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(LL.type,n.id,r),a=new ML(this.services,r,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new LL(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return s.apply(this,arguments)})},{key:"list",value:(o=pM.default(kM.default.mark((function e(t){var n,r,i,a,o=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=YL(t)).mode){e.next=9;break}return e.next=6,this._createList(n.id,n.purpose,n.context,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,AL.type))){e.next=14;break}return e.abrupt("return",new AL(i));case 14:return e.prev=14,e.next=17,this._getList(n.id);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createList(n.id,n.purpose,n.context,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.list(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(AL.type,n.id,r),a=new OL(this.services,r,(function(e,t,n){return o.removeFromCacheAndSession(e,t,n)})),a=this.entities.store(a),e.abrupt("return",new AL(a));case 43:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return o.apply(this,arguments)})},{key:"stream",value:(a=pM.default(kM.default.mark((function e(t){var n,r,i,a,o,s=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if("create_new"!==(n=YL(t)).mode){e.next=9;break}return e.next=6,this._createStream(n.id,n.ttl);case 6:case 17:case 29:r=e.sent,e.next=39;break;case 9:if(!(i=this.getCached(n.id,FL.type))){e.next=14;break}return e.abrupt("return",new FL(i));case 14:return e.prev=14,e.next=17,this._getStream(n.id);case 20:if(e.prev=20,e.t0=e.catch(14),404===e.t0.status&&"open_existing"!==n.mode){e.next=26;break}throw e.t0;case 26:return e.prev=26,e.next=29,this._createStream(n.id,n.ttl);case 32:if(e.prev=32,e.t1=e.catch(26),409!==e.t1.status){e.next=38;break}return e.abrupt("return",this.stream(t));case 38:throw e.t1;case 39:return this.storeRootInSessionCache(FL.type,n.id,r),a=function(e,t,n){return s.removeFromCacheAndSession(e,t,n)},o=new UL(this.services,r,a),o=this.entities.store(o),e.abrupt("return",new FL(o));case 44:case"end":return e.stop()}}),e,this,[[14,20],[26,32]])}))),function(e){return a.apply(this,arguments)})},{key:"shutdown",value:(i=pM.default(kM.default.mark((function e(){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateToken",value:(r=pM.default(kM.default.mark((function e(t){return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.twilsock.updateToken(t).catch((function(e){var t,n=null==e||null===(t=e.reply)||void 0===t?void 0:t.status;if(401===(null==n?void 0:n.code)&&"UNAUTHORIZED"===(null==n?void 0:n.status))throw new BM("Updated token was rejected by server",400,51130);throw e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"liveQuery",value:(n=pM.default(kM.default.mark((function e(t,n){var r,i,a,o,s,u=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return r=new FM(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),e.next=5,WL({network:this.services.network,uri:r,queryString:n,type:$L.type});case 5:return i=e.sent,(a=this.getCached(i.query_id,$L.type))||((o=this._getLiveQuery(i.query_id))||(o={indexName:t,queryExpression:n,sid:i.query_id,queryUri:r,last_event_id:i.last_event_id}),s=function(e,t,n){return u.removeFromCacheAndSession(e,t,n)},a=new zL(o,this.services,s,i.items)),this.storeRootInSessionCache($L.type,i.query_id,a.liveQueryDescriptor),a=this.entities.store(a),e.abrupt("return",new $L(a));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"instantQuery",value:(t=pM.default(kM.default.mark((function e(t){var n,r=this;return kM.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return n=function(e,t){return r.liveQuery(e,t)},e.abrupt("return",new HL({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:n}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([tN,XL,ZL,eN])}},{key:"version",get:function(){return QL}}]),m}(PM);wM.default(nN,"connectionStateChanged","connectionStateChanged"),wM.default(nN,"connectionError","connectionError"),wM.default(nN,"tokenAboutToExpire","tokenAboutToExpire"),wM.default(nN,"tokenExpired","tokenExpired"),CM([nM.validateTypesAsync(["undefined","string",nM.objectSchema("open document options",{id:["string","undefined"],mode:[nM.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[nM.nonNegativeInteger,"undefined"],data:[nM.pureObject,"undefined",nM.literal(null)]})]),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],nN.prototype,"document",null),CM([nM.validateTypesAsync(["undefined","string",nM.objectSchema("open map options",{id:["string","undefined"],mode:[nM.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[nM.nonNegativeInteger,"undefined"],data:[nM.pureObject,"undefined",nM.literal(null)],includeItems:["boolean","undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],nN.prototype,"map",null),CM([nM.validateTypesAsync(["undefined","string",nM.objectSchema("open list options",{id:["string","undefined"],mode:[nM.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[nM.nonNegativeInteger,"undefined"],data:[nM.pureObject,"undefined",nM.literal(null)],purpose:["string","undefined"],context:[nM.pureObject,"undefined"],includeItems:["boolean","undefined"]})]),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],nN.prototype,"list",null),CM([nM.validateTypesAsync(["undefined","string",nM.objectSchema("open stream options",{id:["string","undefined"],mode:[nM.literal("open_or_create","open_existing","create_new"),"undefined"],ttl:[nM.nonNegativeInteger,"undefined"],data:[nM.pureObject,"undefined",nM.literal(null)]})]),OM("design:type",Function),OM("design:paramtypes",[Object]),OM("design:returntype",Promise)],nN.prototype,"stream",null),CM([nM.validateTypesAsync(nM.nonEmptyString),OM("design:type",Function),OM("design:paramtypes",[String]),OM("design:returntype",Promise)],nN.prototype,"updateToken",null),CM([nM.validateTypesAsync(nM.nonEmptyString,"string"),OM("design:type",Function),OM("design:paramtypes",[String,String]),OM("design:returntype",Promise)],nN.prototype,"liveQuery",null),CM([nM.validateTypesAsync(nM.nonEmptyString),OM("design:type",Function),OM("design:paramtypes",[String]),OM("design:returntype",Promise)],nN.prototype,"instantQuery",null),dj.Client=nN,dj.InsightsItem=function e(){hM.default(this,e)},dj.InstantQuery=HL,dj.LiveQuery=$L,dj.Paginator=bL,dj.SyncClient=nN,dj.SyncDocument=mL,dj.SyncList=AL,dj.SyncListItem=gL,dj.SyncMap=LL,dj.SyncMapItem=PL,dj.SyncStream=FL;var rN,iN={},aN=V,oN=A,sN=st("match"),uN=function(e){var t;return aN(e)&&(void 0!==(t=e[sN])?!!t:"RegExp"===oN(e))},cN=TypeError,lN=function(e){if(uN(e))throw new cN("The method doesn't accept regular expressions");return e},fN=st("match"),dN=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[fN]=!1,"/./"[e](t)}catch(r){}}return!1},pN=si,hN=go,vN=c.f,yN=yr,mN=Va,gN=lN,bN=B,wN=dN,kN=hN("".slice),xN=Math.min,_N=wN("startsWith");pN({target:"String",proto:!0,forced:!!(_N||(rN=vN(String.prototype,"startsWith"),!rN||rN.writable))&&!_N},{startsWith:function(e){var t=mN(bN(this));gN(e);var n=yN(xN(arguments.length>1?arguments[1]:void 0,t.length)),r=mN(e);return kN(t,n,n+r.length)===r}});var SN=l,EN=f,TN=st("iterator"),RN=!SN((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),n.delete("b",void 0),!t.size&&!EN||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[TN]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("https://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host})),IN=R,CN=2147483647,ON=/[^\0-\u007E]/,AN=/[.\u3002\uFF0E\uFF61]/g,PN="Overflow: input needs wider integers to process",jN=RangeError,MN=IN(AN.exec),LN=Math.floor,NN=String.fromCharCode,UN=IN("".charCodeAt),FN=IN([].join),DN=IN([].push),BN=IN("".replace),qN=IN("".split),zN=IN("".toLowerCase),WN=function(e){return e+22+75*(e<26)},GN=function(e,t,n){var r=0;for(e=n?LN(e/700):e>>1,e+=LN(e/t);e>455;)e=LN(e/35),r+=36;return LN(r+36*e/(e+38))},$N=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=UN(e,n++);if(i>=55296&&i<=56319&&n<r){var a=UN(e,n++);56320==(64512&a)?DN(t,((1023&i)<<10)+(1023&a)+65536):(DN(t,i),n--)}else DN(t,i)}return t}(e);var n,r,i=e.length,a=128,o=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&DN(t,NN(r));var u=t.length,c=u;for(u&&DN(t,"-");c<i;){var l=CN;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<l&&(l=r);var f=c+1;if(l-a>LN((CN-o)/f))throw new jN(PN);for(o+=(l-a)*f,a=l,n=0;n<e.length;n++){if((r=e[n])<a&&++o>CN)throw new jN(PN);if(r===a){for(var d=o,p=36;;){var h=p<=s?1:p>=s+26?26:p-s;if(d<h)break;var v=d-h,y=36-h;DN(t,NN(WN(h+v%y))),d=LN(v/y),p+=36}DN(t,NN(WN(d))),s=GN(o,f,c===u),o=0,c++}}o++,a++}return FN(t,"")},HN=si,VN=u,JN=Hl,KN=v,QN=R,YN=f,XN=RN,ZN=ir,eU=no,tU=Yx,nU=fi,rU=Rv,iU=Ln,aU=sl,oU=$,sU=Ve,uU=xo,cU=Di,lU=Dt,fU=V,dU=Va,pU=Ia,hU=x,vU=Xd,yU=$d,mU=Jv,gU=hl,bU=ZO,wU=st("iterator"),kU="URLSearchParams",xU=kU+"Iterator",_U=iU.set,SU=iU.getterFor(kU),EU=iU.getterFor(xU),TU=JN("fetch"),RU=JN("Request"),IU=JN("Headers"),CU=RU&&RU.prototype,OU=IU&&IU.prototype,AU=VN.RegExp,PU=VN.TypeError,jU=VN.decodeURIComponent,MU=VN.encodeURIComponent,LU=QN("".charAt),NU=QN([].join),UU=QN([].push),FU=QN("".replace),DU=QN([].shift),BU=QN([].splice),qU=QN("".split),zU=QN("".slice),WU=/\+/g,GU=Array(4),$U=function(e){return GU[e-1]||(GU[e-1]=AU("((?:%[\\da-f]{2}){"+e+"})","gi"))},HU=function(e){try{return jU(e)}catch(NB){return e}},VU=function(e){var t=FU(e,WU," "),n=4;try{return jU(t)}catch(NB){for(;n;)t=FU(t,$U(n--),HU);return t}},JU=/[!'()~]|%20/g,KU={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},QU=function(e){return KU[e]},YU=function(e){return FU(MU(e),JU,QU)},XU=rU((function(e,t){_U(this,{type:xU,target:SU(e).entries,index:0,kind:t})}),kU,(function(){var e=EU(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,mU(void 0,!0);var r=t[n];switch(e.kind){case"keys":return mU(r.key,!1);case"values":return mU(r.value,!1)}return mU([r.key,r.value],!1)}),!0),ZU=function(e){this.entries=[],this.url=null,void 0!==e&&(fU(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===LU(e,0)?zU(e,1):e:dU(e)))};ZU.prototype={type:kU,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,o,s,u=this.entries,c=yU(e);if(c)for(n=(t=vU(e,c)).next;!(r=KN(n,t)).done;){if(a=(i=vU(lU(r.value))).next,(o=KN(a,i)).done||(s=KN(a,i)).done||!KN(a,i).done)throw new PU("Expected sequence with length 2");UU(u,{key:dU(o.value),value:dU(s.value)})}else for(var l in e)sU(e,l)&&UU(u,{key:l,value:dU(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=qU(e,"&"),a=0;a<i.length;)(t=i[a++]).length&&(n=qU(t,"="),UU(r,{key:VU(DU(n)),value:VU(NU(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],UU(n,YU(e.key)+"="+YU(e.value));return NU(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var eF=function(){aU(this,tF);var e=_U(this,new ZU(arguments.length>0?arguments[0]:void 0));YN||(this.size=e.entries.length)},tF=eF.prototype;if(tU(tF,{append:function(e,t){var n=SU(this);gU(arguments.length,2),UU(n.entries,{key:dU(e),value:dU(t)}),YN||this.length++,n.updateURL()},delete:function(e){for(var t=SU(this),n=gU(arguments.length,1),r=t.entries,i=dU(e),a=n<2?void 0:arguments[1],o=void 0===a?a:dU(a),s=0;s<r.length;){var u=r[s];if(u.key!==i||void 0!==o&&u.value!==o)s++;else if(BU(r,s,1),void 0!==o)break}YN||(this.size=r.length),t.updateURL()},get:function(e){var t=SU(this).entries;gU(arguments.length,1);for(var n=dU(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=SU(this).entries;gU(arguments.length,1);for(var n=dU(e),r=[],i=0;i<t.length;i++)t[i].key===n&&UU(r,t[i].value);return r},has:function(e){for(var t=SU(this).entries,n=gU(arguments.length,1),r=dU(e),i=n<2?void 0:arguments[1],a=void 0===i?i:dU(i),o=0;o<t.length;){var s=t[o++];if(s.key===r&&(void 0===a||s.value===a))return!0}return!1},set:function(e,t){var n=SU(this);gU(arguments.length,1);for(var r,i=n.entries,a=!1,o=dU(e),s=dU(t),u=0;u<i.length;u++)(r=i[u]).key===o&&(a?BU(i,u--,1):(a=!0,r.value=s));a||UU(i,{key:o,value:s}),YN||(this.size=i.length),n.updateURL()},sort:function(){var e=SU(this);bU(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=SU(this).entries,r=uU(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new XU(this,"keys")},values:function(){return new XU(this,"values")},entries:function(){return new XU(this,"entries")}},{enumerable:!0}),ZN(tF,wU,tF.entries,{name:"entries"}),ZN(tF,"toString",(function(){return SU(this).serialize()}),{enumerable:!0}),YN&&eU(tF,"size",{get:function(){return SU(this).entries.length},configurable:!0,enumerable:!0}),nU(eF,kU),HN({global:!0,constructor:!0,forced:!XN},{URLSearchParams:eF}),!XN&&oU(IU)){var nF=QN(OU.has),rF=QN(OU.set),iF=function(e){if(fU(e)){var t,n=e.body;if(cU(n)===kU)return t=e.headers?new IU(e.headers):new IU,nF(t,"content-type")||rF(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),pU(e,{body:hU(0,dU(n)),headers:hU(0,t)})}return e};if(oU(TU)&&HN({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return TU(e,arguments.length>1?iF(arguments[1]):{})}}),oU(RU)){var aF=function(e){return aU(this,CU),new RU(e,arguments.length>1?iF(arguments[1]):{})};CU.constructor=aF,aF.prototype=CU,HN({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:aF})}}var oF,sF=si,uF=f,cF=RN,lF=u,fF=xo,dF=R,pF=ir,hF=no,vF=sl,yF=Ve,mF=lj,gF=Wh,bF=bi,wF=nv.codeAt,kF=function(e){var t,n,r=[],i=qN(BN(zN(e),AN,"."),".");for(t=0;t<i.length;t++)n=i[t],DN(r,MN(ON,n)?"xn--"+$N(n):n);return FN(r,".")},xF=Va,_F=fi,SF=hl,EF={URLSearchParams:eF,getState:SU},TF=Ln,RF=TF.set,IF=TF.getterFor("URL"),CF=EF.URLSearchParams,OF=EF.getState,AF=lF.URL,PF=lF.TypeError,jF=lF.parseInt,MF=Math.floor,LF=Math.pow,NF=dF("".charAt),UF=dF(/./.exec),FF=dF([].join),DF=dF(1..toString),BF=dF([].pop),qF=dF([].push),zF=dF("".replace),WF=dF([].shift),GF=dF("".split),$F=dF("".slice),HF=dF("".toLowerCase),VF=dF([].unshift),JF="Invalid scheme",KF="Invalid host",QF="Invalid port",YF=/[a-z]/i,XF=/[\d+-.a-z]/i,ZF=/\d/,eD=/^0x/i,tD=/^[0-7]+$/,nD=/^\d+$/,rD=/^[\da-f]+$/i,iD=/[\0\t\n\r #%/:<>?@[\\\]^|]/,aD=/[\0\t\n\r #/:<>?@[\\\]^|]/,oD=/^[\u0000-\u0020]+/,sD=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,uD=/[\t\n\r]/g,cD=function(t){var n,r,i,a;if("number"==typeof t){for(n=[],r=0;r<4;r++)VF(n,t%256),t=MF(t/256);return FF(n,".")}if("object"==e(t)){for(n="",i=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n?r:t}(t),r=0;r<8;r++)a&&0===t[r]||(a&&(a=!1),i===r?(n+=r?":":"::",a=!0):(n+=DF(t[r],16),r<7&&(n+=":")));return"["+n+"]"}return t},lD={},fD=mF({},lD,{" ":1,'"':1,"<":1,">":1,"`":1}),dD=mF({},fD,{"#":1,"?":1,"{":1,"}":1}),pD=mF({},dD,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),hD=function(e,t){var n=wF(e,0);return n>32&&n<127&&!yF(t,e)?e:encodeURIComponent(e)},vD={ftp:21,file:null,http:80,https:443,ws:80,wss:443},yD=function(e,t){var n;return 2===e.length&&UF(YF,NF(e,0))&&(":"===(n=NF(e,1))||!t&&"|"===n)},mD=function(e){var t;return e.length>1&&yD($F(e,0,2))&&(2===e.length||"/"===(t=NF(e,2))||"\\"===t||"?"===t||"#"===t)},gD=function(e){return"."===e||"%2e"===HF(e)},bD={},wD={},kD={},xD={},_D={},SD={},ED={},TD={},RD={},ID={},CD={},OD={},AD={},PD={},jD={},MD={},LD={},ND={},UD={},FD={},DD={},BD=function(e,t,n){var r,i,a,o=xF(e);if(t){if(i=this.parse(o))throw new PF(i);this.searchParams=null}else{if(void 0!==n&&(r=new BD(n,!0)),i=this.parse(o,null,r))throw new PF(i);(a=OF(new CF)).bindURL(this),this.searchParams=a}};BD.prototype={type:"URL",parse:function(e,t,n){var r,i,a,o,s,u=this,c=t||bD,l=0,f="",d=!1,p=!1,h=!1;for(e=xF(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=zF(e,oD,""),e=zF(e,sD,"$1")),e=zF(e,uD,""),r=gF(e);l<=r.length;){switch(i=r[l],c){case bD:if(!i||!UF(YF,i)){if(t)return JF;c=kD;continue}f+=HF(i),c=wD;break;case wD:if(i&&(UF(XF,i)||"+"===i||"-"===i||"."===i))f+=HF(i);else{if(":"!==i){if(t)return JF;f="",c=kD,l=0;continue}if(t&&(u.isSpecial()!==yF(vD,f)||"file"===f&&(u.includesCredentials()||null!==u.port)||"file"===u.scheme&&!u.host))return;if(u.scheme=f,t)return void(u.isSpecial()&&vD[u.scheme]===u.port&&(u.port=null));f="","file"===u.scheme?c=PD:u.isSpecial()&&n&&n.scheme===u.scheme?c=xD:u.isSpecial()?c=TD:"/"===r[l+1]?(c=_D,l++):(u.cannotBeABaseURL=!0,qF(u.path,""),c=UD)}break;case kD:if(!n||n.cannotBeABaseURL&&"#"!==i)return JF;if(n.cannotBeABaseURL&&"#"===i){u.scheme=n.scheme,u.path=bF(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,c=DD;break}c="file"===n.scheme?PD:SD;continue;case xD:if("/"!==i||"/"!==r[l+1]){c=SD;continue}c=RD,l++;break;case _D:if("/"===i){c=ID;break}c=ND;continue;case SD:if(u.scheme=n.scheme,i===oF)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=bF(n.path),u.query=n.query;else if("/"===i||"\\"===i&&u.isSpecial())c=ED;else if("?"===i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=bF(n.path),u.query="",c=FD;else{if("#"!==i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=bF(n.path),u.path.length--,c=ND;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=bF(n.path),u.query=n.query,u.fragment="",c=DD}break;case ED:if(!u.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,c=ND;continue}c=ID}else c=RD;break;case TD:if(c=RD,"/"!==i||"/"!==NF(f,l+1))continue;l++;break;case RD:if("/"!==i&&"\\"!==i){c=ID;continue}break;case ID:if("@"===i){d&&(f="%40"+f),d=!0,a=gF(f);for(var v=0;v<a.length;v++){var y=a[v];if(":"!==y||h){var m=hD(y,pD);h?u.password+=m:u.username+=m}else h=!0}f=""}else if(i===oF||"/"===i||"?"===i||"#"===i||"\\"===i&&u.isSpecial()){if(d&&""===f)return"Invalid authority";l-=gF(f).length+1,f="",c=CD}else f+=i;break;case CD:case OD:if(t&&"file"===u.scheme){c=MD;continue}if(":"!==i||p){if(i===oF||"/"===i||"?"===i||"#"===i||"\\"===i&&u.isSpecial()){if(u.isSpecial()&&""===f)return KF;if(t&&""===f&&(u.includesCredentials()||null!==u.port))return;if(o=u.parseHost(f))return o;if(f="",c=LD,t)return;continue}"["===i?p=!0:"]"===i&&(p=!1),f+=i}else{if(""===f)return KF;if(o=u.parseHost(f))return o;if(f="",c=AD,t===OD)return}break;case AD:if(!UF(ZF,i)){if(i===oF||"/"===i||"?"===i||"#"===i||"\\"===i&&u.isSpecial()||t){if(""!==f){var g=jF(f,10);if(g>65535)return QF;u.port=u.isSpecial()&&g===vD[u.scheme]?null:g,f=""}if(t)return;c=LD;continue}return QF}f+=i;break;case PD:if(u.scheme="file","/"===i||"\\"===i)c=jD;else{if(!n||"file"!==n.scheme){c=ND;continue}switch(i){case oF:u.host=n.host,u.path=bF(n.path),u.query=n.query;break;case"?":u.host=n.host,u.path=bF(n.path),u.query="",c=FD;break;case"#":u.host=n.host,u.path=bF(n.path),u.query=n.query,u.fragment="",c=DD;break;default:mD(FF(bF(r,l),""))||(u.host=n.host,u.path=bF(n.path),u.shortenPath()),c=ND;continue}}break;case jD:if("/"===i||"\\"===i){c=MD;break}n&&"file"===n.scheme&&!mD(FF(bF(r,l),""))&&(yD(n.path[0],!0)?qF(u.path,n.path[0]):u.host=n.host),c=ND;continue;case MD:if(i===oF||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&yD(f))c=ND;else if(""===f){if(u.host="",t)return;c=LD}else{if(o=u.parseHost(f))return o;if("localhost"===u.host&&(u.host=""),t)return;f="",c=LD}continue}f+=i;break;case LD:if(u.isSpecial()){if(c=ND,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==oF&&(c=ND,"/"!==i))continue}else u.fragment="",c=DD;else u.query="",c=FD;break;case ND:if(i===oF||"/"===i||"\\"===i&&u.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(s=HF(s=f))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"===i||"\\"===i&&u.isSpecial()||qF(u.path,"")):gD(f)?"/"===i||"\\"===i&&u.isSpecial()||qF(u.path,""):("file"===u.scheme&&!u.path.length&&yD(f)&&(u.host&&(u.host=""),f=NF(f,0)+":"),qF(u.path,f)),f="","file"===u.scheme&&(i===oF||"?"===i||"#"===i))for(;u.path.length>1&&""===u.path[0];)WF(u.path);"?"===i?(u.query="",c=FD):"#"===i&&(u.fragment="",c=DD)}else f+=hD(i,dD);break;case UD:"?"===i?(u.query="",c=FD):"#"===i?(u.fragment="",c=DD):i!==oF&&(u.path[0]+=hD(i,lD));break;case FD:t||"#"!==i?i!==oF&&("'"===i&&u.isSpecial()?u.query+="%27":u.query+="#"===i?"%23":hD(i,lD)):(u.fragment="",c=DD);break;case DD:i!==oF&&(u.fragment+=hD(i,fD))}l++}},parseHost:function(e){var t,n,r;if("["===NF(e,0)){if("]"!==NF(e,e.length-1))return KF;if(t=function(e){var t,n,r,i,a,o,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,f=0,d=function(){return NF(e,f)};if(":"===d()){if(":"!==NF(e,1))return;f+=2,l=++c}for(;d();){if(8===c)return;if(":"!==d()){for(t=n=0;n<4&&UF(rD,d());)t=16*t+jF(d(),16),f++,n++;if("."===d()){if(0===n)return;if(f-=n,c>6)return;for(r=0;d();){if(i=null,r>0){if(!("."===d()&&r<4))return;f++}if(!UF(ZF,d()))return;for(;UF(ZF,d());){if(a=jF(d(),10),null===i)i=a;else{if(0===i)return;i=10*i+a}if(i>255)return;f++}u[c]=256*u[c]+i,2!=++r&&4!==r||c++}if(4!==r)return;break}if(":"===d()){if(f++,!d())return}else if(d())return;u[c++]=t}else{if(null!==l)return;f++,l=++c}}if(null!==l)for(o=c-l,c=7;0!==c&&o>0;)s=u[c],u[c--]=u[l+o-1],u[l+--o]=s;else if(8!==c)return;return u}($F(e,1,-1)),!t)return KF;this.host=t}else if(this.isSpecial()){if(e=kF(e),UF(iD,e))return KF;if(t=function(e){var t,n,r,i,a,o,s,u=GF(e,".");if(u.length&&""===u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=u[r]))return e;if(a=10,i.length>1&&"0"===NF(i,0)&&(a=UF(eD,i)?16:8,i=$F(i,8===a?1:2)),""===i)o=0;else{if(!UF(10===a?nD:8===a?tD:rD,i))return e;o=jF(i,a)}qF(n,o)}for(r=0;r<t;r++)if(o=n[r],r===t-1){if(o>=LF(256,5-t))return null}else if(o>255)return null;for(s=BF(n),r=0;r<n.length;r++)s+=n[r]*LF(256,3-r);return s}(e),null===t)return KF;this.host=t}else{if(UF(aD,e))return KF;for(t="",n=gF(e),r=0;r<n.length;r++)t+=hD(n[r],lD);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return yF(vD,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&yD(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=cD(i),null!==a&&(c+=":"+a)):"file"===t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+FF(o,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw new PF(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new qD(e.path[0]).origin}catch(NB){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+cD(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(xF(e)+":",bD)},getUsername:function(){return this.username},setUsername:function(e){var t=gF(xF(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=hD(t[n],pD)}},getPassword:function(){return this.password},setPassword:function(e){var t=gF(xF(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=hD(t[n],pD)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?cD(e):cD(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,CD)},getHostname:function(){var e=this.host;return null===e?"":cD(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,OD)},getPort:function(){var e=this.port;return null===e?"":xF(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=xF(e))?this.port=null:this.parse(e,AD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+FF(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,LD))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=xF(e))?this.query=null:("?"===NF(e,0)&&(e=$F(e,1)),this.query="",this.parse(e,FD)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=xF(e))?("#"===NF(e,0)&&(e=$F(e,1)),this.fragment="",this.parse(e,DD)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var qD=function(e){var t=vF(this,zD),n=SF(arguments.length,1)>1?arguments[1]:void 0,r=RF(t,new BD(e,!1,n));uF||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},zD=qD.prototype,WD=function(e,t){return{get:function(){return IF(this)[e]()},set:t&&function(e){return IF(this)[t](e)},configurable:!0,enumerable:!0}};if(uF&&(hF(zD,"href",WD("serialize","setHref")),hF(zD,"origin",WD("getOrigin")),hF(zD,"protocol",WD("getProtocol","setProtocol")),hF(zD,"username",WD("getUsername","setUsername")),hF(zD,"password",WD("getPassword","setPassword")),hF(zD,"host",WD("getHost","setHost")),hF(zD,"hostname",WD("getHostname","setHostname")),hF(zD,"port",WD("getPort","setPort")),hF(zD,"pathname",WD("getPathname","setPathname")),hF(zD,"search",WD("getSearch","setSearch")),hF(zD,"searchParams",WD("getSearchParams")),hF(zD,"hash",WD("getHash","setHash"))),pF(zD,"toJSON",(function(){return IF(this).serialize()}),{enumerable:!0}),pF(zD,"toString",(function(){return IF(this).serialize()}),{enumerable:!0}),AF){var GD=AF.createObjectURL,$D=AF.revokeObjectURL;GD&&pF(qD,"createObjectURL",fF(GD,AF)),$D&&pF(qD,"revokeObjectURL",fF($D,AF))}_F(qD,"URL"),sF({global:!0,constructor:!0,forced:!cF,sham:!uF},{URL:qD}),
/*
      @license
      Copyright (c) 2018, Twilio, Inc.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted, provided that the above
      copyright notice and this permission notice appear in all copies.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
      WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
      MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
      SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
      WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
      OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
      CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

      */
function(t){var n=void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};Object.defineProperty(t,"__esModule",{value:!0});var r=Ic,i=hc,a=gc,o=wc,s=dP,u=Tc,c=uc,l=ph,f=mc,d=iy,p=p_,h=mb;function v(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}function y(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var m=v(Oc),g=v(r),b=v(i),w=v(a),k=v(o),x=v(s),_=v(u),S=v(c),E=v(l),T=v(f),R=y(d),I={exports:{}},C="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(C){var O=new Uint8Array(16);I.exports=function(){return C(O),O}}else{var A=new Array(16);I.exports=function(){for(var e,t=0;t<16;t++)3&t||(e=4294967296*Math.random()),A[t]=e>>>((3&t)<<3)&255;return A}}for(var P=[],j=0;j<256;++j)P[j]=(j+256).toString(16).substr(1);var M,L,N=function(e,t){var n=t||0,r=P;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},U=I.exports,F=N,D=0,B=0;var q=function(e,t,n){var r=t&&n||0,i=t||[],a=(e=e||{}).node||M,o=void 0!==e.clockseq?e.clockseq:L;if(null==a||null==o){var s=U();null==a&&(a=M=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=L=16383&(s[6]<<8|s[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:B+1,l=u-D+(c-B)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||u>D)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");D=u,B=c,L=o;var f=(1e4*(268435455&(u+=122192928e5))+c)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=255&f;var d=u/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=255&d,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var p=0;p<6;++p)i[r+p]=a[p];return t||F(i)},z=I.exports,W=N;var G=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||z)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[r+a]=i[a];return t||W(i)},$=q,H=G,V=H;V.v1=$,V.v4=H;var J=V;function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k.default(e);if(t){var i=k.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w.default(this,n)}}var Q=function(e){b.default(n,e);var t=K(n);function n(e){var r;m.default(this,n);var i,a=J.v4();return(r=t.call(this,(function(t,r){return i=r,e((function(e){n.cancellationMap.delete(a),t(e)}),(function(e){n.cancellationMap.delete(a),r(e)}),(function(e){n.cancellationMap.set(a,e)}))}))).id=a,r.rejectPromise=i,r}return g.default(n,[{key:"cancel",value:function(){var e=n.cancellationMap.get(this.id);return null==e||e(),this.rejectPromise&&(this.catch((function(){})),this.rejectPromise(new Error("Promise was cancelled"))),this}}]),n}(x.default(Promise));function Y(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":T.default(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function X(e,t){if("object"===("undefined"==typeof Reflect?"undefined":T.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Z(e,t){return["".concat((new Date).toISOString()," MCS Client ").concat(e,":")].concat(Array.from(t))}_.default(Q,"cancellationMap",new Map);var ee=function(){function e(t){m.default(this,e),_.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?t+" ":""}return g.default(e,[{key:"setLevel",value:function(e){R.setLevel(e)}},{key:"trace",value:function(){if(R.getLevel()==R.levels.TRACE){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.debug.apply(null,Z(this.prefix+"T",t))}}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.debug.apply(null,Z(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.info.apply(null,Z(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.warn.apply(null,Z(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.error.apply(null,Z(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){R.setLevel(e)}},{key:"trace",value:function(){if(R.getLevel()==R.levels.TRACE){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.debug.apply(null,Z("T",t))}}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.debug.apply(null,Z("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.info.apply(null,Z("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.warn.apply(null,Z("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R.error.apply(null,Z("E",t))}}]),e}(),te=!0,ne=function(e,t){return"".concat((n=e,n.startsWith("http")?"":function(e){return"https://mcs.".concat(null!=e?e:"us1",".twilio.com")}(t))).concat(e);var n},re=function(){function e(t,n,r,i){var a,o,s,u,c,l;m.default(this,e);var f=null!==(a=null!==(o=i.MCS)&&void 0!==o?o:i)&&void 0!==a?a:{};this.region=null!==(s=null!==(u=f.region)&&void 0!==u?u:i.region)&&void 0!==s?s:"us1",this.mediaUrl=ne(n,this.region),this.mediaSetUrl=r?ne(r):"".concat(this.mediaUrl,"Set"),this.token=t,this.retryWhenThrottledOverride=null!==(c=f.retryWhenThrottledOverride)&&void 0!==c?c:te,this.backoffConfigOverride=null!==(l=f.backoffConfigOverride)&&void 0!==l?l:e.backoffConfigDefault}return g.default(e,[{key:"updateToken",value:function(e){this.token=e}}],[{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}},{key:"retryWhenThrottledDefault",get:function(){return te}}]),e}(),ie=function(){function e(t,n,r){m.default(this,e),this.config=t,this.network=n,this._update(r)}return g.default(e,[{key:"sid",get:function(){return this.state.sid}},{key:"serviceSid",get:function(){return this.state.serviceSid}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"fileName",get:function(){return this.state.filename}},{key:"filename",get:function(){return this.state.filename}},{key:"category",get:function(){return this.state.category}},{key:"getContentUrl",value:function(){var e=this;return new Q(function(){var t=S.default(E.default.mark((function t(n,r,i){var a,o;return E.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.network.get("".concat(e.config.mediaUrl,"/").concat(e.sid)),i((function(){return a.cancel()})),t.prev=2,t.next=5,a;case 5:o=t.sent,e._update(o.body),n(e.state.contentDirectUrl),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),r(t.t0);case 13:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e,n,r){return t.apply(this,arguments)}}())}},{key:"_update",value:function(e){var t,n,r,i;this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUploadUpdated:e.date_upload_updated?new Date(e.date_upload_updated):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,author:e.author,url:e.url,contentUrl:e.links.content,contentDirectUrl:null!==(t=e.links.content_direct_temporary)&&void 0!==t?t:null,filename:null!==(n=e.filename)&&void 0!==n?n:null,category:null!==(r=e.category)&&void 0!==r?r:"media",isMultipartUpstream:null!==(i=e.is_multipart_upstream)&&void 0!==i&&i}}},{key:"_state",value:function(){var e;return{sid:this.state.sid,category:this.state.category,filename:null!==(e=this.state.filename)&&void 0!==e?e:null,contentType:this.state.contentType,size:this.state.size}}}]),e}();function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k.default(e);if(t){var i=k.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w.default(this,n)}}var oe=function(e){b.default(n,e);var t=ae(n);function n(e,r,i,a,o){var s;return m.default(this,n),(s=t.call(this,e)).code=r,s.body=i,s.status=a,s.headers=o,s}return g.default(n)}(x.default(Error)),se=n.XMLHttpRequest||{};var ue,ce=function(){function e(){m.default(this,e)}return g.default(e,[{key:"get",value:function(t,n){return e.request("GET",t,n)}},{key:"post",value:function(t,n,r){return e.request("POST",t,n,r)}}],[{key:"request",value:function(e,t,n,r){return new Q((function(i,a,o){var s=new se,u=!1;for(var c in o((function(){s.abort(),u=!0})),s.open(e,t,!0),s.onreadystatechange=function(){if(4===s.readyState&&!u){var e,t=(e=s.getAllResponseHeaders())?e.split("\r\n").map((function(e){return e.split(": ")})).filter((function(e){return 2===e.length&&e[1].length>0})).reduce((function(e,t){return e[t[0]]=t[1],e}),{}):{},n=function(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(n){return e.responseText}}(s);if(200<=s.status&&s.status<300)i({status:s.status,headers:t,body:n});else{var r,o,c=null!==(r=s.statusText)&&void 0!==r?r:"NONE";if("string"==typeof n)if(n&&1===n.split("\n",2).length)o=n;else{var l,f=null===(l=n.replace(/<.*?>/g,"").split(/\r\n/g).filter((function(e){return e.length}))[0])||void 0===l?void 0:l.split(" ");o=(null==f?void 0:f.length)>2?null==f?void 0:f.slice(1).join(" "):""}else o=JSON.stringify(n);var d="".concat(s.status,": [").concat(c,"] ").concat(o);a(new oe(d,s.status,n,c,t))}}},n)s.setRequestHeader(c,n[c]),"Content-Type"===c&&"application/json"===n[c]&&(r=JSON.stringify(r));s.send(r)}))}}]),e}(),le=ee.scope("Network"),fe=function(){function e(t,n){m.default(this,e),this.config=t,this.transport=n}return g.default(e,[{key:"backoffConfig",value:function(){return Object.assign(re.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){var e,t;return null!==(e=null!==(t=this.config.retryWhenThrottledOverride)&&void 0!==t?t:re.retryWhenThrottledDefault)&&void 0!==e&&e}},{key:"executeWithRetry",value:function(e,t){var n=this;return new Q(function(){var r=S.default(E.default.mark((function r(i,a,o){var s,u;return E.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=new p.Retrier(n.backoffConfig()),u=[502,503,504],t&&u.push(429),o((function(){s.cancel(),s.removeAllListeners()})),s.on("attempt",S.default(E.default.mark((function t(){var n,r;return E.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=e(),o((function(){n.cancel(),s.cancel(),s.removeAllListeners()})),t.next=5,n;case 5:r=t.sent,s.succeeded(r),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),u.indexOf(t.t0.status)>-1||"Twilsock disconnected"===t.t0.message?s.failed(t.t0):(s.removeAllListeners(),s.cancel(),a(t.t0));case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))),s.on("succeeded",(function(e){i(e)})),s.on("cancelled",(function(e){return a(e)})),s.on("failed",(function(e){return a(e)})),s.start();case 9:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}())}},{key:"get",value:function(e){var t=this;return new Q(function(){var n=S.default(E.default.mark((function n(r,i,a){var o,s,u;return E.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={"X-Twilio-Token":t.config.token},s=t.executeWithRetry((function(){return t.transport.get(e,o)}),t.retryWhenThrottled()),le.trace("sending GET request to ",e," headers ",o),a((function(){return s.cancel()})),n.prev=4,n.next=7,s;case 7:u=n.sent,le.trace("response",u),r(u),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(4),le.debug("get() error ".concat(n.t0)),i(n.t0);case 16:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(e,t,r){return n.apply(this,arguments)}}())}},{key:"post",value:function(e,t,r,i,a){var o=this,s={"X-Twilio-Token":this.config.token};"undefined"!=typeof FormData&&r instanceof FormData||!i||Object.assign(s,{"Content-Type":i});var u=new URL(e);return t&&u.searchParams.append("Category",t),a&&u.searchParams.append("Filename",a),new Q(function(){var t=S.default(E.default.mark((function t(i,a,c){var l,f;return E.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=o.transport.post(u.href,s,r),c((function(){return l.cancel()})),le.trace("sending POST request to ".concat(e," with headers ").concat(s)),t.prev=3,t.next=6,l;case 6:f=t.sent,t.next=17;break;case 9:if(t.prev=9,t.t0=t.catch(3),!(void 0===n.XMLHttpRequest&&r instanceof FormData)){t.next=14;break}return a(new TypeError("Posting FormData supported only with browser engine's FormData")),t.abrupt("return");case 14:return le.debug("post() error ".concat(t.t0)),a(t.t0),t.abrupt("return");case 17:le.trace("response",f),i(f);case 19:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e,n,r){return t.apply(this,arguments)}}())}}]),e}(),de=ee.scope("");t.default=(ue=function(){function e(t,n,r){var i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};m.default(this,e),this.options=o,this.options.logLevel=null!==(i=this.options.logLevel)&&void 0!==i?i:"silent",this.config=new re(t,n,r,this.options),de.setLevel(this.options.logLevel),this.options.transport=null!==(a=this.options.transport)&&void 0!==a?a:new ce,this.transport=this.options.transport,this.network=new fe(this.config,this.transport)}return g.default(e,[{key:"updateToken",value:function(e){de.info("updateToken"),this.config.updateToken(e)}},{key:"get",value:function(e){var t=this;return new Q(function(){var n=S.default(E.default.mark((function n(r,i,a){var o,s;return E.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=t.network.get("".concat(t.config.mediaUrl,"/").concat(e)),a((function(){return o.cancel()})),n.prev=2,n.next=5,o;case 5:s=n.sent,r(new ie(t.config,t.network,s.body)),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),i(n.t0);case 12:case"end":return n.stop()}}),n,null,[[2,9]])})));return function(e,t,r){return n.apply(this,arguments)}}())}},{key:"post",value:function(e,t,n,r){var i=this;return new Q(function(){var a=S.default(E.default.mark((function a(o,s,u){var c,l;return E.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return c=i.network.post(i.config.mediaUrl,null!=n?n:"media",t,e,r),u((function(){return c.cancel()})),a.prev=2,a.next=5,c;case 5:l=a.sent,o(new ie(i.config,i.network,l.body)),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(2),s(a.t0);case 12:case"end":return a.stop()}}),a,null,[[2,9]])})));return function(e,t,n){return a.apply(this,arguments)}}())}},{key:"postFormData",value:function(e,t){var n=this;return new Q(function(){var r=S.default(E.default.mark((function r(i,a,o){var s,u;return E.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=n.network.post(n.config.mediaUrl,null!=t?t:"media",e),o((function(){return s.cancel()})),r.prev=2,r.next=5,s;case 5:u=r.sent,i(new ie(n.config,n.network,u.body)),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),a(r.t0);case 12:case"end":return r.stop()}}),r,null,[[2,9]])})));return function(e,t,n){return r.apply(this,arguments)}}())}},{key:"mediaSetGet",value:function(e){var t=this;return new Q(function(){var n=S.default(E.default.mark((function n(r,i,a){var o,s,u,c;return E.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={command:"get",list:e.map((function(e){return{media_sid:e}}))},s=t.network.post("".concat(t.config.mediaSetUrl),null,o,"application/json"),a((function(){return s.cancel()})),n.prev=3,n.next=6,s;case 6:u=n.sent,c=u.body.map((function(e){if(200===e.code)return new ie(t.config,t.network,e.media_record);i("Failed to obtain detailed information about Media items (failed SID ".concat(e.media_record.sid,")"))})),r(c),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(3),i(n.t0);case 14:case"end":return n.stop()}}),n,null,[[3,11]])})));return function(e,t,r){return n.apply(this,arguments)}}())}},{key:"mediaSetGetContentUrls",value:function(e){var t=this;return new Q(function(){var n=S.default(E.default.mark((function n(r,i,a){var o,s,u,c;return E.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o={command:"get",list:e.map((function(e){return{media_sid:e}}))},s=t.network.post("".concat(t.config.mediaSetUrl),null,o,"application/json"),a((function(){return s.cancel()})),n.prev=3,n.next=6,s;case 6:u=n.sent,c=new Map,u.body.forEach((function(e){200===e.code?c.set(e.media_record.sid,e.media_record.links.content_direct_temporary):i("Failed to obtain detailed information about Media items (failed SID ".concat(e.media_record.sid,")"))})),r(c),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(3),i(n.t0);case 15:case"end":return n.stop()}}),n,null,[[3,12]])})));return function(e,t,r){return n.apply(this,arguments)}}())}}]),e}(),_.default(ue,"version","0.6.8"),ue),Y([h.validateTypes(h.nonEmptyString),X("design:type",Function),X("design:paramtypes",[String]),X("design:returntype",void 0)],t.default.prototype,"updateToken",null),Y([h.validateTypesAsync(h.nonEmptyString),X("design:type",Function),X("design:paramtypes",[String]),X("design:returntype",Q)],t.default.prototype,"get",null),t.default=Y([h.validateConstructorTypes(h.nonEmptyString,h.nonEmptyString,[h.nonEmptyString,h.literal(null)],[h.pureObject,"undefined"]),X("design:paramtypes",[String,String,Object,Object])],t.default),t.CancellablePromise=Q,t.Client=t.default,t.McsClient=t.default,t.McsMedia=ie,t.Media=ie}(iN);var HD=gr,VD=cr,JD=JE.aTypedArray;(0,JE.exportTypedArrayMethod)("at",(function(e){var t=JD(this),n=HD(t),r=VD(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:t[i]}));var KD=il,QD="ArrayBuffer",YD=SR[QD];si({global:!0,constructor:!0,forced:u[QD]!==YD},{ArrayBuffer:YD}),KD(QD);var XD=si,ZD=R,eB=_e,tB=Ge,nB=gr,rB=KI,iB=Va,aB=l,oB=ZO,sB=th,uB=tA,cB=nA,lB=se,fB=iA,dB=[],pB=ZD(dB.sort),hB=ZD(dB.push),vB=aB((function(){dB.sort(void 0)})),yB=aB((function(){dB.sort(null)})),mB=sB("sort"),gB=!aB((function(){if(lB)return lB<70;if(!(uB&&uB>3)){if(cB)return!0;if(fB)return fB<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)dB.push({k:t+r,v:n})}for(dB.sort((function(e,t){return t.v-e.v})),r=0;r<dB.length;r++)t=dB[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));XD({target:"Array",proto:!0,forced:vB||!yB||!mB||!gB},{sort:function(e){void 0!==e&&eB(e);var t=tB(this);if(gB)return void 0===e?pB(t):pB(t,e);var n,r,i=[],a=nB(t);for(r=0;r<a;r++)r in t&&hB(i,t[r]);for(oB(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:iB(t)>iB(n)?1:-1}}(e)),n=nB(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)rB(t,r++);return t}});var bB=si,wB=lN,kB=B,xB=Va,_B=dN,SB=R("".indexOf);bB({target:"String",proto:!0,forced:!_B("includes")},{includes:function(e){return!!~SB(xB(kB(this)),xB(wB(e)),arguments.length>1?arguments[1]:void 0)}});var EB={},TB={exports:{}};!function(t){var n,i;n=r,i=function(){var t=function(){},n="undefined",r=("undefined"==typeof window?"undefined":e(window))!==n&&e(window.navigator)!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(e,n){for(var r=0;r<i.length;r++){var a=i[r];this[a]=r<e?t:this.methodFactory(a,e,n)}this.log=this.debug}function u(t,r,i){return function(){("undefined"==typeof console?"undefined":e(console))!==n&&(s.call(this,r,i),this[t].apply(this,arguments))}}function c(i,s,c){return function(i){return"debug"===i&&(i="log"),("undefined"==typeof console?"undefined":e(console))!==n&&("trace"===i&&r?o:void 0!==console[i]?a(console,i):void 0!==console.log?a(console,"log"):t)}(i)||u.apply(this,arguments)}function l(t,r,a){var o,u=this;r=null==r?"WARN":r;var l="loglevel";function f(){var t;if(("undefined"==typeof window?"undefined":e(window))!==n&&l){try{t=window.localStorage[l]}catch(a){}if(e(t)===n)try{var r=window.document.cookie,i=r.indexOf(encodeURIComponent(l)+"=");-1!==i&&(t=/^([^;]+)/.exec(r.slice(i))[1])}catch(a){}return void 0===u.levels[t]&&(t=void 0),t}}"string"==typeof t?l+=":"+t:"symbol"===e(t)&&(l=void 0),u.name=t,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=a||c,u.getLevel=function(){return o},u.setLevel=function(r,a){if("string"==typeof r&&void 0!==u.levels[r.toUpperCase()]&&(r=u.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(o=r,!1!==a&&function(t){var r=(i[t]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":e(window))!==n&&l){try{return void(window.localStorage[l]=r)}catch(a){}try{window.document.cookie=encodeURIComponent(l)+"="+r+";"}catch(a){}}}(r),s.call(u,r,t),("undefined"==typeof console?"undefined":e(console))===n&&r<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){r=e,f()||u.setLevel(e,!1)},u.resetLevel=function(){u.setLevel(r,!1),function(){if(("undefined"==typeof window?"undefined":e(window))!==n&&l){try{return void window.localStorage.removeItem(l)}catch(t){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(t){}}}()},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var d=f();null==d&&(d=r),u.setLevel(d,!1)}var f=new l,d={};f.getLogger=function(t){if("symbol"!==e(t)&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var n=d[t];return n||(n=d[t]=new l(t,f.getLevel(),f.methodFactory)),n};var p=("undefined"==typeof window?"undefined":e(window))!==n?window.log:void 0;return f.noConflict=function(){return("undefined"==typeof window?"undefined":e(window))!==n&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return d},f.default=f,f},t.exports?t.exports=i():n.log=i()}(TB);var RB=TB.exports;
/*
      @license
      Copyright (c) 2022 Twilio Inc.

      Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

      The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


      */function IB(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}Object.defineProperty(EB,"__esModule",{value:!0});var CB=IB(RB),OB=function(e){var t=CB.default.getLevel();CB.default.setLevel("warn"),CB.default.warn(e),CB.default.setLevel(t)};EB.deprecated=function(e,t,n){return function(r,i,a){if("function"!=typeof a.value&&void 0===(null==a?void 0:a.get))throw new Error("The deprecated decorator can only be applied to methods or getters");if("function"!=typeof a.value){var o=a.get;a.get=function(){return OB("The getter ".concat(e," is deprecated").concat(t?", use "+t+" instead":"").concat(n?", "+n:".")),null==o?void 0:o.apply(this)}}else{var s=a.value;a.value=function(){OB("The method ".concat(e," is deprecated").concat(t?", use "+t+" instead":"").concat(n?", "+n:"."));for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return s.apply(this,i)}}}},EB.deprecationWarning=OB;var AB=si,PB=Do.find,jB=_y,MB="find",LB=!0;MB in[]&&Array(1)[MB]((function(){LB=!1})),AB({target:"Array",proto:!0,forced:LB},{find:function(e){return PB(this,e,arguments.length>1?arguments[1]:void 0)}}),jB(MB),
/*
      @license
      The following license applies to all parts of this software except as
      documented below.

          Copyright (c) 2019, Twilio, inc.
          All rights reserved.

          Redistribution and use in source and binary forms, with or without
          modification, are permitted provided that the following conditions are
          met:

            1. Redistributions of source code must retain the above copyright
               notice, this list of conditions and the following disclaimer.

            2. Redistributions in binary form must reproduce the above copyright
               notice, this list of conditions and the following disclaimer in
               the documentation and/or other materials provided with the
               distribution.

            3. Neither the name of Twilio nor the names of its contributors may
               be used to endorse or promote products derived from this software
               without specific prior written permission.

          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
          "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
          LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
          A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
          HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
          SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
          LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
          DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
          THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
          (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
          OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

      This software includes javascript-state-machine under the following license.

          Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

          Permission is hereby granted, free of charge, to any person obtaining a copy
          of this software and associated documentation files (the "Software"), to deal
          in the Software without restriction, including without limitation the rights
          to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the Software is
          furnished to do so, subject to the following conditions:

          The above copyright notice and this permission notice shall be included in all
          copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
          IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
          FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
          AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
          LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
          OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

      This software includes loglevel under the following license.

          Copyright (c) 2013 Tim Perry

          Permission is hereby granted, free of charge, to any person
          obtaining a copy of this software and associated documentation
          files (the "Software"), to deal in the Software without
          restriction, including without limitation the rights to use,
          copy, modify, merge, publish, distribute, sublicense, and/or sell
          copies of the Software, and to permit persons to whom the
          Software is furnished to do so, subject to the following
          conditions:

          The above copyright notice and this permission notice shall be
          included in all copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
          EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
          OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
          NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
          HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
          WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
          FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
          OTHER DEALINGS IN THE SOFTWARE.

      This software includes q under the following license.

          Copyright 2009â2014 Kristopher Michael Kowal. All rights reserved.
          Permission is hereby granted, free of charge, to any person obtaining a copy
          of this software and associated documentation files (the "Software"), to
          deal in the Software without restriction, including without limitation the
          rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
          sell copies of the Software, and to permit persons to whom the Software is
          furnished to do so, subject to the following conditions:

          The above copyright notice and this permission notice shall be included in
          all copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
          IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
          FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
          AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
          LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
          FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
          IN THE SOFTWARE.

      This software includes platform.js under the following license.

          Copyright 2014 Benjamin Tan <https://d10.github.io/>
          Copyright 2011-2015 John-David Dalton <http://allyoucanleet.com/>

          Permission is hereby granted, free of charge, to any person obtaining
          a copy of this software and associated documentation files (the
          "Software"), to deal in the Software without restriction, including
          without limitation the rights to use, copy, modify, merge, publish,
          distribute, sublicense, and/or sell copies of the Software, and to
          permit persons to whom the Software is furnished to do so, subject to
          the following conditions:

          The above copyright notice and this permission notice shall be
          included in all copies or substantial portions of the Software.

          THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
          EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
          MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
          NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
          LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
          OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
          WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

      */
function(t){Object.defineProperty(t,"__esModule",{value:!0});var n=lc,r=hc,i=gc,a=wc,o=Tc,s=Ic,u=Oc,c=ph,l=mc,f=iy,d=my,p=mb,h=Ck,v=ux,y=Ub,m=p_,g=q_,b=YP,w=dj,k=iN,x=jw,_=EB,S=lE;function E(t){return t&&"object"===e(t)&&"default"in t?t:{default:t}}function T(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var R=E(uc),I=E(n),C=E(r),O=E(i),A=E(a),P=E(o),j=E(s),M=E(u),L=E(c),N=E(l),U=T(f),F=E(v),D=E(y),B=E(x);function q(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":N.default(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}function z(e,t){if("object"===("undefined"==typeof Reflect?"undefined":N.default(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function W(e,t){return["".concat((new Date).toISOString()," Conversations ").concat(e,":")].concat(Array.from(t))}var G=U.getLogger("twilio-conversations"),$=function(){function e(t){M.default(this,e),P.default(this,"prefix",""),this.prefix=null!=t&&t.length>0?t+" ":""}return j.default(e,[{key:"setLevel",value:function(e){G.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.trace.apply(null,W(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.debug.apply(null,W(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.info.apply(null,W(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.warn.apply(null,W(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.error.apply(null,W(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){G.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.trace.apply(null,W("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.debug.apply(null,W("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.info.apply(null,W("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.warn.apply(null,W("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];G.error.apply(null,W("E",t))}}]),e}();function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var V="PT5S",J="PT5S",K=j.default((function e(){var t,n,r,i,a,o,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;M.default(this,e),P.default(this,"typingIndicatorTimeoutDefault",5e3);var l=s.Chat||s.IPMessaging||s||{};this.productId=l.productId,this.links={myConversations:u.links.my_conversations,conversations:u.links.conversations,users:u.links.users,currentUser:u.links.current_user,typing:u.links.typing,mediaService:u.links.media_service,mediaSetService:u.links.media_set_service,messagesReceipts:u.links.messages_receipts},this.limits={mediaAttachmentsCountLimit:u.options.media_attachments_count_limit,mediaAttachmentSizeLimitInMb:u.options.media_attachment_size_limit_in_mb,mediaAttachmentsTotalSizeLimitInMb:u.options.media_attachments_total_size_limit_in_mb,emailHistoriesAllowedContentTypes:u.options.email_histories_allowed_mime_types,emailBodiesAllowedContentTypes:u.options.email_bodies_allowed_mime_types},this.typingIndicatorTimeoutOverride=l.typingIndicatorTimeoutOverride,this.backoffConfiguration=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){P.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({min:1e3,max:4e3,maxAttemptsCount:3},l.backoffConfigOverride),this.retryWhenThrottled=void 0===l.retryWhenThrottledOverride||l.retryWhenThrottledOverride,this.userInfosToSubscribe=null!==(t=null!==(n=l.userInfosToSubscribeOverride)&&void 0!==n?n:u.options.user_infos_to_subscribe)&&void 0!==t?t:100,this.reachabilityEnabled=u.options.reachability_enabled,this.userIdentity=u.identity,this.userInfo=u.sync_objects.my_user_info,this.myConversations=u.sync_objects.my_conversations;var f=null!==(r=null!==(i=l.httpCacheIntervalOverride)&&void 0!==i?i:u.options.http_cache_interval)&&void 0!==r?r:V;try{this.httpCacheInterval=d.toSeconds(d.parse(f))}catch(h){c.error("Failed to parse http cache interval ".concat(f,", using default value ").concat(V)),this.httpCacheInterval=d.toSeconds(d.parse(V))}var p=null!==(a=null!==(o=l.consumptionReportIntervalOverride)&&void 0!==o?o:u.options.consumption_report_interval)&&void 0!==a?a:J;try{this.consumptionReportInterval=d.toSeconds(d.parse(p))}catch(v){c.error("Failed to parse consumption report interval ".concat(p,", using default value ").concat(J)),this.consumptionReportInterval=d.toSeconds(d.parse(J))}}));function Q(e){return void 0===e||isNaN(Number(e))?null:Number(e)}function Y(e){try{return new Date(e)}catch(t){return null}}function X(e,t,n){var r={};if(e)try{r=JSON.parse(e)}catch(i){n.warn(t,i)}return r}var Z=function(){function e(t){M.default(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return j.default(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}(),ee=p.custom((function(e){return[["string","number","boolean","object"].includes(N.default(e)),"a JSON type"]})),te=p.custom((function(e){return[["undefined","string","number","boolean","object"].includes(N.default(e)),"an optional JSON type"]}));function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}var re=$.scope("User"),ie=function(e){C.default(c,e);var t,n,r,i,a,o,s,u=ne(c);function c(e,t,n,r){var i;return M.default(this,c),i=u.call(this),P.default(I.default(i),"promiseToFetch",null),P.default(I.default(i),"updated","updated"),P.default(I.default(i),"userSubscribed","userSubscribed"),P.default(I.default(i),"userUnsubscribed","userUnsubscribed"),i.services=r,i.subscribed="initializing",i.setMaxListeners(0),i.state={identity:e,entityName:t,friendlyName:null,attributes:{},online:null,notifiable:null},i._initializationPromise=new Promise((function(e){i._resolveInitializationPromise=e})),null!==n&&i._resolveInitialization(n,e,t,!1),i}return j.default(c,[{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"isOnline",get:function(){return this.state.online}},{key:"isNotifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}},{key:"_update",value:(s=R.default(L.default.mark((function e(t,n){var r,i;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:r=[],re.debug("User for",this.state.identity,"updated:",t,n),e.t0=t,e.next="friendlyName"===e.t0?7:"attributes"===e.t0?9:"reachability"===e.t0?12:15;break;case 7:return this.state.friendlyName!==n.value&&(r.push("friendlyName"),this.state.friendlyName=n.value),e.abrupt("break",16);case 9:return i=X(n.value,"Retrieved malformed attributes from the server for user: ".concat(this.state.identity),re),F.default(this.state.attributes,i)||(this.state.attributes=i,r.push("attributes")),e.abrupt("break",16);case 12:return this.state.online!==n.online&&(this.state.online=n.online,r.push("reachabilityOnline")),this.state.notifiable!==n.notifiable&&(this.state.notifiable=n.notifiable,r.push("reachabilityNotifiable")),e.abrupt("break",16);case 15:return e.abrupt("return");case 16:r.length>0&&this.emit("updated",{user:this,updateReasons:r});case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_updateReachabilityInfo",value:(o=R.default(L.default.mark((function e(t,n){var r=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(this.configuration.reachabilityEnabled){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return e.abrupt("return",t.get("reachability").then(n).catch((function(e){re.warn("Failed to get reachability info for ",r.state.identity,e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_fetch",value:(a=R.default(L.default.mark((function e(){var t=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(this.state.entityName){e.next=4;break}return e.abrupt("return",this);case 4:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then((function(e){return t.entity=e,e.on("itemUpdated",(function(e){return re.debug(t.state.entityName+" ("+t.state.identity+") itemUpdated: "+e.item.key),t._update(e.item.key,e.item.data)})),Promise.all([e.get("friendlyName").then((function(e){return t._update(e.key,e.data)})),e.get("attributes").then((function(e){return t._update(e.key,e.data)})),t._updateReachabilityInfo(e,(function(e){return t._update(e.key,e.data)}))])})).then((function(){return re.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t})).catch((function(e){throw t.promiseToFetch=null,e})),e.abrupt("return",this.promiseToFetch);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_ensureFetched",value:(i=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:return e.abrupt("return",this.promiseToFetch||this._fetch());case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateAttributes",value:(r=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(t)});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"updateFriendlyName",value:(n=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.commandExecutor.mutateResource("post",this.links.self,{friendly_name:t});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unsubscribe",value:(t=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._initializationPromise;case 2:if(!this.promiseToFetch){e.next=9;break}return e.next=5,this.promiseToFetch;case 5:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_resolveInitialization",value:function(e,t,n,r){this.configuration=e,this.identity=t,this.entityName=n,this.links={self:"".concat(this.configuration.links.users,"/").concat(encodeURIComponent(this.identity))},this._resolveInitializationPromise(),r&&this.emit("updated",{user:this,updateReasons:["friendlyName","attributes","reachabilityOnline","reachabilityNotifiable"]})}}]),c}(h.ReplayEventEmitter);function ae(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}q([p.validateTypesAsync(ee),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],ie.prototype,"updateAttributes",null),q([p.validateTypesAsync(["string"]),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],ie.prototype,"updateFriendlyName",null);var se=function(){function e(t,n){M.default(this,e),this.configuration=t,this.services=n,this.cache=new Map,this.cacheLifetime=100*this.configuration.httpCacheInterval,this.cleanupCache()}return j.default(e,[{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e,t=ae(this.cache);try{for(t.s();!(e=t.n()).done;){var n=D.default(e.value,2),r=n[0],i=n[1];this.isExpired(i.timestamp)&&this.cache.delete(r)}}catch(a){t.e(a)}finally{t.f()}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval((function(){return e.cleanupCache()}),2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(r,i){var a=[502,503,504];n&&a.push(429);var o=new m.Retrier(t.configuration.backoffConfiguration);o.on("attempt",(function(){e().then((function(e){return o.succeeded(e)})).catch((function(e){a.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?o.failed(e):(o.removeAllListeners(),o.cancel(),i(e))}))})),o.on("succeeded",(function(e){r(e)})),o.on("cancelled",(function(e){return i(e)})),o.on("failed",(function(e){return i(e)})),o.start()}))}},{key:"get",value:function(){var e=R.default(L.default.mark((function e(t){var n,r,i,a=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))||this.isExpired(n.timestamp)){e.next=3;break}return e.abrupt("return",n.response);case 3:return r={},e.next=6,this.executeWithRetry((function(){return a.services.transport.get(t,r,a.configuration.productId)}),this.configuration.retryWhenThrottled);case 6:return i=e.sent,this.cache.set(t,{response:i,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ue=j.default((function e(){M.default(this,e)}));function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}P.default(ue,"TYPING_INDICATOR","twilio.ipmsg.typing_indicator"),P.default(ue,"NEW_MESSAGE","twilio.conversations.new_message"),P.default(ue,"ADDED_TO_CONVERSATION","twilio.conversations.added_to_conversation"),P.default(ue,"REMOVED_FROM_CONVERSATION","twilio.conversations.removed_from_conversation"),P.default(ue,"CONSUMPTION_UPDATE","twilio.channel.consumption_update");var le=$.scope("Participant"),fe=function(e){C.default(a,e);var t,n,r,i=ce(a);function a(e,t,n,r,o){var s,u,c;if(M.default(this,a),(c=i.call(this)).conversation=n,c.links=r,c.services=o,c.state={attributes:X(e.attributes,"Retrieved malformed attributes from the server for participant: "+t,le),dateCreated:e.dateCreated?Y(e.dateCreated):null,dateUpdated:e.dateCreated?Y(e.dateUpdated):null,sid:t,typingTimeout:null,isTyping:!1,identity:e.identity,roleSid:null!==(s=e.roleSid)&&void 0!==s?s:"",lastReadMessageIndex:Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,lastReadTimestamp:e.lastConsumptionTimestamp?Y(e.lastConsumptionTimestamp):null,type:e.type||"chat",userInfo:e.userInfo,bindings:null!==(u=e.bindings)&&void 0!==u?u:{}},!e.identity&&!e.type)throw new Error("Received invalid Participant object from server: Missing identity or type of Participant.");return c}return j.default(a,[{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastReadMessageIndex",get:function(){return this.state.lastReadMessageIndex}},{key:"lastReadTimestamp",get:function(){return this.state.lastReadTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}},{key:"bindings",get:function(){var e;return null!==(e=this.state.bindings)&&void 0!==e?e:{}}},{key:"_startTyping",value:function(e){var t=this;return this.state.typingTimeout&&clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.conversation.emit("typingStarted",this),this.state.typingTimeout=Number(setTimeout((function(){return t._endTyping()}),e)),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.conversation.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[],n=X(e.attributes,"Retrieved malformed attributes from the server for participant: "+this.state.sid,le);e.attributes&&!F.default(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var r=Y(e.dateUpdated);e.dateUpdated&&(null==r?void 0:r.getTime())!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=r,t.push("dateUpdated"));var i=Y(e.dateCreated);if(e.dateCreated&&(null==i?void 0:i.getTime())!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=i,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!Number.isInteger(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastReadMessageIndex===e.lastConsumedMessageIndex||(this.state.lastReadMessageIndex=e.lastConsumedMessageIndex,t.push("lastReadMessageIndex")),e.lastConsumptionTimestamp){var a=new Date(e.lastConsumptionTimestamp);this.state.lastReadTimestamp&&this.state.lastReadTimestamp.getTime()===a.getTime()||(this.state.lastReadTimestamp=a,t.push("lastReadTimestamp"))}return e.bindings&&!F.default(this.state.bindings,e.bindings)&&(this.state.bindings=e.bindings,t.push("bindings")),t.length>0&&this.emit("updated",{participant:this,updateReasons:t}),this}},{key:"getUser",value:(r=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Participant type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"remove",value:(n=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.conversation.removeParticipant(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateAttributes",value:(t=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:JSON.stringify(t)});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(h.ReplayEventEmitter);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}P.default(fe,"typingStarted","typingStarted"),P.default(fe,"typingEnded","typingEnded"),P.default(fe,"updated","updated"),q([p.validateTypesAsync(ee),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],fe.prototype,"updateAttributes",null);var pe=$.scope("Participants"),he=function(e){C.default(l,e);var t,n,r,i,a,o,s,u,c=de(l);function l(e,t,n,r,i){var a;return M.default(this,l),a=c.call(this),P.default(I.default(a),"rosterEntityPromise",null),a.conversation=e,a.participants=t,a.links=n,a.configuration=r,a.services=i,a}return j.default(l,[{key:"unsubscribe",value:(u=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"subscribe",value:function(e){var t=this,n="string"==typeof e?this.services.syncClient.map({id:e,mode:"open_existing"}):Promise.resolve(e);return this.rosterEntityPromise=this.rosterEntityPromise||n.then((function(e){e.on("itemAdded",(function(e){pe.debug(t.conversation.sid+" itemAdded: "+e.item.key),t.upsertParticipant(e.item.key,e.item.data).then((function(e){t.emit("participantJoined",e)}))})),e.on("itemRemoved",(function(e){pe.debug(t.conversation.sid+" itemRemoved: "+e.key);var n=e.key;if(t.participants.has(n)){var r=t.participants.get(n);t.participants.delete(n),r&&t.emit("participantLeft",r)}})),e.on("itemUpdated",(function(e){pe.debug(t.conversation.sid+" itemUpdated: "+e.item.key),t.upsertParticipant(e.item.key,e.item.data)}));var n=[];return e.getItems().then((function e(r){return r.items.forEach((function(e){n.push(t.upsertParticipant(e.key,e.data))})),r.hasNextPage?r.nextPage().then(e):null})).then((function(){return Promise.all(n)})).then((function(){return e}))})).catch((function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&pe.error("Failed to get roster object for conversation",t.conversation.sid,e),pe.debug("ERROR: Failed to get roster object for conversation",t.conversation.sid,e),e}))}},{key:"upsertParticipantFromResponse",value:(s=R.default(L.default.mark((function e(t){var n,r,i,a,o,s,u,c;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sid,i=t.attributes,a=t.date_created,o=t.date_updated,s=t.identity,u=t.role_sid,c=t.messaging_binding,e.next=3,this.upsertParticipant(r,{attributes:i,dateCreated:new Date(a),dateUpdated:new Date(o),identity:s,roleSid:u,lastConsumedMessageIndex:null,lastConsumptionTimestamp:null,type:null!==(n=null==c?void 0:c.type)&&void 0!==n?n:"chat"});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"upsertParticipant",value:(o=R.default(L.default.mark((function e(t,n){var r,i,a=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.participants.get(t))){e.next=3;break}return e.abrupt("return",r._update(n));case 3:return i={self:"".concat(this.links.participants,"/").concat(t)},r=new fe(n,t,this.conversation,i,this.services),this.participants.set(t,r),r.on("updated",(function(e){return a.emit("participantUpdated",e)})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getParticipants",value:(a=R.default(L.default.mark((function e(){var t=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then((function(){var e=[];return t.participants.forEach((function(t){return e.push(t)})),e})):[]);case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getParticipantBySid",value:(i=R.default(L.default.mark((function e(t){var n=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then((function(){var e=n.participants.get(t);if(!e)throw new Error("Participant with SID "+t+" was not found");return e})):null);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getParticipantByIdentity",value:(r=R.default(L.default.mark((function e(t){var n,r=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise?this.rosterEntityPromise.then((function(){if(r.participants.forEach((function(e){e.identity===t&&(n=e)})),!n)throw new Error("Participant with identity "+t+" was not found");return n})):null);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"add",value:(n=R.default(L.default.mark((function e(t,n){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.participants,{identity:t,attributes:void 0!==n?JSON.stringify(n):void 0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addNonChatParticipant",value:(t=R.default(L.default.mark((function e(t,n){var r,i,a,o,s=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>2&&void 0!==s[2]?s[2]:{},o=s.length>3&&void 0!==s[3]?s[3]:{},e.next=4,this.services.commandExecutor.mutateResource("post",this.links.participants,{attributes:void 0!==a?JSON.stringify(a):void 0,messaging_binding:{address:n,proxy_address:t,name:null==o||null===(r=o.email)||void 0===r?void 0:r.name,level:null==o||null===(i=o.email)||void 0===i?void 0:i.level}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"remove",value:function(e){return this.services.commandExecutor.mutateResource("delete","".concat(this.links.participants,"/").concat(e))}}]),l}(h.ReplayEventEmitter),ve=function(){function e(t,n){M.default(this,e),P.default(this,"mcsMedia",null),this.services=n,t instanceof k.McsMedia&&(this.mcsMedia=t),this.state={sid:t.sid,category:t.category,filename:t.filename,contentType:t.contentType,size:t.size}}return j.default(e,[{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}},{key:"category",get:function(){return this.state.category}},{key:"getContentTemporaryUrl",value:function(){var e=this;return new k.CancellablePromise(function(){var t=R.default(L.default.mark((function t(n,r,i){var a,o,s,u;return L.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e._fetchMcsMedia(),s=null===(a=e.mcsMedia)||void 0===a?void 0:a.getContentUrl(),i((function(){o.cancel(),s&&s.cancel()})),t.prev=3,e.mcsMedia){t.next=9;break}return t.next=7,o;case 7:u=t.sent,s=u.getContentUrl();case 9:if(t.t0=n,!s){t.next=16;break}return t.next=13,s;case 13:t.t1=t.sent,t.next=17;break;case 16:t.t1=null;case 17:t.t2=t.t1,(0,t.t0)(t.t2),t.next=24;break;case 21:t.prev=21,t.t3=t.catch(3),r(t.t3);case 24:case"end":return t.stop()}}),t,null,[[3,21]])})));return function(e,n,r){return t.apply(this,arguments)}}())}},{key:"_fetchMcsMedia",value:function(){var e=this;return new k.CancellablePromise(function(){var t=R.default(L.default.mark((function t(n,r,i){var a;return L.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.services.mcsClient.get(e.state.sid),!e.services.mcsClient){t.next=14;break}return i((function(){return a.cancel()})),t.prev=3,t.next=6,a;case 6:e.mcsMedia=t.sent,n(e.mcsMedia),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),r(t.t0);case 13:return t.abrupt("return");case 14:r(new Error("Media Content Service is unavailable"));case 15:case"end":return t.stop()}}),t,null,[[3,10]])})));return function(e,n,r){return t.apply(this,arguments)}}())}}]),e}(),ye=function(){function e(t){M.default(this,e),this.state=t}return j.default(e,[{key:"total",get:function(){return this.state.total}},{key:"sent",get:function(){return this.state.sent}},{key:"delivered",get:function(){return this.state.delivered}},{key:"read",get:function(){return this.state.read}},{key:"undelivered",get:function(){return this.state.undelivered}},{key:"failed",get:function(){return this.state.failed}},{key:"_update",value:function(e){this.state=e}},{key:"_isEquals",value:function(e){var t=this.total===e.total,n=this.sent===e.sent,r=this.delivered===e.delivered,i=this.read===e.read,a=this.undelivered===e.undelivered,o=this.failed===e.failed;return t&&n&&r&&i&&a&&o}}]),e}(),me=function(){function e(t,n,r,i){M.default(this,e),this.state={prevToken:r,nextToken:i,source:n,items:t}}return j.default(e,[{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}},{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):Promise.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):Promise.reject(new Error("No previous page"))}}]),e}(),ge=j.default((function e(t){M.default(this,e),this.sid=t.sid,this.messageSid=t.message_sid,this.conversationSid=t.conversation_sid,this.channelMessageSid=t.channel_message_sid,this.participantSid=t.participant_sid,this.status=t.status||"queued",this.errorCode=t.error_code||0,this.dateCreated=t.date_created,this.dateUpdated=t.date_updated}));function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){P.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}var xe=$.scope("Message"),_e=function(e){C.default(c,e);var t,n,r,i,a,o,s,u=ke(c);function c(e,t,n,r,i,a){var o,s,l,f,d;return M.default(this,c),(d=u.call(this)).conversation=n,d.links=r,d.configuration=i,d.services=a,d.state={sid:t.sid,index:e,author:t.author,subject:t.subject,body:null!==(o=t.text)&&void 0!==o?o:null,timestamp:t.timestamp?new Date(t.timestamp):null,dateUpdated:t.dateUpdated?new Date(t.dateUpdated):null,lastUpdatedBy:null!==(s=t.lastUpdatedBy)&&void 0!==s?s:null,attributes:X(t.attributes,"Got malformed attributes for the message ".concat(t.sid),xe),type:null!==(l=t.type)&&void 0!==l?l:"text",media:"media"===t.type&&t.media?new ve(t.media,d.services):null,medias:"media"===t.type&&t.medias?t.medias.map((function(e){return new ve(e,d.services)})):"media"===t.type&&t.media&&!t.medias?[new ve(we(we({},t.media),{},{category:"media"}),d.services)]:null,participantSid:null!==(f=t.memberSid)&&void 0!==f?f:null,aggregatedDeliveryReceipt:t.delivery?new ye(t.delivery):null},d}return j.default(c,[{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"subject",get:function(){return this.state.subject}},{key:"body",get:function(){return this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"dateCreated",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"attachedMedia",get:function(){return this.getMediaByCategories(["media"])}},{key:"participantSid",get:function(){return this.state.participantSid}},{key:"aggregatedDeliveryReceipt",get:function(){return this.state.aggregatedDeliveryReceipt}},{key:"getMediaByCategory",value:function(e){return this.getMediaByCategories(e)}},{key:"getMediaByCategories",value:function(e){var t;return(null!==(t=this.state.medias)&&void 0!==t?t:[]).filter((function(t){return e.includes(t.category)}))}},{key:"getEmailBody",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text/plain";return null!==(e=null===(t=this.getMediaByCategories(["body"]))||void 0===t?void 0:t.filter((function(e){return e.contentType==n})).shift())&&void 0!==e?e:null}},{key:"getEmailHistory",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text/plain";return null!==(e=null===(t=this.getMediaByCategories(["history"]))||void 0===t?void 0:t.filter((function(e){return e.contentType==n})).shift())&&void 0!==e?e:null}},{key:"_update",value:function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.subject&&e.subject!==this.state.subject&&(this.state.subject=e.subject,t.push("subject")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("dateCreated"));var n=X(e.attributes,"Got malformed attributes for the message ".concat(this.sid),xe);F.default(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes"));var r=e.delivery,i=this.state.aggregatedDeliveryReceipt;!!(r&&r.total&&r.delivered&&r.failed&&r.read&&r.sent&&r.undelivered)&&(i?i._isEquals(r)||(i._update(r),t.push("deliveryReceipt")):(this.state.aggregatedDeliveryReceipt=new ye(r),t.push("deliveryReceipt"))),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getParticipant",value:(s=R.default(L.default.mark((function e(){var t,n,r=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.participantSid){e.next=5;break}return e.next=4,this.conversation.getParticipantBySid(this.state.participantSid).catch((function(){return xe.debug('Participant with sid "'.concat(r.participantSid,'" not found for message ').concat(r.sid)),null}));case 4:t=e.sent;case 5:if(t||!this.state.author){e.next=9;break}return e.next=8,this.conversation.getParticipantByIdentity(this.state.author).catch((function(){return xe.debug('Participant with identity "'.concat(r.author,'" not found for message ').concat(r.sid)),null}));case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Participant with ",this.state.participantSid&&(n+="SID '"+this.state.participantSid+"' "),this.state.author&&(this.state.participantSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Participant with "===n&&(n="Participant "),n+="was not found",new Error(n);case 17:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getDetailedDeliveryReceipts",value:(o=R.default(L.default.mark((function e(){var t,n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getDetailedDeliveryReceiptsPaginator();case 2:t=e.sent,n=t.items;case 4:if(!t.hasNextPage){e.next=11;break}return e.next=7,t.nextPage();case 7:t=e.sent,n=[].concat(B.default(n),B.default(t.items)),e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"remove",value:(a=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("delete",this.links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateBody",value:(i=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{body:t});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateAttributes",value:(r=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.commandExecutor.mutateResource("post",this.links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"attachTemporaryUrlsFor",value:(n=R.default(L.default.mark((function e(t){var n,r=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null==t?void 0:t.map((function(e){return e.sid})),!this.services.mcsClient||!n){e.next=7;break}return e.next=4,this.services.mcsClient.mediaSetGet(n);case 4:return e.abrupt("return",e.sent.map((function(e){return new ve(e,r.services)})));case 7:throw new Error("Media Content Service is unavailable");case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getTemporaryContentUrlsForMedia",value:function(e){var t=e.map((function(e){return e.sid}));return this.getTemporaryContentUrlsForMediaSids(t)}},{key:"getTemporaryContentUrlsForMediaSids",value:function(e){var t=this;return new k.CancellablePromise(function(){var n=R.default(L.default.mark((function n(r,i,a){var o,s;return L.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.services.mcsClient.mediaSetGetContentUrls(null!=e?e:[]),t.services.mcsClient&&e){n.next=4;break}return i(new Error("Media Content Service is unavailable")),n.abrupt("return");case 4:return a((function(){o.cancel()})),n.prev=5,n.next=8,o;case 8:s=n.sent,r(s),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(5),i(n.t0);case 15:case"end":return n.stop()}}),n,null,[[5,12]])})));return function(e,t,r){return n.apply(this,arguments)}}())}},{key:"getTemporaryContentUrlsForAttachedMedia",value:function(){var e,t=this.attachedMedia,n=null!==(e=null==t?void 0:t.map((function(e){return e.sid})))&&void 0!==e?e:[];return this.getTemporaryContentUrlsForMediaSids(n)}},{key:"_getDetailedDeliveryReceiptsPaginator",value:(t=R.default(L.default.mark((function e(t){var n,r,i,a=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.configuration.links.messagesReceipts.replace("%s",this.conversation.sid).replace("%s",this.sid),r=new Z(n).arg("PageToken",null==t?void 0:t.pageToken).arg("PageSize",null==t?void 0:t.pageSize).build(),e.next=4,this.services.network.get(r);case 4:return i=e.sent,e.abrupt("return",new me(i.body.delivery_receipts.map((function(e){return new ge(e)})),(function(e,t){return a._getDetailedDeliveryReceiptsPaginator({pageToken:e,pageSize:t})}),i.body.meta.previous_token,i.body.meta.next_token));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),c}(h.ReplayEventEmitter);function Se(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ee(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}P.default(_e,"updated","updated"),q([_.deprecated("getMediaByCategory","getMediaByCategories"),z("design:type",Function),z("design:paramtypes",[Array]),z("design:returntype",Array)],_e.prototype,"getMediaByCategory",null),q([p.validateTypes([p.nonEmptyString,"undefined"]),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",ve)],_e.prototype,"getEmailBody",null),q([p.validateTypes([p.nonEmptyString,"undefined"]),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",ve)],_e.prototype,"getEmailHistory",null),q([p.validateTypesAsync("string"),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],_e.prototype,"updateBody",null),q([p.validateTypesAsync(ee),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],_e.prototype,"updateAttributes",null),q([_.deprecated("attachTemporaryUrlsFor","getTemporaryContentUrlsForMedia"),z("design:type",Function),z("design:paramtypes",[Array]),z("design:returntype",Promise)],_e.prototype,"attachTemporaryUrlsFor",null),q([p.validateTypesAsync(p.nonEmptyArray("media",ve)),z("design:type",Function),z("design:paramtypes",[Array]),z("design:returntype",k.CancellablePromise)],_e.prototype,"getTemporaryContentUrlsForMedia",null),q([p.validateTypesAsync(p.nonEmptyArray("strings","string")),z("design:type",Function),z("design:paramtypes",[Array]),z("design:returntype",k.CancellablePromise)],_e.prototype,"getTemporaryContentUrlsForMediaSids",null);var Re=$.scope("Messages"),Ie=function(e){C.default(u,e);var t,n,r,i,a,o,s=Te(u);function u(e,t,n){var r;return M.default(this,u),(r=s.call(this)).conversation=e,r.configuration=t,r.services=n,r.messagesByIndex=new Map,r.messagesListPromise=null,r}return j.default(u,[{key:"subscribe",value:(o=R.default(L.default.mark((function e(t){var n,r=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=2;break}return e.abrupt("return",this.messagesListPromise);case 2:return this.messagesListPromise="string"==typeof t?this.services.syncClient.list({id:t,mode:"open_existing"}):Promise.resolve(t),e.prev=3,e.next=6,this.messagesListPromise;case 6:return(n=e.sent).on("itemAdded",(function(e){Re.debug("".concat(r.conversation.sid," itemAdded: ").concat(e.item.index));var t={self:"".concat(r.conversation._links.messages,"/").concat(e.item.data.sid),conversation:r.conversation._links.self,messages_receipts:"".concat(r.conversation._links.messages,"/").concat(e.item.data.sid,"/Receipts")},n=new _e(e.item.index,e.item.data,r.conversation,t,r.configuration,r.services);r.messagesByIndex.has(n.index)?Re.debug("Message arrived, but is already known and ignored",r.conversation.sid,n.index):(r.messagesByIndex.set(n.index,n),n.on("updated",(function(e){return r.emit("messageUpdated",e)})),r.emit("messageAdded",n))})),n.on("itemRemoved",(function(e){Re.debug("#{this.conversation.sid} itemRemoved: ".concat(e.index));var t=e.index;if(r.messagesByIndex.has(t)){var n=r.messagesByIndex.get(t);if(!n)return;r.messagesByIndex.delete(n.index),n.removeAllListeners("updated"),r.emit("messageRemoved",n)}})),n.on("itemUpdated",(function(e){Re.debug("".concat(r.conversation.sid," itemUpdated: ").concat(e.item.index));var t=r.messagesByIndex.get(e.item.index);t&&t._update(e.item.data)})),e.abrupt("return",n);case 13:throw e.prev=13,e.t0=e.catch(3),this.messagesListPromise=null,"disconnected"!==this.services.syncClient.connectionState&&Re.error("Failed to get messages object for conversation",this.conversation.sid,e.t0),Re.debug("ERROR: Failed to get messages object for conversation",this.conversation.sid,e.t0),e.t0;case 19:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(e){return o.apply(this,arguments)})},{key:"unsubscribe",value:(a=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.messagesListPromise){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.messagesListPromise;case 4:e.sent.close(),this.messagesListPromise=null;case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"sendV2",value:function(e){var t=this;return Re.debug("Sending message V2",e.mediaContent,e.attributes,e.emailOptions),new k.CancellablePromise(function(){var n=R.default(L.default.mark((function n(r,i,a){var o,s,u,c,l,f,d,p,h,v,y,m;return L.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=[],u=[],a((function(){u.forEach((function(e){return e.cancel()}))})),c=Se(e.mediaContent),n.prev=4,c.s();case 6:if((l=c.n()).done){n.next=25;break}return f=D.default(l.value,2),d=f[0],p=f[1],n.prev=8,Re.debug("Adding media to a message as ".concat(p instanceof FormData?"FormData":"SendMediaOptions"),p),y=p instanceof FormData?t.services.mcsClient.postFormData(p,d):t.services.mcsClient.post(null!==(h=p.contentType)&&void 0!==h?h:"",null!==(v=p.media)&&void 0!==v?v:"",d,p.filename),u.push(y),n.t0=s,n.next=15,y;case 15:n.t1=n.sent,n.t0.push.call(n.t0,n.t1),n.next=23;break;case 19:return n.prev=19,n.t2=n.catch(8),i(n.t2),n.abrupt("return");case 23:n.next=6;break;case 25:n.next=30;break;case 27:n.prev=27,n.t3=n.catch(4),c.e(n.t3);case 30:return n.prev=30,c.f(),n.finish(30);case 33:return m=t.services.commandExecutor.mutateResource("post",t.conversation._links.messages,{body:e.text,subject:null===(o=e.emailOptions)||void 0===o?void 0:o.subject,media_sids:s.map((function(e){return e.sid})),attributes:void 0!==e.attributes?JSON.stringify(e.attributes):void 0}),n.prev=34,n.t4=r,n.next=38,m;case 38:n.t5=n.sent,(0,n.t4)(n.t5),n.next=45;break;case 42:n.prev=42,n.t6=n.catch(34),i(n.t6);case 45:case"end":return n.stop()}}),n,null,[[4,27,30,33],[8,19],[34,42]])})));return function(e,t,r){return n.apply(this,arguments)}}())}},{key:"send",value:(i=R.default(L.default.mark((function e(t){var n,r,i=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2?i[2]:void 0,Re.debug("Sending text message",t,n,r),e.abrupt("return",this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{body:null!=t?t:"",attributes:void 0!==n?JSON.stringify(n):void 0,subject:null==r?void 0:r.subject}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"sendMedia",value:(r=R.default(L.default.mark((function e(t){var n,r,i,a,o,s=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>1&&void 0!==s[1]?s[1]:{},a=s.length>2?s[2]:void 0,Re.debug("Sending media message",t,i,a),Re.debug("Sending media message as ".concat(t instanceof FormData?"FormData":"SendMediaOptions"),t,i),!(t instanceof FormData)){e.next=10;break}return e.next=7,this.services.mcsClient.postFormData(t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,this.services.mcsClient.post(null!==(n=t.contentType)&&void 0!==n?n:"",null!==(r=t.media)&&void 0!==r?r:"","media",t.filename);case 12:e.t0=e.sent;case 13:return o=e.t0,e.next=16,this.services.commandExecutor.mutateResource("post",this.conversation._links.messages,{media_sids:[o.sid],attributes:void 0!==i?JSON.stringify(i):void 0});case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getMessages",value:(n=R.default(L.default.mark((function e(t,n){var r,i=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:"backwards",e.abrupt("return",this._getMessages(t,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,a=function(){return t.nextPage().then((function(t){return r._wrapPaginator(e,t,n)}))},o=function(){return t.prevPage().then((function(t){return r._wrapPaginator(e,t,n)}))};return n(t.items).then((function(e){return{items:e.sort((function(e,t){return e.index-t.index})),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?a:o,nextPage:i?o:a}}))}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i={self:"".concat(this.conversation._links.messages,"/").concat(t.sid),conversation:this.conversation._links.self,messages_receipts:"".concat(this.conversation._links.messages,"/").concat(t.sid,"/Receipts")},a=new _e(e,t,this.conversation,i,this.configuration,this.services);return this.messagesByIndex.set(a.index,a),a.on("updated",(function(e){return n.emit("messageUpdated",e)})),a}},{key:"_getMessages",value:(t=R.default(L.default.mark((function e(){var t,n,r,i,a,o=this,s=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:30,n=s.length>1&&void 0!==s[1]?s[1]:"end",r="backwards"===(s.length>2&&void 0!==s[2]?s[2]:"forward")?"desc":"asc",e.next=6,this.messagesListPromise;case 6:return i=e.sent,e.next=9,null==i?void 0:i.getItems({from:"end"!==n?n:void 0,pageSize:t,order:r,limit:t});case 9:return a=e.sent,e.next=12,this._wrapPaginator(r,a,(function(e){return Promise.all(e.map((function(e){return o._upsertMessage(e.index,e.data)})))}));case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),u}(h.ReplayEventEmitter),Ce=function(){function e(t){M.default(this,e),P.default(this,"attributes",{}),P.default(this,"mediaContent",[]),P.default(this,"emailOptions",{}),this.messagesEntity=t}return j.default(e,[{key:"send",value:function(){var e=this;return new k.CancellablePromise(function(){var t=R.default(L.default.mark((function t(n,r,i){var a,o;return L.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.messagesEntity.sendV2(e),i((function(){return a.cancel()})),t.prev=2,t.next=5,a;case 5:o=t.sent,n(Q(o.index)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),r(t.t0);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e,n,r){return t.apply(this,arguments)}}())}}]),e}(),Oe=function(){function e(t,n){M.default(this,e),this.limits=t,this.message=new Ce(n),this.emailBodies=new Map,this.emailHistories=new Map}return j.default(e,[{key:"setBody",value:function(e){return this.message.text=e,this}},{key:"setSubject",value:function(e){return this.message.emailOptions.subject=e,this}},{key:"setAttributes",value:function(e){return this.message.attributes=e,this}},{key:"setEmailBody",value:function(e,t){return this.emailBodies.set(e,t),this}},{key:"setEmailHistory",value:function(e,t){return this.emailHistories.set(e,t),this}},{key:"addMedia",value:function(e){if("undefined"==typeof FormData&&e instanceof FormData)throw new Error("Could not add FormData content whilst not in a browser");if(!(e instanceof FormData)){var t=e;if(!t.contentType||!t.media)throw new Error("Media content in SendMediaOptions must contain non-empty contentType and media")}return this.message.mediaContent.push(["media",e]),this}},{key:"build",value:function(){var e=this;if(this.emailBodies.forEach((function(t,n){if(!e.limits.emailBodiesAllowedContentTypes.includes(n))throw new Error("Unsupported email body content type ".concat(n))})),this.emailHistories.forEach((function(t,n){if(!e.limits.emailHistoriesAllowedContentTypes.includes(n))throw new Error("Unsupported email history content type ".concat(n))})),this.emailBodies.size>this.limits.emailBodiesAllowedContentTypes.length)throw new Error("Too many email bodies attached to the message (".concat(this.emailBodies.size," > ").concat(this.limits.emailBodiesAllowedContentTypes.length,")"));if(this.emailHistories.size>this.limits.emailHistoriesAllowedContentTypes.length)throw new Error("Too many email histories attached to the message (".concat(this.emailHistories.size," > ").concat(this.limits.emailHistoriesAllowedContentTypes.length,")"));if(this.message.mediaContent.length>this.limits.mediaAttachmentsCountLimit)throw new Error("Too many media attachments in the message (".concat(this.message.mediaContent.length," > ").concat(this.limits.mediaAttachmentsCountLimit,")"));return this.emailBodies.forEach((function(t){e.message.mediaContent.push(["body",t])})),this.emailHistories.forEach((function(t){e.message.mediaContent.push(["history",t])})),this.message}},{key:"buildAndSend",value:function(){return this.build().send()}},{key:"getPayloadContentType",value:function(e){return"undefined"!=typeof FormData&&e instanceof FormData?e.get("Content-Type"):e.contentType}}]),e}();function Ae(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pe(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}var Me={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",uniqueName:"uniqueName",state:"state",bindings:"bindings"},Le=function(e){C.default(N,e);var t,n,r,i,a,o,s,u,c,l,f,d,p,h,v,y,m,g,b,w,k,x,_,S,E,T,O,A,P=je(N);function N(e,t,n,r,i){var a,o,s;M.default(this,N),(s=P.call(this)).sid=t,s._links=n,s._configuration=r,s._services=i,s._entityName=e.channel,s._internalState={uniqueName:e.uniqueName||null,status:"notParticipating",attributes:null!==(a=e.attributes)&&void 0!==a?a:{},createdBy:e.createdBy,dateCreated:Y(e.dateCreated),dateUpdated:Y(e.dateUpdated),friendlyName:e.friendlyName||null,lastReadMessageIndex:Number.isInteger(e.lastConsumedMessageIndex)?e.lastConsumedMessageIndex:null,bindings:null!==(o=e.bindings)&&void 0!==o?o:{}},e.notificationLevel&&(s._internalState.notificationLevel=e.notificationLevel);var u={participants:s._links.participants};return s._participants=new Map,s._participantsEntity=new he(I.default(s),s._participants,u,s._configuration,s._services),s._participantsEntity.on("participantJoined",(function(e){return s.emit("participantJoined",e)})),s._participantsEntity.on("participantLeft",(function(e){return s.emit("participantLeft",e)})),s._participantsEntity.on("participantUpdated",(function(e){return s.emit("participantUpdated",e)})),s._messagesEntity=new Ie(I.default(s),r,i),s._messagesEntity.on("messageAdded",(function(e){return s._onMessageAdded(e)})),s._messagesEntity.on("messageUpdated",(function(e){return s.emit("messageUpdated",e)})),s._messagesEntity.on("messageRemoved",(function(e){return s.emit("messageRemoved",e)})),s}return j.default(N,[{key:"uniqueName",get:function(){return this._internalState.uniqueName}},{key:"status",get:function(){return this._internalState.status}},{key:"friendlyName",get:function(){return this._internalState.friendlyName}},{key:"dateUpdated",get:function(){return this._internalState.dateUpdated}},{key:"dateCreated",get:function(){return this._internalState.dateCreated}},{key:"createdBy",get:function(){var e;return null!==(e=this._internalState.createdBy)&&void 0!==e?e:""}},{key:"attributes",get:function(){return this._internalState.attributes}},{key:"lastReadMessageIndex",get:function(){return this._internalState.lastReadMessageIndex}},{key:"lastMessage",get:function(){var e;return null!==(e=this._internalState.lastMessage)&&void 0!==e?e:void 0}},{key:"notificationLevel",get:function(){var e;return null!==(e=this._internalState.notificationLevel)&&void 0!==e?e:"default"}},{key:"bindings",get:function(){return this._internalState.bindings}},{key:"limits",get:function(){return this._configuration.limits}},{key:"state",get:function(){return this._internalState.state}},{key:"_statusSource",get:function(){return this._dataSource}},{key:"add",value:(A=R.default(L.default.mark((function e(t,n){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._participantsEntity.add(t,null!=n?n:{}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return A.apply(this,arguments)})},{key:"addNonChatParticipant",value:(O=R.default(L.default.mark((function e(t,n){var r,i,a=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},i=a.length>3&&void 0!==a[3]?a[3]:{},e.abrupt("return",this._participantsEntity.addNonChatParticipant(t,n,null!=r?r:{},null!=i?i:{}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return O.apply(this,arguments)})},{key:"advanceLastReadMessageIndex",value:(T=R.default(L.default.mark((function e(t){var n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:if(!(t<(null!==(n=this.lastReadMessageIndex)&&void 0!==n?n:0))){e.next=6;break}return e.next=5,this._setLastReadMessageIndex(this.lastReadMessageIndex);case 5:case 8:return e.abrupt("return",e.sent);case 6:return e.next=8,this._setLastReadMessageIndex(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"delete",value:(E=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("delete",this._links.self);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"getAttributes",value:(S=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"getMessages",value:(_=R.default(L.default.mark((function e(t,n,r){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._messagesEntity.getMessages(t,n,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return _.apply(this,arguments)})},{key:"getParticipants",value:(x=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._participantsEntity.getParticipants());case 3:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"getParticipantsCount",value:(k=R.default(L.default.mark((function e(){var t,n,r;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Z(this._configuration.links.conversations).path(this.sid).build(),e.next=3,this._services.network.get(n);case 3:return r=e.sent,e.abrupt("return",null!==(t=r.body.participants_count)&&void 0!==t?t:0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"getParticipantBySid",value:(w=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._participantsEntity.getParticipantBySid(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"getParticipantByIdentity",value:(b=R.default(L.default.mark((function e(){var t,n=arguments;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",e.abrupt("return",this._participantsEntity.getParticipantByIdentity(null!=t?t:""));case 2:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"getMessagesCount",value:(g=R.default(L.default.mark((function e(){var t,n,r;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Z(this._configuration.links.conversations).path(this.sid).build(),e.next=3,this._services.network.get(n);case 3:return r=e.sent,e.abrupt("return",null!==(t=r.body.messages_count)&&void 0!==t?t:0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"getUnreadMessagesCount",value:(m=R.default(L.default.mark((function e(){var t,n,r;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Z(this._configuration.links.myConversations).path(this.sid).build(),e.next=3,this._services.network.get(t);case 3:if((n=e.sent).body.conversation_sid===this.sid){e.next=6;break}throw new Error("Conversation was not found in the user conversations list");case 6:if("number"!=typeof(r=n.body.unread_messages_count)){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"join",value:(y=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post",this._links.participants,{identity:this._configuration.userIdentity});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"leave",value:(v=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this._internalState.status){e.next=3;break}return e.next=3,this._services.commandExecutor.mutateResource("delete","".concat(this._links.participants,"/").concat(this._configuration.userIdentity));case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"removeParticipant",value:(h=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._participantsEntity.remove("string"==typeof t?t:t.sid);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"sendMessage",value:(p=R.default(L.default.mark((function e(t,n,r){var i,a,o,s;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t&&null!==t){e.next=5;break}return e.next=3,this._messagesEntity.send(t,n,r);case 3:return o=e.sent,e.abrupt("return",null!==(a=Q(o.index))&&void 0!==a?a:0);case 5:return e.next=7,this._messagesEntity.sendMedia(t,n,r);case 7:return s=e.sent,e.abrupt("return",null!==(i=Q(s.index))&&void 0!==i?i:0);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"prepareMessage",value:function(){return new Oe(this.limits,this._messagesEntity)}},{key:"setAllMessagesRead",value:(d=R.default(L.default.mark((function e(){var t;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastReadMessageIndex(t.items[0].index));case 7:return e.abrupt("return",0);case 8:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"setAllMessagesUnread",value:(f=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this._setLastReadMessageIndex(null);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(l=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{notification_level:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"typing",value:function(){return this._services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(c=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post",this._links.self,{attributes:void 0!==t?JSON.stringify(t):void 0});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"updateFriendlyName",value:(u=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._internalState.friendlyName===t){e.next=3;break}return e.next=3,this._services.commandExecutor.mutateResource("post",this._links.self,{friendly_name:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"updateLastReadMessageIndex",value:(s=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this._setLastReadMessageIndex(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"updateUniqueName",value:(o=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._internalState.uniqueName===t){e.next=4;break}return t||(t=""),e.next=4,this._services.commandExecutor.mutateResource("post",this._links.self,{unique_name:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_subscribe",value:(a=R.default(L.default.mark((function e(){var t=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._entityPromise){e.next=2;break}return e.abrupt("return",this._entityPromise);case 2:return this._entityPromise=this._services.syncClient.document({id:this._entityName,mode:"open_existing"}),e.prev=3,e.next=6,this._entityPromise;case 6:return this._entity=e.sent,this._entity.on("updated",(function(e){return t._update(e.data)})),this._entity.on("removed",(function(){return t.emit("removed",t)})),this._update(this._entity.data),e.abrupt("return",this._entity);case 13:throw e.prev=13,e.t0=e.catch(3),this._entity=null,this._entityPromise=null,"disconnected"!=this._services.syncClient.connectionState&&N._logger.error("Failed to get conversation object",e.t0),N._logger.debug("ERROR: Failed to get conversation object",e.t0),e.t0;case 20:case"end":return e.stop()}}),e,this,[[3,13]])}))),function(){return a.apply(this,arguments)})},{key:"_fetchStreams",value:(i=R.default(L.default.mark((function e(){var t,n,r;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return N._logger.trace("_streamsAvailable, this.entity.data=",null===(t=this._entity)||void 0===t?void 0:t.data),r=null===(n=this._entity)||void 0===n?void 0:n.data,e.next=6,this._services.syncClient.list({id:r.messages,mode:"open_existing"});case 6:return this._messagesList=e.sent,e.next=9,this._services.syncClient.map({id:r.roster,mode:"open_existing"});case 9:this._participantsMap=e.sent;case 10:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_subscribeStreams",value:(r=R.default(L.default.mark((function e(){var t,n,r,i,a,o,s;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return N._logger.trace("_subscribeStreams, this.entity.data=",null===(t=this._entity)||void 0===t?void 0:t.data),a=null===(n=this._entity)||void 0===n?void 0:n.data,o=a.messages,s=a.roster,e.next=9,Promise.all([this._messagesEntity.subscribe(null!==(r=this._messagesList)&&void 0!==r?r:o),this._participantsEntity.subscribe(null!==(i=this._participantsMap)&&void 0!==i?i:s)]);case 9:e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(0),"disconnected"!==this._services.syncClient.connectionState&&N._logger.error("Failed to subscribe on conversation objects",this.sid,e.t0),N._logger.debug("ERROR: Failed to subscribe on conversation objects",this.sid,e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(){return r.apply(this,arguments)})},{key:"_unsubscribe",value:(n=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._entity){e.next=5;break}return e.next=3,this._entity.close();case 3:this._entity=null,this._entityPromise=null;case 5:return e.abrupt("return",Promise.all([this._participantsEntity.unsubscribe(),this._messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;this._dataSource=t,this._internalState.status!==e&&(this._internalState.status=e,"joined"!==e?this._entityPromise&&this._unsubscribe().catch((function(t){if(N._logger.debug("ERROR while setting conversation status "+e,t),"disconnected"!==n._services.syncClient.connectionState)throw t})):this._subscribeStreams().catch((function(t){if(N._logger.debug("ERROR while setting conversation status "+e,t),"disconnected"!==n._services.syncClient.connectionState)throw t})))}},{key:"_update",value:function(e){var t,n,r,i,a;N._logger.trace("_update",e),N.preprocessUpdate(e,this.sid);for(var o=new Set,s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=Me[c];if(l)switch(l){case Me.status:if(!e.status||"unknown"===e.status||this._internalState.status===e.status)break;this._internalState.status=e.status,o.add(l);break;case Me.attributes:if(F.default(this._internalState.attributes,e.attributes))break;this._internalState.attributes=e.attributes,o.add(l);break;case Me.lastConsumedMessageIndex:if(void 0===e.lastConsumedMessageIndex||e.lastConsumedMessageIndex===this._internalState.lastReadMessageIndex)break;this._internalState.lastReadMessageIndex=e.lastConsumedMessageIndex,o.add("lastReadMessageIndex");break;case Me.lastMessage:if(this._internalState.lastMessage&&!e.lastMessage){delete this._internalState.lastMessage,o.add(l);break}this._internalState.lastMessage=this._internalState.lastMessage||{},void 0!==(null===(t=e.lastMessage)||void 0===t?void 0:t.index)&&e.lastMessage.index!==this._internalState.lastMessage.index&&(this._internalState.lastMessage.index=e.lastMessage.index,o.add(l)),void 0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.timestamp)&&(null===(r=this._internalState.lastMessage)||void 0===r||null===(i=r.dateCreated)||void 0===i?void 0:i.getTime())!==e.lastMessage.timestamp.getTime()&&(this._internalState.lastMessage.dateCreated=e.lastMessage.timestamp,o.add(l)),F.default(this._internalState.lastMessage,{})&&delete this._internalState.lastMessage;break;case Me.state:var f=e.state||void 0;if(void 0!==f&&(f.dateUpdated=new Date(f.dateUpdated)),F.default(this._internalState.state,f))break;this._internalState.state=f,o.add(l);break;case Me.bindings:if(F.default(this._internalState.bindings,e.bindings))break;this._internalState.bindings=e.bindings,o.add(l);break;default:var d=e[c]instanceof Date,p=d&&(null===(a=this._internalState[l])||void 0===a?void 0:a.getTime())===e[c].getTime(),h=!d&&this[l]===e[c];if(p||h)break;this._internalState[l]=e[c],o.add(l)}}o.size>0&&this.emit("updated",{conversation:this,updateReasons:B.default(o)})}},{key:"_onMessageAdded",value:function(e){var t,n=Ae(this._participants.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identity===e.author){r._endTyping();break}}}catch(i){n.e(i)}finally{n.f()}this.emit("messageAdded",e)}},{key:"_setLastReadMessageIndex",value:(t=R.default(L.default.mark((function e(t){var n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.mutateResource("post","".concat(this._configuration.links.myConversations,"/").concat(this.sid),{last_read_message_index:t});case 2:return n=e.sent,e.abrupt("return",n.unread_messages_count);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&JSON.stringify(e.attributes)}catch(n){N._logger.warn("Retrieved malformed attributes from the server for conversation: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){N._logger.warn("Retrieved malformed dateCreated from the server for conversation: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){N._logger.warn("Retrieved malformed dateUpdated from the server for conversation: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){N._logger.warn("Retrieved malformed lastMessage.timestamp from the server for conversation: "+t),delete e.lastMessage.timestamp}}}]),N}(h.ReplayEventEmitter);P.default(Le,"participantJoined","participantJoined"),P.default(Le,"participantLeft","participantLeft"),P.default(Le,"participantUpdated","participantUpdated"),P.default(Le,"messageAdded","messageAdded"),P.default(Le,"messageRemoved","messageRemoved"),P.default(Le,"messageUpdated","messageUpdated"),P.default(Le,"typingEnded","typingEnded"),P.default(Le,"typingStarted","typingStarted"),P.default(Le,"updated","updated"),P.default(Le,"removed","removed"),P.default(Le,"_logger",$.scope("Conversation")),q([p.validateTypesAsync(p.nonEmptyString,te),z("design:type",Function),z("design:paramtypes",[String,Object]),z("design:returntype",Promise)],Le.prototype,"add",null),q([p.validateTypesAsync(p.nonEmptyString,p.nonEmptyString,te),z("design:type",Function),z("design:paramtypes",[String,String,Object,Object]),z("design:returntype",Promise)],Le.prototype,"addNonChatParticipant",null),q([p.validateTypesAsync(p.nonNegativeInteger),z("design:type",Function),z("design:paramtypes",[Number]),z("design:returntype",Promise)],Le.prototype,"advanceLastReadMessageIndex",null),q([p.validateTypesAsync(["undefined",p.nonNegativeInteger],["undefined",p.nonNegativeInteger],["undefined",p.literal("backwards","forward")]),z("design:type",Function),z("design:paramtypes",[Number,Number,String]),z("design:returntype",Promise)],Le.prototype,"getMessages",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],Le.prototype,"getParticipantBySid",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],Le.prototype,"getParticipantByIdentity",null),q([p.validateTypesAsync([p.nonEmptyString,fe]),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],Le.prototype,"removeParticipant",null),q([p.validateTypesAsync(["string",FormData,p.literal(null),p.objectSchema("media options",{contentType:p.nonEmptyString,media:p.custom((function(e){var t="string"==typeof e&&e.length>0||e instanceof Uint8Array||e instanceof ArrayBuffer;return"function"==typeof Blob&&(t=t||e instanceof Blob),[t,"a non-empty string, an instance of Buffer or an instance of Blob"]}))})],te,["undefined",p.literal(null),p.objectSchema("email attributes",{subject:[p.nonEmptyString,"undefined"]})]),z("design:type",Function),z("design:paramtypes",[Object,Object,Object]),z("design:returntype",Promise)],Le.prototype,"sendMessage",null),q([p.validateTypesAsync(p.literal("default","muted")),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],Le.prototype,"setUserNotificationLevel",null),q([p.validateTypesAsync(ee),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],Le.prototype,"updateAttributes",null),q([p.validateTypesAsync("string"),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],Le.prototype,"updateFriendlyName",null),q([p.validateTypesAsync([p.literal(null),p.nonNegativeInteger]),z("design:type",Function),z("design:paramtypes",[Number]),z("design:returntype",Promise)],Le.prototype,"updateLastReadMessageIndex",null),q([p.validateTypesAsync(["string",p.literal(null)]),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],Le.prototype,"updateUniqueName",null);var Ne=function(){function e(){var t=this;M.default(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return j.default(e,[{key:"promise",get:function(){return this._promise}},{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}}]),e}();function Ue(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fe(e,t)}(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){P.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}var ze=$.scope("Conversations"),We=function(e){C.default(p,e);var t,n,r,i,a,o,s,u,c,l,f,d=qe(p);function p(e,t){var n;return M.default(this,p),n=d.call(this),P.default(I.default(n),"conversations",new Map),P.default(I.default(n),"myConversationsRead",new Ne),P.default(I.default(n),"tombstones",new Set),P.default(I.default(n),"myConversationsFetched",!1),n.configuration=e,n.services=t,n}return j.default(p,[{key:"addConversation",value:(f=R.default(L.default.mark((function e(t){var n,r,i,a,o,s,u,c,l,f;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0!==(null==t?void 0:t.attributes)?t.attributes:{},e.next=3,this.services.commandExecutor.mutateResource("post",this.configuration.links.conversations,{friendly_name:t.friendlyName,unique_name:t.uniqueName,attributes:void 0!==a?JSON.stringify(a):void 0});case 3:if(o=e.sent,s=null!==(n=o.sid)&&void 0!==n?n:null,u=null!==(r=null===(i=o.sync_objects)||void 0===i?void 0:i.conversation)&&void 0!==r?r:null,c=Be({self:o.url},o.links),!(l=this.conversations.get(s))){e.next=12;break}return e.next=11,l._subscribe();case 11:return e.abrupt("return",l);case 12:return f=new Le({channel:u,entityName:"",uniqueName:"",attributes:null,createdBy:"",friendlyName:"",lastConsumedMessageIndex:0,dateCreated:null,dateUpdated:null},s,c,this.configuration,this.services),this.conversations.set(f.sid,f),this._registerForEvents(f),e.next=17,f._subscribe();case 17:return this.emit("conversationAdded",f),e.abrupt("return",f);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"fetchConversations",value:(l=R.default(L.default.mark((function e(){var t,n,r,i,a,o,s,u=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getMap();case 3:return(t=e.sent).on("itemAdded",(function(e){ze.debug("itemAdded: ".concat(e.item.key)),u._upsertConversation("sync",e.item.key,e.item.data)})),t.on("itemRemoved",(function(e){ze.debug("itemRemoved: ".concat(e.key));var t=e.key;u.myConversationsFetched||u.tombstones.add(t);var n=u.conversations.get(t);n&&("joined"===n.status&&(n._setStatus("notParticipating","sync"),u.emit("conversationLeft",n)),u.conversations.delete(t),u.emit("conversationRemoved",n),n.emit("removed",n))})),t.on("itemUpdated",(function(e){ze.debug("itemUpdated: ".concat(e.item.key)),u._upsertConversation("sync",e.item.key,e.item.data)})),e.next=9,this._fetchMyConversations();case 9:n=e.sent,r=[],i=Ue(n);try{for(i.s();!(a=i.n()).done;)o=a.value,r.push(this._upsertConversation("rest",o.channel_sid,o))}catch(c){i.e(c)}finally{i.f()}return this.myConversationsRead.set(!0),e.next=16,Promise.all(r);case 16:return this.myConversationsFetched=!0,this.tombstones.clear(),ze.debug("The conversations list has been successfully fetched"),e.abrupt("return",this);case 22:throw e.prev=22,e.t0=e.catch(0),s="Failed to fetch the conversations list","disconnected"!==this.services.syncClient.connectionState&&ze.error(s,e.t0),ze.debug("ERROR: ".concat(s),e.t0),e.t0;case 28:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(){return l.apply(this,arguments)})},{key:"getConversations",value:(c=R.default(L.default.mark((function e(){var t,n,r=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getMap();case 2:return t=e.sent,e.next=5,t.getItems();case 5:return n=e.sent,e.abrupt("return",this._wrapPaginator(n,(function(e){return Promise.all(e.map((function(e){return r._upsertConversation("sync",e.key,e.data)})))})));case 7:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getConversation",value:(u=R.default(L.default.mark((function e(t){var n,r,i,a=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getMap();case 2:return n=e.sent,e.next=5,n.getItems({key:t});case 5:return r=e.sent,i=r.items.map((function(e){return a._upsertConversation("sync",e.key,e.data)})),e.abrupt("return",i.length>0?i[0]:null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getConversationByUniqueName",value:(s=R.default(L.default.mark((function e(t){var n,r,i,a,o;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Z(this.configuration.links.myConversations).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,i=r.body,a=i.conversation_sid,o={entityName:null,lastConsumedMessageIndex:i.last_read_message_index,status:(null==i?void 0:i.status)||"unknown",friendlyName:i.friendly_name,dateUpdated:i.date_updated,dateCreated:i.date_created,uniqueName:i.unique_name,createdBy:i.created_by,attributes:i.attributes,channel:i.sync_objects.conversation,notificationLevel:null==i?void 0:i.notification_level,sid:a},e.abrupt("return",a?this._upsertConversation("sync",a,o):null);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"peekConversation",value:(o=R.default(L.default.mark((function e(t){var n,r,i,a;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Z(this.configuration.links.conversations).path(t).build(),e.next=3,this.services.network.get(n);case 3:return r=e.sent,i=r.body,a={entityName:null,status:(null==i?void 0:i.status)||"unknown",friendlyName:i.friendly_name,dateUpdated:i.date_updated,dateCreated:i.date_created,uniqueName:i.unique_name,createdBy:i.created_by,attributes:i.attributes,channel:"".concat(t,".channel"),sid:t},e.abrupt("return",this._upsertConversation("sync",t,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_getMap",value:(a=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.syncClient.map({id:this.configuration.myConversations,mode:"open_existing"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_wrapPaginator",value:(i=R.default(L.default.mark((function e(t,n){var r,i=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t.items);case 2:return r=e.sent,e.abrupt("return",{items:r.filter((function(e){return null!==e})),hasNextPage:t.hasNextPage,hasPrevPage:t.hasPrevPage,nextPage:function(){return t.nextPage().then((function(e){return i._wrapPaginator(e,n)}))},prevPage:function(){return t.prevPage().then((function(e){return i._wrapPaginator(e,n)}))}});case 4:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"_updateConversation",value:(r=R.default(L.default.mark((function e(t,n,r){var i,a,o;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0!==n._statusSource&&t!==n._statusSource,a="rest"!==t||"sync"===n._statusSource,!i||!a||"sync"===t){e.next=5;break}return ze.trace("upsertConversation: conversation is known from sync and came from REST, ignoring",{sid:n.sid,data:r.status,conversation:n.status}),e.abrupt("return");case 5:if("joined"!==r.status||"joined"===n.status){e.next=15;break}return n._setStatus("joined",t),o={},void 0!==r.notificationLevel&&(o.notificationLevel=r.notificationLevel),void 0!==r.lastConsumedMessageIndex&&(o.lastConsumedMessageIndex=r.lastConsumedMessageIndex),F.default(o,{})||n._update(o),e.next=13,n._subscribe();case 13:return this.emit("conversationJoined",n),e.abrupt("return");case 15:if("notParticipating"!==r.status||"joined"!==n.status){e.next=22;break}return n._setStatus("notParticipating",t),n._update(r),e.next=20,n._subscribe();case 20:return this.emit("conversationLeft",n),e.abrupt("return");case 22:if("notParticipating"!==r.status){e.next=26;break}return e.next=25,n._subscribe();case 25:return e.abrupt("return");case 26:n._update(r);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_upsertConversation",value:(n=R.default(L.default.mark((function e(t,n,r){var i,a,o,s;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ze.trace("upsertConversation called for ".concat(n),r),!(i=this.conversations.get(n))){e.next=9;break}return ze.trace("upsertConversation: the conversation ".concat(i.sid," is known;")+"its status is known from the source ".concat(i._statusSource," ")+"and the update came from the source ".concat(t),i),e.next=6,this._updateConversation(t,i,r);case 6:return e.next=8,i._subscribe();case 8:return e.abrupt("return",i);case 9:if("rest"!==t||!this.tombstones.has(n)){e.next=12;break}return ze.trace("upsertChannel: the conversation is deleted but reappeared again from REST, ignoring",n),e.abrupt("return",null);case 12:return ze.trace("upsertConversation: creating a local conversation object with sid "+n,r),a="".concat(this.configuration.links.conversations,"/").concat(n),o={self:a,messages:"".concat(a,"/Messages"),participants:"".concat(a,"/Participants")},s=new Le(r,n,o,this.configuration,this.services),this.conversations.set(n,s),e.prev=17,e.next=20,s._subscribe();case 20:if("joined"!==r.status){e.next=23;break}return e.next=23,s._fetchStreams();case 23:e.next=32;break;case 25:if(e.prev=25,e.t0=e.catch(17),"SyncError"===e.t0.name){e.next=29;break}throw e.t0;case 29:return ze.trace("upsertChannel: the conversation is missing some Sync entity(ies), ignoring",n,e.t0),this.conversations.delete(n),e.abrupt("return",null);case 32:return this._registerForEvents(s),this.emit("conversationAdded",s),"joined"===r.status&&(s._setStatus("joined",t),this.emit("conversationJoined",s)),e.abrupt("return",s);case 36:case"end":return e.stop()}}),e,this,[[17,25]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_fetchMyConversations",value:(t=R.default(L.default.mark((function e(){var t,n,r,i,a,o;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=null;case 2:return i=new Z(this.configuration.links.myConversations),n&&i.arg("PageToken",n),e.next=6,this.services.network.get(i.build());case 6:a=e.sent,o=null===(r=a.body)||void 0===r?void 0:r.conversations.map((function(e){return{descriptor:e,channel_sid:e.conversation_sid,status:e.status,channel:e.sync_objects.conversation,messages:e.sync_objects.messages,roster:"".concat(e.conversation_sid,".roster"),lastConsumedMessageIndex:e.last_read_message_index,notificationLevel:e.notification_level}})),n=a.body.meta.next_token,t=[].concat(B.default(t),B.default(o));case 10:if(n){e.next=2;break}case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_onConversationRemoved",value:function(e){var t=this.conversations.get(e);t&&(this.conversations.delete(e),this.emit("conversationRemoved",t))}},{key:"_registerForEvents",value:function(e){var t=this;e.on("removed",(function(){return t._onConversationRemoved(e.sid)})),e.on("updated",(function(e){return t.emit("conversationUpdated",e)})),e.on("participantJoined",(function(e){return t.emit("participantJoined",e)})),e.on("participantLeft",(function(e){return t.emit("participantLeft",e)})),e.on("participantUpdated",(function(e){return t.emit("participantUpdated",e)})),e.on("messageAdded",(function(e){return t.emit("messageAdded",e)})),e.on("messageUpdated",(function(e){return t.emit("messageUpdated",e)})),e.on("messageRemoved",(function(e){return t.emit("messageRemoved",e)})),e.on("typingStarted",(function(e){return t.emit("typingStarted",e)})),e.on("typingEnded",(function(e){return t.emit("typingEnded",e)}))}}]),p}(h.ReplayEventEmitter);function Ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}var $e=function(e){C.default(a,e);var t,n,r,i=Ge(a);function a(e,t,n){var r;return M.default(this,a),(r=i.call(this)).configuration=t,r.services=n,r.fifoStack=[],r.myself=e,r.myself.on("updated",(function(e){return r.emit("userUpdated",e)})),r.myself.on("userSubscribed",(function(){return r.emit("userSubscribed",r.myself)})),r.myself.on("userUnsubscribed",(function(){r.emit("userUnsubscribed",r.myself),r.myself._ensureFetched()})),r.subscribedUsers=new Map,r}return j.default(a,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=0,n=this.fifoStack.find((function(n,r){return n==e.identity&&(t=r,!0)}));n&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){if(!this.subscribedUsers.has(e.identity)){if(this.fifoStack.length>=this.configuration.userInfosToSubscribe){var t,n,r=this.fifoStack.shift();null===(t=this.subscribedUsers)||void 0===t||null===(n=t.get(r))||void 0===n||n.unsubscribe()}this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e)}}},{key:"getUser",value:(r=R.default(L.default.mark((function e(t,n){var r,i,a,o=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.myself._ensureFetched();case 2:if(t!=this.myself.identity){e.next=4;break}return e.abrupt("return",this.myself);case 4:if(!(i=this.subscribedUsers.get(t))){e.next=7;break}return e.abrupt("return",i);case 7:if(null===(r=n)||void 0===r){e.next=11;break}e.next=14;break;case 11:return e.next=13,this.getSyncUniqueName(t);case 13:n=e.sent;case 14:return(a=new ie(t,n,this.configuration,this.services)).on("updated",(function(e){return o.emit("userUpdated",e)})),a.on("userSubscribed",(function(){return o.handleSubscribeUser(a)})),a.on("userUnsubscribed",(function(){return o.handleUnsubscribeUser(a)})),e.next=20,a._ensureFetched();case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"getSubscribedUsers",value:(n=R.default(L.default.mark((function e(){var t;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.myself._ensureFetched();case 2:return t=[this.myself],this.subscribedUsers.forEach((function(e){return t.push(e)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getSyncUniqueName",value:(t=R.default(L.default.mark((function e(t){var n,r,i,a;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Z(this.configuration.links.users).path(t).build(),e.next=3,this.services.network.get(i);case 3:return a=e.sent,e.abrupt("return",null!==(n=null===(r=a.body)||void 0===r?void 0:r.sync_objects.user_info_map)&&void 0!==n?n:"");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(h.ReplayEventEmitter),He=$.scope("TypingIndicator"),Ve=function(){function e(t,n,r){M.default(this,e),this.configuration=n,this.services=r,this.getConversation=t,this.serviceTypingTimeout=null,this.sentUpdates=new Map}var t;return j.default(e,[{key:"typingTimeout",get:function(){return this.configuration.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.configuration.typingIndicatorTimeoutDefault}},{key:"initialize",value:function(){var e=this;this.services.notificationClient.on("message",function(){var t=R.default(L.default.mark((function t(n,r){return L.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n!==ue.TYPING_INDICATOR){t.next=3;break}return t.next=3,e._handleRemoteTyping(r);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"_handleRemoteTyping",value:(t=R.default(L.default.mark((function e(t){var n=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:He.trace("Got new typing indicator ",t),this.getConversation(t.channel_sid).then((function(e){e&&e._participants.forEach((function(e){if(e.identity===t.identity){var r=n.configuration.typingIndicatorTimeoutOverride?n.configuration.typingIndicatorTimeoutOverride+1e3:1e3*t.typing_timeout;e._startTyping(r)}}))})).catch((function(e){throw He.error(e),e}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?Promise.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;He.trace("Sending typing indicator");var n=this.configuration.links.typing,r="ChannelSid=".concat(e);return this.services.twilsockClient.post(n,{"Content-Type":"application/x-www-form-urlencoded"},r,this.configuration.productId).then((function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)})).catch((function(e){throw He.error("Failed to send typing indicator:",e),e}))}}]),e}(),Je=j.default((function e(t){M.default(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}})),Ke="2.2.1";function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){P.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xe,Ze,et=function(e){return e.replace(/(^\/+|\/+$)/g,"")},tt=function(){function e(t,n,r){M.default(this,e),this._serviceUrl=t,this._services=n,this._productId=r}var t,n,r;return j.default(e,[{key:"_preProcessUrl",value:function(e){var t=et(e);return/^https?:\/\//.test(e)?t:"".concat(et(this._serviceUrl),"/").concat(t)}},{key:"_makeRequest",value:(r=R.default(L.default.mark((function e(t,n,r,i){var a,o,s,u;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this._preProcessUrl(n),o=Ye({"Content-Type":"application/json; charset=utf-8"},i||{}),e.t0=t,e.next="get"===e.t0?5:"post"===e.t0?11:"delete"===e.t0?15:19;break;case 5:return u=a,r&&(u+="?"+Object.entries(r).map((function(e){return e.map(encodeURIComponent).join("=")})).join("&")),e.next=9,this._services.transport.get(u,o,this._productId);case 9:case 13:case 17:return s=e.sent,e.abrupt("break",19);case 11:return e.next=13,this._services.transport.post(a,o,JSON.stringify(r),this._productId);case 15:return e.next=17,this._services.transport.delete(a,o,{},this._productId);case 19:if(!(s.status.code<200||s.status.code>=300)){e.next=21;break}throw new Error("Request responded with a non-success code ".concat(s.status.code));case 21:return e.abrupt("return",s);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"fetchResource",value:(n=R.default(L.default.mark((function e(t,n){var r,i=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,new m.AsyncRetrier({min:50,max:1600,maxAttemptsCount:6}).run((function(){return i._makeRequest("get",t,n)}));case 4:return r=e.sent,e.abrupt("return",r.body);case 8:throw e.prev=8,e.t0=e.catch(1),new Error('Fetch resource from "'.concat(t,'" failed.'));case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"mutateResource",value:(t=R.default(L.default.mark((function e(t,n,r){var i;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._makeRequest(t,n,r,{"X-Twilio-Mutation-Id":S.v4()});case 2:if(202!==(i=e.sent).status.code){e.next=7;break}return e.next=6,this.fetchResource(i.body.resource_url);case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",i.body);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){P.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function it(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A.default(e);if(t){var i=A.default(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return O.default(this,n)}}var at=j.default((function e(){M.default(this,e)}));t.Client=(Xe=function(e){C.default(m,e);var t,n,r,i,a,o,s,u,c,l,f,d,p,h,v,y=it(m);function m(e){var t,n,r,i,a,o,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(M.default(this,m),o=y.call(this),P.default(I.default(o),"version",Ke),P.default(I.default(o),"connectionState","unknown"),P.default(I.default(o),"parsePushNotification",Ze.parsePushNotification),o._fpaToken=null!=e?e:"",o._options=null!=u?u:{},!o._options.disableDeepClone){var c=rt(rt({},o._options),{},{transport:void 0,twilsockClient:void 0});s=c,(c=JSON.parse(JSON.stringify(s))).transport=o._options.transport,c.twilsockClient=o._options.twilsockClient,o._options=c}o._options.logLevel=null!==(t=o._options.logLevel)&&void 0!==t?t:"silent",Ze._logger.setLevel(o._options.logLevel);var l=o._options.productId="ip_messaging";if(o._options.clientMetadata=o._options.clientMetadata||{},o._options.clientMetadata.hasOwnProperty("type")||(o._options.clientMetadata.type="conversations"),o._options.clientMetadata.hasOwnProperty("sdk")||(o._options.clientMetadata.sdk="JS",o._options.clientMetadata.sdkv=Ke),o._options.Sync=o._options.Sync||{},void 0===o._options.Sync.enableSessionStorage&&(o._options.Sync.enableSessionStorage=!0),o._options.region&&(o._options.Sync.region=o._options.region),!e)throw new Error("A valid Twilio token should be provided");o._services=new at,o._myself=new ie("","",null,o._services);var f=!o._options.twilsockClient;if(!o._options.initRegistrations){var d=new g.InitRegistration(l);Ze.populateInitRegistrations(d),o._options.initRegistrations=[d]}o._services.twilsockClient=o._options.twilsockClient=null!==(n=o._options.twilsockClient)&&void 0!==n?n:new g.TwilsockClient(e,l,o._options),o._services.twilsockClient.on("tokenAboutToExpire",(function(){return o.emit("tokenAboutToExpire")})),o._services.twilsockClient.on("tokenExpired",(function(){return o.emit("tokenExpired")})),o._services.twilsockClient.on("connectionError",(function(e){return o.emit("connectionError",e)})),o._services.twilsockClient.on("stateChanged",(function(e){Ze._logger.debug("Handling stateChanged for ConversationsClient: new state ".concat(e)),e!==o.connectionState&&(o.connectionState=e,o.emit("connectionStateChanged",o.connectionState))})),o._services.transport=o._options.transport=null!==(r=o._options.transport)&&void 0!==r?r:o._options.twilsockClient,o._services.notificationClient=o._options.notificationsClient=null!==(i=o._options.notificationsClient)&&void 0!==i?i:new b.Notifications(e,o._options),o._services.syncClient=o._options.syncClient=null!==(a=o._options.syncClient)&&void 0!==a?a:new w.SyncClient(e,o._options);var p=(null==u?void 0:u.Chat)||(null==u?void 0:u.IPMessaging)||u||{},h=p.region||(null==u?void 0:u.region),v=p.apiUri||p.typingUri||"https://aim.".concat(h||"us1",".twilio.com");o._services.commandExecutor=new tt(v,{transport:o._options.transport},l);var k=function(e){o._rejectEnsureReady(e),o.emit("stateChanged","failed"),o.emit("initFailed",{error:e})},x=function(){k({terminal:!0,message:"Twilsock has disconnected."})};return o._services.twilsockClient.once("connectionError",k),o._services.twilsockClient.once("disconnected",x),o._services.twilsockClient.once("connected",R.default(L.default.mark((function e(){var t,n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ze._logger.debug("ConversationsClient started INITIALIZING"),o._services.twilsockClient.off("connectionError",k),o._services.twilsockClient.off("disconnected",x),e.prev=3,t="conversations.client.startup",o._services.twilsockClient.addPartialTelemetryEvent(new g.TelemetryEventDescription(t,"Conversations client startup",new Date),t,g.TelemetryPoint.Start),e.next=8,o._initialize();case 8:o._services.twilsockClient.addPartialTelemetryEvent(new g.TelemetryEventDescription("","",new Date),t,g.TelemetryPoint.End),e.next=17;break;case 11:e.prev=11,e.t0=e.catch(3),n={terminal:!0,message:e.t0.message},o._rejectEnsureReady(n),o.emit("stateChanged","failed"),o.emit("initFailed",{error:n});case 17:case"end":return e.stop()}}),e,null,[[3,11]])})))),o._ensureReady=new Promise((function(e,t){o._resolveEnsureReady=e,o._rejectEnsureReady=t})).catch((function(){})),f&&o._services.twilsockClient.connect(),o}return j.default(m,[{key:"user",get:function(){return this._myself}},{key:"reachabilityEnabled",get:function(){if(!this._configuration)throw new Error("Reachability information could not yet be accessed as the client has not yet been initialized. Subscribe to the 'stateChanged' event to properly react to the client initialization.");return this._configuration.reachabilityEnabled}},{key:"token",get:function(){return this._fpaToken}},{key:"shutdown",value:(v=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._services.twilsockClient.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"updateToken",value:(h=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:if(Ze._logger.info("updateToken"),this._fpaToken!==t){e.next=5;break}return e.abrupt("return",this);case 5:return e.next=7,this._services.twilsockClient.updateToken(t);case 7:return e.next=9,this._services.notificationClient.updateToken(t);case 9:return e.next=11,this._services.mcsClient.updateToken(t);case 11:return this._fpaToken=t,e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getConversationBySid",value:(p=R.default(L.default.mark((function e(t){var n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return e.next=6,this._conversationsEntity.getConversation(t);case 6:if(n=e.sent){e.next=12;break}return e.next=10,this.peekConversationBySid(t);case 10:(n=e.sent)&&_.deprecationWarning("The method getConversationBySid is deprecated to retrieve conversations you're not part of. Use peekConversationBySid instead.");case 12:if(n){e.next=14;break}throw new Error("Conversation with SID ".concat(t," was not found."));case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"peekConversationBySid",value:(d=R.default(L.default.mark((function e(t){var n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._conversationsEntity.peekConversation(t);case 4:if(n=e.sent){e.next=7;break}throw new Error("Conversation with SID ".concat(t," was not found."));case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getConversationByUniqueName",value:(f=R.default(L.default.mark((function e(t){var n;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.next=4,this._conversationsEntity.myConversationsRead.promise;case 4:return e.next=6,this._conversationsEntity.getConversationByUniqueName(t);case 6:if(n=e.sent){e.next=9;break}throw new Error("Conversation with unique name ".concat(t," was not found."));case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getSubscribedConversations",value:(l=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.abrupt("return",this._conversationsPromise.then((function(e){return e.getConversations()})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"createConversation",value:(c=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return t=t||{},e.abrupt("return",this._conversationsPromise.then((function(e){return e.addConversation(t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"setPushRegistrationId",value:(u=R.default(L.default.mark((function e(t,n){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return this._subscribeToPushNotifications(t),this._services.notificationClient.setPushRegistrationId(t,n),e.next=6,this._services.notificationClient.commitChanges();case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(s=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return this._unsubscribeFromPushNotifications(t),e.next=5,this._services.notificationClient.commitChanges();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"removePushRegistrations",value:(o=R.default(L.default.mark((function e(t,n){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.notificationClient.removeRegistrations(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"handlePushNotification",value:(a=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:Ze._logger.debug("handlePushNotification, notificationPayload=",t),this.emit("pushNotification",Ze.parsePushNotification(t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getUser",value:(i=R.default(L.default.mark((function e(t){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.abrupt("return",this._services.users.getUser(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getSubscribedUsers",value:(r=R.default(L.default.mark((function e(){return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureReady;case 2:return e.abrupt("return",this._services.users.getSubscribedUsers());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getTemporaryContentUrlsForMediaSids",value:function(e){var t=this;return new k.CancellablePromise(function(){var n=R.default(L.default.mark((function n(r,i,a){var o,s;return L.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t._services.mcsClient&&e){n.next=3;break}return i(new Error("Media Content Service is unavailable")),n.abrupt("return");case 3:return o=t._services.mcsClient.mediaSetGetContentUrls(e),a((function(){o.cancel()})),n.prev=5,n.next=8,o;case 8:s=n.sent,r(s),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(5),i(n.t0);case 15:case"end":return n.stop()}}),n,null,[[5,12]])})));return function(e,t,r){return n.apply(this,arguments)}}())}},{key:"getTemporaryContentUrlsForMedia",value:function(e){var t=e.map((function(e){return e.sid}));return this.getTemporaryContentUrlsForMediaSids(t)}},{key:"_initialize",value:(n=R.default(L.default.mark((function e(){var t,n=this;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._services.commandExecutor.fetchResource("Client/v2/Configuration");case 2:return t=e.sent,this._configuration=new K(this._options,t,Ze._logger),this._myself._resolveInitialization(this._configuration,this._configuration.userIdentity,this._configuration.userInfo,!0),this._services.typingIndicator=new Ve(this.getConversationBySid.bind(this),this._configuration,this._services),this._services.network=new se(this._configuration,this._services),this._services.users=new $e(this._myself,this._configuration,this._services),this._services.users.on("userSubscribed",(function(e){n.emit("userSubscribed",e)})),this._services.users.on("userUpdated",(function(e){return n.emit("userUpdated",e)})),this._services.users.on("userUnsubscribed",(function(e){n.emit("userUnsubscribed",e)})),this._conversationsEntity=new We(this._configuration,this._services),this._conversationsEntity.on("conversationAdded",(function(e){n.emit("conversationAdded",e)})),this._conversationsEntity.on("conversationRemoved",(function(e){n.emit("conversationRemoved",e)})),this._conversationsEntity.on("conversationJoined",(function(e){n.emit("conversationJoined",e)})),this._conversationsEntity.on("conversationLeft",(function(e){n.emit("conversationLeft",e)})),this._conversationsEntity.on("conversationUpdated",(function(e){return n.emit("conversationUpdated",e)})),this._conversationsEntity.on("participantJoined",(function(e){n.emit("participantJoined",e)})),this._conversationsEntity.on("participantLeft",(function(e){n.emit("participantLeft",e)})),this._conversationsEntity.on("participantUpdated",(function(e){return n.emit("participantUpdated",e)})),this._conversationsEntity.on("messageAdded",(function(e){return n.emit("messageAdded",e)})),this._conversationsEntity.on("messageUpdated",(function(e){return n.emit("messageUpdated",e)})),this._conversationsEntity.on("messageRemoved",(function(e){return n.emit("messageRemoved",e)})),this._conversationsEntity.on("typingStarted",(function(e){return n.emit("typingStarted",e)})),this._conversationsEntity.on("typingEnded",(function(e){return n.emit("typingEnded",e)})),this._conversationsPromise=this._conversationsEntity.fetchConversations().then((function(){return n._conversationsEntity})).catch((function(e){throw e})),e.next=28,this._services.users.myself._ensureFetched();case 28:Ze._supportedPushChannels.forEach((function(e){return n._subscribeToPushNotifications(e)})),this._services.typingIndicator.initialize(),this._services.mcsClient=new k.McsClient(this._fpaToken,this._configuration.links.mediaService,this._configuration.links.mediaSetService,rt(rt({},this._options),{},{transport:void 0})),this._resolveEnsureReady(),this.emit("stateChanged","initialized"),this.emit("initialized");case 34:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_subscribeToPushNotifications",value:function(e){var t=this;[ue.NEW_MESSAGE,ue.ADDED_TO_CONVERSATION,ue.REMOVED_FROM_CONVERSATION,ue.TYPING_INDICATOR,ue.CONSUMPTION_UPDATE].forEach((function(n){t._services.notificationClient.subscribe(e,n)}))}},{key:"_unsubscribeFromPushNotifications",value:function(e){var t=this;[ue.NEW_MESSAGE,ue.ADDED_TO_CONVERSATION,ue.REMOVED_FROM_CONVERSATION,ue.TYPING_INDICATOR,ue.CONSUMPTION_UPDATE].forEach((function(n){t._services.notificationClient.unsubscribe(e,n)}))}}],[{key:"create",value:(t=R.default(L.default.mark((function e(t,n){var r;return L.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n||!n.twilsockClient){e.next=2;break}throw new Error("Obsolete usage of ConversationsClient.create() factory method: if you pass twilsock from the outside then you must use ConversationsClient constructor and be prepared to work with uninitialized client.");case 2:return r=new Ze(t,n),e.next=5,r._ensureReady;case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"parsePushNotification",value:function(e){if(Ze._logger.debug("parsePushNotification, notificationPayload=",e),void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var t,n,r,i=Ze._parsePushNotificationChatData(e),a=e.aps,o=null;if("string"==typeof a.alert)t=a.alert||null;else t=(null===(n=a.alert)||void 0===n?void 0:n.body)||null,o=(null===(r=a.alert)||void 0===r?void 0:r.title)||null;return new Je({title:o,body:t,sound:a.sound||null,badge:a.badge||null,action:a.category||null,type:e.twi_message_type,data:i})}if(void 0!==e.data){var s=e.data;if(!s.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var u=Ze._parsePushNotificationChatData(e.data);return new Je({title:s.twi_title||null,body:s.twi_body||null,sound:s.twi_sound||null,badge:null,action:s.twi_action||null,type:s.twi_message_type,data:u})}throw new Error("Provided push notification payload is not Programmable Chat notification")}},{key:"_parsePushNotificationChatData",value:function(e){var t={};for(var n in Ze._supportedPushDataFields){var r=e[n];if(null!=r)if("message_index"!==n&&"media_count"!==n){if("media"!==n)t[Ze._supportedPushDataFields[n]]=r;else if("string"==typeof r)try{t[Ze._supportedPushDataFields[n]]=JSON.parse(r)}catch(a){Ze._logger.debug("Media message notification parsing error")}}else{var i=Q(r);null!==i&&(t[Ze._supportedPushDataFields[n]]=i)}}return t}},{key:"populateInitRegistrations",value:function(e){e.populateInitRegistrations([ue.TYPING_INDICATOR]),w.SyncClient.populateInitRegistrations(e)}}]),m}(h.ReplayEventEmitter),P.default(Xe,"conversationAdded","conversationAdded"),P.default(Xe,"conversationJoined","conversationJoined"),P.default(Xe,"conversationLeft","conversationLeft"),P.default(Xe,"conversationRemoved","conversationRemoved"),P.default(Xe,"conversationUpdated","conversationUpdated"),P.default(Xe,"participantJoined","participantJoined"),P.default(Xe,"participantLeft","participantLeft"),P.default(Xe,"participantUpdated","participantUpdated"),P.default(Xe,"messageAdded","messageAdded"),P.default(Xe,"messageRemoved","messageRemoved"),P.default(Xe,"messageUpdated","messageUpdated"),P.default(Xe,"tokenAboutToExpire","tokenAboutToExpire"),P.default(Xe,"tokenExpired","tokenExpired"),P.default(Xe,"typingEnded","typingEnded"),P.default(Xe,"typingStarted","typingStarted"),P.default(Xe,"pushNotification","pushNotification"),P.default(Xe,"userSubscribed","userSubscribed"),P.default(Xe,"userUnsubscribed","userUnsubscribed"),P.default(Xe,"userUpdated","userUpdated"),P.default(Xe,"stateChanged","stateChanged"),P.default(Xe,"initialized","initialized"),P.default(Xe,"initFailed","initFailed"),P.default(Xe,"connectionStateChanged","connectionStateChanged"),P.default(Xe,"connectionError","connectionError"),P.default(Xe,"version",Ke),P.default(Xe,"_logger",$.scope("Client")),P.default(Xe,"_supportedPushChannels",["fcm","apn"]),P.default(Xe,"_supportedPushDataFields",{conversation_sid:"conversationSid",conversation_title:"conversationTitle",message_sid:"messageSid",message_index:"messageIndex",media_count:"mediaCount",media:"media"}),Ze=Xe),q([_.deprecated("token"),z("design:type",String),z("design:paramtypes",[])],t.Client.prototype,"token",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],t.Client.prototype,"updateToken",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],t.Client.prototype,"getConversationBySid",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],t.Client.prototype,"peekConversationBySid",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],t.Client.prototype,"getConversationByUniqueName",null),q([p.validateTypesAsync(["undefined",p.objectSchema("conversation options",{friendlyName:["string","undefined"],isPrivate:["boolean","undefined"],uniqueName:["string","undefined"]})]),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],t.Client.prototype,"createConversation",null),q([p.validateTypesAsync(p.literal("fcm","apn"),"string"),z("design:type",Function),z("design:paramtypes",[String,String]),z("design:returntype",Promise)],t.Client.prototype,"setPushRegistrationId",null),q([p.validateTypesAsync(p.literal("fcm","apn")),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],t.Client.prototype,"unsetPushRegistrationId",null),q([p.validateTypesAsync(p.literal("fcm","apn"),p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String,String]),z("design:returntype",Promise)],t.Client.prototype,"removePushRegistrations",null),q([p.validateTypesAsync(p.pureObject),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Promise)],t.Client.prototype,"handlePushNotification",null),q([p.validateTypesAsync(p.nonEmptyString),z("design:type",Function),z("design:paramtypes",[String]),z("design:returntype",Promise)],t.Client.prototype,"getUser",null),q([p.validateTypesAsync(p.nonEmptyArray("strings","string")),z("design:type",Function),z("design:paramtypes",[Array]),z("design:returntype",k.CancellablePromise)],t.Client.prototype,"getTemporaryContentUrlsForMediaSids",null),q([p.validateTypesAsync(p.nonEmptyArray("media",ve)),z("design:type",Function),z("design:paramtypes",[Array]),z("design:returntype",k.CancellablePromise)],t.Client.prototype,"getTemporaryContentUrlsForMedia",null),q([_.deprecated("Client.create()","new Client()"),p.validateTypesAsync("string",["undefined",p.pureObject]),z("design:type",Function),z("design:paramtypes",[String,Object]),z("design:returntype",Promise)],t.Client,"create",null),q([p.validateTypes(p.pureObject),z("design:type",Function),z("design:paramtypes",[Object]),z("design:returntype",Je)],t.Client,"parsePushNotification",null),t.Client=Ze=q([p.validateConstructorTypes(p.nonEmptyString,[p.pureObject,"undefined"]),z("design:paramtypes",[String,Object])],t.Client),Object.defineProperty(t,"CancellablePromise",{enumerable:!0,get:function(){return k.CancellablePromise}}),t.AggregatedDeliveryReceipt=ye,t.Conversation=Le,t.DetailedDeliveryReceipt=ge,t.Media=ve,t.Message=_e,t.MessageBuilder=Oe,t.NotificationTypes=ue,t.Participant=fe,t.PushNotification=Je,t.RestPaginator=me,t.UnsentMessage=Ce,t.User=ie}(o),t("b",n({__proto__:null,default:a(o)},[o]))}}}))}();
//# sourceMappingURL=browser-legacy-DDIPNzmE.js.map
